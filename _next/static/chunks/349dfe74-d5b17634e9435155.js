"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[694],{3291:function(a,b,c){c.d(b,{Z:function(){return nQ}});var d,e,f,g,h=c(9477),i=c(7157),j=c(2854),k=c(140),l=c(3454),m=c(1876).Buffer,n=Object.create,o=Object.defineProperty,p=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyNames,r=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,t=(a,b)=>()=>(b||a((b={exports:{}}).exports,b),b.exports),u=(a,b)=>{for(var c in b)o(a,c,{get:b[c],enumerable:!0})},v=(a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let e of q(b))s.call(a,e)||e===c||o(a,e,{get:()=>b[e],enumerable:!(d=p(b,e))||d.enumerable});return a},w=(a,b,c)=>(c=null!=a?n(r(a)):{},v(!b&&a&&a.__esModule?c:o(c,"default",{value:a,enumerable:!0}),a)),x=t(a=>{var b,c,d,e,f,g,h,i,j,k,l,m,n,o;(b=function(){this.init()}).prototype={init:function(){var a=this||c;return a._counter=1e3,a._html5AudioPool=[],a.html5PoolSize=10,a._codecs={},a._howls=[],a._muted=!1,a._volume=1,a._canPlayEvent="canplaythrough",a._navigator="u">typeof window&&window.navigator?window.navigator:null,a.masterGain=null,a.noAudio=!1,a.usingWebAudio=!0,a.autoSuspend=!0,a.ctx=null,a.autoUnlock=!0,a._setup(),a},volume:function(a){var b=this||c;if(a=parseFloat(a),b.ctx||k(),"u">typeof a&&a>=0&&a<=1){if(b._volume=a,b._muted)return b;b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a,c.ctx.currentTime);for(var d=0;d<b._howls.length;d++)if(!b._howls[d]._webAudio)for(var e=b._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=b._howls[d]._soundById(e[f]);g&&g._node&&(g._node.volume=g._volume*a)}return b}return b._volume},mute:function(a){var b=this||c;b.ctx||k(),b._muted=a,b.usingWebAudio&&b.masterGain.gain.setValueAtTime(a?0:b._volume,c.ctx.currentTime);for(var d=0;d<b._howls.length;d++)if(!b._howls[d]._webAudio)for(var e=b._howls[d]._getSoundIds(),f=0;f<e.length;f++){var g=b._howls[d]._soundById(e[f]);g&&g._node&&(g._node.muted=!!a||g._muted)}return b},stop:function(){for(var a=this||c,b=0;b<a._howls.length;b++)a._howls[b].stop();return a},unload:function(){for(var a=this||c,b=a._howls.length-1;b>=0;b--)a._howls[b].unload();return a.usingWebAudio&&a.ctx&&"u">typeof a.ctx.close&&(a.ctx.close(),a.ctx=null,k()),a},codecs:function(a){return(this||c)._codecs[a.replace(/^x-/,"")]},_setup:function(){var a=this||c;if(a.state=a.ctx&&a.ctx.state||"suspended",a._autoSuspend(),!a.usingWebAudio){if("u">typeof Audio)try{var b=new Audio;typeof b.oncanplaythrough>"u"&&(a._canPlayEvent="canplay")}catch{a.noAudio=!0}else a.noAudio=!0}try{var b=new Audio;b.muted&&(a.noAudio=!0)}catch{}return a.noAudio||a._setupCodecs(),a},_setupCodecs:function(){var a=this||c,b=null;try{b="u">typeof Audio?new Audio:null}catch{return a}if(!b||"function"!=typeof b.canPlayType)return a;var d=b.canPlayType("audio/mpeg;").replace(/^no$/,""),e=a._navigator?a._navigator.userAgent:"",f=e.match(/OPR\/([0-6].)/g),g=f&&33>parseInt(f[0].split("/")[1],10),h=-1!==e.indexOf("Safari")&& -1===e.indexOf("Chrome"),i=e.match(/Version\/(.*?) /),j=h&&i&&15>parseInt(i[1],10);return a._codecs={mp3:!!(!g&&(d||b.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!b.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!b.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(b.canPlayType('audio/wav; codecs="1"')||b.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!b.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!b.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/m4a;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(b.canPlayType("audio/x-m4b;")||b.canPlayType("audio/m4b;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(b.canPlayType("audio/x-mp4;")||b.canPlayType("audio/mp4;")||b.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!j&&b.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!j&&b.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!b.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(b.canPlayType("audio/x-flac;")||b.canPlayType("audio/flac;")).replace(/^no$/,"")},a},_unlockAudio:function(){var a=this||c;if(!(a._audioUnlocked||!a.ctx)){a._audioUnlocked=!1,a.autoUnlock=!1,a._mobileUnloaded||44100===a.ctx.sampleRate||(a._mobileUnloaded=!0,a.unload()),a._scratchBuffer=a.ctx.createBuffer(1,1,22050);var b=function(c){for(;a._html5AudioPool.length<a.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,a._releaseHtml5Audio(d)}catch{a.noAudio=!0;break}for(var e=0;e<a._howls.length;e++)if(!a._howls[e]._webAudio)for(var f=a._howls[e]._getSoundIds(),g=0;g<f.length;g++){var h=a._howls[e]._soundById(f[g]);h&&h._node&&!h._node._unlocked&&(h._node._unlocked=!0,h._node.load())}a._autoResume();var i=a.ctx.createBufferSource();i.buffer=a._scratchBuffer,i.connect(a.ctx.destination),typeof i.start>"u"?i.noteOn(0):i.start(0),"function"==typeof a.ctx.resume&&a.ctx.resume(),i.onended=function(){i.disconnect(0),a._audioUnlocked=!0,document.removeEventListener("touchstart",b,!0),document.removeEventListener("touchend",b,!0),document.removeEventListener("click",b,!0),document.removeEventListener("keydown",b,!0);for(var c=0;c<a._howls.length;c++)a._howls[c]._emit("unlock")}};return document.addEventListener("touchstart",b,!0),document.addEventListener("touchend",b,!0),document.addEventListener("click",b,!0),document.addEventListener("keydown",b,!0),a}},_obtainHtml5Audio:function(){var a=this||c;if(a._html5AudioPool.length)return a._html5AudioPool.pop();var b=new Audio().play();return b&&"u">typeof Promise&&(b instanceof Promise||"function"==typeof b.then)&&b.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(a){var b=this||c;return a._unlocked&&b._html5AudioPool.push(a),b},_autoSuspend:function(){var a=this;if(!(!a.autoSuspend||!a.ctx|| typeof a.ctx.suspend>"u"||!c.usingWebAudio)){for(var b=0;b<a._howls.length;b++)if(a._howls[b]._webAudio){for(var d=0;d<a._howls[b]._sounds.length;d++)if(!a._howls[b]._sounds[d]._paused)return a}return a._suspendTimer&&clearTimeout(a._suspendTimer),a._suspendTimer=setTimeout(function(){if(a.autoSuspend){a._suspendTimer=null,a.state="suspending";var b=function(){a.state="suspended",a._resumeAfterSuspend&&(delete a._resumeAfterSuspend,a._autoResume())};a.ctx.suspend().then(b,b)}},3e4),a}},_autoResume:function(){var a=this;if(!(!a.ctx|| typeof a.ctx.resume>"u"||!c.usingWebAudio))return"running"===a.state&&"interrupted"!==a.ctx.state&&a._suspendTimer?(clearTimeout(a._suspendTimer),a._suspendTimer=null):"suspended"===a.state||"running"===a.state&&"interrupted"===a.ctx.state?(a.ctx.resume().then(function(){a.state="running";for(var b=0;b<a._howls.length;b++)a._howls[b]._emit("resume")}),a._suspendTimer&&(clearTimeout(a._suspendTimer),a._suspendTimer=null)):"suspending"===a.state&&(a._resumeAfterSuspend=!0),a}},c=new b,(d=function(a){if(!a.src||0===a.src.length){console.error("An array of source files must be passed with any new Howl.");return}this.init(a)}).prototype={init:function(a){var b=this;return c.ctx||k(),b._autoplay=a.autoplay||!1,b._format="string"!=typeof a.format?a.format:[a.format],b._html5=a.html5||!1,b._muted=a.mute||!1,b._loop=a.loop||!1,b._pool=a.pool||5,b._preload="boolean"!=typeof a.preload&&"metadata"!==a.preload||a.preload,b._rate=a.rate||1,b._sprite=a.sprite||{},b._src="string"!=typeof a.src?a.src:[a.src],b._volume=void 0!==a.volume?a.volume:1,b._xhr={method:a.xhr&&a.xhr.method?a.xhr.method:"GET",headers:a.xhr&&a.xhr.headers?a.xhr.headers:null,withCredentials:!!a.xhr&&!!a.xhr.withCredentials&&a.xhr.withCredentials},b._duration=0,b._state="unloaded",b._sounds=[],b._endTimers={},b._queue=[],b._playLock=!1,b._onend=a.onend?[{fn:a.onend}]:[],b._onfade=a.onfade?[{fn:a.onfade}]:[],b._onload=a.onload?[{fn:a.onload}]:[],b._onloaderror=a.onloaderror?[{fn:a.onloaderror}]:[],b._onplayerror=a.onplayerror?[{fn:a.onplayerror}]:[],b._onpause=a.onpause?[{fn:a.onpause}]:[],b._onplay=a.onplay?[{fn:a.onplay}]:[],b._onstop=a.onstop?[{fn:a.onstop}]:[],b._onmute=a.onmute?[{fn:a.onmute}]:[],b._onvolume=a.onvolume?[{fn:a.onvolume}]:[],b._onrate=a.onrate?[{fn:a.onrate}]:[],b._onseek=a.onseek?[{fn:a.onseek}]:[],b._onunlock=a.onunlock?[{fn:a.onunlock}]:[],b._onresume=[],b._webAudio=c.usingWebAudio&&!b._html5,"u">typeof c.ctx&&c.ctx&&c.autoUnlock&&c._unlockAudio(),c._howls.push(b),b._autoplay&&b._queue.push({event:"play",action:function(){b.play()}}),b._preload&&"none"!==b._preload&&b.load(),b},load:function(){var a,b,d=this,f=null;if(c.noAudio){d._emit("loaderror",null,"No audio support.");return}"string"==typeof d._src&&(d._src=[d._src]);for(var h=0;h<d._src.length;h++){if(d._format&&d._format[h])a=d._format[h];else{if("string"!=typeof(b=d._src[h])){d._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(a=/^data:audio\/([^;,]+);/i.exec(b))||(a=/\.([^.]+)$/.exec(b.split("?",1)[0])),a&&(a=a[1].toLowerCase())}if(a||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),a&&c.codecs(a)){f=d._src[h];break}}if(!f){d._emit("loaderror",null,"No codec support for selected audio sources.");return}return d._src=f,d._state="loading","https:"===window.location.protocol&&"http:"===f.slice(0,5)&&(d._html5=!0,d._webAudio=!1),new e(d),d._webAudio&&g(d),d},play:function(a,b){var d=this,e=null;if("number"==typeof a)e=a,a=null;else{if("string"==typeof a&&"loaded"===d._state&&!d._sprite[a])return null;if(typeof a>"u"&&(a="__default",!d._playLock)){for(var f=0,g=0;g<d._sounds.length;g++)d._sounds[g]._paused&&!d._sounds[g]._ended&&(f++,e=d._sounds[g]._id);1===f?a=null:e=null}}var h=e?d._soundById(e):d._inactiveSound();if(!h)return null;if(e&&!a&&(a=h._sprite||"__default"),"loaded"!==d._state){h._sprite=a,h._ended=!1;var i=h._id;return d._queue.push({event:"play",action:function(){d.play(i)}}),i}if(e&&!h._paused)return b||d._loadQueue("play"),h._id;d._webAudio&&c._autoResume();var j=Math.max(0,h._seek>0?h._seek:d._sprite[a][0]/1e3),k=Math.max(0,(d._sprite[a][0]+d._sprite[a][1])/1e3-j),l=1e3*k/Math.abs(h._rate),m=d._sprite[a][0]/1e3,n=(d._sprite[a][0]+d._sprite[a][1])/1e3;h._sprite=a,h._ended=!1;var o=function(){h._paused=!1,h._seek=j,h._start=m,h._stop=n,h._loop=!!(h._loop||d._sprite[a][2])};if(j>=n){d._ended(h);return}var p=h._node;if(d._webAudio){var q=function(){d._playLock=!1,o(),d._refreshBuffer(h);var a=h._muted||d._muted?0:h._volume;p.gain.setValueAtTime(a,c.ctx.currentTime),h._playStart=c.ctx.currentTime,typeof p.bufferSource.start>"u"?h._loop?p.bufferSource.noteGrainOn(0,j,86400):p.bufferSource.noteGrainOn(0,j,k):h._loop?p.bufferSource.start(0,j,86400):p.bufferSource.start(0,j,k),l!==1/0&&(d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),l)),b||setTimeout(function(){d._emit("play",h._id),d._loadQueue()},0)};"running"===c.state&&"interrupted"!==c.ctx.state?q():(d._playLock=!0,d.once("resume",q),d._clearTimer(h._id))}else{var r=function(){p.currentTime=j,p.muted=h._muted||d._muted||c._muted||p.muted,p.volume=h._volume*c.volume(),p.playbackRate=h._rate;try{var e=p.play();if(e&&"u">typeof Promise&&(e instanceof Promise||"function"==typeof e.then)?(d._playLock=!0,o(),e.then(function(){d._playLock=!1,p._unlocked=!0,b?d._loadQueue():d._emit("play",h._id)}).catch(function(){d._playLock=!1,d._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),h._ended=!0,h._paused=!0})):b||(d._playLock=!1,o(),d._emit("play",h._id)),p.playbackRate=h._rate,p.paused){d._emit("playerror",h._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}"__default"!==a||h._loop?d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),l):(d._endTimers[h._id]=function(){d._ended(h),p.removeEventListener("ended",d._endTimers[h._id],!1)},p.addEventListener("ended",d._endTimers[h._id],!1))}catch(f){d._emit("playerror",h._id,f)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===p.src&&(p.src=d._src,p.load());var s=window&&window.ejecta|| !p.readyState&&c._navigator.isCocoonJS;if(p.readyState>=3||s)r();else{d._playLock=!0,d._state="loading";var t=function(){d._state="loaded",r(),p.removeEventListener(c._canPlayEvent,t,!1)};p.addEventListener(c._canPlayEvent,t,!1),d._clearTimer(h._id)}}return h._id},pause:function(a){var b=this;if("loaded"!==b._state||b._playLock)return b._queue.push({event:"pause",action:function(){b.pause(a)}}),b;for(var c=b._getSoundIds(a),d=0;d<c.length;d++){b._clearTimer(c[d]);var e=b._soundById(c[d]);if(e&&!e._paused&&(e._seek=b.seek(c[d]),e._rateSeek=0,e._paused=!0,b._stopFade(c[d]),e._node)){if(b._webAudio){if(!e._node.bufferSource)continue;typeof e._node.bufferSource.stop>"u"?e._node.bufferSource.noteOff(0):e._node.bufferSource.stop(0),b._cleanBuffer(e._node)}else isNaN(e._node.duration)&&e._node.duration!==1/0||e._node.pause()}arguments[1]||b._emit("pause",e?e._id:null)}return b},stop:function(a,b){var c=this;if("loaded"!==c._state||c._playLock)return c._queue.push({event:"stop",action:function(){c.stop(a)}}),c;for(var d=c._getSoundIds(a),e=0;e<d.length;e++){c._clearTimer(d[e]);var f=c._soundById(d[e]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,c._stopFade(d[e]),f._node&&(c._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),c._cleanBuffer(f._node)):isNaN(f._node.duration)&&f._node.duration!==1/0||(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&c._clearSound(f._node))),b||c._emit("stop",f._id))}return c},mute:function(a,b){var d=this;if("loaded"!==d._state||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(a,b)}}),d;if(typeof b>"u"){if("boolean"!=typeof a)return d._muted;d._muted=a}for(var e=d._getSoundIds(b),f=0;f<e.length;f++){var g=d._soundById(e[f]);g&&(g._muted=a,g._interval&&d._stopFade(g._id),d._webAudio&&g._node?g._node.gain.setValueAtTime(a?0:g._volume,c.ctx.currentTime):g._node&&(g._node.muted=!!c._muted||a),d._emit("mute",g._id))}return d},volume:function(){var a,b,d,e=this,f=arguments;if(0===f.length)return e._volume;if(1===f.length||2===f.length&& typeof f[1]>"u"?e._getSoundIds().indexOf(f[0])>=0?d=parseInt(f[0],10):b=parseFloat(f[0]):f.length>=2&&(b=parseFloat(f[0]),d=parseInt(f[1],10)),!("u">typeof b)||!(b>=0)||!(b<=1))return(a=d?e._soundById(d):e._sounds[0])?a._volume:0;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,f)}}),e;typeof d>"u"&&(e._volume=b),d=e._getSoundIds(d);for(var g=0;g<d.length;g++)(a=e._soundById(d[g]))&&(a._volume=b,f[2]||e._stopFade(d[g]),e._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(b,c.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=b*c.volume()),e._emit("volume",a._id));return e},fade:function(a,b,d,e){var f=this;if("loaded"!==f._state||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(a,b,d,e)}}),f;a=Math.min(Math.max(0,parseFloat(a)),1),b=Math.min(Math.max(0,parseFloat(b)),1),d=parseFloat(d),f.volume(a,e);for(var g=f._getSoundIds(e),h=0;h<g.length;h++){var i=f._soundById(g[h]);if(i){if(e||f._stopFade(g[h]),f._webAudio&&!i._muted){var j=c.ctx.currentTime,k=j+d/1e3;i._volume=a,i._node.gain.setValueAtTime(a,j),i._node.gain.linearRampToValueAtTime(b,k)}f._startFadeInterval(i,a,b,d,g[h],typeof e>"u")}}return f},_startFadeInterval:function(a,b,c,d,e,f){var g=this,h=b,i=c-b,j=Math.abs(i/.01),k=Math.max(4,j>0?d/j:d),l=Date.now();a._fadeTo=c,a._interval=setInterval(function(){var e=(Date.now()-l)/d;l=Date.now(),h+=i*e,h=Math.round(100*h)/100,h=i<0?Math.max(c,h):Math.min(c,h),g._webAudio?a._volume=h:g.volume(h,a._id,!0),f&&(g._volume=h),(c<b&&h<=c||c>b&&h>=c)&&(clearInterval(a._interval),a._interval=null,a._fadeTo=null,g.volume(c,a._id),g._emit("fade",a._id))},k)},_stopFade:function(a){var b=this._soundById(a);return b&&b._interval&&(this._webAudio&&b._node.gain.cancelScheduledValues(c.ctx.currentTime),clearInterval(b._interval),b._interval=null,this.volume(b._fadeTo,a),b._fadeTo=null,this._emit("fade",a)),this},loop:function(){var a,b,c,d=this,e=arguments;if(0===e.length)return d._loop;if(1===e.length){if("boolean"!=typeof e[0])return!!(c=d._soundById(parseInt(e[0],10)))&&c._loop;a=e[0],d._loop=a}else 2===e.length&&(a=e[0],b=parseInt(e[1],10));for(var f=d._getSoundIds(b),g=0;g<f.length;g++)(c=d._soundById(f[g]))&&(c._loop=a,d._webAudio&&c._node&&c._node.bufferSource&&(c._node.bufferSource.loop=a,a&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop,d.playing(f[g])&&(d.pause(f[g],!0),d.play(f[g],!0)))));return d},rate:function(){var a,b,d,e=this,f=arguments;if(0===f.length?d=e._sounds[0]._id:1===f.length?e._getSoundIds().indexOf(f[0])>=0?d=parseInt(f[0],10):b=parseFloat(f[0]):2===f.length&&(b=parseFloat(f[0]),d=parseInt(f[1],10)),"number"!=typeof b)return(a=e._soundById(d))?a._rate:e._rate;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,f)}}),e;typeof d>"u"&&(e._rate=b),d=e._getSoundIds(d);for(var g=0;g<d.length;g++)if(a=e._soundById(d[g])){e.playing(d[g])&&(a._rateSeek=e.seek(d[g]),a._playStart=e._webAudio?c.ctx.currentTime:a._playStart),a._rate=b,e._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.setValueAtTime(b,c.ctx.currentTime):a._node&&(a._node.playbackRate=b);var h=e.seek(d[g]),i=(e._sprite[a._sprite][0]+e._sprite[a._sprite][1])/1e3-h,j=1e3*i/Math.abs(a._rate);(e._endTimers[d[g]]||!a._paused)&&(e._clearTimer(d[g]),e._endTimers[d[g]]=setTimeout(e._ended.bind(e,a),j)),e._emit("rate",a._id)}return e},seek:function(){var a,b,d=this,e=arguments;if(0===e.length?d._sounds.length&&(b=d._sounds[0]._id):1===e.length?d._getSoundIds().indexOf(e[0])>=0?b=parseInt(e[0],10):d._sounds.length&&(b=d._sounds[0]._id,a=parseFloat(e[0])):2===e.length&&(a=parseFloat(e[0]),b=parseInt(e[1],10)),typeof b>"u")return 0;if("number"==typeof a&&("loaded"!==d._state||d._playLock))return d._queue.push({event:"seek",action:function(){d.seek.apply(d,e)}}),d;var f=d._soundById(b);if(f){if("number"==typeof a&&a>=0){var g=d.playing(b);g&&d.pause(b,!0),f._seek=a,f._ended=!1,d._clearTimer(b),d._webAudio||!f._node||isNaN(f._node.duration)||(f._node.currentTime=a);var h=function(){g&&d.play(b,!0),d._emit("seek",b)};if(g&&!d._webAudio){var i=function(){d._playLock?setTimeout(i,0):h()};setTimeout(i,0)}else h()}else{if(!d._webAudio)return f._node.currentTime;var j=d.playing(b)?c.ctx.currentTime-f._playStart:0,k=f._rateSeek?f._rateSeek-f._seek:0;return f._seek+(k+j*Math.abs(f._rate))}}return d},playing:function(a){if("number"==typeof a){var b=this._soundById(a);return!!b&&!b._paused}for(var c=0;c<this._sounds.length;c++)if(!this._sounds[c]._paused)return!0;return!1},duration:function(a){var b=this,c=b._duration,d=b._soundById(a);return d&&(c=b._sprite[d._sprite][1]/1e3),c},state:function(){return this._state},unload:function(){for(var a=this,b=a._sounds,d=0;d<b.length;d++)b[d]._paused||a.stop(b[d]._id),a._webAudio||(a._clearSound(b[d]._node),b[d]._node.removeEventListener("error",b[d]._errorFn,!1),b[d]._node.removeEventListener(c._canPlayEvent,b[d]._loadFn,!1),b[d]._node.removeEventListener("ended",b[d]._endFn,!1),c._releaseHtml5Audio(b[d]._node)),delete b[d]._node,a._clearTimer(b[d]._id);var e=c._howls.indexOf(a);e>=0&&c._howls.splice(e,1);var g=!0;for(d=0;d<c._howls.length;d++)if(c._howls[d]._src===a._src||a._src.indexOf(c._howls[d]._src)>=0){g=!1;break}return f&&g&&delete f[a._src],c.noAudio=!1,a._state="unloaded",a._sounds=[],a=null,null},on:function(a,b,c,d){var e=this["_on"+a];return"function"==typeof b&&e.push(d?{id:c,fn:b,once:d}:{id:c,fn:b}),this},off:function(a,b,c){var d=this,e=d["_on"+a],f=0;if("number"==typeof b&&(c=b,b=null),b||c)for(f=0;f<e.length;f++){var g=c===e[f].id;if(b===e[f].fn&&g|| !b&&g){e.splice(f,1);break}}else if(a)d["_on"+a]=[];else{var h=Object.keys(d);for(f=0;f<h.length;f++)0===h[f].indexOf("_on")&&Array.isArray(d[h[f]])&&(d[h[f]]=[])}return d},once:function(a,b,c){return this.on(a,b,c,1),this},_emit:function(a,b,c){for(var d=this,e=d["_on"+a],f=e.length-1;f>=0;f--)(!e[f].id||e[f].id===b||"load"===a)&&(setTimeout((function(a){a.call(this,b,c)}).bind(d,e[f].fn),0),e[f].once&&d.off(a,e[f].fn,e[f].id));return d._loadQueue(a),d},_loadQueue:function(a){if(this._queue.length>0){var b=this._queue[0];b.event===a&&(this._queue.shift(),this._loadQueue()),a||b.action()}return this},_ended:function(a){var b=this,d=a._sprite;if(!b._webAudio&&a._node&&!a._node.paused&&!a._node.ended&&a._node.currentTime<a._stop)return setTimeout(b._ended.bind(b,a),100),b;var e=!!(a._loop||b._sprite[d][2]);if(b._emit("end",a._id),!b._webAudio&&e&&b.stop(a._id,!0).play(a._id),b._webAudio&&e){b._emit("play",a._id),a._seek=a._start||0,a._rateSeek=0,a._playStart=c.ctx.currentTime;var f=(a._stop-a._start)*1e3/Math.abs(a._rate);b._endTimers[a._id]=setTimeout(b._ended.bind(b,a),f)}return b._webAudio&&!e&&(a._paused=!0,a._ended=!0,a._seek=a._start||0,a._rateSeek=0,b._clearTimer(a._id),b._cleanBuffer(a._node),c._autoSuspend()),b._webAudio||e||b.stop(a._id,!0),b},_clearTimer:function(a){if(this._endTimers[a]){if("function"!=typeof this._endTimers[a])clearTimeout(this._endTimers[a]);else{var b=this._soundById(a);b&&b._node&&b._node.removeEventListener("ended",this._endTimers[a],!1)}delete this._endTimers[a]}return this},_soundById:function(a){for(var b=0;b<this._sounds.length;b++)if(a===this._sounds[b]._id)return this._sounds[b];return null},_inactiveSound:function(){this._drain();for(var a=0;a<this._sounds.length;a++)if(this._sounds[a]._ended)return this._sounds[a].reset();return new e(this)},_drain:function(){var a=this._pool,b=0,c=0;if(!(this._sounds.length<a)){for(c=0;c<this._sounds.length;c++)this._sounds[c]._ended&&b++;for(c=this._sounds.length-1;c>=0;c--){if(b<=a)return;this._sounds[c]._ended&&(this._webAudio&&this._sounds[c]._node&&this._sounds[c]._node.disconnect(0),this._sounds.splice(c,1),b--)}}},_getSoundIds:function(a){if(!(typeof a>"u"))return[a];for(var b=[],c=0;c<this._sounds.length;c++)b.push(this._sounds[c]._id);return b},_refreshBuffer:function(a){return a._node.bufferSource=c.ctx.createBufferSource(),a._node.bufferSource.buffer=f[this._src],a._panner?a._node.bufferSource.connect(a._panner):a._node.bufferSource.connect(a._node),a._node.bufferSource.loop=a._loop,a._loop&&(a._node.bufferSource.loopStart=a._start||0,a._node.bufferSource.loopEnd=a._stop||0),a._node.bufferSource.playbackRate.setValueAtTime(a._rate,c.ctx.currentTime),this},_cleanBuffer:function(a){var b=c._navigator&&c._navigator.vendor.indexOf("Apple")>=0;if(c._scratchBuffer&&a.bufferSource&&(a.bufferSource.onended=null,a.bufferSource.disconnect(0),b))try{a.bufferSource.buffer=c._scratchBuffer}catch{}return a.bufferSource=null,this},_clearSound:function(a){/MSIE |Trident\//.test(c._navigator&&c._navigator.userAgent)||(a.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}},(e=function(a){this._parent=a,this.init()}).prototype={init:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._rate=b._rate,a._seek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++c._counter,b._sounds.push(a),a.create(),a},create:function(){var a=this,b=a._parent,d=c._muted||a._muted||a._parent._muted?0:a._volume;return b._webAudio?(a._node=typeof c.ctx.createGain>"u"?c.ctx.createGainNode():c.ctx.createGain(),a._node.gain.setValueAtTime(d,c.ctx.currentTime),a._node.paused=!0,a._node.connect(c.masterGain)):c.noAudio||(a._node=c._obtainHtml5Audio(),a._errorFn=a._errorListener.bind(a),a._node.addEventListener("error",a._errorFn,!1),a._loadFn=a._loadListener.bind(a),a._node.addEventListener(c._canPlayEvent,a._loadFn,!1),a._endFn=a._endListener.bind(a),a._node.addEventListener("ended",a._endFn,!1),a._node.src=b._src,a._node.preload=!0===b._preload?"auto":b._preload,a._node.volume=d*c.volume(),a._node.load()),a},reset:function(){var a=this,b=a._parent;return a._muted=b._muted,a._loop=b._loop,a._volume=b._volume,a._rate=b._rate,a._seek=0,a._rateSeek=0,a._paused=!0,a._ended=!0,a._sprite="__default",a._id=++c._counter,a},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var a=this._parent;a._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1e3*a._duration]}),"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue()),this._node.removeEventListener(c._canPlayEvent,this._loadFn,!1)},_endListener:function(){var a=this._parent;a._duration===1/0&&(a._duration=Math.ceil(10*this._node.duration)/10,a._sprite.__default[1]===1/0&&(a._sprite.__default[1]=1e3*a._duration),a._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}},f={},g=function(a){var b=a._src;if(f[b]){a._duration=f[b].duration,j(a);return}if(/^data:[^;]+;base64,/.test(b)){for(var c=atob(b.split(",")[1]),d=new Uint8Array(c.length),e=0;e<c.length;++e)d[e]=c.charCodeAt(e);i(d.buffer,a)}else{var g=new XMLHttpRequest;g.open(a._xhr.method,b,!0),g.withCredentials=a._xhr.withCredentials,g.responseType="arraybuffer",a._xhr.headers&&Object.keys(a._xhr.headers).forEach(function(b){g.setRequestHeader(b,a._xhr.headers[b])}),g.onload=function(){var b=(g.status+"")[0];if("0"!==b&&"2"!==b&&"3"!==b){a._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}i(g.response,a)},g.onerror=function(){a._webAudio&&(a._html5=!0,a._webAudio=!1,a._sounds=[],delete f[b],a.load())},h(g)}},h=function(a){try{a.send()}catch{a.onerror()}},i=function(a,b){var d=function(){b._emit("loaderror",null,"Decoding audio data failed.")},e=function(a){a&&b._sounds.length>0?(f[b._src]=a,j(b,a)):d()};"u">typeof Promise&&1===c.ctx.decodeAudioData.length?c.ctx.decodeAudioData(a).then(e).catch(d):c.ctx.decodeAudioData(a,e,d)},j=function(a,b){b&&!a._duration&&(a._duration=b.duration),0===Object.keys(a._sprite).length&&(a._sprite={__default:[0,1e3*a._duration]}),"loaded"!==a._state&&(a._state="loaded",a._emit("load"),a._loadQueue())},k=function(){if(c.usingWebAudio){try{"u">typeof AudioContext?c.ctx=new AudioContext:"u">typeof webkitAudioContext?c.ctx=new webkitAudioContext:c.usingWebAudio=!1}catch{c.usingWebAudio=!1}c.ctx||(c.usingWebAudio=!1);var a=/iP(hone|od|ad)/.test(c._navigator&&c._navigator.platform),b=c._navigator&&c._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=b?parseInt(b[1],10):null;if(a&&d&&d<9){var e=/safari/.test(c._navigator&&c._navigator.userAgent.toLowerCase());c._navigator&&!e&&(c.usingWebAudio=!1)}c.usingWebAudio&&(c.masterGain=typeof c.ctx.createGain>"u"?c.ctx.createGainNode():c.ctx.createGain(),c.masterGain.gain.setValueAtTime(c._muted?0:c._volume,c.ctx.currentTime),c.masterGain.connect(c.ctx.destination)),c._setup()}},"function"==typeof define&&define.amd&&define([],function(){return{Howler:c,Howl:d}}),"u">typeof a&&(a.Howler=c,a.Howl=d),"u">typeof global?(global.HowlerGlobal=b,global.Howler=c,global.Howl=d,global.Sound=e):"u">typeof window&&(window.HowlerGlobal=b,window.Howler=c,window.Howl=d,window.Sound=e),HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(a){var b=this;if(!b.ctx||!b.ctx.listener)return b;for(var c=b._howls.length-1;c>=0;c--)b._howls[c].stereo(a);return b},HowlerGlobal.prototype.pos=function(a,b,c){var d=this;return d.ctx&&d.ctx.listener?(b="number"!=typeof b?d._pos[1]:b,c="number"!=typeof c?d._pos[2]:c,"number"!=typeof a)?d._pos:(d._pos=[a,b,c],"u">typeof d.ctx.listener.positionX?(d.ctx.listener.positionX.setTargetAtTime(d._pos[0],Howler.ctx.currentTime,.1),d.ctx.listener.positionY.setTargetAtTime(d._pos[1],Howler.ctx.currentTime,.1),d.ctx.listener.positionZ.setTargetAtTime(d._pos[2],Howler.ctx.currentTime,.1)):d.ctx.listener.setPosition(d._pos[0],d._pos[1],d._pos[2]),d):d},HowlerGlobal.prototype.orientation=function(a,b,c,d,e,f){var g=this;if(!g.ctx||!g.ctx.listener)return g;var h=g._orientation;return(b="number"!=typeof b?h[1]:b,c="number"!=typeof c?h[2]:c,d="number"!=typeof d?h[3]:d,e="number"!=typeof e?h[4]:e,f="number"!=typeof f?h[5]:f,"number"!=typeof a)?h:(g._orientation=[a,b,c,d,e,f],"u">typeof g.ctx.listener.forwardX?(g.ctx.listener.forwardX.setTargetAtTime(a,Howler.ctx.currentTime,.1),g.ctx.listener.forwardY.setTargetAtTime(b,Howler.ctx.currentTime,.1),g.ctx.listener.forwardZ.setTargetAtTime(c,Howler.ctx.currentTime,.1),g.ctx.listener.upX.setTargetAtTime(d,Howler.ctx.currentTime,.1),g.ctx.listener.upY.setTargetAtTime(e,Howler.ctx.currentTime,.1),g.ctx.listener.upZ.setTargetAtTime(f,Howler.ctx.currentTime,.1)):g.ctx.listener.setOrientation(a,b,c,d,e,f),g)},Howl.prototype.init=(l=Howl.prototype.init,function(a){var b=this;return b._orientation=a.orientation||[1,0,0],b._stereo=a.stereo||null,b._pos=a.pos||null,b._pannerAttr={coneInnerAngle:"u">typeof a.coneInnerAngle?a.coneInnerAngle:360,coneOuterAngle:"u">typeof a.coneOuterAngle?a.coneOuterAngle:360,coneOuterGain:"u">typeof a.coneOuterGain?a.coneOuterGain:0,distanceModel:"u">typeof a.distanceModel?a.distanceModel:"inverse",maxDistance:"u">typeof a.maxDistance?a.maxDistance:1e4,panningModel:"u">typeof a.panningModel?a.panningModel:"HRTF",refDistance:"u">typeof a.refDistance?a.refDistance:1,rolloffFactor:"u">typeof a.rolloffFactor?a.rolloffFactor:1},b._onstereo=a.onstereo?[{fn:a.onstereo}]:[],b._onpos=a.onpos?[{fn:a.onpos}]:[],b._onorientation=a.onorientation?[{fn:a.onorientation}]:[],l.call(this,a)}),Howl.prototype.stereo=function(a,b){var c=this;if(!c._webAudio)return c;if("loaded"!==c._state)return c._queue.push({event:"stereo",action:function(){c.stereo(a,b)}}),c;var d=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof b>"u"){if("number"!=typeof a)return c._stereo;c._stereo=a,c._pos=[a,0,0]}for(var e=c._getSoundIds(b),f=0;f<e.length;f++){var g=c._soundById(e[f]);if(g){if("number"!=typeof a)return g._stereo;g._stereo=a,g._pos=[a,0,0],g._node&&(g._pannerAttr.panningModel="equalpower",g._panner&&g._panner.pan||o(g,d),"spatial"===d?"u">typeof g._panner.positionX?(g._panner.positionX.setValueAtTime(a,Howler.ctx.currentTime),g._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),g._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):g._panner.setPosition(a,0,0):g._panner.pan.setValueAtTime(a,Howler.ctx.currentTime)),c._emit("stereo",g._id)}}return c},Howl.prototype.pos=function(a,b,c,d){var e=this;if(!e._webAudio)return e;if("loaded"!==e._state)return e._queue.push({event:"pos",action:function(){e.pos(a,b,c,d)}}),e;if(b="number"!=typeof b?0:b,c="number"!=typeof c?-.5:c,typeof d>"u"){if("number"!=typeof a)return e._pos;e._pos=[a,b,c]}for(var f=e._getSoundIds(d),g=0;g<f.length;g++){var h=e._soundById(f[g]);if(h){if("number"!=typeof a)return h._pos;h._pos=[a,b,c],h._node&&((!h._panner||h._panner.pan)&&o(h,"spatial"),"u">typeof h._panner.positionX?(h._panner.positionX.setValueAtTime(a,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(b,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(c,Howler.ctx.currentTime)):h._panner.setPosition(a,b,c)),e._emit("pos",h._id)}}return e},Howl.prototype.orientation=function(a,b,c,d){var e=this;if(!e._webAudio)return e;if("loaded"!==e._state)return e._queue.push({event:"orientation",action:function(){e.orientation(a,b,c,d)}}),e;if(b="number"!=typeof b?e._orientation[1]:b,c="number"!=typeof c?e._orientation[2]:c,typeof d>"u"){if("number"!=typeof a)return e._orientation;e._orientation=[a,b,c]}for(var f=e._getSoundIds(d),g=0;g<f.length;g++){var h=e._soundById(f[g]);if(h){if("number"!=typeof a)return h._orientation;h._orientation=[a,b,c],h._node&&(h._panner||(h._pos||(h._pos=e._pos||[0,0,-.5]),o(h,"spatial")),"u">typeof h._panner.orientationX?(h._panner.orientationX.setValueAtTime(a,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(b,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(c,Howler.ctx.currentTime)):h._panner.setOrientation(a,b,c)),e._emit("orientation",h._id)}}return e},Howl.prototype.pannerAttr=function(){var a,b,c,d=this,e=arguments;if(!d._webAudio)return d;if(0===e.length)return d._pannerAttr;if(1===e.length){if("object"!=typeof e[0])return(c=d._soundById(parseInt(e[0],10)))?c._pannerAttr:d._pannerAttr;a=e[0],typeof b>"u"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),d._pannerAttr={coneInnerAngle:"u">typeof a.pannerAttr.coneInnerAngle?a.pannerAttr.coneInnerAngle:d._coneInnerAngle,coneOuterAngle:"u">typeof a.pannerAttr.coneOuterAngle?a.pannerAttr.coneOuterAngle:d._coneOuterAngle,coneOuterGain:"u">typeof a.pannerAttr.coneOuterGain?a.pannerAttr.coneOuterGain:d._coneOuterGain,distanceModel:"u">typeof a.pannerAttr.distanceModel?a.pannerAttr.distanceModel:d._distanceModel,maxDistance:"u">typeof a.pannerAttr.maxDistance?a.pannerAttr.maxDistance:d._maxDistance,refDistance:"u">typeof a.pannerAttr.refDistance?a.pannerAttr.refDistance:d._refDistance,rolloffFactor:"u">typeof a.pannerAttr.rolloffFactor?a.pannerAttr.rolloffFactor:d._rolloffFactor,panningModel:"u">typeof a.pannerAttr.panningModel?a.pannerAttr.panningModel:d._panningModel})}else 2===e.length&&(a=e[0],b=parseInt(e[1],10));for(var f=d._getSoundIds(b),g=0;g<f.length;g++)if(c=d._soundById(f[g])){var h=c._pannerAttr;h={coneInnerAngle:"u">typeof a.coneInnerAngle?a.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:"u">typeof a.coneOuterAngle?a.coneOuterAngle:h.coneOuterAngle,coneOuterGain:"u">typeof a.coneOuterGain?a.coneOuterGain:h.coneOuterGain,distanceModel:"u">typeof a.distanceModel?a.distanceModel:h.distanceModel,maxDistance:"u">typeof a.maxDistance?a.maxDistance:h.maxDistance,refDistance:"u">typeof a.refDistance?a.refDistance:h.refDistance,rolloffFactor:"u">typeof a.rolloffFactor?a.rolloffFactor:h.rolloffFactor,panningModel:"u">typeof a.panningModel?a.panningModel:h.panningModel};var i=c._panner;i?(i.coneInnerAngle=h.coneInnerAngle,i.coneOuterAngle=h.coneOuterAngle,i.coneOuterGain=h.coneOuterGain,i.distanceModel=h.distanceModel,i.maxDistance=h.maxDistance,i.refDistance=h.refDistance,i.rolloffFactor=h.rolloffFactor,i.panningModel=h.panningModel):(c._pos||(c._pos=d._pos||[0,0,-.5]),o(c,"spatial"))}return d},Sound.prototype.init=(m=Sound.prototype.init,function(){var a=this,b=a._parent;a._orientation=b._orientation,a._stereo=b._stereo,a._pos=b._pos,a._pannerAttr=b._pannerAttr,m.call(this),a._stereo?b.stereo(a._stereo):a._pos&&b.pos(a._pos[0],a._pos[1],a._pos[2],a._id)}),Sound.prototype.reset=(n=Sound.prototype.reset,function(){var a=this,b=a._parent;return a._orientation=b._orientation,a._stereo=b._stereo,a._pos=b._pos,a._pannerAttr=b._pannerAttr,a._stereo?b.stereo(a._stereo):a._pos?b.pos(a._pos[0],a._pos[1],a._pos[2],a._id):a._panner&&(a._panner.disconnect(0),a._panner=void 0,b._refreshBuffer(a)),n.call(this)}),o=function(a,b){"spatial"===(b=b||"spatial")?(a._panner=Howler.ctx.createPanner(),a._panner.coneInnerAngle=a._pannerAttr.coneInnerAngle,a._panner.coneOuterAngle=a._pannerAttr.coneOuterAngle,a._panner.coneOuterGain=a._pannerAttr.coneOuterGain,a._panner.distanceModel=a._pannerAttr.distanceModel,a._panner.maxDistance=a._pannerAttr.maxDistance,a._panner.refDistance=a._pannerAttr.refDistance,a._panner.rolloffFactor=a._pannerAttr.rolloffFactor,a._panner.panningModel=a._pannerAttr.panningModel,"u">typeof a._panner.positionX?(a._panner.positionX.setValueAtTime(a._pos[0],Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(a._pos[1],Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(a._pos[2],Howler.ctx.currentTime)):a._panner.setPosition(a._pos[0],a._pos[1],a._pos[2]),"u">typeof a._panner.orientationX?(a._panner.orientationX.setValueAtTime(a._orientation[0],Howler.ctx.currentTime),a._panner.orientationY.setValueAtTime(a._orientation[1],Howler.ctx.currentTime),a._panner.orientationZ.setValueAtTime(a._orientation[2],Howler.ctx.currentTime)):a._panner.setOrientation(a._orientation[0],a._orientation[1],a._orientation[2])):(a._panner=Howler.ctx.createStereoPanner(),a._panner.pan.setValueAtTime(a._stereo,Howler.ctx.currentTime)),a._panner.connect(a._node),a._paused||a._parent.pause(a._id,!0).play(a._id,!0)}}),y=t((a,b)=>{!function(c,d){"object"==typeof a&&"u">typeof b?d(a):"function"==typeof define&&define.amd?define(["exports"],d):d((c="u">typeof globalThis?globalThis:c||self).SVDJS={})}(a,function(a){a.SVD=function(a,b,c,d,e){if(b=void 0===b||b,c=void 0===c||c,e=1e-64/(d=d||2220446049250313e-31),!a)throw TypeError("Matrix a is not defined");var f,g,h,i,j,k,l,m,n,o,p,q,r=a[0].length,s=a.length;if(s<r)throw TypeError("Invalid matrix: m < n");for(var t=[],u=[],v=[],w="f"===b?s:r,x=o=l=0;x<s;x++)u[x]=Array(w).fill(0);for(x=0;x<r;x++)v[x]=Array(r).fill(0);var y,z=Array(r).fill(0);for(x=0;x<s;x++)for(f=0;f<r;f++)u[x][f]=a[x][f];for(x=0;x<r;x++){for(t[x]=l,n=0,h=x+1,f=x;f<s;f++)n+=Math.pow(u[f][x],2);if(n<e)l=0;else for(m=(k=u[x][x])*(l=k<0?Math.sqrt(n):-Math.sqrt(n))-n,u[x][x]=k-l,f=h;f<r;f++){for(n=0,g=x;g<s;g++)n+=u[g][x]*u[g][f];for(k=n/m,g=x;g<s;g++)u[g][f]=u[g][f]+k*u[g][x]}for(z[x]=l,n=0,f=h;f<r;f++)n+=Math.pow(u[x][f],2);if(n<e)l=0;else{for(m=(k=u[x][x+1])*(l=k<0?Math.sqrt(n):-Math.sqrt(n))-n,u[x][x+1]=k-l,f=h;f<r;f++)t[f]=u[x][f]/m;for(f=h;f<s;f++){for(n=0,g=h;g<r;g++)n+=u[f][g]*u[x][g];for(g=h;g<r;g++)u[f][g]=u[f][g]+n*t[g]}}o<(p=Math.abs(z[x])+Math.abs(t[x]))&&(o=p)}if(c)for(x=r-1;0<=x;x--){if(0!==l){for(m=u[x][x+1]*l,f=h;f<r;f++)v[f][x]=u[x][f]/m;for(f=h;f<r;f++){for(n=0,g=h;g<r;g++)n+=u[x][g]*v[g][f];for(g=h;g<r;g++)v[g][f]=v[g][f]+n*v[g][x]}}for(f=h;f<r;f++)v[x][f]=0,v[f][x]=0;v[x][x]=1,l=t[x],h=x}if(b){if("f"===b)for(x=r;x<s;x++){for(f=r;f<s;f++)u[x][f]=0;u[x][x]=1}for(x=r-1;0<=x;x--){for(h=x+1,l=z[x],f=h;f<w;f++)u[x][f]=0;if(0!==l){for(m=u[x][x]*l,f=h;f<w;f++){for(n=0,g=h;g<s;g++)n+=u[g][x]*u[g][f];for(k=n/m,g=x;g<s;g++)u[g][f]=u[g][f]+k*u[g][x]}for(f=x;f<s;f++)u[f][x]=u[f][x]/l}else for(f=x;f<s;f++)u[f][x]=0;u[x][x]=u[x][x]+1}}for(d*=o,g=r-1;0<=g;g--)for(var A=0;A<50;A++){for(y=!1,h=g;0<=h;h--){if(Math.abs(t[h])<=d){y=!0;break}if(Math.abs(z[h-1])<=d)break}if(!y){for(j=0,i=h-(n=1),x=h;x<g+1&&(k=n*t[x],t[x]=j*t[x],!(Math.abs(k)<=d));x++)if(l=z[x],z[x]=Math.sqrt(k*k+l*l),j=l/(m=z[x]),n=-k/m,b)for(f=0;f<s;f++)p=u[f][i],q=u[f][x],u[f][i]=p*j+q*n,u[f][x]=-p*n+q*j}if(q=z[g],h===g){if(q<0&&(z[g]=-q,c))for(f=0;f<r;f++)v[f][g]=-v[f][g];break}for(o=z[h],k=(((p=z[g-1])-q)*(p+q)+((l=t[g-1])-(m=t[g]))*(l+m))/(2*m*p),l=Math.sqrt(k*k+1),k=((o-q)*(o+q)+m*(p/(k<0?k-l:k+l)-m))/o,x=h+(n=j=1);x<g+1;x++){if(l=t[x],p=z[x],m=n*l,l*=j,q=Math.sqrt(k*k+m*m),k=o*(j=k/(t[x-1]=q))+l*(n=m/q),l=-o*n+l*j,m=p*n,p*=j,c)for(f=0;f<r;f++)o=v[f][x-1],q=v[f][x],v[f][x-1]=o*j+q*n,v[f][x]=-o*n+q*j;if(q=Math.sqrt(k*k+m*m),k=(j=k/(z[x-1]=q))*l+(n=m/q)*p,o=-n*l+j*p,b)for(f=0;f<s;f++)p=u[f][x-1],q=u[f][x],u[f][x-1]=p*j+q*n,u[f][x]=-p*n+q*j}t[h]=0,t[g]=k,z[g]=o}for(x=0;x<r;x++)z[x]<d&&(z[x]=0);return{u:u,q:z,v:v}},a.VERSION="1.1.1",Object.defineProperty(a,"__esModule",{value:!0})})});function z(a,b){return Object.setPrototypeOf(a,b),a}var A="object"==typeof global&&global&&global.Object===Object&&global,B="object"==typeof self&&self&&self.Object===Object&&self,C=A||B||Function("return this")(),D=C.Symbol,E=Object.prototype,F=E.hasOwnProperty,G=E.toString,H=D?D.toStringTag:void 0,I=function(a){var b=F.call(a,H),c=a[H];try{a[H]=void 0;var d=!0}catch{}var e=G.call(a);return d&&(b?a[H]=c:delete a[H]),e},J=Object.prototype.toString,K=function(a){return J.call(a)},L="[object Null]",M="[object Undefined]",N=D?D.toStringTag:void 0,O=function(a){return null==a?void 0===a?M:L:N&&N in Object(a)?I(a):K(a)},P=function(a){return null!=a&&"object"==typeof a},Q="[object Symbol]",R=function(a){return"symbol"==typeof a||P(a)&&O(a)==Q},S=function(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e},T=Array.isArray,U=1/0,V=D?D.prototype:void 0,W=V?V.toString:void 0;function X(a){if("string"==typeof a)return a;if(T(a))return S(a,X)+"";if(R(a))return W?W.call(a):"";var b=a+"";return"0"==b&&1/a== -U?"-0":b}var Y=X,Z=function(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)};function $(a){return a}var _,aa=$,ab="[object AsyncFunction]",ac="[object Function]",ad="[object GeneratorFunction]",ae="[object Proxy]",af=function(a){if(!Z(a))return!1;var b=O(a);return b==ac||b==ad||b==ab||b==ae},ag=C["__core-js_shared__"],ah=(_=/[^.]+$/.exec(ag&&ag.keys&&ag.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"",ai=function(a){return!!ah&&ah in a},aj=Function.prototype.toString,ak=function(a){if(null!=a){try{return aj.call(a)}catch{}try{return a+""}catch{}}return""},al=/[\\^$.*+?()[\]{}|]/g,am=/^\[object .+?Constructor\]$/,an=Function.prototype,ao=Object.prototype,ap=an.toString,aq=ao.hasOwnProperty,ar=RegExp("^"+ap.call(aq).replace(al,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),as=function(a){return!(!Z(a)||ai(a))&&(af(a)?ar:am).test(ak(a))};function at(a,b){return a?.[b]}var au=at,av=function(a,b){var c=au(a,b);return as(c)?c:void 0},aw=av(C,"WeakMap"),ax=Object.create,ay=function(){function a(){}return function(b){if(!Z(b))return{};if(ax)return ax(b);a.prototype=b;var c=new a;return a.prototype=void 0,c}}(),az=function(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)},aA=function(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b},aB=800,aC=16,aD=Date.now,aE=function(a){var b=0,c=0;return function(){var d=aD(),e=aC-(d-c);if(c=d,e>0){if(++b>=aB)return arguments[0]}else b=0;return a.apply(void 0,arguments)}},aF=function(a){return function(){return a}},aG=function(){try{var a=av(Object,"defineProperty");return a({},"",{}),a}catch{}}(),aH=aG?function(a,b){return aG(a,"toString",{configurable:!0,enumerable:!1,value:aF(b),writable:!0})}:aa,aI=aE(aH),aJ=function(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&& !1!==b(a[c],c,a););return a},aK=9007199254740991,aL=/^(?:0|[1-9]\d*)$/,aM=function(a,b){var c=typeof a;return!!(b=b??aK)&&("number"==c||"symbol"!=c&&aL.test(a))&&a> -1&&a%1==0&&a<b},aN=function(a,b,c){"__proto__"==b&&aG?aG(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c},aO=function(a,b){return a===b||a!=a&&b!=b},aP=Object.prototype.hasOwnProperty,aQ=function(a,b,c){var d=a[b];aP.call(a,b)&&aO(d,c)&&(void 0!==c||b in a)||aN(a,b,c)},aR=function(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):void 0;void 0===i&&(i=a[h]),e?aN(c,h,i):aQ(c,h,i)}return c},aS=Math.max,aT=function(a,b,c){return b=aS(void 0===b?a.length-1:b,0),function(){for(var d=arguments,e=-1,f=aS(d.length-b,0),g=Array(f);++e<f;)g[e]=d[b+e];e=-1;for(var h=Array(b+1);++e<b;)h[e]=d[e];return h[b]=c(g),az(a,this,h)}},aU=9007199254740991,aV=function(a){return"number"==typeof a&&a> -1&&a%1==0&&a<=aU},aW=function(a){return null!=a&&aV(a.length)&&!af(a)},aX=function(a,b,c){if(!Z(c))return!1;var d=typeof b;return("number"==d?!!(aW(c)&&aM(b,c.length)):"string"==d&&b in c)&&aO(c[b],a)},aY=Object.prototype,aZ=function(a){var b=a&&a.constructor,c="function"==typeof b&&b.prototype||aY;return a===c},a$=function(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d},a_="[object Arguments]",a0=function(a){return P(a)&&O(a)==a_},a1=Object.prototype,a2=a1.hasOwnProperty,a3=a1.propertyIsEnumerable,a4=a0(function(){return arguments}())?a0:function(a){return P(a)&&a2.call(a,"callee")&&!a3.call(a,"callee")};function a5(){return!1}var a6=a5,a7="object"==typeof exports&&exports&&!exports.nodeType&&exports,a8=a7&&"object"==typeof module&&module&&!module.nodeType&&module,a9=a8&&a8.exports===a7?C.Buffer:void 0,ba=(a9?a9.isBuffer:void 0)||a6,bb={};bb["[object Float32Array]"]=bb["[object Float64Array]"]=bb["[object Int8Array]"]=bb["[object Int16Array]"]=bb["[object Int32Array]"]=bb["[object Uint8Array]"]=bb["[object Uint8ClampedArray]"]=bb["[object Uint16Array]"]=bb["[object Uint32Array]"]=!0,bb["[object Arguments]"]=bb["[object Array]"]=bb["[object ArrayBuffer]"]=bb["[object Boolean]"]=bb["[object DataView]"]=bb["[object Date]"]=bb["[object Error]"]=bb["[object Function]"]=bb["[object Map]"]=bb["[object Number]"]=bb["[object Object]"]=bb["[object RegExp]"]=bb["[object Set]"]=bb["[object String]"]=bb["[object WeakMap]"]=!1;var bc=function(a){return P(a)&&aV(a.length)&&!!bb[O(a)]},bd=function(a){return function(b){return a(b)}},be="object"==typeof exports&&exports&&!exports.nodeType&&exports,bf=be&&"object"==typeof module&&module&&!module.nodeType&&module,bg=bf&&bf.exports===be&&A.process,bh=function(){try{return bf&&bf.require&&bf.require("util").types||bg&&bg.binding&&bg.binding("util")}catch{}}(),bi=bh&&bh.isTypedArray,bj=bi?bd(bi):bc,bk=Object.prototype.hasOwnProperty,bl=function(a,b){var c=T(a),d=!c&&a4(a),e=!c&&!d&&ba(a),f=!c&&!d&&!e&&bj(a),g=c||d||e||f,h=g?a$(a.length,String):[],i=h.length;for(var j in a)(b||bk.call(a,j))&&!(g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||aM(j,i)))&&h.push(j);return h},bm=function(a,b){return function(c){return a(b(c))}},bn=bm(Object.keys,Object),bo=Object.prototype.hasOwnProperty,bp=function(a){if(!aZ(a))return bn(a);var b=[];for(var c in Object(a))bo.call(a,c)&&"constructor"!=c&&b.push(c);return b},bq=function(a){return aW(a)?bl(a):bp(a)},br=function(a){var b=[];if(null!=a)for(var c in Object(a))b.push(c);return b},bs=Object.prototype.hasOwnProperty,bt=function(a){if(!Z(a))return br(a);var b=aZ(a),c=[];for(var d in a)"constructor"==d&&(b||!bs.call(a,d))||c.push(d);return c},bu=function(a){return aW(a)?bl(a,!0):bt(a)},bv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bw=/^\w*$/,bx=function(a,b){if(T(a))return!1;var c=typeof a;return!!("number"==c||"symbol"==c||"boolean"==c||null==a||R(a))||bw.test(a)||!bv.test(a)||null!=b&&a in Object(b)},by=av(Object,"create"),bz=function(){this.__data__=by?by(null):{},this.size=0},bA=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b},bB=Object.prototype.hasOwnProperty,bC=function(a){var b=this.__data__;if(by){var c=b[a];return"__lodash_hash_undefined__"===c?void 0:c}return bB.call(b,a)?b[a]:void 0},bD=Object.prototype.hasOwnProperty,bE=function(a){var b=this.__data__;return by?void 0!==b[a]:bD.call(b,a)},bF=function(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=by&& void 0===b?"__lodash_hash_undefined__":b,this};function bG(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}bG.prototype.clear=bz,bG.prototype.delete=bA,bG.prototype.get=bC,bG.prototype.has=bE,bG.prototype.set=bF;var bH=bG,bI=function(){this.__data__=[],this.size=0},bJ=function(a,b){for(var c=a.length;c--;)if(aO(a[c][0],b))return c;return -1},bK=Array.prototype.splice,bL=function(a){var b=this.__data__,c=bJ(b,a);return!(c<0)&&(c==b.length-1?b.pop():bK.call(b,c,1),--this.size,!0)},bM=function(a){var b=this.__data__,c=bJ(b,a);return c<0?void 0:b[c][1]},bN=function(a){return bJ(this.__data__,a)> -1},bO=function(a,b){var c=this.__data__,d=bJ(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this};function bP(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}bP.prototype.clear=bI,bP.prototype.delete=bL,bP.prototype.get=bM,bP.prototype.has=bN,bP.prototype.set=bO;var bQ=bP,bR=av(C,"Map"),bS=function(){this.size=0,this.__data__={hash:new bH,map:new(bR||bQ),string:new bH}},bT=function(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a},bU=function(a,b){var c=a.__data__;return bT(b)?c["string"==typeof b?"string":"hash"]:c.map},bV=function(a){var b=bU(this,a).delete(a);return this.size-=b?1:0,b},bW=function(a){return bU(this,a).get(a)},bX=function(a){return bU(this,a).has(a)},bY=function(a,b){var c=bU(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this};function bZ(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}bZ.prototype.clear=bS,bZ.prototype.delete=bV,bZ.prototype.get=bW,bZ.prototype.has=bX,bZ.prototype.set=bY;var b$=bZ,b_="Expected a function";function b0(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw TypeError(b_);var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(b0.Cache||b$),c}b0.Cache=b$;var b1=b0,b2=500,b3=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,b4=/\\(\\)?/g,b5=function(a){var b=b1(a,function(a){return c.size===b2&&c.clear(),a}),c=b.cache;return b}(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(b3,function(a,c,d,e){b.push(d?e.replace(b4,"$1"):c||a)}),b}),b6=function(a){return null==a?"":Y(a)},b7=function(a,b){return T(a)?a:bx(a,b)?[a]:b5(b6(a))},b8=1/0,b9=function(a){if("string"==typeof a||R(a))return a;var b=a+"";return"0"==b&&1/a== -b8?"-0":b},ca=function(a,b){b=b7(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[b9(b[c++])];return c&&c==d?a:void 0},cb=function(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a},cc=D?D.isConcatSpreadable:void 0,cd=function(a){return T(a)||a4(a)||!!(cc&&a&&a[cc])};function ce(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=cd),e||(e=[]);++f<g;){var h=a[f];b>0&&c(h)?b>1?ce(h,b-1,c,d,e):cb(e,h):d||(e[e.length]=h)}return e}var cf=ce,cg=function(a){return(null==a?0:a.length)?cf(a,1):[]},ch=function(a){return aI(aT(a,void 0,cg),a+"")},ci=bm(Object.getPrototypeOf,Object),cj="[object Object]",ck=Function.prototype,cl=Object.prototype,cm=ck.toString,cn=cl.hasOwnProperty,co=cm.call(Object),cp=function(a){if(!P(a)||O(a)!=cj)return!1;var b=ci(a);if(null===b)return!0;var c=cn.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&cm.call(c)==co},cq=function(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),(c=c>e?e:c)<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f},cr=function(){this.__data__=new bQ,this.size=0},cs=function(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c},ct=function(a){return this.__data__.get(a)},cu=function(a){return this.__data__.has(a)},cv=function(a,b){var c=this.__data__;if(c instanceof bQ){var d=c.__data__;if(!bR||d.length<199)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new b$(d)}return c.set(a,b),this.size=c.size,this};function cw(a){var b=this.__data__=new bQ(a);this.size=b.size}cw.prototype.clear=cr,cw.prototype.delete=cs,cw.prototype.get=ct,cw.prototype.has=cu,cw.prototype.set=cv;var cx=cw,cy=function(a,b){return a&&aR(b,bq(b),a)},cz=function(a,b){return a&&aR(b,bu(b),a)},cA="object"==typeof exports&&exports&&!exports.nodeType&&exports,cB=cA&&"object"==typeof module&&module&&!module.nodeType&&module,cC=cB&&cB.exports===cA?C.Buffer:void 0,cD=cC?cC.allocUnsafe:void 0,cE=function(a,b){if(b)return a.slice();var c=a.length,d=cD?cD(c):new a.constructor(c);return a.copy(d),d},cF=function(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f};function cG(){return[]}var cH=cG,cI=Object.prototype.propertyIsEnumerable,cJ=Object.getOwnPropertySymbols,cK=cJ?function(a){return null==a?[]:cF(cJ(a=Object(a)),function(b){return cI.call(a,b)})}:cH,cL=function(a,b){return aR(a,cK(a),b)},cM=Object.getOwnPropertySymbols?function(a){for(var b=[];a;)cb(b,cK(a)),a=ci(a);return b}:cH,cN=function(a,b){return aR(a,cM(a),b)},cO=function(a,b,c){var d=b(a);return T(a)?d:cb(d,c(a))},cP=function(a){return cO(a,bq,cK)},cQ=function(a){return cO(a,bu,cM)},cR=av(C,"DataView"),cS=av(C,"Promise"),cT=av(C,"Set"),cU="[object Map]",cV="[object Object]",cW="[object Promise]",cX="[object Set]",cY="[object WeakMap]",cZ="[object DataView]",c$=ak(cR),c_=ak(bR),c0=ak(cS),c1=ak(cT),c2=ak(aw),c3=O;(cR&&c3(new cR(new ArrayBuffer(1)))!=cZ||bR&&c3(new bR)!=cU||cS&&c3(cS.resolve())!=cW||cT&&c3(new cT)!=cX||aw&&c3(new aw)!=cY)&&(c3=function(a){var b=O(a),c=b==cV?a.constructor:void 0,d=c?ak(c):"";if(d)switch(d){case c$:return cZ;case c_:return cU;case c0:return cW;case c1:return cX;case c2:return cY}return b});var c4=c3,c5=Object.prototype.hasOwnProperty,c6=function(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&c5.call(a,"index")&&(c.index=a.index,c.input=a.input),c},c7=C.Uint8Array,c8=function(a){var b=new a.constructor(a.byteLength);return new c7(b).set(new c7(a)),b},c9=function(a,b){var c=b?c8(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)},da=/\w*$/,db=function(a){var b=new a.constructor(a.source,da.exec(a));return b.lastIndex=a.lastIndex,b},dc=D?D.prototype:void 0,dd=dc?dc.valueOf:void 0,de=function(a){return dd?Object(dd.call(a)):{}},df=function(a,b){var c=b?c8(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)},dg="[object Boolean]",dh="[object Date]",di="[object Map]",dj="[object Number]",dk="[object RegExp]",dl="[object Set]",dm="[object String]",dn="[object Symbol]",dp="[object ArrayBuffer]",dq="[object DataView]",dr="[object Float32Array]",ds="[object Float64Array]",dt="[object Int8Array]",du="[object Int16Array]",dv="[object Int32Array]",dw="[object Uint8Array]",dx="[object Uint8ClampedArray]",dy="[object Uint16Array]",dz="[object Uint32Array]",dA=function(a,b,c){var d=a.constructor;switch(b){case dp:return c8(a);case dg:case dh:return new d(+a);case dq:return c9(a,c);case dr:case ds:case dt:case du:case dv:case dw:case dx:case dy:case dz:return df(a,c);case di:return new d;case dj:case dm:return new d(a);case dk:return db(a);case dl:return new d;case dn:return de(a)}},dB=function(a){return"function"!=typeof a.constructor||aZ(a)?{}:ay(ci(a))},dC="[object Map]",dD=function(a){return P(a)&&c4(a)==dC},dE=bh&&bh.isMap,dF=dE?bd(dE):dD,dG="[object Set]",dH=function(a){return P(a)&&c4(a)==dG},dI=bh&&bh.isSet,dJ=dI?bd(dI):dH,dK=1,dL=2,dM=4,dN="[object Arguments]",dO="[object Function]",dP="[object GeneratorFunction]",dQ="[object Object]",dR={};function dS(a,b,c,d,e,f){var g,h=b&dK,i=b&dL,j=b&dM;if(c&&(g=e?c(a,d,e,f):c(a)),void 0!==g)return g;if(!Z(a))return a;var k=T(a);if(k){if(g=c6(a),!h)return aA(a,g)}else{var l=c4(a),m=l==dO||l==dP;if(ba(a))return cE(a,h);if(l==dQ||l==dN||m&&!e){if(g=i||m?{}:dB(a),!h)return i?cN(a,cz(g,a)):cL(a,cy(g,a))}else{if(!dR[l])return e?a:{};g=dA(a,l,h)}}f||(f=new cx);var n=f.get(a);if(n)return n;f.set(a,g),dJ(a)?a.forEach(function(d){g.add(dS(d,b,c,d,a,f))}):dF(a)&&a.forEach(function(d,e){g.set(e,dS(d,b,c,e,a,f))});var o=j?i?cQ:cP:i?bu:bq,p=k?void 0:o(a);return aJ(p||a,function(d,e){p&&(d=a[e=d]),aQ(g,e,dS(d,b,c,e,a,f))}),g}dR[dN]=dR["[object Array]"]=dR["[object ArrayBuffer]"]=dR["[object DataView]"]=dR["[object Boolean]"]=dR["[object Date]"]=dR["[object Float32Array]"]=dR["[object Float64Array]"]=dR["[object Int8Array]"]=dR["[object Int16Array]"]=dR["[object Int32Array]"]=dR["[object Map]"]=dR["[object Number]"]=dR[dQ]=dR["[object RegExp]"]=dR["[object Set]"]=dR["[object String]"]=dR["[object Symbol]"]=dR["[object Uint8Array]"]=dR["[object Uint8ClampedArray]"]=dR["[object Uint16Array]"]=dR["[object Uint32Array]"]=!0,dR["[object Error]"]=dR[dO]=dR["[object WeakMap]"]=!1;var dT=dS,dU=function(a){return dT(a,5)},dV=function(a,b){return null!=a&&b in Object(a)},dW=function(a,b,c){b=b7(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=b9(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f|| ++d!=e?f:!!(e=null==a?0:a.length)&&aV(e)&&aM(g,e)&&(T(a)||a4(a))},dX=function(a,b){return null!=a&&dW(a,b,dV)},dY=function(a,b,c){for(var d=-1,e=Object(a),f=c(a),g=f.length;g--;){var h=f[++d];if(!1===b(e[h],h,e))break}return a},dZ=function(a,b,c){(void 0===c||aO(a[b],c))&&(void 0!==c||b in a)||aN(a,b,c)},d$=function(a,b){if(!("constructor"===b&&"function"==typeof a[b])&&"__proto__"!=b)return a[b]},d_=function(a,b,c,d,e,f,g){var h=d$(a,c),i=d$(b,c),j=g.get(i);if(j){dZ(a,c,j);return}var k=f?f(h,i,c+"",a,b,g):void 0,l=void 0===k;if(l){var m,n,o=T(i),p=!o&&ba(i),q=!o&&!p&&bj(i);k=i,o||p||q?T(h)?k=h:P(m=h)&&aW(m)?k=aA(h):p?(l=!1,k=cE(i,!0)):q?(l=!1,k=df(i,!0)):k=[]:cp(i)||a4(i)?(k=h,a4(h)?k=aR(n=h,bu(n)):(!Z(h)||af(h))&&(k=dB(i))):l=!1}l&&(g.set(i,k),e(k,i,d,f,g),g.delete(i)),dZ(a,c,k)};function d0(a,b,c,d,e){a!==b&&dY(b,function(f,g){if(e||(e=new cx),Z(f))d_(a,b,g,c,d0,d,e);else{var h=d?d(d$(a,g),f,g+"",a,b,e):void 0;void 0===h&&(h=f),dZ(a,g,h)}},bu)}var d1,d2,d3,d4,d5,d6,d7,d8,d9,ea,eb,ec,ed=d0,ee=function(a){var b=null==a?0:a.length;return b?a[b-1]:void 0},ef=function(a,b){return b.length<2?a:ca(a,cq(b,0,-1))},eg=function(a){return function(a,b){return aI(aT(a,void 0,aa),a+"")}(function(b,c){var d=-1,e=c.length,f=e>1?c[e-1]:void 0,g=e>2?c[2]:void 0;for(f=a.length>3&&"function"==typeof f?(e--,f):void 0,g&&aX(c[0],c[1],g)&&(f=e<3?void 0:f,e=1),b=Object(b);++d<e;){var h=c[d];h&&a(b,h,d,f)}return b})}(function(a,b,c){ed(a,b,c)}),eh=function(a,b){return b=b7(b,a),null==(a=ef(a,b))||delete a[b9(ee(b))]},ei=function(a){return cp(a)?void 0:a},ej=1,ek=2,el=4,em=ch(function(a,b){var c={};if(null==a)return c;var d=!1;b=S(b,function(b){return b=b7(b,a),d||(d=b.length>1),b}),aR(a,cQ(a),c),d&&(c=dT(c,ej|ek|el,ei));for(var e=b.length;e--;)eh(c,b[e]);return c}),en=function(a,b,c,d){if(!Z(a))return a;b=b7(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&& ++e<f;){var i=b9(b[e]),j=c;if("__proto__"===i||"constructor"===i||"prototype"===i)break;if(e!=g){var k=h[i];void 0===(j=d?d(k,i,h):void 0)&&(j=Z(k)?k:aM(b[e+1])?[]:{})}aQ(h,i,j),h=h[i]}return a},eo=function(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=ca(a,g);c(h,g)&&en(f,b7(g,a),h)}return f},ep=function(a,b){return eo(a,b,function(b,c){return dX(a,c)})},eq=ch(function(a,b){return null==a?{}:ep(a,b)});(d1=eU||(eU={})).all=["PerspectiveCamera","OrthographicCamera"],d1.is=function(a){return d1.all.includes(a)},(d2=eV||(eV={})).DefaultUp=[0,1,0],d2.DefaultTargetOffset=1e3,d2.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:5,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:d2.DefaultUp,isUpVectorFlipped:!1,targetOffset:d2.DefaultTargetOffset},d2.getZoom=function(a){return"PerspectiveCamera"===a.type?a.perspective.zoom:a.orthographic.zoom},(d3=eW||(eW={})).isEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]},d3.lerp=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c]},(d4=eX||(eX={})).isEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},d4.add=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},d4.sub=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},d4.lerp=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c,a[2]+(b[2]-a[2])*c]},(d5=eY||(eY={})).isEqual=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},d5.lerp=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c,a[2]+(b[2]-a[2])*c,a[3]+(b[3]-a[3])*c]},(d6=eZ||(eZ={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d6.isEqual=function(a,b){for(let c=0;c<16;c++)if(a[c]!==b[c])return!1;return!0},d6.simplify=function(a){return a??d6.identity},d6.applyMatrix4=function(a,b){let c=b.slice(0);for(var d=0,e=b.length;d<e;d+=3){let f=a[3]*b[d]+a[7]*b[d+1]+a[11]*b[d+2]+a[15];c[d]=(a[0]*b[d]+a[4]*b[d+1]+a[8]*b[d+2]+a[12])/f,c[d+1]=(a[1]*b[d]+a[5]*b[d+1]+a[9]*b[d+2]+a[13])/f,c[d+2]=(a[2]*b[d]+a[6]*b[d+1]+a[10]*b[d+2]+a[14])/f}return c},(d7=e$||(e$={})).white={r:1,g:1,b:1},d7.red={r:1,g:0,b:0},d7.black={r:0,g:0,b:0},d7.toRgb255a1=function(a){return{r:Math.round(255*a.r),g:Math.round(255*a.g),b:Math.round(255*a.b),a:1}},d7.clone=function(a){return{r:a.r,g:a.g,b:a.b}},d7.fromHex=function(a){return{r:((a=Math.floor(a))>>16&255)/255,g:(a>>8&255)/255,b:(255&a)/255}},d7.equals=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b},d7.lerp=function(a,b,c){return{r:a.r+(b.r-a.r)*c,g:a.g+(b.g-a.g)*c,b:a.b+(b.b-a.b)*c}},(d8=e_||(e_={})).white={...e$.white,a:1},d8.transparent={...e$.white,a:0},d8.from0to1=function(a){return{r:a[0],g:a[1],b:a[2],a:a[3]}},d8.fromHexAndA=function(a,b){return{...e$.fromHex(a),a:b}},d8.toRgb255a1=function(a){return{r:Math.round(255*a.r),g:Math.round(255*a.g),b:Math.round(255*a.b),a:a.a}},d8.equals=function(a,b){return e$.equals(a,b)&&a.a===b.a},d8.lerp=function(a,b,c){return{r:a.r+(b.r-a.r)*c,g:a.g+(b.g-a.g)*c,b:a.b+(b.b-a.b)*c,a:a.a+(b.a-a.a)*c}},(e0||(e0={})).identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},(e1||(e1={})).defaultData={mass:1,stiffness:80,damping:10,velocity:0},(e2||(e2={})).defaultData={control1:[.5,.05],control2:[.1,.3]},(ec=e3||(e3={})).defaultData=function(a,b=.1){return{type:"radial",hideBase:!1,count:3,radial:{radius:2*Math.max(a[0],a[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},linear:{scale:[1,1,1],rotation:[0,0,0],position:[a[0]+a[0]*b,0,0]},grid:{count:[2,2,2],size:a.map(a=>a*(1+b)),useCenter:!0}}};var er=class{modifyById(a,b){if(void 0===this[a])throw Error("not expected");{let c={...this,[a]:b};return Object.setPrototypeOf(c,er.prototype),c}}add(a,b){return this.runOp({type:1,id:a,data:b})?.data??this}runOp(a){if(1===a.type){let b=this[a.id],c;c=void 0===b?{type:2,id:a.id}:{type:1,id:a.id,data:b};let{id:d,data:e}=a,f={...this,[d]:e};return Object.setPrototypeOf(f,er.prototype),{data:f,actual:a,reverse:c}}if(2===a.type){let{id:g}=a,h=this[g];if(void 0===h)return null;{let i={...this};return Object.setPrototypeOf(i,er.prototype),delete i[g],{data:i,actual:a,reverse:{type:1,id:g,data:h}}}}throw Error("illegal arg")}};function es(a){if(void 0!==a.deepFreeze){a.deepFreeze(a);return}let b=Object.getOwnPropertyNames(a);for(let c of b){let d=a[c];d&&"object"==typeof d&&es(d)}return Object.freeze(a)}var et=class extends Error{};function eu(a,b,c){if(void 0===a?void 0===b?(a=0,b=10):a=b-10:void 0===b&&(b=a+10),a>b){let d=a;a=b,b=d}let e=[],f=1/(c+1);for(let g=0;g<c;g++){let h=a+(b-a)*(g+.75+.5*Math.random())*f;e.push(h)}return e}function ev(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array}function ew(a,b){for(let c of a)b(c.id,c.data),ew(c.children,b)}function ex(a,b){for(let c of(b(a.id,a.data),a.children))ex(c,b)}var ey,ez=class extends Array{constructor(...a){super(...a),Object.setPrototypeOf(this,ez.prototype)}deepFreeze(){let a=0;for(;a<this.length;)es(this[a]),a++}fillCaches0(a,b){for(let c of(this.objCaches.set(a.id,a),this.parentCaches.set(a.id,b),a.children))this.fillCaches0(c,a.id)}fillCaches(){if(void 0===this.objCaches)for(let a of(this.objCaches=new Map,this.parentCaches=new Map,this))this.fillCaches0(a,null)}randomId(){this.fillCaches();let a=Array.from(this.objCaches.keys());if(0!==a.length)return a[Math.max(0,Math.floor(Math.random()*a.length)-1)]}isDescendantOf(a,b){for(;a;){let c=this.parent(a);if(c===b)return!0;a=c}return!1}data(a){return this.get(a)?.data}has(a){return void 0!==this.childrenOf(a)}get(a){return this.fillCaches(),this.objCaches.get(a)}childrenOf(a){return null===a?this:this.get(a)?.children}traverseFrom(a,b){if(null===a)this.traverse(b);else{let c=this.get(a);c&&ex(c,b)}}traverse(a){ew(this,a)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(a){return this.fillCaches(),this.parentCaches.get(a)}childrenArray(a){return null===a?this:this.get(a).children}modifyById(a,b){if(void 0===this.get(a))throw Error("not expected");{let c=this.parent(a),d=this.childrenArray(c),e=d.findIndex(b=>b.id===a);if(e<0)throw Error("not expected");let f=d[e];return(d=[...d])[e]={...f,data:b},this.modifyArrayBy(c,d)}}modifyArrayBy(a,b){let c=a,d=b;for(;null!==c;){let e=d,f=c;if(void 0===(c=this.parent(c)))throw Error();let g=(d=this.childrenArray(c)).findIndex(a=>a.id===f);if(g<0)throw Error();(d=[...d])[g]={...d[g],children:e}}Object.setPrototypeOf(d,ez.prototype);let h=d;return h.fillCaches(),h}runOp(a){switch(a.type){case 7:return this.addOp(a);case 8:return this.deleteOp(a);case 9:return this.moveOp(a)}}checkDuplicatedIdRec({id:a,children:b}){if(void 0!==this.get(a))return!0;for(let c of b)if(this.checkDuplicatedIdRec(c))return!0;return!1}addOp(a){let{parent:b,fi:c,id:d,data:e,children:f}=a;if(null!==b&& void 0===this.get(b)||this.checkDuplicatedIdRec(a))return null;{let g=b,h=this.childrenArray(g),i={fi:c,id:d,data:e,children:f};return(h=[...h,i]).sort((a,b)=>a.fi-b.fi),a.localIndex=h.indexOf(i),{data:this.modifyArrayBy(g,h),actual:a,reverse:{type:8,id:d}}}}deleteOp(a){let{id:b}=a;if(null===this.get(b))return null;{let c=this.parent(b);if(void 0===c)return null;let d=this.childrenArray(c),e=d.findIndex(a=>a.id===b);a.localIndex=e;let f=(d=[...d]).splice(e,1)[0];return{data:this.modifyArrayBy(c,d),actual:a,reverse:{type:7,...f,parent:c}}}}moveOp(a){let{parent:b,fi:c,id:d}=a;if(null!==b&& void 0===this.get(b))return this.deleteOp({type:8,id:d});if(null!==b){let e=b;for(;null!==e;){if(void 0===e)throw Error();if(e===d)throw new et("cyclic tree");e=this.parent(e)}}let f=this.parent(d);if(void 0===f)return null;let g=f,h=this.childrenArray(f),i=h.findIndex(a=>a.id===d);h=[...h];let j=h.splice(i,1)[0],k=this.modifyArrayBy(f,h);f=b,h=k.childrenArray(f);let l=j.fi;return j={...j,fi:c},(h=[...h,j]).sort((a,b)=>a.fi-b.fi),a.localIndex=h.indexOf(j),{data:k=k.modifyArrayBy(f,h),actual:a,reverse:{type:9,parent:g,fi:l,id:d}}}previous(a,b){if(null===b){let c=this.childrenArray(a);return 0===c.length?null:c[c.length-1].id}let d=null;for(let e of this.childrenArray(a)){if(e.id===b)return d;d=e.id}return null}traverseSortNext(a){let b=this.parent(a);if(void 0!==b){let c=this.childrenArray(b),d=c.findIndex(b=>b.id===a)+1;if(d<c.length)return c[d].id;if(b)return this.traverseSortNext(b)}}sortNext(a){let b=this.childrenArray(a);return b.length>0?b[0].id:this.traverseSortNext(a)}traverseSortPrevious(a){let b=this.childrenArray(a);return b.length>0?this.traverseSortPrevious(b[b.length-1].id):a}sortPrevious(a){let b=this.parent(a);if(void 0!==b){let c=this.childrenArray(b),d=c.findIndex(b=>b.id===a)-1;return d>=0?this.traverseSortPrevious(c[d].id):b}}getAllSorted(a){let b=[];for(let c of a){let d=this.getWithSortKey(c.id);void 0!==d&&b.push({...c,...d})}for(let e of(b.sort((a,b)=>(function(a,b){let c=0;for(;c<a.length&&c<b.length;){if(a[c]<b[c])return -1;if(a[c]>b[c])return 1;c+=1}return c!==b.length?-1:c!==a.length?1:0})(a.sortKey,b.sortKey)),b))delete e.sortKey;return b}getWithSortKey(a){var b=a;let c=[],d=this.get(b),e=d;if(void 0!==d){for(;b;)c.splice(0,0,d.fi),null!==(b=this.parent(b))&&(d=this.get(b));return{...e,sortKey:c}}}insertBeforeHelper(a,b,c){return this.insertAfterHelper(a,this.previous(a,b),c)}insertAfterHelper(a,b,c){let d=this.childrenArray(a);if(null===b){if(0===d.length)return eu(0,c,c);{let e=d[0].fi;return eu(e-c,e,c)}}{let f=this.get(b);if(void 0===f||this.parent(b)!==a)throw Error("illegal args");let g=d.find(a=>a.fi>f.fi);if(void 0!==g)return eu(f.fi,g.fi,c);{let h=d[d.length-1].fi;return eu(h,h+c,c)}}}};(ey=e4||(e4={})).runOp=function(a,b){if(Array.isArray(a)){let c=b.props,d={},e=[...a],f=!1;if(c)for(let g of Object.keys(c)){let h=parseInt(g);if(isNaN(h))throw Error("wrong index");d[g]=e[h],e[h]=c[g],f=!0}return f?{data:e,actual:b,reverse:{type:0,props:d}}:null}{let i=b.props,j={},k={...a},l=!1;if(i)for(let m of Object.keys(i)){j[m]=k[m];let n=i[m];void 0===n?delete k[m]:k[m]=n,l=!0}return l?{data:k,actual:b,reverse:{type:0,props:j}}:null}};var eA=class extends Array{constructor(...a){super(...a),Object.setPrototypeOf(this,eA.prototype)}deepFreeze(){let a=0;for(;a<this.length;)es(this[a]),a++}fillCaches0(a){this.objCaches.set(a.id,a)}fillCaches(){if(void 0===this.objCaches)for(let a of(this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1,this))this.fillCaches0(a)}randomId(){this.fillCaches();let a=Array.from(this.objCaches.keys());if(0!==a.length)return a[Math.max(0,Math.floor(Math.random()*a.length)-1)]}data(a){return this.get(a)?.data}get(a){return this.fillCaches(),this.objCaches.get(a)}modifyById(a,b){if(void 0===this.get(a))throw Error("not expected");{let c=this,d=c.findIndex(b=>b.id===a);if(d<0)throw Error("not expected");let e=c[d];return(c=[...c])[d]={...e,data:b},this.modifyArrayBy(c)}}modifyArrayBy(a){Object.setPrototypeOf(a,eA.prototype);let b=a;return"u">typeof l||b.fillCaches(),b}runOp(a){switch(a.type){case 4:return this.addOp(a);case 5:return this.deleteOp(a);case 6:return this.moveOp(a)}}addOp(a){let{fi:b,id:c,data:d}=a,e=this,f={fi:b,id:c,data:d};return(e=[...e,f]).sort((a,b)=>a.fi-b.fi),a.localIndex=e.indexOf(f),{data:this.modifyArrayBy(e),actual:a,reverse:{type:5,id:c}}}deleteOp(a){let{id:b}=a,c=this,d=c.findIndex(a=>a.id===b);if(-1===d)return null;a.localIndex=d;let e=(c=[...c]).splice(d,1)[0];return{data:this.modifyArrayBy(c),actual:a,reverse:{type:4,...e}}}moveOp(a){let{fi:b,id:c}=a,d=this,e=(d=[...d]).findIndex(a=>a.id===c);if(-1===e)return null;let f=d[e].fi,g={...d[e],fi:b};return d[e]=g,d.sort((a,b)=>a.fi-b.fi),a.localIndex=d.indexOf(g),{data:this.modifyArrayBy(d),actual:a,reverse:{type:6,fi:f,id:c}}}previous(a){if(null===a)return 0===this.length?null:this[this.length-1].id;let b=null;for(let c of this){if(c.id===a)return b;b=c.id}return null}insertBeforeHelper(a,b){return this.insertAfterHelper(this.previous(a),b)}insertAfterHelper(a,b){if(null===a){if(0===this.length)return eu(0,b,b);{let c=this[0].fi;return eu(c-b,c,b)}}{let d=this.get(a);if(void 0===d)throw Error("illegal args");let e=this.find(a=>a.fi>d.fi);if(void 0!==e)return eu(d.fi,e.fi,b);{let f=this[this.length-1].fi;return eu(f,f+b,b)}}}},eB=Symbol(),eC=Symbol(),eD=class{reportOp(a,b){let c=this;if(null===b)return;c._current=b.data;let d=[];for(;!(c instanceof eM);){let e=c._path,f=c._current;if(""!==e&&d.splice(0,0,e),null===(c=c._parent))return;c.update(e,f)}c.push(d,a,b.actual,b.reverse)}deleteChildren(a){if(this._children){let b=this._children[a];if(b){let c=b[eC];c&&c(),delete this._children[a]}}}},eE=class extends eD{constructor(a,b,c){super(),this._parent=a,this._path=b,this._current=c}update(a,b){if(Array.isArray(this._current)){if("string"==typeof a&&(a=parseInt(a),isNaN(a)))throw Error("Invalid path");this._current=[...this._current],this._current[a]=b}else this._current={...this._current,[a]:b}}runOp(a){this.reportOp(a,e4.runOp(this._current,a))}},eF=class extends eD{constructor(a,b,c){super(),this._parent=a,this._path=b,this._current=c}update(a,b){this._current={...this._current,[a]:b},Object.setPrototypeOf(this._current,er.prototype)}runOp(a){this.reportOp(a,this._current.runOp(a))}},eG={get(a,b){if(b===eC)return()=>{a._parent=null};if(b===eB)return a._current;let{_current:c,_children:d}=a;if("push"===b&&Array.isArray(c))throw Error("not supported to expand array");let e=void 0===d?void 0:d[b];if(void 0!==e)return e;let f=c[b],g=eN(a,b,f);return g!==f?(void 0===d&&(d={},a._children=d),d[b]=g,g):f},has(a,b){return b in a._current},ownKeys(a){return Reflect.ownKeys(a._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(a){return Object.getPrototypeOf(a._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(a,b){let c=a._current,d=Reflect.getOwnPropertyDescriptor(c,b);return d&&{writable:!0,configurable:!0,enumerable:d.enumerable,value:c[b]}}},eH={...eG,set(a,b,c){let d={type:0,props:{[b]:eQ(c)??c}};return a.deleteChildren(b),a.runOp(d),!0},deleteProperty(a,b){return a.deleteChildren(b),a.runOp({type:0,props:{[b]:void 0}}),!0}},eI={...eG,set(a,b,c){return void 0===c?this.deleteProperty(a,b):(a.deleteChildren(b),a.runOp({type:1,id:b,data:c})),!0},deleteProperty(a,b){return a.runOp({type:2,id:b}),!0}},eJ=class extends eD{constructor(a,b,c){super(),this._children={},this._parent=a,this._path=b,this._current=c,this[eC]=()=>{this._parent=null}}unproxy(){return this._current}update(a,b){this._current=this._current.modifyById(a,b)}runOp(a){this.reportOp(a,this._current.runOp(a))}randomId(){return this._current.randomId()}isDescendantOf(a,b){return this._current.isDescendantOf(a,b)}childrenOf(a){return this._current.childrenOf(a)}traverse(a){return this._current.traverse(a)}get(a){return this._current.get(a)}parent(a){return this._current.parent(a)}traverse(a){this._current.traverse((b,c)=>{a(b,this.data(b))})}data(a){let{_current:b,_children:c}=this,d=void 0===c?void 0:c[a];if(void 0!==d)return d;let e=b.get(a)?.data,f=eN(this,a,e);return f!==e?(void 0===c&&(c={},this._children=c),c[a]=f,f):e}add(a,b,c,d,e){this.runOp({type:7,parent:a,fi:b,id:c,data:d,children:e})}move(a,b,c){this.runOp({type:9,parent:a,fi:b,id:c})}insertAfter(a,b,c){let d=this._current.insertAfterHelper(a,b,c.length);for(let e=0;e<c.length;e++){let f=c[e];this.add(a,d[e],f.id,f.data,f.children)}}insertBefore(a,b,c){let d=this._current.insertBeforeHelper(a,b,c.length);for(let e=0;e<c.length;e++){let f=c[e];this.add(a,d[e],f.id,f.data,f.children)}}moveAfter(a,b,c){let d=this._current.insertAfterHelper(a,b,c.length);for(let e=0;e<c.length;e++){let f=c[e];this.move(a,d[e],f)}}moveBefore(a,b,c){let d=this._current.insertBeforeHelper(a,b,c.length);for(let e=0;e<c.length;e++){let f=c[e];this.move(a,d[e],f)}}delete(a){this.deleteChildren(a),this.runOp({type:8,id:a})}sortNext(a){return this._current.sortNext(a)}sortPrevious(a){return this._current.sortPrevious(a)}getAllSorted(a){return this._current.getAllSorted(a)}},eK=class extends eD{constructor(a,b,c){super(),this._children={},this._parent=a,this._path=b,this._current=c,this[eC]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(a){let b=this.length;for(let c=0;c<b;c++){let d=this._current[c].id;a(this.data(this._current[c].id),d)}}update(a,b){this._current=this._current.modifyById(a,b)}randomId(){return this._current.randomId()}get(a){return{...this._current.get(a),data:this.data(a)}}data(a){let{_current:b,_children:c}=this,d=void 0===c?void 0:c[a];if(void 0!==d)return d;let e=b.get(a)?.data,f=eN(this,a,e);return f!==e?(void 0===c&&(c={},this._children=c),c[a]=f,f):e}runOp(a){this.reportOp(a,this._current.runOp(a))}add(a,b,c){this.runOp({type:4,fi:a,id:b,data:c})}move(a,b){this.runOp({type:6,fi:a,id:b})}insertAfter(a,b){let c=this._current.insertAfterHelper(a,b.length);for(let d=0;d<b.length;d++){let e=b[d];this.add(c[d],e.id,e.data)}}insertBefore(a,b){let c=this._current.insertBeforeHelper(a,b.length);for(let d=0;d<b.length;d++){let e=b[d];this.add(c[d],e.id,e.data)}}moveAfter(a,b){let c=this._current.insertAfterHelper(a,b.length);for(let d=0;d<b.length;d++){let e=b[d];this.move(c[d],e)}}moveBefore(a,b){let c=this._current.insertBeforeHelper(a,b.length);for(let d=0;d<b.length;d++){let e=b[d];this.move(c[d],e)}}delete(a){this.deleteChildren(a),this.runOp({type:5,id:a})}};function eL(a,b,c){if(a.length>0){let d=a[a.length-1];if(0===d.type&&0===b.type&&e5.equal(d.path,c)){Object.assign(d.props,b.props);return}}a.push({...b,path:c})}var eM=class{constructor(a){this.ts=[],this.actual=[],this.reverse=[],this._current=a}update(a,b){if(""!==a)throw Error("");this._current=b}push(a,b,c,d){eL(this.ts,b,a),eL(this.actual,c,a),eL(this.reverse,d,a)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function eN(a,b,c){return c instanceof ez?new eJ(a,b,c):c instanceof eA?new eK(a,b,c):c instanceof er?new Proxy(new eF(a,b,c),eI):null!==c&&"object"==typeof c?ev(c)?c:new Proxy(new eE(a,b,c),eH):c}function eO(a){let b=new eM(a);return[eN(b,"",a),b]}function eP(a,b){let[c,d]=eO(a);return b(c),d.result()}function eQ(a){return a instanceof eJ||a instanceof eK?a._current:null!==a&&"object"==typeof a?a[eB]:a}(a=>{function b(a,c,d=0){return c.length<=d?a:(a instanceof ez||a instanceof eJ)&&"string"==typeof c[d]||(a instanceof eA||a instanceof eK)&&"string"==typeof c[d]?b(a.data(c[d]),c,d+1):"number"==typeof c[d]&&Array.isArray(a)||"string"==typeof c[d]&&"object"==typeof a?b(a[c[d]],c,d+1):void 0}a.equal=function(a,b){if(b.length!==a.length)return!1;for(var c=0;c<a.length;){if(a[c]!==b[c])return!1;c+=1}return!0},a.removeOverridden=function(a,c,d){let e=b(d,a);if(void 0===e||"object"!=typeof e||null===e)return c;{let f={...c};return Object.keys(e).forEach(a=>{delete f[a]}),f}},a.zoom=b})(e5||(e5={}));var eR=class{},eS=class extends eR{constructor(a){super(),this.id=a}},eT=class extends eR{constructor(a){super(),this.data=a}};try{e6=new TextDecoder}catch{}var eU,eV,eW,eX,eY,eZ,e$,e_,e0,e1,e2,e3,e4,e5,e6,e7,e8,e9,fa,fb,fc,fd,fe=0,ff=[],fg=ff,fh=0,fi={},fj=0,fk=0,fl=[],fm={useRecords:!1,mapsAsObjects:!0},fn=class{},fo=new fn;fo.name="MessagePack 0xC1";var fp=!1,fq=class{constructor(a){a&&(!1===a.useRecords&& void 0===a.mapsAsObjects&&(a.mapsAsObjects=!0),a.structures?a.structures.sharedLength=a.structures.length:a.getStructures&&((a.structures=[]).uninitialized=!0,a.structures.sharedLength=0)),Object.assign(this,a)}unpack(a,b){if(e7)return fP(()=>(fQ(),this?this.unpack(a,b):fq.prototype.unpack.call(fm,a,b)));e8=b> -1?b:a.length,fe=0,fh=0,fk=0,fa=null,fg=ff,fb=null,e7=a;try{fd=a.dataView||(a.dataView=new DataView(a.buffer,a.byteOffset,a.byteLength))}catch(c){throw e7=null,a instanceof Uint8Array?c:Error("Source must be a Uint8Array or Buffer but was a "+(a&&"object"==typeof a?a.constructor.name:typeof a))}if(this instanceof fq){if(fi=this,this.structures)return e9=this.structures,fr();(!e9||e9.length>0)&&(e9=[])}else fi=fm,(!e9||e9.length>0)&&(e9=[]);return fr()}unpackMultiple(a,b){let c,d=0;try{fp=!0;let e=a.length,f=this?this.unpack(a,e):fT.unpack(a,e);if(b){for(b(f);fe<e;)if(d=fe,!1===b(fr()))return}else{for(c=[f];fe<e;)d=fe,c.push(fr());return c}}catch(g){throw g.lastPosition=d,g.values=c,g}finally{fp=!1,fQ()}}_mergeStructures(a,b){a=a||[];for(let c=0,d=a.length;c<d;c++){let e=a[c];e&&(e.isShared=!0,c>=32&&(e.highByte=c-32>>5))}for(let f in a.sharedLength=a.length,b||[])if(f>=0){let g=a[f],h=b[f];h&&(g&&((a.restoreStructures||(a.restoreStructures=[]))[f]=g),a[f]=h)}return this.structures=a}decode(a,b){return this.unpack(a,b)}};function fr(){try{if(!fi.trusted&&!fp){let a=e9.sharedLength||0;a<e9.length&&(e9.length=a)}let b=ft();if(fe==e8)e9.restoreStructures&&fs(),e9=null,e7=null,fc&&(fc=null);else if(fe>e8){let c=Error("Unexpected end of MessagePack data");throw c.incomplete=!0,c}else if(!fp)throw Error("Data read, but end of buffer not reached");return b}catch(d){throw e9.restoreStructures&&fs(),fQ(),(d instanceof RangeError||d.message.startsWith("Unexpected end of buffer"))&&(d.incomplete=!0),d}}function fs(){for(let a in e9.restoreStructures)e9[a]=e9.restoreStructures[a];e9.restoreStructures=null}function ft(){let a=e7[fe++];if(a<160){if(a<128){if(a<64)return a;{let b=e9[63&a]||fi.getStructures&&fx()[63&a];return b?(b.read||(b.read=fv(b,63&a)),b.read()):a}}if(a<144){if(a-=128,fi.mapsAsObjects){let c={};for(let d=0;d<a;d++)c[fL()]=ft();return c}{let e=new Map;for(let f=0;f<a;f++)e.set(ft(),ft());return e}}else{let g=Array(a-=144);for(let h=0;h<a;h++)g[h]=ft();return g}}if(a<192){let i=a-160;if(fk>=fe)return fa.slice(fe-fj,(fe+=i)-fj);if(0==fk&&e8<140){let j=i<16?fH(i):fG(i);if(null!=j)return j}return fy(i)}{let k;switch(a){case 192:return null;case 193:return fb?(k=ft())>0?fb[1].slice(fb.position1,fb.position1+=k):fb[0].slice(fb.position0,fb.position0-=k):fo;case 194:return!1;case 195:return!0;case 196:return fI(e7[fe++]);case 197:return k=fd.getUint16(fe),fe+=2,fI(k);case 198:return k=fd.getUint32(fe),fe+=4,fI(k);case 199:return fJ(e7[fe++]);case 200:return k=fd.getUint16(fe),fe+=2,fJ(k);case 201:return k=fd.getUint32(fe),fe+=4,fJ(k);case 202:if(k=fd.getFloat32(fe),fi.useFloat32>2){let l=fR[(127&e7[fe])<<1|e7[fe+1]>>7];return fe+=4,(l*k+(k>0?.5:-.5)>>0)/l}return fe+=4,k;case 203:return k=fd.getFloat64(fe),fe+=8,k;case 204:return e7[fe++];case 205:return k=fd.getUint16(fe),fe+=2,k;case 206:return k=fd.getUint32(fe),fe+=4,k;case 207:return fi.int64AsNumber?(k=4294967296*fd.getUint32(fe),k+=fd.getUint32(fe+4)):k=fd.getBigUint64(fe),fe+=8,k;case 208:return fd.getInt8(fe++);case 209:return k=fd.getInt16(fe),fe+=2,k;case 210:return k=fd.getInt32(fe),fe+=4,k;case 211:return fi.int64AsNumber?(k=4294967296*fd.getInt32(fe),k+=fd.getUint32(fe+4)):k=fd.getBigInt64(fe),fe+=8,k;case 212:if(114==(k=e7[fe++]))return fM(63&e7[fe++]);{let m=fl[k];if(m)return m.read?(fe++,m.read(ft())):m.noBuffer?(fe++,m()):m(e7.subarray(fe,++fe));throw Error("Unknown extension "+k)}case 213:return 114==(k=e7[fe])?(fe++,fM(63&e7[fe++],e7[fe++])):fJ(2);case 214:return fJ(4);case 215:return fJ(8);case 216:return fJ(16);case 217:return k=e7[fe++],fk>=fe?fa.slice(fe-fj,(fe+=k)-fj):fz(k);case 218:return k=fd.getUint16(fe),fk>=(fe+=2)?fa.slice(fe-fj,(fe+=k)-fj):fA(k);case 219:return k=fd.getUint32(fe),fk>=(fe+=4)?fa.slice(fe-fj,(fe+=k)-fj):fB(k);case 220:return k=fd.getUint16(fe),fe+=2,fD(k);case 221:return k=fd.getUint32(fe),fe+=4,fD(k);case 222:return k=fd.getUint16(fe),fe+=2,fE(k);case 223:return k=fd.getUint32(fe),fe+=4,fE(k);default:if(a>=224)return a-256;if(void 0===a){let n=Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw Error("Unknown MessagePack token "+a)}}}var fu=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function fv(a,b){function c(){if(c.count++ >2){let d=a.read=Function("r","return function(){return {"+a.map(a=>fu.test(a)?a+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}}")(ft);return 0===a.highByte&&(a.read=fw(b,a.read)),d()}let e={};for(let f=0,g=a.length;f<g;f++)e[a[f]]=ft();return e}return c.count=0,0===a.highByte?fw(b,c):c}var fw=(a,b)=>function(){let c=e7[fe++];if(0===c)return b();let d=a<32?-(a+(c<<5)):a+(c<<5),e=e9[d]||fx()[d];if(!e)throw Error("Record id is not defined for "+d);return e.read||(e.read=fv(e,a)),e.read()};function fx(){let a=fP(()=>(e7=null,fi.getStructures()));return e9=fi._mergeStructures(a,e9)}var fy=fC,fz=fC,fA=fC,fB=fC;function fC(a){let b;if(a<16&&(b=fH(a)))return b;if(a>64&&e6)return e6.decode(e7.subarray(fe,fe+=a));let c=fe+a,d=[];for(b="";fe<c;){let e=e7[fe++];if((128&e)==0)d.push(e);else if((224&e)==192){let f=63&e7[fe++];d.push((31&e)<<6|f)}else if((240&e)==224){let g=63&e7[fe++],h=63&e7[fe++];d.push((31&e)<<12|g<<6|h)}else if((248&e)==240){let i=63&e7[fe++],j=63&e7[fe++],k=63&e7[fe++],l=(7&e)<<18|i<<12|j<<6|k;l>65535&&(l-=65536,d.push(l>>>10&1023|55296),l=56320|1023&l),d.push(l)}else d.push(e);d.length>=4096&&(b+=fF.apply(String,d),d.length=0)}return d.length>0&&(b+=fF.apply(String,d)),b}function fD(a){let b=Array(a);for(let c=0;c<a;c++)b[c]=ft();return b}function fE(a){if(fi.mapsAsObjects){let b={};for(let c=0;c<a;c++)b[fL()]=ft();return b}{let d=new Map;for(let e=0;e<a;e++)d.set(ft(),ft());return d}}var fF=String.fromCharCode;function fG(a){let b=fe,c=Array(a);for(let d=0;d<a;d++){let e=e7[fe++];if((128&e)>0){fe=b;return}c[d]=e}return fF.apply(String,c)}function fH(a){if(a<4){if(a<2){if(0===a)return"";{let b=e7[fe++];if((128&b)>1){fe-=1;return}return fF(b)}}{let c=e7[fe++],d=e7[fe++];if((128&c)>0||(128&d)>0){fe-=2;return}if(a<3)return fF(c,d);let e=e7[fe++];if((128&e)>0){fe-=3;return}return fF(c,d,e)}}{let f=e7[fe++],g=e7[fe++],h=e7[fe++],i=e7[fe++];if((128&f)>0||(128&g)>0||(128&h)>0||(128&i)>0){fe-=4;return}if(a<6){if(4===a)return fF(f,g,h,i);{let j=e7[fe++];if((128&j)>0){fe-=5;return}return fF(f,g,h,i,j)}}if(a<8){let k=e7[fe++],l=e7[fe++];if((128&k)>0||(128&l)>0){fe-=6;return}if(a<7)return fF(f,g,h,i,k,l);let m=e7[fe++];if((128&m)>0){fe-=7;return}return fF(f,g,h,i,k,l,m)}{let n=e7[fe++],o=e7[fe++],p=e7[fe++],q=e7[fe++];if((128&n)>0||(128&o)>0||(128&p)>0||(128&q)>0){fe-=8;return}if(a<10){if(8===a)return fF(f,g,h,i,n,o,p,q);{let r=e7[fe++];if((128&r)>0){fe-=9;return}return fF(f,g,h,i,n,o,p,q,r)}}if(a<12){let s=e7[fe++],t=e7[fe++];if((128&s)>0||(128&t)>0){fe-=10;return}if(a<11)return fF(f,g,h,i,n,o,p,q,s,t);let u=e7[fe++];if((128&u)>0){fe-=11;return}return fF(f,g,h,i,n,o,p,q,s,t,u)}{let v=e7[fe++],w=e7[fe++],x=e7[fe++],y=e7[fe++];if((128&v)>0||(128&w)>0||(128&x)>0||(128&y)>0){fe-=12;return}if(a<14){if(12===a)return fF(f,g,h,i,n,o,p,q,v,w,x,y);{let z=e7[fe++];if((128&z)>0){fe-=13;return}return fF(f,g,h,i,n,o,p,q,v,w,x,y,z)}}{let A=e7[fe++],B=e7[fe++];if((128&A)>0||(128&B)>0){fe-=14;return}if(a<15)return fF(f,g,h,i,n,o,p,q,v,w,x,y,A,B);let C=e7[fe++];if((128&C)>0){fe-=15;return}return fF(f,g,h,i,n,o,p,q,v,w,x,y,A,B,C)}}}}}function fI(a){return fi.copyBuffers?Uint8Array.prototype.slice.call(e7,fe,fe+=a):e7.subarray(fe,fe+=a)}function fJ(a){let b=e7[fe++];if(fl[b])return fl[b](e7.subarray(fe,fe+=a));throw Error("Unknown extension type "+b)}var fK=Array(4096);function fL(){let a=e7[fe++];if(!(a>=160)||!(a<192))return fe--,ft();if(a-=160,fk>=fe)return fa.slice(fe-fj,(fe+=a)-fj);if(!(0==fk&&e8<180))return fy(a);let b=(a<<5^(a>1?fd.getUint16(fe):a>0?e7[fe]:0))&4095,c=fK[b],d=fe,e=fe+a-3,f,g=0;if(c&&c.bytes==a){for(;d<e;){if((f=fd.getUint32(d))!=c[g++]){d=1879048192;break}d+=4}for(e+=3;d<e;)if((f=e7[d++])!=c[g++]){d=1879048192;break}if(d===e)return fe=d,c.string;e-=3,d=fe}for(c=[],fK[b]=c,c.bytes=a;d<e;)f=fd.getUint32(d),c.push(f),d+=4;for(e+=3;d<e;)f=e7[d++],c.push(f);let h=a<16?fH(a):fG(a);return null!=h?c.string=h:c.string=fy(a)}var fM=(a,b)=>{var c=ft();let d=a;void 0!==b&&(a=a<32?-((b<<5)+a):(b<<5)+a,c.highByte=b);let e=e9[a];return e&&e.isShared&&((e9.restoreStructures||(e9.restoreStructures=[]))[a]=e),e9[a]=c,c.read=fv(c,d),c.read()},fN="object"==typeof self?self:global;fl[0]=()=>{},fl[0].noBuffer=!0,fl[101]=()=>{let a=ft();return(fN[a[0]]||Error)(a[1])},fl[105]=a=>{let b=fd.getUint32(fe-4);fc||(fc=new Map);let c=e7[fe],d,e={target:d=c>=144&&c<160||220==c||221==c?[]:{}};fc.set(b,e);let f=ft();return e.used?Object.assign(d,f):(e.target=f,f)},fl[112]=a=>{let b=fd.getUint32(fe-4),c=fc.get(b);return c.used=!0,c.target},fl[115]=()=>new Set(ft());var fO=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(a=>a+"Array");function fP(a){let b=e8,c=fe,d=fh,e=fj,f=fk,g=fa,h=fg,i=fc,j=fb,k=new Uint8Array(e7.slice(0,e8)),l=e9,m=e9.slice(0,e9.length),n=fi,o=fp,p=a();return e8=b,fe=c,fh=d,fj=e,fk=f,fa=g,fg=h,fc=i,fb=j,e7=k,fp=o,(e9=l).splice(0,e9.length,...m),fi=n,fd=new DataView(e7.buffer,e7.byteOffset,e7.byteLength),p}function fQ(){e7=null,fc=null,e9=null}fl[116]=a=>{let b=a[0],c=fO[b];if(!c)throw Error("Could not find typed array for code "+b);return new fN[c](Uint8Array.prototype.slice.call(a,1).buffer)},fl[120]=()=>{let a=ft();return RegExp(a[0],a[1])},fl[98]=a=>{let b=(a[0]<<24)+(a[1]<<16)+(a[2]<<8)+a[3],c=fe;fe+=b-4,(fb=[ft(),ft()]).position0=0,fb.position1=0;let d=fe;fe=c;try{return ft()}finally{fe=d}},fl[255]=a=>new Date(4==a.length?(16777216*a[0]+(a[1]<<16)+(a[2]<<8)+a[3])*1e3:8==a.length?((a[0]<<22)+(a[1]<<14)+(a[2]<<6)+(a[3]>>2))/1e6+((3&a[3])*4294967296+16777216*a[4]+(a[5]<<16)+(a[6]<<8)+a[7])*1e3:12==a.length?((a[0]<<24)+(a[1]<<16)+(a[2]<<8)+a[3])/1e6+((128&a[4]?-281474976710656:0)+1099511627776*a[6]+4294967296*a[7]+16777216*a[8]+(a[9]<<16)+(a[10]<<8)+a[11])*1e3:"invalid");var fR=Array(147);for(let fS=0;fS<256;fS++)fR[fS]=+("1e"+Math.floor(45.15-.30103*fS));var fT=new fq({useRecords:!1}),fU=(fT.unpack,fT.unpackMultiple,fT.unpack,new Float32Array(1));new Uint8Array(fU.buffer,0,4);try{fV=new TextEncoder}catch{}var fV,fW,fX,fY,fZ,f$,f_="u">typeof m,f0=f_?m.allocUnsafeSlow:Uint8Array,f1=f_?m:Uint8Array,f2=f_?4294967296:2144337920,f3=0,f4=null,f5=/[\u0080-\uFFFF]/,f6=Symbol("record-id"),f7=class extends fq{constructor(a){super(a),this.offset=0;let b,c,d,e,f,g=0,h=f1.prototype.utf8Write?function(a,b,c){return fY.utf8Write(a,b,c)}:!!fV&&!!fV.encodeInto&&function(a,b){return fV.encodeInto(a,fY.subarray(b)).written},i=this;a||(a={});let j=a&&a.sequential,k=a.structures||a.saveStructures,l=a.maxSharedStructures;if(null==l&&(l=k?32:0),l>8160)throw Error("Maximum maxSharedStructure is 8160");let m=a.maxOwnStructures;null==m&&(m=k?32:64),j&&!a.saveStructures&&(this.structures=[]);let n=l>32||m+l>64,o=l+64,p=l+m+64;if(p>8256)throw Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let q=[],r=0,s=0;this.pack=this.encode=function(a,h){if(fY||(fY=new f0(8192),fZ=new DataView(fY.buffer,0,8192),f3=0),(f$=fY.length-10)-f3<2048?(fY=new f0(fY.length),fZ=new DataView(fY.buffer,0,fY.length),f$=fY.length-10,f3=0):f3=f3+7&2147483640,b=f3,f=i.structuredClone?new Map:null,i.bundleStrings?(f4=["",""],fY[f3++]=214,fY[f3++]=98,f4.position=f3-b,f3+=4):f4=null,c=i.structures){c.uninitialized&&(c=i._mergeStructures(i.getStructures()));let k=c.sharedLength||0;if(k>l)throw Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+c.sharedLength);if(!c.transitions){c.transitions=Object.create(null);for(let m=0;m<k;m++){let n=c[m];if(!n)continue;let o,p=c.transitions;for(let u=0,w=n.length;u<w;u++){let x=n[u];(o=p[x])||(o=p[x]=Object.create(null)),p=o}p[f6]=m+64}g=k}j||(c.nextId=k+64)}d&&(d=!1),e=c||[];try{if(t(a),f4){fZ.setUint32(f4.position+b,f3-f4.position-b);let y=f4;f4=null,t(y[0]),t(y[1])}if(i.offset=f3,f&&f.idsToInsert){(f3+=6*f.idsToInsert.length)>f$&&v(f3),i.offset=f3;let z=gb(fY.subarray(b,f3),f.idsToInsert);return f=null,z}return h&gi?(fY.start=b,fY.end=f3,fY):fY.subarray(b,f3)}finally{if(c){if(s<10&&s++,r>1e4)c.transitions=null,s=0,r=0,q.length>0&&(q=[]);else if(q.length>0&&!j){for(let A=0,B=q.length;A<B;A++)q[A][f6]=0;q=[]}if(d&&i.saveStructures){let C=c.sharedLength||l;c.length>C&&(c=c.slice(0,C));let D=fY.subarray(b,f3);return!1===i.saveStructures(c,g)?(i._mergeStructures(i.getStructures()),i.pack(a)):(g=C,D)}}h&gj&&(f3=b)}};let t=a=>{f3>f$&&(fY=v(f3));var c,d=typeof a;if("string"===d){let e=a.length;if(f4&&e>=8&&e<4096){let g=f5.test(a);f4[g?0:1]+=a,fY[f3++]=193,t(g?-e:e);return}let i;i=e<32?1:e<256?2:e<65536?3:5;let j=3*e;if(f3+j>f$&&(fY=v(f3+j)),e<64||!h){let k,l,m,n=f3+i;for(k=0;k<e;k++)(l=a.charCodeAt(k))<128?fY[n++]=l:l<2048?(fY[n++]=l>>6|192,fY[n++]=63&l|128):(64512&l)==55296&&(64512&(m=a.charCodeAt(k+1)))==56320?(l=65536+((1023&l)<<10)+(1023&m),k++,fY[n++]=l>>18|240,fY[n++]=l>>12&63|128,fY[n++]=l>>6&63|128,fY[n++]=63&l|128):(fY[n++]=l>>12|224,fY[n++]=l>>6&63|128,fY[n++]=63&l|128);c=n-f3-i}else c=h(a,f3+i,j);c<32?fY[f3++]=160|c:c<256?(i<2&&fY.copyWithin(f3+2,f3+1,f3+1+c),fY[f3++]=217,fY[f3++]=c):c<65536?(i<3&&fY.copyWithin(f3+3,f3+2,f3+2+c),fY[f3++]=218,fY[f3++]=c>>8,fY[f3++]=255&c):(i<5&&fY.copyWithin(f3+5,f3+3,f3+3+c),fY[f3++]=219,fZ.setUint32(f3,c),f3+=4),f3+=c}else if("number"===d){if(a>>>0===a)a<64?fY[f3++]=a:a<256?(fY[f3++]=204,fY[f3++]=a):a<65536?(fY[f3++]=205,fY[f3++]=a>>8,fY[f3++]=255&a):(fY[f3++]=206,fZ.setUint32(f3,a),f3+=4);else if(a>>0===a)a>= -32?fY[f3++]=256+a:a>= -128?(fY[f3++]=208,fY[f3++]=a+256):a>= -32768?(fY[f3++]=209,fZ.setInt16(f3,a),f3+=2):(fY[f3++]=210,fZ.setInt32(f3,a),f3+=4);else{let o;if((o=this.useFloat32)>0&&a<4294967296&&a>= -2147483648){fY[f3++]=202,fZ.setFloat32(f3,a);let p;if(o<4||(p=a*fR[(127&fY[f3])<<1|fY[f3+1]>>7])>>0===p){f3+=4;return}f3--}fY[f3++]=203,fZ.setFloat64(f3,a),f3+=8}}else if("object"===d){if(a){if(f){let q=f.get(a);if(q){if(!q.id){let r=f.idsToInsert||(f.idsToInsert=[]);q.id=r.push(q)}fY[f3++]=214,fY[f3++]=112,fZ.setUint32(f3,q.id),f3+=4;return}f.set(a,{offset:f3-b})}let s=a.constructor;if(s===Object)u(a,!0);else if(s===Array){(c=a.length)<16?fY[f3++]=144|c:c<65536?(fY[f3++]=220,fY[f3++]=c>>8,fY[f3++]=255&c):(fY[f3++]=221,fZ.setUint32(f3,c),f3+=4);for(let w=0;w<c;w++)t(a[w])}else if(s===Map)for(let[x,y]of((c=a.size)<16?fY[f3++]=128|c:c<65536?(fY[f3++]=222,fY[f3++]=c>>8,fY[f3++]=255&c):(fY[f3++]=223,fZ.setUint32(f3,c),f3+=4),a))t(x),t(y);else{for(let z=0,A=fW.length;z<A;z++)if(a instanceof fX[z]){let B=fW[z];if(B.write){B.type&&(fY[f3++]=212,fY[f3++]=B.type,fY[f3++]=0),t(B.write.call(this,a));return}let C=fY,D=fZ,E=f3;fY=null;let F;try{F=B.pack.call(this,a,a=>(fY=C,C=null,(f3+=a)>f$&&v(f3),{target:fY,targetView:fZ,position:f3-a}),t)}finally{C&&(fY=C,fZ=D,f3=E,f$=fY.length-10)}F&&(F.length+f3>f$&&v(F.length+f3),f3=ga(F,fY,f3,B.type));return}u(a,!a.hasOwnProperty)}}else fY[f3++]=192}else if("boolean"===d)fY[f3++]=a?195:194;else if("bigint"===d){if(a<BigInt(1)<<BigInt(63)&&a>= -(BigInt(1)<<BigInt(63)))fY[f3++]=211,fZ.setBigInt64(f3,a);else if(a<BigInt(1)<<BigInt(64)&&a>0)fY[f3++]=207,fZ.setBigUint64(f3,a);else if(this.largeBigIntToFloat)fY[f3++]=203,fZ.setFloat64(f3,Number(a));else throw RangeError(a+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");f3+=8}else if("undefined"===d)this.encodeUndefinedAsNil?fY[f3++]=192:(fY[f3++]=212,fY[f3++]=0,fY[f3++]=0);else if("function"===d)t(this.writeFunction&&this.writeFunction());else throw Error("Unknown type: "+d)},u=!1===this.useRecords?this.variableMapSize?a=>{let b=Object.keys(a),c=b.length;c<16?fY[f3++]=128|c:c<65536?(fY[f3++]=222,fY[f3++]=c>>8,fY[f3++]=255&c):(fY[f3++]=223,fZ.setUint32(f3,c),f3+=4);let d;for(let e=0;e<c;e++)t(d=b[e]),t(a[d])}:(a,c)=>{fY[f3++]=222;let d=f3-b;f3+=2;let e=0;for(let f in a)(c||a.hasOwnProperty(f))&&(t(f),t(a[f]),e++);fY[(d++)+b]=e>>8,fY[d+b]=255&e}:a=>{let b=Object.keys(a),c,f=e.transitions||(e.transitions=Object.create(null)),g=0;for(let h=0,i=b.length;h<i;h++){let j=b[h];(c=f[j])||(c=f[j]=Object.create(null),g++),f=c}let k=f[f6];if(k)k>=96&&n?(fY[f3++]=(31&(k-=96))+96,fY[f3++]=k>>5):fY[f3++]=k;else{(k=e.nextId)||(k=64),k<o&&this.shouldShareStructure&&!this.shouldShareStructure(b)?((k=e.nextOwnId)<p||(k=o),e.nextOwnId=k+1):(k>=p&&(k=o),e.nextId=k+1);let l=b.highByte=k>=96&&n?k-96>>5:-1;f[f6]=k,e[k-64]=b,k<o?(b.isShared=!0,e.sharedLength=k-63,d=!0,l>=0?(fY[f3++]=(31&k)+96,fY[f3++]=l):fY[f3++]=k):(l>=0?(fY[f3++]=213,fY[f3++]=114,fY[f3++]=(31&k)+96,fY[f3++]=l):(fY[f3++]=212,fY[f3++]=114,fY[f3++]=k),g&&(r+=s*g),q.length>=m&&(q.shift()[f6]=0),q.push(f),t(b))}for(let u=0,v=b.length;u<v;u++)t(a[b[u]])},v=a=>{let c;if(a>16777216){if(a-b>f2)throw Error("Packed buffer would be larger than maximum buffer size");c=Math.min(f2,4096*Math.round(Math.max((a-b)*(a>67108864?1.25:2),4194304)/4096))}else c=(Math.max(a-b<<2,fY.length-1)>>12)+1<<12;let d=new f0(c);return fZ=new DataView(d.buffer,0,c),fY.copy?fY.copy(d,0,b,a):d.set(fY.slice(b,a)),f3-=b,b=0,f$=d.length-10,fY=d}}useBuffer(a){fY=a,fZ=new DataView(fY.buffer,fY.byteOffset,fY.byteLength),f3=0}};function f8(a,b,c,d){let e=a.byteLength;if(e+1<256){var{target:f,position:g}=c(4+e);f[g++]=199,f[g++]=e+1}else if(e+1<65536){var{target:f,position:g}=c(5+e);f[g++]=200,f[g++]=e+1>>8,f[g++]=e+1&255}else{var{target:f,position:g,targetView:h}=c(7+e);f[g++]=201,h.setUint32(g,e+1),g+=4}f[g++]=116,f[g++]=b,f.set(new Uint8Array(a.buffer,a.byteOffset,a.byteLength),g)}function f9(a,b){let c=a.byteLength;if(c<256){var d,e,{target:d,position:e}=b(c+2);d[e++]=196,d[e++]=c}else if(c<65536){var{target:d,position:e}=b(c+3);d[e++]=197,d[e++]=c>>8,d[e++]=255&c}else{var{target:d,position:e,targetView:f}=b(c+5);d[e++]=198,f.setUint32(e,c),e+=4}d.set(a,e)}function ga(a,b,c,d){let e=a.length;switch(e){case 1:b[c++]=212;break;case 2:b[c++]=213;break;case 4:b[c++]=214;break;case 8:b[c++]=215;break;case 16:b[c++]=216;break;default:e<256?(b[c++]=199,b[c++]=e):e<65536?(b[c++]=200,b[c++]=e>>8,b[c++]=255&e):(b[c++]=201,b[c++]=e>>24,b[c++]=e>>16&255,b[c++]=e>>8&255,b[c++]=255&e)}return b[c++]=d,b.set(a,c),c+=e}function gb(a,b){let c,d=6*b.length,e=a.length-d;for(b.sort((a,b)=>a.offset>b.offset?1:-1);c=b.pop();){let f=c.offset,g=c.id;a.copyWithin(f+d,f,e);let h=f+(d-=6);a[h++]=214,a[h++]=105,a[h++]=g>>24,a[h++]=g>>16&255,a[h++]=g>>8&255,a[h++]=255&g,e=f}return a}function gc(a){var b;if(a.Class){if(!a.pack&&!a.write)throw Error("Extension has no pack or write function");if(a.pack&&!a.type)throw Error("Extension has no type (numeric code to identify the extension)");fX.unshift(a.Class),fW.unshift(a)}(b=a).unpack?fl[b.type]=b.unpack:fl[b.type]=b}fX=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,fn],fW=[{pack(a,b,c){let d=a.getTime()/1e3;if((this.useTimestamp32||0===a.getMilliseconds())&&d>=0&&d<4294967296){let{target:e,targetView:f,position:g}=b(6);e[g++]=214,e[g++]=255,f.setUint32(g,d)}else if(d>0&&d<17179869184){let{target:h,targetView:i,position:j}=b(10);h[j++]=215,h[j++]=255,i.setUint32(j,4e6*a.getMilliseconds()+(d/1e3/4294967296>>0)),i.setUint32(j+4,d)}else if(isNaN(d)){if(this.onInvalidDate)return b(0),c(this.onInvalidDate());let{target:k,targetView:l,position:m}=b(3);k[m++]=212,k[m++]=255,k[m++]=255}else{let{target:n,targetView:o,position:p}=b(15);n[p++]=199,n[p++]=12,n[p++]=255,o.setUint32(p,1e6*a.getMilliseconds()),o.setBigInt64(p+4,BigInt(Math.floor(d)))}}},{pack(a,b,c){let d=Array.from(a),{target:e,position:f}=b(this.structuredClone?3:0);this.structuredClone&&(e[f++]=212,e[f++]=115,e[f++]=0),c(d)}},{pack(a,b,c){let{target:d,position:e}=b(this.structuredClone?3:0);this.structuredClone&&(d[e++]=212,d[e++]=101,d[e++]=0),c([a.name,a.message])}},{pack(a,b,c){let{target:d,position:e}=b(this.structuredClone?3:0);this.structuredClone&&(d[e++]=212,d[e++]=120,d[e++]=0),c([a.source,a.flags])}},{pack(a,b){this.structuredClone?f8(a,16,b):f9(f_?m.from(a):new Uint8Array(a),b)}},{pack(a,b){let c=a.constructor;c!==f1&&this.structuredClone?f8(a,fO.indexOf(c.name),b):f9(a,b)}},{pack(a,b){let{target:c,position:d}=b(1);c[d]=193}}];var gd=new f7({useRecords:!1});gd.pack,gd.pack;var{NEVER:ge,ALWAYS:gf,DECIMAL_ROUND:gg,DECIMAL_FIT:gh}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},gi=512,gj=1024,gk=new f7({structuredClone:!0});function gl(a){if(ev(a))return a;if(Array.isArray(a))return a.map(gl);if("object"!=typeof a||null===a)return a;{let b={};for(let c of Object.keys(a).sort())b[c]=gl(a[c]);return Object.setPrototypeOf(b,Object.getPrototypeOf(a)),b}}gc({Class:er.prototype.constructor,type:1,write(a){return{...a}},read(a){return Object.setPrototypeOf(a,er.prototype),a}}),gc({Class:eA.prototype.constructor,type:2,write(a){return[...a]},read(a){return Object.setPrototypeOf(a,eA.prototype),a}}),gc({Class:ez.prototype.constructor,type:3,write(a){return[...a]},read(a){return Object.setPrototypeOf(a,ez.prototype),a}}),gc({Class:eS.prototype.constructor,type:4,write(a){return a.id},read(a){return new eS(a)}}),gc({Class:eT.prototype.constructor,type:5,write(a){return a.data},read(a){return new eT(a)}}),(a=>{function b(a){return gk.pack(a)}a.serialize=b,a.deserialize=function(a){return gk.unpack(a)},a.checksum=function(a){return(function(a){var b=0;if(0===a.length)return b;for(let c=0;c<a.length;c++)b=(b<<5)-b+a[c],b&=b;return b})(b(gl(a))).toString()}})(gt||(gt={})),(gm=gu||(gu={})).all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],gm.is=function(a){return gm.all.includes(a)},(a=>{function b(a){return c(a)}function c(a){if("PointLight"===a)return{type:a,color:e_.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if("SpotLight"===a)return{type:a,color:e_.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===a)return{type:a,color:e_.white,intensity:1,shadows:!0,size:1e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw Error("not implemented")}a.defaultData=b})(gv||(gv={})),(gn=gw||(gw={})).defaultData={castShadow:!0,receiveShadow:!0},gn.equals=function(a,b){return a.castShadow===b.castShadow&&a.receiveShadow===b.receiveShadow},(go=gx||(gx={})).defaultData={flatShading:!1,wireframe:!1,side:0},go.equals=function(a,b){return a.flatShading===b.flatShading&&a.side===b.side&&a.wireframe===b.wireframe},(gy||(gy={})).defaultData={...gx.defaultData,...gw.defaultData,cloner:null,booleanExclude:null};var gm,gn,go,gp,gq,gr,gs,gt,gu,gv,gw,gx,gy,gz,gA,gB=((gq=gB||{})[gq.Left=1]="Left",gq[gq.Right=2]="Right",gq[gq.Center=3]="Center",gq[gq.Justify=4]="Justify",gq),gC=((gr=gC||{})[gr.Top=1]="Top",gr[gr.Center=2]="Center",gr[gr.Bottom=3]="Bottom",gr),gD=((gs=gD||{})[gs.None=1]="None",gs[gs.Upper=2]="Upper",gs[gs.Lower=3]="Lower",gs);(gz||(gz={})).defaultData={width:100,height:100,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.5,letterSpacing:1,text:"",textTransform:1,color:e_.fromHexAndA(6974058,1),alpha:1,font:"roboto_regular"};var gE,gF,gG,gH,gI,gJ,gK,gL,gM,gN,gO,gP,gQ,gR,gS=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],gT=["wrapping","image"];function gU(a){a.layers.forEach(a=>{if("depth"===a.type&& void 0!==a.colorA){let b=a.colorA,c=a.colorB,d=[[b.r,b.g,b.b,b.a],[c.r,c.g,c.b,c.a]],e=[0,1];for(let f=2;f<10;f++)d.push(d[1]),e.push(1);let g={...eq(eQ(a),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,a.near),far:Math.max(0,a.far),colors:d,steps:e,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(a,g)}else if("depth"===a.type&&1===a.gradientType&&(a.near<0||a.far<0)){let h={...eQ(a),near:Math.max(a.near,0),far:Math.max(a.far,0)};Object.assign(a,h)}})}function gV(a,b){Object.values(a.shared.materials).forEach(a=>b(a))}function gW(a,b){a.scene.objects.traverse((a,c)=>{"materials"in c?c.materials.forEach(a=>{"string"!=typeof a&&b(a)}):"material"in c&&"string"!=typeof c.material&&b(c.material)})}function gX(a){void 0===a.layers&&Object.assign(a,iX.defaultTwoLayerData("lambert"))}function gY(a){a.layers&&a.layers.forEach(a=>{if("depth"===a.type&&10===a.colors.length){let b=[...a.colors];b.push(a.colors[9]);let c=[...a.steps];c.push(a.steps[9]);let d={...eQ(a),colors:b,steps:c};Object.assign(a,d)}})}function gZ(a){a.scene.objects.traverse((a,b)=>{"materials"in b?b.materials.forEach(a=>{"string"!=typeof a&&gY(a)}):"material"in b&&"string"!=typeof b.material&&gY(b.material)}),Object.values(a.shared.materials).forEach(a=>gY(a))}function g$(a){a.layers&&a.layers.forEach(a=>{"depth"===a.type&& void 0!==a.num&&(a.colors=a.colors.slice(0,a.num),a.steps=a.steps.slice(0,a.num),delete a.num)})}(iT=gE||(gE={})).defaultData=function(a,b){return"light"===a&&b?function a(b){switch(b){case"basic":return{type:"light",category:"basic",alpha:1,visible:!0,mode:0};case"phong":return{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"toon":return{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"lambert":return{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0};case"physical":return{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0}}}(b):function a(b){switch(b){case"texture":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"texture",projection:0,texture:{image:"image_0",wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!0};case"color":return{type:"color",alpha:1,visible:!0,mode:0,color:e$.fromHex(4737101)};case"depth":return{type:"depth",alpha:1,visible:!0,mode:0,gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{type:"normal",alpha:1,visible:!0,mode:0,cnormal:[1,1,1]};case"gradient":return{type:"gradient",alpha:1,visible:!0,mode:0,gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{type:"noise",alpha:1,visible:!0,mode:0,size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...e$.fromHex(6710886),a:1},colorB:{...e$.fromHex(6710886),a:1},colorC:{...e$.fromHex(16777215),a:1},colorD:{...e$.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8]};case"fresnel":return{type:"fresnel",alpha:1,visible:!0,mode:0,color:e_.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{type:"rainbow",alpha:1,visible:!0,mode:0,filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{type:"toon",alpha:1,visible:!0,mode:0,positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:e_.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{type:"outline",alpha:1,visible:!0,mode:0,outlineColor:e_.fromHexAndA(0,1),contourColor:e_.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{type:"matcap",alpha:1,visible:!0,mode:0,texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{type:"transmission",alpha:1,visible:!0,mode:0,thickness:10,ior:1.5,roughness:1};case"displace":return{type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,visible:!0}}}(a)},(a=>{function b(a){let b=0;for(let c of a.layers)"alpha"in c.data&&"light"!==c.data.type&&"fresnel"!==c.data.type&&(b+=(1-b)*c.data.alpha);return b<1}function c(a,b="layer1",c="layer2"){let d=new eA;return d.push({fi:0,data:gE.defaultData("light",a),id:b}),d.push({fi:1,data:gE.defaultData("color"),id:c}),{layers:d}}a.isMergable=function(a){return!a.layers.some(a=>{if("texture"===a.data.type&&0!==a.data.projection||"depth"===a.data.type&&!a.data.isWorldSpace||"noise"===a.data.type||"displace"===a.data.type)return!0})&&!b(a)},a.getHash=function(a){let b="";return a.layers.forEach(a=>{Object.entries(a.data).forEach(([a,c])=>{b+=`${a}${c}`,Array.isArray(c)?c.forEach(a=>b+=`${a}`):"object"==typeof c?Object.values(c).forEach(a=>{"number"==typeof a?b+=`${a.toFixed(4)}`:b+=`${a}`}):b+=`${c}`})}),b},a.isTransparent=b,a.defaultEmptyData=function(){return{layers:new eA}},a.defaultData=function(a="layer1",b="layer2"){return c("phong",a,b)},a.defaultTwoLayerData=c,a.defaultTwoLayerTextureData=function(a,b="basic",c="layer1",d="layer2"){let e=gE.defaultData("texture");Object.assign(e.texture,{image:a});let f=new eA;return f.push({fi:0,data:e,id:c}),f.push({fi:1,data:gE.defaultData("light",b),id:d}),{layers:f}}})(iX||(iX={})),(gF=iY||(iY={})).defaultData=function(){return{points:new eA,roundness:0,shapeHoles:[],isClosed:!1}},(gG=iZ||(iZ={})).is2DParametricMesh=function(a){return"PolygonGeometry"===a||"RectangleGeometry"===a||"StarGeometry"===a||"TriangleGeometry"===a||"EllipseGeometry"===a},(gH=i$||(i$={})).defaultData=function(a){if("RectangleGeometry"===a)return{width:320,height:320,type:a,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("VectorGeometry"===a)return{width:1,height:1,type:a,subdivisions:12,shape:iY.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===a)return{type:a,operation:2,width:0,height:0,depth:0,phongAngle:35};throw Error("not implemented")},(gI=i_||(i_={})).identity={...e0.identity,hiddenMatrix:eZ.identity},gI.fromObject=function(a){return{position:a.position,rotation:a.rotation,scale:a.scale,hiddenMatrix:a.hiddenMatrix}},gI.merge=function(a,b){return{position:b?.position||a.position,rotation:b?.rotation||a.rotation,scale:b?.scale||a.scale,hiddenMatrix:b?.hiddenMatrix||a.hiddenMatrix}},gI.diff=function(a,b){return{position:eX.isEqual(a.position,b.position)?null:b.position,rotation:eX.isEqual(a.rotation,b.rotation)?null:b.rotation,scale:eX.isEqual(a.scale,b.scale)?null:b.scale,hiddenMatrix:eZ.isEqual(a.hiddenMatrix,b.hiddenMatrix)?null:b.hiddenMatrix}},(i0||(i0={})).defaultData={states:new eA,events:new eA,visible:!0,raycastLock:!1,...i_.identity},(i1||(i1={})).defaultData={type:"Empty",...i0.defaultData},(i2||(i2={})).defaultData={type:"Mesh",...i0.defaultData,...gy.defaultData},(i3||(i3={})).defaultData={type:"TextFrame",...i0.defaultData,...gz.defaultData},(i4||(i4={})).defaultData={...i0.defaultData,...i_.identity,...eV.defaultData},(gO=i5||(i5={})).defaultData=function(a){return{...i0.defaultData,...gv.defaultData(a)}},(gP=i6||(i6={})).defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:eZ.identity,name:"Play Camera",visible:!0,raycastLock:!1,states:new eA,events:new eA,...eV.defaultData},gP.defaultMeshObject={name:"Rectangle",...i0.defaultData,...i2.defaultData,geometry:i$.defaultData("RectangleGeometry"),material:iX.defaultTwoLayerData("basic","layer1","layer2")},gP.defaultBooleanObject={name:"Boolean",...i0.defaultData,...i2.defaultData,geometry:i$.defaultData("BooleanGeometry"),material:iX.defaultTwoLayerData("phong","layer1","layer2")},(a=>{function b(a,b){if(void 0===b)return a;let c={...a};return"material"in c&&"material"in b&&b.material&&(c.material=eP(c.material,a=>{if("string"!=typeof a)for(let[c,d]of Object.entries(b.material.layers)){let e=a.layers.data(c);e&&eg(e,d)}}).data),c.materials&&b.materials&&(c.materials=eP(c.materials,a=>{for(let d=0;d<c.materials.length;d++){let e=b.materials[d];if("string"!=typeof e)for(let[f,g]of Object.entries(e.layers)){let h=a[d]?.layers?.data(f);h&&eg(h,g)}}}).data),c}a.patchMaterialState=b,a.patch=function(a,c){if(void 0===c)return a;let d={...a};if(Object.assign(d,i_.merge(d,c)),eU.is(a.type)){d.orthographic={...d.orthographic},d.perspective={...d.perspective};let e=c;e.orthographic?.zoom!==void 0&&(d.orthographic.zoom=e.orthographic.zoom),e.perspective?.zoom!==void 0&&(d.perspective.zoom=e.perspective.zoom),void 0!==e.isUpVectorFlipped&&(d.isUpVectorFlipped=e.isUpVectorFlipped),void 0!==e.targetOffset&&(d.targetOffset=e.targetOffset)}else if("Mesh"===a.type)d.geometry={...d.geometry},Object.assign(d.geometry,c.geometry),d=b(d,c);else if(gu.is(a.type)){let f=c;void 0!==f.intensity&&(d.intensity=f.intensity),void 0!==f.color&&("string"==typeof f.color?d.color=f.color:d.color=e$.clone(f.color))}return d}})(i7||(i7={})),(i8||(i8={})).defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3},(gR=i9||(i9={})).defaultColors=function(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},z(a,er.prototype)},gR.emptyData=function(){return{materials:new er,images:new er,colors:new er,audios:new er,penumbraSize:[.5,.5,.5]}},(ja||(ja={})).emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="};var g_=class extends h.Color{constructor(a,b,c,d){super(a,b,c),this.isColorA=!0,this.a=d}setRGBA(a,b,c,d){super.setRGB(a,b,c),this.a=d}copy(a){return super.copy(a),this.a="a"in a?a.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(a){this.r=a}set y(a){this.g=a}set z(a){this.b=a}set w(a){this.a=a}},g0=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:0,cornerSegments:8,hollow:0},a.parameters),d=c.width/2,e=c.radiusTop??d,f=c.radiusBottom??d;return e===f?(e=d,f=d):e>f?(e=d,f=f*d/e):(e=e*d/f,f=d),{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width),radiusTop:e,radiusBottom:f})}}static build(a){let{width:b,depth:c,height:d,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:i,thetaLength:j,radiusTop:k,radiusBottom:l,cornerRadius:m,cornerSegments:n,hollow:o}=a.parameters,p;return(p=m||o?new g3(k,l,d,e,f,g,i,j*Math.PI/180,m,m,n,o):new h.CylinderBufferGeometry(k,l,d,e,f,g,i,j*Math.PI/180)).scale(1,1,c/b),Object.assign(p,{userData:{...a,type:"CylinderGeometry"}})}};function g1(a,b,c){c.x=a.x*b.x,c.y=a.y,c.z=a.x*b.y}function g2(a){return new h.Vector2(a.y,-a.x)}var g3=class extends h.BufferGeometry{constructor(a,b,c,d,e,f,g,i,j,k,l,m,n=!1){super(),this.type="RoundedCylinderBufferGeometry",a=void 0!==a?a:1,b=void 0!==b?b:1,c=c||1,d=Math.floor(d)||8,e=Math.floor(e)||1,f=void 0!==f&&f,g=void 0!==g?g:0,i=void 0!==i?i:2*Math.PI,f&&(j=0,k=0);let o=[],p=[],q=[],r=[],s=0,t=c/2,u=new h.Vector3,v=new h.Vector3;n&&0==a&&(a=j),n&&0==b&&(b=k);let w=new h.Vector2(a,t),x=new h.Vector2(b,-t),y=null,z=null,A=null,B=null,C=w.clone().sub(x),D=0,E=0,F=0;m>0&&(D=Math.min(a,b)*(1-m),E=a-D,F=b-D);let G=w.clone();G.x-=D;let H=Math.PI-C.angle(),I=C.angle(),J=Math.tan(I/2),K=Math.tan(H/2),L=J+K,M=m?L:K,N=m?L:J;if(j=Math.min(j,(a-E)/M,C.length()/L),k=Math.min(k,(b-F)/N,C.length()/L),j>0){let O=j/J;y=w.clone().sub(new h.Vector2(O,j)),m&&(A=y.clone(),A.x-=D-L*j),w.sub(C.clone().setLength(O))}if(k>0){let P=k/K;z=x.clone().sub(new h.Vector2(P,-k)),x.add(C.clone().setLength(P)),m&&(B=z.clone(),B.x-=D-L*k,G.sub(C.clone().setLength(P)))}let Q=.5>(C=w.clone().sub(x)).length(),R=[];for(let S=0;S<=d;S++){let T=[],U=S/d,V=U*i+g,W=new h.Vector2(Math.sin(V),Math.cos(V));B&&z?(al(T,U,W,H,k,B,-1,!0),al(T,U,W,I,k,z,-1,!1)):z?(am(T,W,z.x,0,-1),al(T,U,W,I,k,z,-1,!1)):f||am(T,W,b,F,-1);let X=g2(C).normalize();if(g1(X,W,u),!Q)for(let Y=0;Y<=e;Y++){let Z=Y/e,$=C.clone().multiplyScalar(Z).add(x);g1($,W,v),p.push(v.x,v.y,v.z),q.push(u.x,u.y,u.z),r.push(U,.5+v.y/c),T.push(s++)}if(A&&y?(al(T,U,W,H,j,y,1,!1),al(T,U,W,I,j,A,1,!0)):y?(al(T,U,W,H,j,y,1,!1),am(T,W,y.x,0,1)):f||am(T,W,a,E,1),m&&!Q){let _=g2(C).multiplyScalar(-1).normalize();g1(_,W,u);for(let aa=0;aa<=e;aa++){let ab=aa/e,ac=C.clone().multiplyScalar(-ab).add(G);g1(ac,W,v),p.push(v.x,v.y,v.z),q.push(u.x,u.y,u.z),r.push(U,.5+v.y/c),T.push(s++)}}m&&!f&&T.push(T[0]),R.push(T)}for(let ad=0;ad<R.length-1;ad++)for(let ae=0;ae<R[0].length-1;ae++){if(f&&m&&ae==e)continue;let af=R[ad][ae],ag=R[ad+1][ae],ah=R[ad+1][ae+1],ai=R[ad][ae+1],aj=p[3*ah+0],ak=p[3*ah+2];o.push(af,ag,ai),(0!=aj||0!=ak)&&o.push(ag,ah,ai)}function al(a,b,d,e,f,g,i,j){for(let k=0;k<l+1;k++){let m=k/l,n=i<0?m:1-m;j&&(n-=1),n*=e;let o=new h.Vector2(Math.sin(n),Math.cos(n)*i),t=o.clone().multiplyScalar(f).add(g);g1(t,d,v),p.push(v.x,v.y,v.z),g1(o,d,u),q.push(u.x,u.y,u.z),r.push(b,.5+v.y/c),a.push(s++)}}function am(a,b,c,d,e){let f=new h.Vector3,g=new h.Vector2,i=[c,d];for(let j of(e<0&&i.reverse(),i))g.set(j,t*e),g1(g,b,f),p.push(f.x,f.y,f.z),q.push(0,e,0),r.push(.5,.5),a.push(s++)}function an(c,d,e){let f=new h.Vector2(Math.sin(e),Math.cos(e)),g=new h.Vector2(-Math.cos(e),Math.sin(e)),i=new h.Vector3,j=c<0?(a,b,c)=>o.push(a,b,c):(a,b,c)=>o.push(a,c,b),k=new h.Vector2((a+b+E+F)/4,0);g1(k,f,i),p.push(i.x,i.y,i.z),q.push(g.x,0,g.y),r.push(.5,.5);let l=s++;for(let m of d){let n=p.slice(3*m,3*m+3);p.push(...n),q.push(g.x,0,g.y);let t=r.slice(2*m,2*m+2);r.push(...t),s++}for(let u=l+1;u<s-1;u++)j(l,u,u+1);j(l,s-1,l+1)}i<2*Math.PI&&(an(-1,R[0],g),an(1,R[R.length-1],g+i)),this.setIndex(o),this.setAttribute("position",new h.Float32BufferAttribute(p,3)),this.setAttribute("normal",new h.Float32BufferAttribute(q,3)),this.setAttribute("uv",new h.Float32BufferAttribute(r,2))}},g4=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:0,cornerRadiusBottom:0,cornerSegments:8},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b,depth:c,height:d,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:i,thetaLength:j,cornerRadiusTop:k,cornerRadiusBottom:l,cornerSegments:m}=a.parameters,n;return(n=k>0||l>0||j<360?new g3(0,b/2,d,e,f,g,i,j*Math.PI/180,k,l,m,0,!0):new h.ConeBufferGeometry(b/2,d,e,f,g)).scale(1,1,c/b),Object.assign(n,{userData:{...a,type:"ConeGeometry"}})}},g5=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:0,cornerSegments:8},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b,height:c,depth:d,widthSegments:e,heightSegments:f,depthSegments:g,cornerRadius:i,cornerSegments:j}=a.parameters,k;return Object.assign(0==i?new h.BoxBufferGeometry(b,c,d,e,f,g):new g7(b,c,d,e,f,g,i,j),{userData:{...a,type:"CubeGeometry"}})}},g6=Math.PI/2,g7=class extends h.BufferGeometry{constructor(a=1,b=1,c=1,d=1,e=1,f=1,g=0,i=4){super(),this.type="BoxBufferGeometry";let j=this;d=Math.floor(d),e=Math.floor(e),f=Math.floor(f),i=Math.floor(i),g=Math.min(g,a/2,b/2,c/2);let k=[],l=[],m=[],n=[],o=0,p=0;function q(a,b,c,d,e,f,i,q,r,s,t){let u=(f-2*g)/r,v=(i-2*g)/s,w=f/2-g,x=i/2-g,y=q/2,z=r+1,A=s+1,B=0,C=0,D=new h.Vector3;for(let E=0;E<A;E++){let F=E*v-x;for(let G=0;G<z;G++){let H=G*u-w;D[a]=H*d,D[b]=F*e,D[c]=y,l.push(D.x,D.y,D.z),D[a]=0,D[b]=0,D[c]=q>0?1:-1,m.push(D.x,D.y,D.z),n.push(G/r),n.push(1-E/s),B+=1}}for(let I=0;I<s;I++)for(let J=0;J<r;J++){let K=o+J+z*I,L=o+J+z*(I+1),M=o+(J+1)+z*(I+1),N=o+(J+1)+z*I;k.push(K,L,N),k.push(L,M,N),C+=6}j.addGroup(p,C,t),p+=C,o+=B}function r(a,b,c,d,e,f,q,r,s,t,u){let v=(q-2*g)/t,w=q/2-g,x=r/2-g,y=s/2,z=t+1,A=0,B=0,C=new h.Vector3,D=new h.Vector3;for(let E=0;E<i+1;E++){let F=E/i*g6,G=Math.sin(F)*g,H=(1-Math.cos(F))*g,I=Math.sin(F),J=Math.cos(F);C[b]=(x+G)*e,C[c]=(y-H)*f,D[a]=0,D[b]=I*Math.sign(C[b]),D[c]=J*Math.sign(C[c]);for(let K=0;K<z;K++){let L=K*v-w;C[a]=L*d,l.push(C.x,C.y,C.z),m.push(D.x,D.y,D.z),n.push(K/t),n.push(0),A+=1}}for(let M=0;M<i;M++)for(let N=0;N<t;N++){let O=o+N+z*M,P=o+N+z*(M+1),Q=o+(N+1)+z*(M+1),R=o+(N+1)+z*M;k.push(O,P,R),k.push(P,Q,R),B+=6}j.addGroup(p,B,u),p+=B,o+=A}function s(d,e,f){let j=new h.Vector3,p=new h.Vector3(a/2,b/2,c/2);p.subScalar(g);let q=[],r=d*e*f>0?(a,b,c)=>k.push(a,b,c):(a,b,c)=>k.push(a,c,b);for(let s=0;s<=i;s++){let t=[],u=g6*(1-s/i),v=Math.cos(u),w=Math.sin(u),x=0;for(let y=0;y<=s;y++){let z=Math.cos(x),A=Math.sin(x);j.x=v*z,j.y=w,j.z=v*A;let B=p.clone().addScaledVector(j,g);l.push(d*B.x,e*B.y,f*B.z),m.push(d*j.x,e*j.y,f*j.z),n.push(0,0),t.push(o++),x+=g6/s}q.push(t)}let C=q.length-1;for(let D=0;D<C;D++){let E=q[D],F=q[D+1],G=E.length-1;r(E[0],F[1],F[0]);for(let H=1;H<=G;H++)r(E[H-1],E[H],F[H]),r(E[H],F[H+1],F[H])}}q("z","y","x",-1,-1,c,b,a,f,e,0),q("z","y","x",1,-1,c,b,-a,f,e,1),q("x","z","y",1,1,a,c,b,d,f,2),q("x","z","y",1,-1,a,c,-b,d,f,3),q("x","y","z",1,-1,a,b,c,d,e,4),q("x","y","z",-1,-1,a,b,-c,d,e,5),g>0&&(r("z","y","x",-1,-1,1,c,b,a,f,0),r("z","y","x",1,-1,-1,c,b,a,f,1),r("z","y","x",-1,1,-1,c,b,a,f,1),r("z","y","x",1,1,1,c,b,a,f,0),r("x","y","z",-1,-1,-1,a,b,c,d,0),r("x","y","z",1,-1,1,a,b,c,d,1),r("x","y","z",-1,1,1,a,b,c,d,0),r("x","y","z",1,1,-1,a,b,c,d,1),r("y","x","z",-1,-1,1,b,a,c,e,0),r("y","x","z",1,-1,-1,b,a,c,e,1),r("y","x","z",1,1,1,b,a,c,e,1),r("y","x","z",-1,1,-1,b,a,c,e,0),s(1,1,1),s(-1,1,1),s(1,-1,1),s(-1,-1,1),s(1,1,-1),s(-1,1,-1),s(1,-1,-1),s(-1,-1,-1)),this.setIndex(k),this.setAttribute("position",new h.Float32BufferAttribute(l,3)),this.setAttribute("normal",new h.Float32BufferAttribute(m,3)),this.setAttribute("uv",new h.Float32BufferAttribute(n,2))}},g8=class extends h.BufferGeometry{constructor(a=[],b=[],c="",d=1,e=.2,f=4){super(),this.type="PolyhedronGeometryRound";let g=[],i=[],j=[];(function(){0==(e=Math.min(1-1e-5,e))&&(f=0);let i={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[c],k=new h.Vector3,l=k.clone(),m=new h.Triangle,n=e*d,o=d-n,p=f+1,q=new h.Vector3,r=(a,b)=>q.subVectors(a,b).normalize(),s=(a,b)=>Array(a).fill(void 0).map(b),t=s(a.length/3,(b,c)=>new h.Vector3().fromArray(a,3*c).setLength(d)),u=[];for(let v=0;v<t.length;v++){let w=t[v],x=[],y,z,A,B=1e10,C=-1;for(;-1!=(C=b.indexOf(v,C+1));){let D=C-C%3;y=b[D+(C+1)%3],z=b[D+(C+2)%3],A=w.distanceToSquared(t[y]),B=Math.min(B,A),x.push([y,z,A])}B+=1e-6;let E=[],F=0,G=x.length;for(let H=0;H<G;H++){[y,z,A]=x[F];let I=!0==u[y]?.includes(v);A<=B&&E.push(y+1e6*+I),F=x.findIndex(a=>a[0]==z)}u.push(E)}let J=[];{let K=0,L=0,M,N,O=3==i;for(let P=0;P<=f;P++){M=P*(P+1)/2,N=(P+1)*(P+2)/2;for(let Q=0;Q<f-P;Q++)[K,L]=[M+Q+P+2,N+Q+P+3],J.push(M,N,...O?[L,M]:[K,N],L,K),[M,N]=[K,L];J.push(M,N,M+f+2)}}let R=k.clone(),S=k.clone(),T=k.clone(),U=k.clone(),V=k.clone(),W=[],X=s(t.length,()=>s(i,()=>k.clone()));for(let Y=0;Y<t.length;Y++){k.copy(t[Y]).normalize(),R.copy(k).multiplyScalar(o);let Z=u[Y];for(let $=0;$<Z.length;$++){let _=Z[$],aa=Z[($+1)%i];m.setFromPointsAndIndices(t,Y,_%1e6,aa%1e6),m.b.sub(m.a).setLength(1e10).add(m.a),m.c.sub(m.a).setLength(1e10).add(m.a),m.closestPointToPoint(R,X[Y][$])}let ab=[],ac=[],ad=[],ae=new h.Vector3;0==f&&[...X[Y]].reduce((a,b)=>a.add(b),ae).multiplyScalar(1/i);for(let af=0;af<i;af++){let ag=[],ah=(af-1+i)%i,ai=X[Y][ah],aj=X[Y][af];k.copy(ai).sub(R),l.copy(aj).sub(R);let ak=R.angleTo(k),al=k.angleTo(l),am=Math.cos(ak)*n;0==f?S.copy(ae):S.copy(R).setLength(o+am),ac.push(am);let an=[S,ai,aj];for(let ao=0;ao<2;ao++){let ap=an[ao],aq=an[ao+1];U.subVectors(ap,R),V.subVectors(aq,R),T.crossVectors(U,V).normalize();for(let ar=0;ar<p;ar++){let as=[ak,al][ao]*ar/p;k.copy(U).applyAxisAngle(T,as).add(R),ab.push(k.clone()),ao&&(r(k,R),ag.push([0==ar?ap:k.clone(),q.clone()]))}ao&&(r(aq,R),ag.push([aq,q.clone()]))}ad.push(ag)}W.push(ad);let at=2*p,au=2;for(let av=0;av<i;av++){let aw=at*av,ax=at*((av+1)%i),ay=[ab[aw]];for(let az=1;az<p;az++){U=ab[aw+az],V=ab[ax+az],ay.push(U);for(let aA=1,aB=az-au+1;aA<=aB;aA++)k.lerpVectors(U,V,aA/(aB+1)),k.sub(R).setLength(ac[av]).add(R),ay.push(k.clone());ay.push(V)}for(let aC=0;aC<p;aC++)ay.push(ab[aC+p+aw]);ay.push(ab[ax+p]);let aD=J.map(a=>ay[a]);g.push(...aD.map(a=>[a.x,a.y,a.z]).flat()),j.push(...aD.map(a=>(r(a,R),[q.x,q.y,q.z])).flat())}}let aE=[];for(let aF=0;aF<u.length;aF++)for(let aG=0;aG<i;aG++){let aH=u[aF][aG];if(aH<1e6){let aI=u[aH].findIndex(a=>a%1e6==aF),aJ=W[aF][aG],aK=W[aH][aI];for(let aL=0;aL<p;aL++){let aM=aJ[aL],aN=aK[p-aL],aO=aJ[aL+1],aP=aK[p-(aL+1)];[aM,aN,aO,aO,aN,aP].forEach(a=>{g.push(a[0].x,a[0].y,a[0].z),j.push(a[1].x,a[1].y,a[1].z)})}aE.push(aJ[0][0],aK[p][0],aJ[p][0],aK[0][0])}}for(;aE.length;){let aQ,aR,aS,aT;[aQ,aR]=aE.splice(0,2);let aU=[aQ];for(;aQ!=aR;)aU.push(aR),aT=(aS=aE.indexOf(aR))%2,aR=aE.splice(aS-aT,2)[1-aT];q.subVectors(aU[0],aU[1]).cross(k.subVectors(aU[0],aU[2])).normalize();let aV=0>q.dot(aU[0]);aV&&q.negate();for(let aW=1;aW<=aU.length-2;aW++)[aU[aW+ +aV],aU[aW+1- +aV],aU[0]].forEach(a=>{g.push(a.x,a.y,a.z),j.push(q.x,q.y,q.z)})}})(),function(){let a=new h.Vector3;for(let b=0;b<g.length;b+=3){a.x=g[b+0],a.y=g[b+1],a.z=g[b+2];let c=y(a)/2/Math.PI+.5,d=z(a)/Math.PI+.5;i.push(c,1-d)}let e=new h.Vector3,f=new h.Vector3,j=new h.Vector3,k=new h.Vector3,l=new h.Vector2,m=new h.Vector2,n=new h.Vector2,o=(a,b,c,d)=>{d<0&&1===a.x&&(i[b]=a.x-1),0===c.x&&0===c.z&&(i[b]=d/2/Math.PI+.5)};for(let p=0,q=0;p<g.length;p+=9,q+=6){e.set(g[p+0],g[p+1],g[p+2]),f.set(g[p+3],g[p+4],g[p+5]),j.set(g[p+6],g[p+7],g[p+8]),l.set(i[q+0],i[q+1]),m.set(i[q+2],i[q+3]),n.set(i[q+4],i[q+5]),k.copy(e).add(f).add(j).divideScalar(3);let r=y(k);o(l,q+0,e,r),o(m,q+2,f,r),o(n,q+4,j,r)}for(let s=0;s<i.length;s+=6){let t=i[s+0],u=i[s+2],v=i[s+4],w=Math.max(t,u,v),x=Math.min(t,u,v);w>.9&&x<.1&&(t<.2&&(i[s+0]+=1),u<.2&&(i[s+2]+=1),v<.2&&(i[s+4]+=1))}function y(a){return Math.atan2(a.z,-a.x)}function z(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}}(),this.setAttribute("position",new h.Float32BufferAttribute(g,3)),this.setAttribute("normal",new h.Float32BufferAttribute(j,3)),this.setAttribute("uv",new h.Float32BufferAttribute(i,2))}static fromJSON(a){return new g8(a.vertices,a.indices,a.radius,a.corner,a.cornerSides)}},g9=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,detail:0,corner:0,cornerSides:4},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b,height:c,depth:d,detail:e,corner:f,cornerSides:g}=a.parameters,i=0===e&&0!==f?new ha(.5*b,f,g):new h.DodecahedronBufferGeometry(.5*b,e);return i.scale(1,c/b,d/b),Object.assign(i,{userData:{...a,type:"DodecahedronGeometry"}})}},ha=class extends g8{constructor(a=1,b=.2,c=4){let d=(1+Math.sqrt(5))/2,e=1/d,f="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-e,-d,0,-e,d,0,e,-d,0,e,d,-e,-d,0,-e,d,0,e,-d,0,e,d,0,-d,0,-e,d,0,-e,-d,0,e,d,0,e],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],f,a,b,c),this.type=f}static fromJSON(a){return new ha(a.radius,a.corner,a.cornerSides)}},hb=class{constructor(a){this.position=new h.Vector2,this.startPosition=new h.Vector2,this.uuid=h.MathUtils.generateUUID(),this.position=a.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(a){this.position.copy(this.startPosition).add(a)}copy(a){return this.position.copy(a.position),this.startPosition.copy(a.startPosition),this}clone(){return new hb(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},hc=class extends hb{constructor(a){super(a.position),this.parent=a}copy(a){return super.copy(a),this}clone(){return new hc(this.parent).copy(this)}},hd=class extends hb{constructor(a,b){super(b),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=a,this.controls.push(new hc(this),new hc(this))}static create(a,b){let c=new hd(a,new h.Vector2(...b.position));return c.controls[0].position.set(...b.controlPrevious.position),c.controls[1].position.set(...b.controlNext.position),c.roundness=b.roundness,c.areControlsDirectionsMirrored=b.areControlsDirectionsMirrored,c}getOppositeControl(a){let b=this.controls.indexOf(a);return 0===b?this.controls[1]:1===b?this.controls[0]:null}applyOffsetToControls(a,b=1){for(let c=0,d=this.controls.length;c<d;c++){let e=this.controls[c];this.position.distanceTo(e.position)<=b?e.position.copy(this.position):e.applyOffset(a)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(a){return super.copy(a),this.controls[0].copy(a.controls[0]),this.controls[1].copy(a.controls[1]),this.roundness=a.roundness,this.uuid=a.uuid,this}clone(){return new hd(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let a;return[this.curveBefore?.getTangentAt(1),this.curveAfter?.getTangentAt(0)]}computeNormals(a=new h.Vector2,b=new h.Vector2){let[c,d]=this.computeTangents();return c&&d&&(he(c,a),he(d,b)),[a,b]}computeTangent(a=new h.Vector2){let[b,c]=this.computeTangents();return b&&c&&a.copy(b).add(c).normalize(),a}computeNormal(a=new h.Vector2){let[b,c]=this.computeNormals();return a.copy(b).add(c).normalize(),a}};function he(a,b=new h.Vector2){let c=a.length();return b.set(-a.y/c,a.x/c)}var hf=a=>a,hg=new h.Vector2,hh=new h.Vector2,hi=new h.Vector2,hj=new h.Vector2,hk=new h.Vector2,hl=new h.Vector2,hm=new h.Vector3,hn=new h.Vector3;function ho(a){let b=new h.Vector2;b.addVectors(a.v0,hg.subVectors(a.v1,a.v0).multiplyScalar(2/3));let c=new h.Vector2;return c.addVectors(a.v2,hh.subVectors(a.v1,a.v2).multiplyScalar(2/3)),new h.CubicBezierCurve(a.v0,b,c,a.v2)}function hp(a,b,c=Number.EPSILON){return Math.abs(a-b)<c}function hq(a,b,c=Number.EPSILON){return a.distanceTo(b)<c}function hr(a,b,c=Number.EPSILON){return a.distanceTo(b)<c}function hs(a,b,c){let d=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),e=Math.sqrt(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2)),f=Math.sqrt(Math.pow(c.x-a.x,2)+Math.pow(c.y-a.y,2));return Math.acos((e*e+d*d-f*f)/(2*e*d))}function ht(a,b,c){return hz(a,b)&&hz(b,c)&&hu(a.position,b.position,c.position)}function hu(a,b,c){return 0===hg.copy(b).sub(a).cross(hh.copy(c).sub(a))}function hv(a,b,c,d,e){let f=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)),g=(a.y+b.y)/2,h=(a.x+b.x)/2,i=Math.sqrt(Math.pow(c,2)-Math.pow(f/2,2))*(a.y-b.y)/f,j=Math.sqrt(Math.pow(c,2)-Math.pow(f/2,2))*(b.x-a.x)/f;return d.set(h+i,g+j),e.set(h-i,g-j),[d,e]}function hw(a,b,c){let d=a.distanceTo(c),e=b.distanceTo(c);return d<e?b:a}function hx(a,b,c,d,e,f){let g=b.x-a.x,h=b.y-a.y,i=c.x-a.x,j=c.y-a.y,k=Math.sqrt((g+i)*(g+i)+(h+j)*(h+j)),l;return hs(b,a,c)>Math.PI&&(k*=-1),l=hp(j,h)?(h+j)*(d/k-.5)*8/3/(g-i):(g+i)*(d/k-.5)*8/3/(j-h),e.set(b.x-l*h,b.y+l*g),f.set(c.x+l*j,c.y-l*i),[e,f]}function hy(a,b){return a.position.equals(a.controls[1].position)&&b.position.equals(b.controls[0].position)}function hz(a,b){return hu(a.position,a.controls[1].position,b.position)&&hu(a.position,b.controls[0].position,b.position)}function hA(a,b=12,c=!1){let d=[];for(let e=0,f=a.length;e<f;e++){let g=a[e],h=0;if(c&& void 0!==g.roundedCurveCorner){let i=.5*hB(g.roundedCurveCorner,b);e>0&&(d[e-1]+=i),h+=i}void 0!==g.curveAfter&&(h+=hB(g.curveAfter,b)),d.push(h)}return a.length>0&&c&& void 0!==a[0].roundedCurveCorner&&(d[a.length-1]+=.5*hB(a[0].roundedCurveCorner,b)),d}function hB(a,b=12){return a&&a instanceof h.EllipseCurve?2*b:a&&(a instanceof h.LineCurve||a instanceof h.LineCurve3)?1:a&&a instanceof h.SplineCurve?b*a.points.length:b}var hC=new h.Vector2,hD=new h.Vector2,hE=new h.Vector2,hF=new h.Vector2,hG=new h.Vector2,hH=new h.Vector2,hI=class extends h.Shape{constructor(a=100,b=100){super(),this.points=[],this.shapeHoles=[],this.eventDispatcher=new h.EventDispatcher,this.plane=new h.Plane(new h.Vector3(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=h.MathUtils.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=a,this._height=b}static createFromState(a,b,c){let d=new hI;return d.isClosed=a.isClosed,d.points=a.points.map(a=>hd.create(a.id,a.data)),"number"==typeof a.roundness&&(d.roundness=a.roundness),d.shapeHoles=a.shapeHoles.map(a=>hI.createFromState(a)),void 0!==b&& void 0!==c&&d.applySize(b,c),d.update(),d}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(a){if(this._roundness!==a){this._roundness=a;for(let b=0,c=this.points.length;b<c;b++)this.points[b].roundness=a;this.needsUpdate=!0}}getPointsIndexesByIds(a){return a.map(a=>this.getPointIndexById(a)).filter(a=>a>=0)}getPointIndexById(a){let b=this.points.length,c=this.points.findIndex(b=>b.uuid===a);if(c<0){let d=b;for(let e=0,f=this.shapeHoles.length;e<f;e++){let g=this.shapeHoles[e],h=g.points.length-1,i=g.getPointIndexById(a);if(!(i<0))return i+d;d+=h}}return c}getLineIndexById(a){return this.getPointIndexById(a)}getBezierPoint(a){if(a<=this.points.length-1)return this.points[a];if(this.shapeHoles.length>0)for(let b=0,c=this.shapeHoles.length;b<c;b++){let d=this.shapeHoles[b],e=a-this.points.length;if(e<=d.points.length-1)return d.points[e]}throw Error("This shape does not have a point for this index: "+a)}getBezierPointIndex(a){let b=this.points.indexOf(a);if(b>=0)return b;if(b=this.points.length,this.shapeHoles.length>0)for(let c=0,d=this.shapeHoles.length;c<d;c++){let e=this.shapeHoles[c],f=e.points.indexOf(a);if(f>=0)return b+f;b+=e.points.length}return -1}getAllPoints(){let a=[].concat(...this.shapeHoles.map(a=>a.points));return[...this.points,...a]}applySize(a,b){0===a&&(a=.001),0===b&&(b=.001),this._width=a,this._height=b}applyScale(a,b){let c=hC.set(a,b);for(let d=0,e=this.points.length;d<e;d++){let f=this.points[d];f.position.multiply(c),f.controls[0].position.multiply(c),f.controls[1].position.multiply(c)}for(let g=0,h=this.shapeHoles.length;g<h;g++)this.shapeHoles[g].applyScale(a,b);this._update(!1)}createPoint(a,b=0,c=h.MathUtils.generateUUID()){let d;d=a instanceof h.Vector2?a:new h.Vector2(a,b);let e=new hd(c,d);return e.roundness=this.roundness,e}addPoint(a){this.points.push(a),this.needsUpdate=!0}addPointAt(a,b){this.points.splice(b,0,a),this.needsUpdate=!0}getPointByUuid(a){for(let b=0,c=this.points.length;b<c;b++){let d=this.points[b];if(d.uuid===a)return d}for(let e=0,f=this.shapeHoles.length;e<f;e++){let g=this.shapeHoles[e].getPointByUuid(a);if(g)return g}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(a){let b=this.points.indexOf(a);b>=0&&this.points.splice(b,1),this.needsUpdate=!0}removePointById(a){let b=this.points.find(b=>b.uuid===a);b&&this.removePoint(b)}update(a=!0){for(let b=0,c=this.shapeHoles.length;b<c;b++)this.shapeHoles[b].update(!1);this._update(a)}extractShapePointsToBuffer(a,b=12,c=!1){this.subdivision=b,void 0===this.curveDivisions&&this.computeCurveDivisions(b);let d=c?this.roundedCurveDivisions:this.curveDivisions;return function(a,b,c=12,d=!0){let e=hn.set(0,0,0),f,g=0,i=[];for(let j=0;j<b.length;j++){let k=hf(b[j]),l=hg,m=hB(k,c);i.push(m);for(let n=0;n<=m;n++)if(k instanceof h.CubicBezierCurve||k instanceof h.QuadraticBezierCurve||k instanceof h.LineCurve){if(k.getPoint(n/m,l),e.set(l.x,l.y,0),void 0!==f&&hr(f,e))continue;void 0===f&&(f=hm),f.copy(e),a.setXYZ(g,e.x,e.y,e.z),g++}}d&&g>1&&!(a.getX(g-1)===a.getX(0)&&a.getY(g-1)===a.getY(0)&&a.getZ(g-1)===a.getZ(0))&&(a.setXYZ(g,a.getX(0),a.getY(0),a.getZ(0)),g++)}(a,c?this.roundedCurves:this.curves,b,this.autoClose),d.reduce((a,b)=>a+b,0)+1}computeCurveDivisions(a=12){return this.curveDivisions=hA(this.points,a,!1),this.roundedCurveDivisions=hA(this.points,a,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(a,b,c=12){return 2*(function(a,b,c,d=12,e=!0){let f=hn.set(0,0,0),g=0,i=[];for(let j=0;j<b.length;j++){if(!1===c[j])continue;let k,l=hf(b[j]),m=hg,n=hB(l,d);i.push(n);for(let o=0;o<=n;o++)if(l instanceof h.CubicBezierCurve||l instanceof h.QuadraticBezierCurve||l instanceof h.LineCurve){if(l.getPoint(o/n,m),f.set(m.x,m.y,0),k?.equals(f))continue;void 0===k?k=hm:(a.setXYZ(g,k.x,k.y,k.z),g++,a.setXYZ(g,f.x,f.y,f.z),g++),k.copy(f)}}return e&&g>1&&!(a.getX(g-1)===a.getX(0)&&a.getY(g-1)===a.getY(0)&&a.getZ(g-1)===a.getZ(0))&&(a.setXYZ(g,a.getX(0),a.getY(0),a.getZ(0)),g++),i})(a,this.curves,b,c,this.autoClose).reduce((a,b)=>a+b,0)}extractShapePointsToFlatArray(a,b=12){return this.subdivision=b,void 0===this.curveDivisions&&this.computeCurveDivisions(b),function(a,b,c=12,d=!0){let e,f=0;for(let g=0;g<b.length;g++){let i=hf(b[g]),j=hB(i,c),k=hg;for(let l=0;l<=j;l++)if(i instanceof h.CubicBezierCurve||i instanceof h.QuadraticBezierCurve||i instanceof h.LineCurve){if(i.getPoint(l/j,k),void 0!==e&&hq(e,k,1e-12))continue;void 0===e&&(e=hh),e.copy(k),a.push(k.x,k.y),f++}}return hp(a[0],a[a.length-2],1e-12)&&hp(a[1],a[a.length-1],1e-12)&&(a.pop(),a.pop()),d&&f>1&&!(hp(a[f-1],a[1],1e-12)&&hp(a[f-2],a[0],1e-12))&&(a.push(a[0],a[1]),f++),a}(a,this.roundedCurves,b,this.autoClose)}getCurveIndexFromVertexId(a,b=!1){let c=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let d=b?this.roundedCurveDivisions:this.curveDivisions,e=0;b&& void 0!==this.points[0].roundedCurveCorner&&(e=.5*hB(this.points[0].roundedCurveCorner,this.subdivision));let f=a-e;f<0&&(f+=d.reduce((a,b)=>a+b,0));for(let g=0,h=d.length;g<h;g++){let i=d[g];if(f<c+i)return[g,(f-c+1)/i];c+=i}return[0,1]}getCurveT(a,b,c){let d=this.points[a],e=this.points[a>=this.points.length-1?0:a+1],f=this.curveDivisions,g=f[a];if(hy(d,e)){let h=d.position.distanceTo(e.position);return d.position.distanceTo(hC.set(c.x,c.y))/h}let i=0;for(let j=0;j<a;j++)i+=f[j];return(b-i)/g}dispose(){this.eventDispatcher=null}_applyCurveForPoint(a,b){hy(b,a)?this.lineTo(a.position.x,a.position.y):this.bezierCurveTo(b.controls[1].position.x,b.controls[1].position.y,a.controls[0].position.x,a.controls[0].position.y,a.position.x,a.position.y);let c=this.curves[this.curves.length-1];a.curveBefore=c,b.curveAfter=c;let d=c.clone();a.roundedCurveBefore=d,b.roundedCurveAfter=d,a.roundedCurveCorner=void 0,this.roundedCurves.push(d)}_update(a=!0){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let b=0,c=this.points.length;b<c;b++){let d=this.points[b];if(0===b)this.moveTo(d.position.x,d.position.y);else{let e=this.points[b-1];this._applyCurveForPoint(d,e)}}let f=this.getLastPoint();if(f?.curveAfter&&(f.curveAfter=void 0),this.isClosed){let g=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(g,i)}if(this.points.length>2){let j=0;for(let k=0,l=this.points.length;k<l;k++){let m=this.points[k],n=this.points[k-1]??this.points[this.points.length-1],o=this.points[k+1]??this.points[0],p=m.roundness,q=n&&o&&ht(n,m,o);if(!m.controlsMoved()&&p>0&&!q){let r=m.curveBefore,s=m.curveAfter;if(void 0===r|| void 0===s)continue;let t=m.roundedCurveBefore,u=m.roundedCurveAfter,v=r.getLength(),w=s.getLength(),x=Math.min(p,.499*v),y=Math.min(p,.499*w),z=Math.min(x,y),A=1-z/v,B=z/w,C=r.getPointAt(A,hC),D=s.getPointAt(B,hD);this._subSplitCurve(r,t,A,C,void 0),this._subSplitCurve(s,u,B,void 0,D);let E;if(this.useCubicForRoundedCorners){let F=Math.tan(hs(C,m.position,D)/2)*C.distanceTo(m.position),[G,H]=hv(C,D,F,hE,hF),I=hw(G,H,m.position),[J,K]=hx(I,C,D,F,hG,hH);E=new h.CubicBezierCurve(C.clone(),J.clone(),K.clone(),D.clone())}else E=new h.QuadraticBezierCurve(C.clone(),m.position.clone(),D.clone());m.roundedCurveCorner=E,this.roundedCurves.splice(k+j,0,E),j++}}}a&&this.eventDispatcher?.dispatchEvent({type:"update"})}_subSplitCurve(a,b,c,d,e){if(a instanceof h.LineCurve)void 0!==d&&b.v2.copy(d),void 0!==e&&b.v1.copy(e);else{let f=a,g=b,i=f.getUtoTmapping(c,0),j=function(a,b,c,d,e=.5){let f=hg.subVectors(b,a).multiplyScalar(e).add(a),g=hh.subVectors(c,b).multiplyScalar(e).add(b),h=hi.subVectors(d,c).multiplyScalar(e).add(c),i=f,j=hj.subVectors(g,f).multiplyScalar(e).add(f),k=hk.subVectors(h,g).multiplyScalar(e).add(g),l=h,m=hl.subVectors(k,j).multiplyScalar(e).add(j);return[a.x,a.y,i.x,i.y,j.x,j.y,m.x,m.y,k.x,k.y,l.x,l.y,d.x,d.y]}(f.v0,f.v1,f.v2,f.v3,i);return void 0!==d&&(g.v0.set(j[0],j[1]),g.v1.set(j[2],j[3]),g.v2.set(j[4],j[5]),g.v3.set(j[6],j[7])),void 0!==e&&(g.v0.set(j[6],j[7]),g.v1.set(j[8],j[9]),g.v2.set(j[10],j[11]),g.v3.set(j[12],j[13])),g}return b}clone(){let a=new hI(this._width,this._height);return a.points=this.points.map(a=>a.clone()),a.isClosed=this.isClosed,a.roundness=this.roundness,a.isMesh2D=this.isMesh2D,a.shapeHoles=this.shapeHoles.map(a=>a.clone()),a}toJSON(){return{points:this.points.reduce((a,b)=>a.concat(b.toJSON()),[]),shapeHoles:this.shapeHoles.map(a=>a.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(a){this.points=[],this.pointIDs=0;let b=a.points.length/7;for(let c=0;c<b;c++){let d=7*c,e=a.points[d+0],f=a.points[d+1],g=a.points[d+2],i=a.points[d+3],j=a.points[d+4],k=a.points[d+5],l=a.points[d+6],m=new hd(h.MathUtils.generateUUID(),new h.Vector2(e,f));m.controls[0].position.set(g,i),m.controls[1].position.set(j,k),m.roundness=l,this.points.push(m)}return this.shapeHoles=a.shapeHoles?.length?a.shapeHoles.map(a=>{let b=new hI;return b.fromJSON(a),b}):[],this.isClosed=a.isClosed,this._roundness=a.roundness,this._update(),this}fromShape(a){let b=(a,b)=>{b instanceof h.CubicBezierCurve&&b.v3.equals(a.position)&&a.controls[0].position.copy(b.v2)};return this.points=(a=>{let c=[],d,e;for(d=0,e=a.length;d<e;d++)a[d]instanceof h.QuadraticBezierCurve&&(a[d]=ho(a[d]));for(d=0,e=a.length;d<e;d++){let f=a[d],g=d>0?a[d-1]:null,i;f instanceof h.CubicBezierCurve?(i=this.createPoint(f.v0)).controls[1].position.copy(f.v1):f instanceof h.LineCurve&&(i=this.createPoint(f.v1)),void 0!==i&&(null!==g&&b(i,g),c.push(i))}let j=a[a.length-1],k=!1;return j instanceof h.CubicBezierCurve?j.v3.equals(c[0].position)&&(c[0].controls[0].position.copy(j.v2),k=!0):j instanceof h.LineCurve&&j.v2.equals(c[0].position)&&(k=!0),this.isClosed=k,c})(a.curves),a instanceof h.Shape&&(this.shapeHoles=a.holes.map(a=>{let b=new hI;return b.fromShape(a),b})),this.update(),this}},hJ=2*Math.PI;function hK({x:a,y:b},c,d,e,f){return{x:a*c+e,y:b*d+f}}function hL(a,b){let c=1.5707963267948966===b?.551915024494:-1.5707963267948966===b?-.551915024494:1.3333333333333333*Math.tan(b/4),d=Math.cos(a),e=Math.sin(a),f=Math.cos(a+b),g=Math.sin(a+b);return[{x:d-e*c,y:e+d*c},{x:f+g*c,y:g-f*c},{x:f,y:g}]}function hM(a,b,c,d){return(a*d-b*c<0?-1:1)*Math.acos(Math.min(1,Math.max(-1,a*c+b*d)))}function hN(a,b){if(!a)throw b||"Assertion Failed!"}(iV=jb||(jb={}))[iV.ODD=0]="ODD",iV[iV.NONZERO=1]="NONZERO",iV[iV.POSITIVE=2]="POSITIVE",iV[iV.NEGATIVE=3]="NEGATIVE",iV[iV.ABS_GEQ_TWO=4]="ABS_GEQ_TWO",(iW=jc||(jc={}))[iW.POLYGONS=0]="POLYGONS",iW[iW.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",iW[iW.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS";var hO=function(){function a(){}return a.vertEq=function(a,b){return a.s===b.s&&a.t===b.t},a.vertLeq=function(a,b){return a.s<b.s||a.s===b.s&&a.t<=b.t},a.transLeq=function(a,b){return a.t<b.t||a.t===b.t&&a.s<=b.s},a.edgeGoesLeft=function(b){return a.vertLeq(b.Dst,b.Org)},a.edgeGoesRight=function(b){return a.vertLeq(b.Org,b.Dst)},a.vertL1dist=function(a,b){return Math.abs(a.s-b.s)+Math.abs(a.t-b.t)},a.edgeEval=function(b,c,d){hN(a.vertLeq(b,c)&&a.vertLeq(c,d));var e=c.s-b.s,f=d.s-c.s;return e+f>0?e<f?c.t-b.t+(b.t-d.t)*(e/(e+f)):c.t-d.t+(d.t-b.t)*(f/(e+f)):0},a.edgeSign=function(b,c,d){hN(a.vertLeq(b,c)&&a.vertLeq(c,d));var e=c.s-b.s,f=d.s-c.s;return e+f>0?(c.t-d.t)*e+(c.t-b.t)*f:0},a.transEval=function(b,c,d){hN(a.transLeq(b,c)&&a.transLeq(c,d));var e=c.t-b.t,f=d.t-c.t;return e+f>0?e<f?c.s-b.s+(b.s-d.s)*(e/(e+f)):c.s-d.s+(d.s-b.s)*(f/(e+f)):0},a.transSign=function(b,c,d){hN(a.transLeq(b,c)&&a.transLeq(c,d));var e=c.t-b.t,f=d.t-c.t;return e+f>0?(c.s-d.s)*e+(c.s-b.s)*f:0},a.vertCCW=function(a,b,c){return a.s*(b.t-c.t)+b.s*(c.t-a.t)+c.s*(a.t-b.t)>=0},a.interpolate=function(a,b,c,d){return(a=a<0?0:a)<=(c=c<0?0:c)?0===c?(b+d)/2:b+(d-b)*(a/(a+c)):d+(b-d)*(c/(a+c))},a.intersect=function(b,c,d,e,f){var g,h,i;a.vertLeq(b,c)||(i=b,b=c,c=i),a.vertLeq(d,e)||(i=d,d=e,e=i),a.vertLeq(b,d)||(i=b,b=d,d=i,i=c,c=e,e=i),a.vertLeq(d,c)?a.vertLeq(c,e)?(g=a.edgeEval(b,d,c),h=a.edgeEval(d,c,e),g+h<0&&(g=-g,h=-h),f.s=a.interpolate(g,d.s,h,c.s)):(g=a.edgeSign(b,d,c),h=-a.edgeSign(b,e,c),g+h<0&&(g=-g,h=-h),f.s=a.interpolate(g,d.s,h,e.s)):f.s=(d.s+c.s)/2,a.transLeq(b,c)||(i=b,b=c,c=i),a.transLeq(d,e)||(i=d,d=e,e=i),a.transLeq(b,d)||(i=b,b=d,d=i,i=c,c=e,e=i),a.transLeq(d,c)?a.transLeq(c,e)?(g=a.transEval(b,d,c),h=a.transEval(d,c,e),g+h<0&&(g=-g,h=-h),f.t=a.interpolate(g,d.t,h,c.t)):(g=a.transSign(b,d,c),h=-a.transSign(b,e,c),g+h<0&&(g=-g,h=-h),f.t=a.interpolate(g,d.t,h,e.t)):f.t=(d.t+c.t)/2},a}(),hP=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},hQ=function(){function a(a){this.side=a,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(a.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(a){this.Sym.Lface=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(a){this.Sym.Org=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(a){this.Sym.Lnext=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(a){this.Onext.Sym=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(a){this.Lnext.Sym=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(a){this.Sym.Onext=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(a){this.Sym.Onext.Sym=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(a){this.Sym.Lnext.Sym=a},enumerable:!0,configurable:!0}),a}(),hR=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},hS=function(){function a(){var a=new hR,b=new hP,c=new hQ(0),d=new hQ(1);a.next=a.prev=a,a.anEdge=null,b.next=b.prev=b,c.next=c,c.Sym=d,d.next=d,d.Sym=c,this.vHead=a,this.fHead=b,this.eHead=c,this.eHeadSym=d}return a.prototype.makeEdge_=function(a){var b=new hQ(0),c=new hQ(1);a.Sym.side<a.side&&(a=a.Sym);var d=a.Sym.next;return c.next=d,d.Sym.next=b,b.next=a,a.Sym.next=c,b.Sym=c,b.Onext=b,b.Lnext=c,b.Org=null,b.Lface=null,b.winding=0,b.activeRegion=null,c.Sym=b,c.Onext=c,c.Lnext=b,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,b},a.prototype.splice_=function(a,b){var c=a.Onext,d=b.Onext;c.Sym.Lnext=b,d.Sym.Lnext=a,a.Onext=d,b.Onext=c},a.prototype.makeVertex_=function(a,b,c){var d=a;hN(d,"Vertex can't be null!");var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b;var f=b;do f.Org=d,f=f.Onext;while(f!==b)},a.prototype.makeFace_=function(a,b,c){var d=a;hN(d,"Face can't be null");var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b,d.trail=null,d.marked=!1,d.inside=c.inside;var f=b;do f.Lface=d,f=f.Lnext;while(f!==b)},a.prototype.killEdge_=function(a){a.Sym.side<a.side&&(a=a.Sym);var b=a.next,c=a.Sym.next;b.Sym.next=c,c.Sym.next=b},a.prototype.killVertex_=function(a,b){var c=a.anEdge,d=c;do d.Org=b,d=d.Onext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},a.prototype.killFace_=function(a,b){var c=a.anEdge,d=c;do d.Lface=b,d=d.Lnext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},a.prototype.makeEdge=function(){var a=new hR,b=new hR,c=new hP,d=this.makeEdge_(this.eHead);return this.makeVertex_(a,d,this.vHead),this.makeVertex_(b,d.Sym,this.vHead),this.makeFace_(c,d,this.fHead),d},a.prototype.splice=function(a,b){var c=!1,d=!1;if(a!==b){if(b.Org!==a.Org&&(d=!0,this.killVertex_(b.Org,a.Org)),b.Lface!==a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(b,a),!d){var e=new hR;this.makeVertex_(e,b,a.Org),a.Org.anEdge=a}if(!c){var f=new hP;this.makeFace_(f,b,a.Lface),a.Lface.anEdge=a}}},a.prototype.delete=function(a){var b=a.Sym,c=!1;if(a.Lface!==a.Rface&&(c=!0,this.killFace_(a.Lface,a.Rface)),a.Onext===a)this.killVertex_(a.Org,null);else if(a.Rface.anEdge=a.Oprev,a.Org.anEdge=a.Onext,this.splice_(a,a.Oprev),!c){var d=new hP;this.makeFace_(d,a,a.Lface)}b.Onext===b?(this.killVertex_(b.Org,null),this.killFace_(b.Lface,null)):(a.Lface.anEdge=b.Oprev,b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),this.killEdge_(a)},a.prototype.addEdgeVertex=function(a){var b=this.makeEdge_(a),c=b.Sym;this.splice_(b,a.Lnext),b.Org=a.Dst;var d=new hR;return this.makeVertex_(d,c,b.Org),b.Lface=c.Lface=a.Lface,b},a.prototype.splitEdge=function(a){var b=this.addEdgeVertex(a).Sym;return this.splice_(a.Sym,a.Sym.Oprev),this.splice_(a.Sym,b),a.Dst=b.Org,b.Dst.anEdge=b.Sym,b.Rface=a.Rface,b.winding=a.winding,b.Sym.winding=a.Sym.winding,b.idx=a.idx,b.Sym.idx=a.Sym.idx,b},a.prototype.connect=function(a,b){var c=!1,d=this.makeEdge_(a),e=d.Sym;if(b.Lface!==a.Lface&&(c=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(d,a.Lnext),this.splice_(e,b),d.Org=a.Dst,e.Org=b.Org,d.Lface=e.Lface=a.Lface,a.Lface.anEdge=e,!c){var f=new hP;this.makeFace_(f,d,a.Lface)}return d},a.prototype.zapFace=function(a){var b,c,d,e,f,g=a.anEdge;c=g.Lnext;do c=(b=c).Lnext,b.Lface=null,null===b.Rface&&(b.Onext===b?this.killVertex_(b.Org,null):(b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),(d=b.Sym).Onext===d?this.killVertex_(d.Org,null):(d.Org.anEdge=d.Onext,this.splice_(d,d.Oprev)),this.killEdge_(b));while(b!=g);e=a.prev,f=a.next,f.prev=e,e.next=f},a.prototype.countFaceVerts_=function(a){var b=a.anEdge,c=0;do c++,b=b.Lnext;while(b!==a.anEdge);return c},a.prototype.mergeConvexFaces=function(a){var b,c,d,e,f,g,h;for(b=this.fHead.next;b!==this.fHead;b=b.next)if(b.inside)for(f=(c=b.anEdge).Org;d=c.Lnext,e=c.Sym,e&&e.Lface&&e.Lface.inside&&(g=this.countFaceVerts_(b))+this.countFaceVerts_(e.Lface)-2<=a&&hO.vertCCW(c.Lprev.Org,c.Org,e.Lnext.Lnext.Org)&&hO.vertCCW(e.Lprev.Org,e.Org,c.Lnext.Lnext.Org)&&(d=e.Lnext,this.delete(e),c=null,e=null),!(c&&c.Lnext.Org===f);)c=d;return!0},a.prototype.check=function(){var a,b,c,d,e,f,g=this.fHead,h=this.vHead,i=this.eHead;for(b=g,b=g;(a=b.next)!==g;b=a){hN(a.prev===b),e=a.anEdge;do hN(e.Sym!==e),hN(e.Sym.Sym===e),hN(e.Lnext.Onext.Sym===e),hN(e.Onext.Sym.Lnext===e),hN(e.Lface===a),e=e.Lnext;while(e!==a.anEdge)}for(hN(a.prev===b&&null===a.anEdge),d=h,d=h;(c=d.next)!==h;d=c){hN(c.prev===d),e=c.anEdge;do hN(e.Sym!==e),hN(e.Sym.Sym===e),hN(e.Lnext.Onext.Sym===e),hN(e.Onext.Sym.Lnext===e),hN(e.Org===c),e=e.Onext;while(e!==c.anEdge)}for(hN(c.prev===d&&null===c.anEdge),f=i,f=i;(e=f.next)!==i;f=e)hN(e.Sym.next===f.Sym),hN(e.Sym!==e),hN(e.Sym.Sym===e),hN(null!==e.Org),hN(null!==e.Dst),hN(e.Lnext.Onext.Sym===e),hN(e.Onext.Sym.Lnext===e);hN(e.Sym.next===f.Sym&&e.Sym===this.eHeadSym&&e.Sym.Sym===e&&null===e.Org&&null===e.Dst&&null===e.Lface&&null===e.Rface)},a}(),hT=function(){this.handle=null},hU=function(){this.key=null,this.node=0},hV=function(){function a(a,b){this.leq=b,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=a,this.nodes=[],this.handles=[];for(var c=0;c<a+1;c++)this.nodes[c]=new hT,this.handles[c]=new hU;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return a.prototype.floatDown_=function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if((d=a<<1)<this.size&&this.leq(f[e[d+1].handle].key,f[e[d].handle].key)&& ++d,hN(d<=this.max),c=e[d].handle,d>this.size||this.leq(f[b].key,f[c].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},a.prototype.floatUp_=function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if(c=e[d=a>>1].handle,0===d||this.leq(f[c].key,f[b].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},a.prototype.init=function(){for(var a=this.size;a>=1;--a)this.floatDown_(a);this.initialized=!0},a.prototype.min=function(){return this.handles[this.nodes[1].handle].key},a.prototype.insert=function(a){var b,c,d,e;if(2*(b=++this.size)>this.max){for(this.max*=2,e=this.nodes.length,this.nodes.length=this.max+1,d=e;d<this.nodes.length;d++)this.nodes[d]=new hT;for(e=this.handles.length,this.handles.length=this.max+1,d=e;d<this.handles.length;d++)this.handles[d]=new hU}return 0===this.freeList?c=b:(c=this.freeList,this.freeList=this.handles[c].node),this.nodes[b].handle=c,this.handles[c].node=b,this.handles[c].key=a,this.initialized&&this.floatUp_(b),c},a.prototype.extractMin=function(){var a=this.nodes,b=this.handles,c=a[1].handle,d=b[c].key;return this.size>0&&(a[1].handle=a[this.size].handle,b[a[1].handle].node=1,b[c].key=null,b[c].node=this.freeList,this.freeList=c,--this.size,this.size>0&&this.floatDown_(1)),d},a.prototype.delete=function(a){var b,c=this.nodes,d=this.handles;hN(a>=1&&a<=this.max&&null!==d[a].key),c[b=d[a].node].handle=c[this.size].handle,d[c[b].handle].node=b,--this.size,b<=this.size&&(b<=1||this.leq(d[c[b>>1].handle].key,d[c[b].handle].key)?this.floatDown_(b):this.floatUp_(b)),d[a].key=null,d[a].node=this.freeList,this.freeList=a},a}(),hW=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},hX=function(){this.key=null,this.next=null,this.prev=null},hY=function(){function a(a,b){this.frame=a,this.leq=b,this.head=new hX,this.head.next=this.head,this.head.prev=this.head}return a.prototype.min=function(){return this.head.next},a.prototype.max=function(){return this.head.prev},a.prototype.insert=function(a){return this.insertBefore(this.head,a)},a.prototype.search=function(a){var b=this.head;do b=b.next;while(null!==b.key&&!this.leq(this.frame,a,b.key));return b},a.prototype.insertBefore=function(a,b){do a=a.prev;while(null!==a.key&&!this.leq(this.frame,a.key,b));var c=new hX;return c.key=b,c.next=a.next,a.next.prev=c,c.prev=a,a.next=c,c},a.prototype.delete=function(a){a.next.prev=a.prev,a.prev.next=a.next},a}(),hZ=function(){function a(){}return a.regionBelow=function(a){return a.nodeUp.prev.key},a.regionAbove=function(a){return a.nodeUp.next.key},a.debugEvent=function(a){},a.addWinding=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},a.edgeLeq=function(a,b,c){var d=a.event,e=b.eUp,f=c.eUp;if(e.Dst===d)return f.Dst===d?hO.vertLeq(e.Org,f.Org)?0>=hO.edgeSign(f.Dst,e.Org,f.Org):hO.edgeSign(e.Dst,f.Org,e.Org)>=0:0>=hO.edgeSign(f.Dst,d,f.Org);if(f.Dst===d)return hO.edgeSign(e.Dst,d,e.Org)>=0;var g=hO.edgeEval(e.Dst,d,e.Org),h=hO.edgeEval(f.Dst,d,f.Org);return g>=h},a.deleteRegion=function(a,b){b.fixUpperEdge&&hN(0===b.eUp.winding),b.eUp.activeRegion=null,a.dict.delete(b.nodeUp)},a.fixUpperEdge=function(a,b,c){hN(b.fixUpperEdge),a.mesh.delete(b.eUp),b.fixUpperEdge=!1,b.eUp=c,c.activeRegion=b},a.topLeftRegion=function(b,c){var d,e=c.eUp.Org;do c=a.regionAbove(c);while(c.eUp.Org===e);if(c.fixUpperEdge){if(null===(d=b.mesh.connect(a.regionBelow(c).eUp.Sym,c.eUp.Lnext)))return null;a.fixUpperEdge(b,c,d),c=a.regionAbove(c)}return c},a.topRightRegion=function(b){var c=b.eUp.Dst;do b=a.regionAbove(b);while(b.eUp.Dst===c);return b},a.addRegionBelow=function(a,b,c){var d=new hW;return d.eUp=c,d.nodeUp=a.dict.insertBefore(b.nodeUp,d),d.fixUpperEdge=!1,d.sentinel=!1,d.dirty=!1,c.activeRegion=d,d},a.isWindingInside=function(a,b){switch(a.windingRule){case jb.ODD:return(1&b)!=0;case jb.NONZERO:return 0!==b;case jb.POSITIVE:return b>0;case jb.NEGATIVE:return b<0;case jb.ABS_GEQ_TWO:return b>=2||b<= -2}throw Error("Invalid winding rulle")},a.computeWinding=function(b,c){c.windingNumber=a.regionAbove(c).windingNumber+c.eUp.winding,c.inside=a.isWindingInside(b,c.windingNumber)},a.finishRegion=function(b,c){var d=c.eUp,e=d.Lface;e.inside=c.inside,e.anEdge=d,a.deleteRegion(b,c)},a.finishLeftRegions=function(b,c,d){for(var e,f=null,g=c,h=c.eUp;g!==d;){if(g.fixUpperEdge=!1,(e=(f=a.regionBelow(g)).eUp).Org!=h.Org){if(!f.fixUpperEdge){a.finishRegion(b,g);break}e=b.mesh.connect(h.Lprev,e.Sym),a.fixUpperEdge(b,f,e)}h.Onext!==e&&(b.mesh.splice(e.Oprev,e),b.mesh.splice(h,e)),a.finishRegion(b,g),h=f.eUp,g=f}return h},a.addRightEdges=function(b,c,d,e,f,g){var h,i,j,k,l=!0;j=d;do hN(hO.vertLeq(j.Org,j.Dst)),a.addRegionBelow(b,c,j.Sym),j=j.Onext;while(j!==e);for(null===f&&(f=a.regionBelow(c).eUp.Rprev),i=c,k=f;(j=(h=a.regionBelow(i)).eUp.Sym).Org===k.Org;)j.Onext!==k&&(b.mesh.splice(j.Oprev,j),b.mesh.splice(k.Oprev,j)),h.windingNumber=i.windingNumber-j.winding,h.inside=a.isWindingInside(b,h.windingNumber),i.dirty=!0,!l&&a.checkForRightSplice(b,i)&&(a.addWinding(j,k),a.deleteRegion(b,i),b.mesh.delete(k)),l=!1,i=h,k=j;i.dirty=!0,hN(i.windingNumber-j.winding===h.windingNumber),g&&a.walkDirtyRegions(b,i)},a.spliceMergeVertices=function(a,b,c){a.mesh.splice(b,c)},a.vertexWeights=function(a,b,c){var d=hO.vertL1dist(b,a),e=hO.vertL1dist(c,a),f=.5*e/(d+e),g=.5*d/(d+e);a.coords[0]+=f*b.coords[0]+g*c.coords[0],a.coords[1]+=f*b.coords[1]+g*c.coords[1],a.coords[2]+=f*b.coords[2]+g*c.coords[2]},a.getIntersectData=function(b,c,d,e,f,g){c.coords[0]=c.coords[1]=c.coords[2]=0,c.idx=-1,a.vertexWeights(c,d,e),a.vertexWeights(c,f,g)},a.checkForRightSplice=function(b,c){var d=a.regionBelow(c),e=c.eUp,f=d.eUp;if(hO.vertLeq(e.Org,f.Org)){if(hO.edgeSign(f.Dst,e.Org,f.Org)>0)return!1;hO.vertEq(e.Org,f.Org)?e.Org!==f.Org&&(b.pq.delete(e.Org.pqHandle),a.spliceMergeVertices(b,f.Oprev,e)):(b.mesh.splitEdge(f.Sym),b.mesh.splice(e,f.Oprev),c.dirty=d.dirty=!0)}else{if(0>hO.edgeSign(e.Dst,f.Org,e.Org))return!1;a.regionAbove(c).dirty=c.dirty=!0,b.mesh.splitEdge(e.Sym),b.mesh.splice(f.Oprev,e)}return!0},a.checkForLeftSplice=function(b,c){var d,e=a.regionBelow(c),f=c.eUp,g=e.eUp;if(hN(!hO.vertEq(f.Dst,g.Dst)),hO.vertLeq(f.Dst,g.Dst)){if(0>hO.edgeSign(f.Dst,g.Dst,f.Org))return!1;a.regionAbove(c).dirty=c.dirty=!0,d=b.mesh.splitEdge(f),b.mesh.splice(g.Sym,d),d.Lface.inside=c.inside}else{if(hO.edgeSign(g.Dst,f.Dst,g.Org)>0)return!1;c.dirty=e.dirty=!0,d=b.mesh.splitEdge(g),b.mesh.splice(f.Lnext,g.Sym),d.Rface.inside=c.inside}return!0},a.checkForIntersect=function(b,c){var d,e,f,g,h=a.regionBelow(c),i=c.eUp,j=h.eUp,k=i.Org,l=j.Org,m=i.Dst,n=j.Dst,o=new hR;if(hN(!hO.vertEq(n,m)),hN(0>=hO.edgeSign(m,b.event,k)),hN(hO.edgeSign(n,b.event,l)>=0),hN(k!==b.event&&l!==b.event),hN(!c.fixUpperEdge&&!h.fixUpperEdge),k===l||(d=Math.min(k.t,m.t),e=Math.max(l.t,n.t),d>e))return!1;if(hO.vertLeq(k,l)){if(hO.edgeSign(n,k,l)>0)return!1}else if(0>hO.edgeSign(m,l,k))return!1;return a.debugEvent(b),hO.intersect(m,k,n,l,o),hN(Math.min(k.t,m.t)<=o.t),hN(o.t<=Math.max(l.t,n.t)),hN(Math.min(n.s,m.s)<=o.s),hN(o.s<=Math.max(l.s,k.s)),hO.vertLeq(o,b.event)&&(o.s=b.event.s,o.t=b.event.t),f=hO.vertLeq(k,l)?k:l,hO.vertLeq(f,o)&&(o.s=f.s,o.t=f.t),hO.vertEq(o,k)||hO.vertEq(o,l)?(a.checkForRightSplice(b,c),!1):!hO.vertEq(m,b.event)&&hO.edgeSign(m,b.event,o)>=0|| !hO.vertEq(n,b.event)&&0>=hO.edgeSign(n,b.event,o)?n===b.event?(b.mesh.splitEdge(i.Sym),b.mesh.splice(j.Sym,i),c=a.topLeftRegion(b,c),i=a.regionBelow(c).eUp,a.finishLeftRegions(b,a.regionBelow(c),h),a.addRightEdges(b,c,i.Oprev,i,i,!0),!0):m===b.event?(b.mesh.splitEdge(j.Sym),b.mesh.splice(i.Lnext,j.Oprev),h=c,c=a.topRightRegion(c),g=a.regionBelow(c).eUp.Rprev,h.eUp=j.Oprev,j=a.finishLeftRegions(b,h,null),a.addRightEdges(b,c,j.Onext,i.Rprev,g,!0),!0):(hO.edgeSign(m,b.event,o)>=0&&(a.regionAbove(c).dirty=c.dirty=!0,b.mesh.splitEdge(i.Sym),i.Org.s=b.event.s,i.Org.t=b.event.t),0>=hO.edgeSign(n,b.event,o)&&(c.dirty=h.dirty=!0,b.mesh.splitEdge(j.Sym),j.Org.s=b.event.s,j.Org.t=b.event.t),!1):(b.mesh.splitEdge(i.Sym),b.mesh.splitEdge(j.Sym),b.mesh.splice(j.Oprev,i),i.Org.s=o.s,i.Org.t=o.t,i.Org.pqHandle=b.pq.insert(i.Org),a.getIntersectData(b,i.Org,k,m,l,n),a.regionAbove(c).dirty=c.dirty=h.dirty=!0,!1)},a.walkDirtyRegions=function(b,c){for(var d,e,f=a.regionBelow(c);;){for(;f.dirty;)c=f,f=a.regionBelow(f);if(!c.dirty&&(f=c,null===(c=a.regionAbove(c))||!c.dirty))return;if(c.dirty=!1,d=c.eUp,e=f.eUp,d.Dst!==e.Dst&&a.checkForLeftSplice(b,c)&&(f.fixUpperEdge?(a.deleteRegion(b,f),b.mesh.delete(e),e=(f=a.regionBelow(c)).eUp):c.fixUpperEdge&&(a.deleteRegion(b,c),b.mesh.delete(d),d=(c=a.regionAbove(f)).eUp)),d.Org!==e.Org){if(d.Dst===e.Dst||c.fixUpperEdge||f.fixUpperEdge||d.Dst!==b.event&&e.Dst!==b.event)a.checkForRightSplice(b,c);else if(a.checkForIntersect(b,c))return}d.Org===e.Org&&d.Dst===e.Dst&&(a.addWinding(e,d),a.deleteRegion(b,c),b.mesh.delete(d),c=a.regionAbove(f))}},a.connectRightVertex=function(b,c,d){var e,f=d.Onext,g=a.regionBelow(c),h=c.eUp,i=g.eUp,j=!1;if(h.Dst!==i.Dst&&a.checkForIntersect(b,c),hO.vertEq(h.Org,b.event)&&(b.mesh.splice(f.Oprev,h),c=a.topLeftRegion(b,c),f=a.regionBelow(c).eUp,a.finishLeftRegions(b,a.regionBelow(c),g),j=!0),hO.vertEq(i.Org,b.event)&&(b.mesh.splice(d,i.Oprev),d=a.finishLeftRegions(b,g,null),j=!0),j){a.addRightEdges(b,c,d.Onext,f,f,!0);return}e=hO.vertLeq(i.Org,h.Org)?i.Oprev:h,e=b.mesh.connect(d.Lprev,e),a.addRightEdges(b,c,e,e.Onext,e.Onext,!1),e.Sym.activeRegion.fixUpperEdge=!0,a.walkDirtyRegions(b,c)},a.connectLeftDegenerate=function(b,c,d){var e,f,g,h,i;if(e=c.eUp,hO.vertEq(e.Org,d)){hN(!1),a.spliceMergeVertices(b,e,d.anEdge);return}if(!hO.vertEq(e.Dst,d)){b.mesh.splitEdge(e.Sym),c.fixUpperEdge&&(b.mesh.delete(e.Onext),c.fixUpperEdge=!1),b.mesh.splice(d.anEdge,e),a.sweepEvent(b,d);return}hN(!1),c=a.topRightRegion(c),i=a.regionBelow(c),g=i.eUp.Sym,f=h=g.Onext,i.fixUpperEdge&&(hN(f!==g),a.deleteRegion(b,i),b.mesh.delete(g),g=f.Oprev),b.mesh.splice(d.anEdge,g),hO.edgeGoesLeft(f)||(f=null),a.addRightEdges(b,c,g.Onext,h,f,!0)},a.connectLeftVertex=function(b,c){var d,e,f,g,h,i,j=new hW;if(j.eUp=c.anEdge.Sym,d=b.dict.search(j).key,e=a.regionBelow(d)){if(g=d.eUp,h=e.eUp,0===hO.edgeSign(g.Dst,c,g.Org)){a.connectLeftDegenerate(b,d,c);return}(f=hO.vertLeq(h.Dst,g.Dst)?d:e,d.inside||f.fixUpperEdge)?(i=f===d?b.mesh.connect(c.anEdge.Sym,g.Lnext):b.mesh.connect(h.Dnext,c.anEdge).Sym,f.fixUpperEdge?a.fixUpperEdge(b,f,i):a.computeWinding(b,a.addRegionBelow(b,d,i)),a.sweepEvent(b,c)):a.addRightEdges(b,d,c.anEdge,c.anEdge,null,!0)}},a.sweepEvent=function(b,c){b.event=c,a.debugEvent(b);for(var d=c.anEdge;null===d.activeRegion;)if((d=d.Onext)===c.anEdge){a.connectLeftVertex(b,c);return}var e=a.topLeftRegion(b,d.activeRegion);hN(null!==e);var f=a.regionBelow(e),g=f.eUp,h=a.finishLeftRegions(b,f,null);h.Onext===g?a.connectRightVertex(b,e,h):a.addRightEdges(b,e,h.Onext,g,g,!0)},a.addSentinel=function(a,b,c,d){var e=new hW,f=a.mesh.makeEdge();f.Org.s=c,f.Org.t=d,f.Dst.s=b,f.Dst.t=d,a.event=f.Dst,e.eUp=f,e.windingNumber=0,e.inside=!1,e.fixUpperEdge=!1,e.sentinel=!0,e.dirty=!1,e.nodeUp=a.dict.insert(e)},a.initEdgeDict=function(b){b.dict=new hY(b,a.edgeLeq);var c=b.bmax[0]-b.bmin[0],d=b.bmax[1]-b.bmin[1],e=b.bmin[0]-c,f=b.bmax[0]+c,g=b.bmin[1]-d,h=b.bmax[1]+d;a.addSentinel(b,e,f,g),a.addSentinel(b,e,f,h)},a.doneEdgeDict=function(b){for(var c,d=0;null!==(c=b.dict.min().key);)c.sentinel||(hN(c.fixUpperEdge),hN(1== ++d)),hN(0===c.windingNumber),a.deleteRegion(b,c)},a.removeDegenerateEdges=function(b){var c,d,e,f=b.mesh.eHead;for(c=f.next;c!==f;c=d)d=c.next,e=c.Lnext,hO.vertEq(c.Org,c.Dst)&&c.Lnext.Lnext!==c&&(a.spliceMergeVertices(b,e,c),b.mesh.delete(c),e=(c=e).Lnext),e.Lnext===c&&(e!==c&&((e===d||e===d.Sym)&&(d=d.next),b.mesh.delete(e)),(c===d||c===d.Sym)&&(d=d.next),b.mesh.delete(c))},a.initPriorityQ=function(a){var b,c,d,e=0;for(c=(d=a.mesh.vHead).next;c!==d;c=c.next)e++;for(e+=8,b=a.pq=new hV(e,hO.vertLeq),d=a.mesh.vHead,c=d.next;c!==d;c=c.next)c.pqHandle=b.insert(c);return c===d&&(b.init(),!0)},a.donePriorityQ=function(a){a.pq=null},a.removeDegenerateFaces=function(b,c){var d,e,f;for(d=c.fHead.next;d!==c.fHead;d=e)e=d.next,f=d.anEdge,hN(f.Lnext!==f),f.Lnext.Lnext===f&&(a.addWinding(f.Onext,f),b.mesh.delete(f));return!0},a.computeInterior=function(b,c){var d,e;if(void 0===c&&(c=!0),a.removeDegenerateEdges(b),!a.initPriorityQ(b))return!1;for(a.initEdgeDict(b);null!==(d=b.pq.extractMin());){for(;!(null===(e=b.pq.min())||!hO.vertEq(e,d));)e=b.pq.extractMin(),a.spliceMergeVertices(b,d.anEdge,e.anEdge);a.sweepEvent(b,d)}return b.event=b.dict.min().key.eUp.Org,a.debugEvent(b),a.doneEdgeDict(b),a.donePriorityQ(b),!!a.removeDegenerateFaces(b,b.mesh)&&(c&&b.mesh.check(),!0)},a}(),h$=function(){function a(){this.mesh=new hS,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=jb.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return a.prototype.dot_=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},a.prototype.normalize_=function(a){var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];if(!b)throw"Zero-size vector!";b=Math.sqrt(b),a[0]/=b,a[1]/=b,a[2]/=b},a.prototype.longAxis_=function(a){var b=0;return Math.abs(a[1])>Math.abs(a[0])&&(b=1),Math.abs(a[2])>Math.abs(a[b])&&(b=2),b},a.prototype.computeNormal_=function(a){var b,c,d,e,f,g,h=[0,0,0],i=[0,0,0],j=[0,0,0],k=[0,0,0],l=[0,0,0],m=[null,null,null],n=[null,null,null],o=this.mesh.vHead;b=o.next;for(var p=0;p<3;++p)e=b.coords[p],i[p]=e,n[p]=b,h[p]=e,m[p]=b;for(b=o.next;b!==o;b=b.next)for(var q=0;q<3;++q)(e=b.coords[q])<i[q]&&(i[q]=e,n[q]=b),e>h[q]&&(h[q]=e,m[q]=b);var r=0;if(h[1]-i[1]>h[0]-i[0]&&(r=1),h[2]-i[2]>h[r]-i[r]&&(r=2),i[r]>=h[r]){a[0]=0,a[1]=0,a[2]=1;return}for(g=0,c=n[r],d=m[r],j[0]=c.coords[0]-d.coords[0],j[1]=c.coords[1]-d.coords[1],j[2]=c.coords[2]-d.coords[2],b=o.next;b!==o;b=b.next)k[0]=b.coords[0]-d.coords[0],k[1]=b.coords[1]-d.coords[1],k[2]=b.coords[2]-d.coords[2],l[0]=j[1]*k[2]-j[2]*k[1],l[1]=j[2]*k[0]-j[0]*k[2],l[2]=j[0]*k[1]-j[1]*k[0],(f=l[0]*l[0]+l[1]*l[1]+l[2]*l[2])>g&&(g=f,a[0]=l[0],a[1]=l[1],a[2]=l[2]);g<=0&&(a[0]=a[1]=a[2]=0,a[this.longAxis_(j)]=1)},a.prototype.checkOrientation_=function(){for(var a,b,c=this.mesh.fHead,d=this.mesh.vHead,e=0,f=c.next;f!==c;f=f.next)if(!((b=f.anEdge).winding<=0))do e+=(b.Org.s-b.Dst.s)*(b.Org.t+b.Dst.t),b=b.Lnext;while(b!==f.anEdge);if(e<0){for(a=d.next;a!==d;a=a.next)a.t=-a.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},a.prototype.projectPolygon_=function(){var a,b,c=this.mesh.vHead,d=[0,0,0],e=!1;d[0]=this.normal[0],d[1]=this.normal[1],d[2]=this.normal[2],d[0]||d[1]||d[2]||(this.computeNormal_(d),e=!0),a=this.sUnit,b=this.tUnit;var f=this.longAxis_(d);a[f]=0,a[(f+1)%3]=1,a[(f+2)%3]=0,b[f]=0,b[(f+1)%3]=0,b[(f+2)%3]=d[f]>0?1:-1;for(var g=c.next;g!==c;g=g.next)g.s=this.dot_(g.coords,a),g.t=this.dot_(g.coords,b);e&&this.checkOrientation_();for(var h=!0,i=c.next;i!==c;i=i.next)h?(this.bmin[0]=this.bmax[0]=i.s,this.bmin[1]=this.bmax[1]=i.t,h=!1):(i.s<this.bmin[0]&&(this.bmin[0]=i.s),i.s>this.bmax[0]&&(this.bmax[0]=i.s),i.t<this.bmin[1]&&(this.bmin[1]=i.t),i.t>this.bmax[1]&&(this.bmax[1]=i.t))},a.prototype.addWinding_=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},a.prototype.tessellateMonoRegion_=function(a,b){var c,d;if(!((c=b.anEdge).Lnext!==c&&c.Lnext.Lnext!==c))throw"Mono region invalid";for(;hO.vertLeq(c.Dst,c.Org);c=c.Lprev);for(;hO.vertLeq(c.Org,c.Dst);c=c.Lnext);d=c.Lprev;for(var e=void 0;c.Lnext!==d;)if(hO.vertLeq(c.Dst,d.Org)){for(;d.Lnext!==c&&(hO.edgeGoesLeft(d.Lnext)||0>=hO.edgeSign(d.Org,d.Dst,d.Lnext.Dst));)d=a.connect(d.Lnext,d).Sym;d=d.Lprev}else{for(;d.Lnext!==c&&(hO.edgeGoesRight(c.Lprev)||hO.edgeSign(c.Dst,c.Org,c.Lprev.Org)>=0);)c=a.connect(c,c.Lprev).Sym;c=c.Lnext}if(d.Lnext===c)throw"Mono region invalid";for(;d.Lnext.Lnext!==c;)d=a.connect(d.Lnext,d).Sym;return!0},a.prototype.tessellateInterior_=function(a){for(var b,c=a.fHead.next;c!==a.fHead;c=b)if(b=c.next,c.inside&&!this.tessellateMonoRegion_(a,c))return!1;return!0},a.prototype.discardExterior_=function(a){for(var b,c=a.fHead.next;c!==a.fHead;c=b)b=c.next,c.inside||a.zapFace(c)},a.prototype.setWindingNumber_=function(a,b,c){for(var d,e=a.eHead.next;e!==a.eHead;e=d)d=e.next,e.Rface.inside!==e.Lface.inside?e.winding=e.Lface.inside?b:-b:c?a.delete(e):e.winding=0},a.prototype.getNeighbourFace_=function(a){return a.Rface&&a.Rface.inside?a.Rface.n:-1},a.prototype.outputPolymesh_=function(a,b,c,d){var e,f,g=0,h=0;c>3&&a.mergeConvexFaces(c);for(var i=a.vHead.next;i!==a.vHead;i=i.next)i.n=-1;for(var j=a.fHead.next;j!==a.fHead;j=j.next)if(j.n=-1,j.inside){e=j.anEdge,f=0;do{var i=e.Org;-1===i.n&&(i.n=h,h++),f++,e=e.Lnext}while(e!==j.anEdge);if(f>c)throw"Face vertex greater that support polygon";j.n=g,++g}this.elementCount=g,b===jc.CONNECTED_POLYGONS&&(g*=2),this.elements=[],this.elements.length=g*c,this.vertexCount=h,this.vertices=[],this.vertices.length=h*d,this.vertexIndices=[],this.vertexIndices.length=h;for(var i=a.vHead.next;i!==a.vHead;i=i.next)if(-1!==i.n){var k=i.n*d;this.vertices[k+0]=i.coords[0],this.vertices[k+1]=i.coords[1],d>2&&(this.vertices[k+2]=i.coords[2]),this.vertexIndices[i.n]=i.idx}for(var l=0,j=a.fHead.next;j!==a.fHead;j=j.next)if(j.inside){e=j.anEdge,f=0;do{var i=e.Org;this.elements[l++]=i.n,f++,e=e.Lnext}while(e!==j.anEdge);for(var m=f;m<c;++m)this.elements[l++]=-1;if(b===jc.CONNECTED_POLYGONS){e=j.anEdge;do this.elements[l++]=this.getNeighbourFace_(e),e=e.Lnext;while(e!==j.anEdge);for(var n=f;n<c;++n)this.elements[l++]=-1}}},a.prototype.outputContours_=function(a,b){var c,d,e=0,f=0;this.vertexCount=0,this.elementCount=0;for(var g=a.fHead.next;g!==a.fHead;g=g.next)if(g.inside){d=c=g.anEdge;do this.vertexCount++,c=c.Lnext;while(c!==d);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*b,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var h=0,i=0,j=0;e=0;for(var g=a.fHead.next;g!==a.fHead;g=g.next)if(g.inside){f=0,d=c=g.anEdge;do this.vertices[h++]=c.Org.coords[0],this.vertices[h++]=c.Org.coords[1],b>2&&(this.vertices[h++]=c.Org.coords[2]),this.vertexIndices[i++]=this.vertexIdCallback?this.vertexIdCallback(c):c.Org.idx,f++,c=c.Lnext;while(c!==d);this.elements[j++]=e,this.elements[j++]=f,e+=f}},a.prototype.addContour=function(a,b){null===this.mesh&&(this.mesh=new hS),a<2&&(a=2),a>3&&(a=3);for(var c=null,d=0;d<b.length;d+=a)null===c?(c=this.mesh.makeEdge(),this.mesh.splice(c,c.Sym)):(this.mesh.splitEdge(c),c=c.Lnext),c.Org.coords[0]=b[d+0],c.Org.coords[1]=b[d+1],a>2?c.Org.coords[2]=b[d+2]:c.Org.coords[2]=0,c.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(c),c.winding=1,c.Sym.winding=-1},a.prototype.tesselate=function(a,b,c,d,e,f){if(void 0===a&&(a=jb.ODD),void 0===b&&(b=jc.POLYGONS),void 0===f&&(f=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,e&&(this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2]),this.windingRule=a,d<2&&(d=2),d>3&&(d=3),!this.mesh)return!1;this.projectPolygon_(),hZ.computeInterior(this,f);var g=this.mesh;return b===jc.BOUNDARY_CONTOURS?this.setWindingNumber_(g,1,!0):this.tessellateInterior_(g),f&&g.check(),b===jc.BOUNDARY_CONTOURS?this.outputContours_(g,d):this.outputPolymesh_(g,b,c,d),!0},a}();function h_(a){var b=a.windingRule,c=void 0===b?jb.ODD:b,d=a.elementType,e=void 0===d?jc.POLYGONS:d,f=a.polySize,g=a.vertexSize,h=void 0===g?2:g,i=a.normal,j=a.contours,k=void 0===j?[]:j,l=a.strict,m=void 0===l||l,n=a.debug;if(!k&&m)throw Error("Contours can't be empty");if(k){var o=new h$;a.edgeCreateCallback&&(o.edgeCreateCallback=a.edgeCreateCallback),a.vertexIdCallback&&(o.vertexIdCallback=a.vertexIdCallback);for(var p=0;p<k.length;p++)o.addContour(h||2,k[p]);return o.tesselate(c,e,void 0===f?3:f,h,void 0===i?[0,0,1]:i,m),{vertices:o.vertices,vertexIndices:o.vertexIndices,vertexCount:o.vertexCount,elements:o.elements,elementCount:o.elementCount,mesh:void 0!==n&&n?o.mesh:void 0}}}jb.ODD,jb.NONZERO,jb.POSITIVE,jb.NEGATIVE,jb.ABS_GEQ_TWO,jc.POLYGONS,jc.CONNECTED_POLYGONS,jc.BOUNDARY_CONTOURS;var h0=class extends h.BufferGeometry{constructor(a,b=12,c={}){super(),this.type="ShapeGeometry",this.windingRule=jb.ODD,this.elementType=jc.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=a,this._curveSegments=b,this._triangulationOptions=Object.assign({windingRule:jb.ODD,elementType:jc.POLYGONS,polySize:3,vertexSize:2,strict:!0},c);let d=this._shape.extractShapePointsToFlatArray([],this._curveSegments),e=this._shape.shapeHoles.map(a=>a.extractShapePointsToFlatArray([],this._curveSegments)),f,g=!0,i=!0,j,k;for(let l=0,m=d.length/2;l<m;l++){let n=2*l,o=d[n+0],p=d[n+1];if(void 0!==j&&o!==j&&(g=!1),void 0!==k&&p!==k&&(i=!1),j=o,k=p,!g&&!i)break}g||i||(f=h_({contours:[d,...e],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict}));let q=f?.vertexCount??1,r=f?.elementCount??1;if(this._positionAttribute=new h.BufferAttribute(new Float32Array(3*q),3),this._normalAttribute=new h.BufferAttribute(new Float32Array(3*q),3),this._uvAttribute=new h.BufferAttribute(new Float32Array(2*q),2),this._indexAttribute=new h.BufferAttribute(new Uint32Array(3*r),1),f){let s=1/0,t=-1/0,u=1/0,v=-1/0;for(let w=0,x=q;w<x;w++){let y=2*w,z=f.vertices[y+0],A=f.vertices[y+1];z<s&&(s=z),z>t&&(t=z),A<u&&(u=A),A>v&&(v=A)}let B=t-s,C=v-u;for(let D=0,E=q;D<E;D++){let F=2*D,G=f.vertices[F+0],H=f.vertices[F+1],I=(G-s)/B,J=(H-u)/C;this._positionAttribute.setXYZ(D,G,H,0),this._normalAttribute.setXYZ(D,0,0,1),this._uvAttribute.setXY(D,I,J)}for(let K=0,L=r;K<L;K++){let M=3*K,N=f.elements[M+0],O=f.elements[M+1],P=f.elements[M+2];this._indexAttribute.setX(M+0,N),this._indexAttribute.setX(M+1,O),this._indexAttribute.setX(M+2,P)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(f?.elementCount??1)*3)}clone(){let a=new h0(this._shape,this._curveSegments);return a.userData=dU(this.userData),a}},h1=class{constructor(a=256,b=!1){this.capacity=a,this.size=0,this.debug=b,this.debug&&console.log(`allocating with cap ${a}`);let c=a*h1.eSize;this.buffer=new ArrayBuffer(c);let d=Float32Array.BYTES_PER_ELEMENT,e=0;this.positions=new Float32Array(this.buffer,e*d,3*a),e+=3*a,this.normals=new Float32Array(this.buffer,e*d,3*a),e+=3*a,this.uvs=new Float32Array(this.buffer,e*d,2*a)}realloc(a,b=!1){if(a<this.size)throw Error("cannot shrink buffer");if(a<=this.capacity&&!b)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${a}`);let c=a*h1.eSize,d=new ArrayBuffer(c),e=Float32Array.BYTES_PER_ELEMENT,f=0,g=new Float32Array(d,f*e,3*a);f+=3*a;let h=new Float32Array(d,f*e,3*a);f+=3*a;let i=new Float32Array(d,f*e,2*a);g.set(this.positions.slice(0,3*this.size)),h.set(this.normals.slice(0,3*this.size)),i.set(this.uvs.slice(0,2*this.size)),this.buffer=d,this.positions=g,this.normals=h,this.uvs=i,this.capacity=a}get(a=1){let b=this.size+a;if(b>this.capacity){let c=this.capacity;for(;b>c;)c*=2;this.realloc(c)}let d=this.size;return this.size=b,d}reserve(a){let b=this.size+a;b>this.capacity&&this.realloc(b)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},h2=h1;h2.eSize=8*Float32Array.BYTES_PER_ELEMENT;var h3=(a,b)=>([c,d])=>(d<c&&(d+=b),(a>=c?a:a+b)<=d),h4=class extends h.BufferGeometry{constructor(a,b,c=0,d=12,e=3){super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=a,this._depth=b,this._bevel=c,this._curveSegments=d,this._bevelSegmentsInput=e,c<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(c,b/2-1e-12),this._bevelSegments=Math.floor(e));let f=this._shape.extractShapePointsToFlatArray([],d),g=this._shape.shapeHoles.map(a=>{let b=a.extractShapePointsToFlatArray([],d),c=[];for(let e=b.length-1;e>=1;e-=2){let f=b[e-1],g=b[e-0];c.push(f,g)}return c}),i=h_({windingRule:jb.ODD,elementType:jc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[f]}),j=h_({windingRule:jb.ODD,elementType:jc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...g]});if(!i)throw Error("error generating geometry");let k=i.elementCount;if(j){i.elementCount+=j.elementCount;for(let l=0;l<j.elements.length;l++){let m=j.elements[l],n=l%2==0?i.vertexCount:0;i.elements.push(m+n)}for(let o=0;o<j.vertexIndices.length;o++){let p=j.vertexIndices[o],q=i.vertexCount;i.vertexIndices.push(p+q)}for(let r=0;r<j.vertices.length;r++){let s=j.vertices[r];i.vertices.push(s)}}let t=1/0,u=-1/0,v=1/0,w=-1/0;for(let x=0,y=i.vertexCount;x<y;x++){let z=2*x,A=i.vertices[z+0],B=i.vertices[z+1];A<t&&(t=A),A>u&&(u=A),B<v&&(v=B),B>w&&(w=B)}this._minX=t,this._minY=v,this._width=u-t,this._height=w-v;let C=2*i.vertexCount*(2+this._bevelSegments);this._buffer=new h2(C);let D=[],E=[];for(let F=i.elementCount-1;F>=0;F--){let G=F>=k,H=2*F,I=i.elements[H+0],J=i.elements[H+1],K=I+J,L={start:I,count:J,normals:[],continuous:[],concave:[]},M=I,N=K-1,O=I+1,P=this._shape.roundedCurves.length;do{let Q=M-I,R=i.vertices[2*N+0],S=i.vertices[2*N+1],T=i.vertices[2*M+0],U=i.vertices[2*M+1],V=i.vertices[2*O+0],W=i.vertices[2*O+1],X=T-R,Y=U-S,Z=Math.sqrt(X*X+Y*Y);X/=Z,Y/=Z;let $=T-V,_=U-W,aa=Math.sqrt($*$+_*_);$/=aa,_/=aa,L.normals[2*Q+0]=-_,L.normals[2*Q+1]=$,L.concave[Q]=X*_-Y*$>0;let ab=i.vertexIndices[M];if(Array.isArray(ab))L.continuous[Q]=!1;else{let[ac,ad]=this._shape.getCurveIndexFromVertexId(ab-1,!0);if(ad>0&&ad<1)L.continuous[Q]=!0;else{let ae=1===ad?ac+1:ac-1;ae=(ae+P)%P;let af=1===ad?0:1,ag=this._shape.roundedCurves[ac].getTangent(ad),ah=this._shape.roundedCurves[ae].getTangent(af);L.continuous[Q]=ag.dot(ah)>.95}}G&&(L.normals[2*Q+0]*=-1,L.normals[2*Q+1]*=-1),[N,M,O]=[M,O,O+1],O>=K&&(O-=J)}while(O!==I+1);let ai=[];ai.push({bevelI:0,angle:0,size:0,boundary:{vertices:i.vertices.slice(2*I,2*K),vertexCount:J,vertexIndices:Array(J).fill(!0).map((a,b)=>[b,b]),elements:[0,J],elementCount:1,mesh:null},reverseMap:[],insetPoints:i.vertices.slice(2*I,2*K)});for(let aj=1;aj<=this._bevelSegments;aj++){let ak=aj/this._bevelSegments*Math.PI/2,al=(1-Math.cos(ak))*this._bevelSize,am=[],an=[],ao=[],ap=[],aq=0;for(let ar=0;ar<J;ar++){let as=2*ar,at=(ar-1+J)%J*2,au=i.vertices[2*L.start+as+0],av=i.vertices[2*L.start+as+1],aw=-L.normals[at+0]*al,ax=-L.normals[at+1]*al,ay=-L.normals[as+0]*al,az=-L.normals[as+1]*al;if(L.concave[ar]|| !L.concave[ar]&&G){let aA=Math.atan2(ax,aw),aB=Math.atan2(az,ay);aB>aA&&(aB-=2*Math.PI);let aC=aB-aA;if(L.continuous[ar]||G){let aD=aA+aC/2,aE=Math.cos(aD)*al,aF=Math.sin(aD)*al;am[2*aq+0]=au+aE*(G?-1:1),am[2*aq+1]=av+aF*(G?-1:1),ap[aq]=ar,aq++}else{let aG=Math.max(1,Math.floor(d/4*Math.abs(aC)/Math.PI));for(let aH=0;aH<=aG;aH++){let aI=aA+aC*(aH/aG),aJ=Math.cos(aI)*al,aK=Math.sin(aI)*al;am[2*aq+0]=au+aJ,am[2*aq+1]=av+aK,ap[aq]=ar,aq++}}}else am[2*aq+0]=au+aw,am[2*aq+1]=av+ax,ap[aq]=ar,an[ar]=aq,am[2* ++aq+0]=au,am[2*aq+1]=av,ap[aq]=ar,am[2* ++aq+0]=au+ay,am[2*aq+1]=av+az,ap[aq]=ar,ao[ar]=aq,aq++}let aL=h_({windingRule:jb.POSITIVE,elementType:jc.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[am],edgeCreateCallback:a=>{let b=a.Org.idx,c=ap[b],d=ap[(b+1)%ap.length];a.idx=[c,d],a.Sym.idx=[d,c]},vertexIdCallback:a=>{let b=a.Lprev.idx;return[b?b[1]:0,a.idx[0]]}});if(!aL)throw console.log("Error"),Error(`error generating bevel geometry for ${aj}'th loop`);if(!aL.vertexCount)break;for(let aM=0;aM<aL.vertexIndices.length;aM++){let[aN,aO]=aL.vertexIndices[aM];if(aN===aO)continue;let aP=aO;aO<aN&&(aP+=J);for(let aQ=aN;aQ<aP;aQ++){let aR=aQ%J,aS=(aQ+1)%J;if(!L.continuous[aR]||!L.continuous[aS]){aL.vertexIndices[aM]=[aN,aR],aL.vertexIndices.splice(aM+1,0,[aS,aO]),aL.vertices.splice((aM+1)*2,0,aL.vertices[2*aM],aL.vertices[2*aM+1]);break}}}ai.push({bevelI:aj,angle:ak,size:al,boundary:aL,reverseMap:ap,insetPoints:am})}let aT=(a,b,c)=>{let d=0,e=a.boundary.vertexIndices.length;for(;d<e&&c(a.boundary.vertexIndices[b]);)b=(b+1)%e,d++;return d},aU=D.length;for(let aV=1;aV<ai.length;aV++){let aW=ai[aV-1],aX=ai[aV],aY=aW.boundary.vertexIndices.length,aZ=aX.boundary.vertexIndices.length;if(!aY||!aZ)break;let a$=L.concave.length,a_=0,a0=h3(a_,J);for(;!aW.boundary.vertexIndices.filter(a0).length||!aX.boundary.vertexIndices.filter(a0).length;)a0=h3(++a_,J);let a1=aW.boundary.vertexIndices.findIndex(a0),a2=aX.boundary.vertexIndices.findIndex(a0);do a1=(a1+1)%aY;while(a0(aW.boundary.vertexIndices[a1]));do a2=(a2+1)%aZ;while(a0(aX.boundary.vertexIndices[a2]));let a3=a_=(a_+1)%J,a4=this.buildBevelVert(L,aW,(a1-1+aY)%aY),a5=this.buildBevelVert(L,aX,(a2-1+aZ)%aZ),a6=a4,a7=a5,a8,a9,ba=!1;do{a0=h3(a_,J);let bb=aT(aW,a1,a0),bc=aT(aX,a2,a0),bd=ba;if(ba=!1,bb&&!bc){for(let be=0;be<bb;be++)a8=this.buildBevelVert(L,aW,(a1+be)%aY,be/(bb-1)),D.push(a6.topN,a8.topP,a7.topN),D.push(a8.bottomP,a6.bottomN,a7.bottomN),a6=a8;ba=!0}else if(!bb&&bc)for(let bf=0;bf<bc;bf++)a9=this.buildBevelVert(L,aX,(a2+bf)%aZ,bf/(bc-1)),D.push(a7.topN,a6.topP,a9.topP),D.push(a6.bottomP,a7.bottomN,a9.bottomP),a7=a9;else if(bb&&bc){if(a8=this.buildBevelVert(L,aW,a1,0),a9=this.buildBevelVert(L,aX,a2,0),bd?(D.push(a6.topN,a9.topP,a7.topN),D.push(a6.topN,a8.topP,a9.topP),D.push(a9.bottomP,a6.bottomN,a7.bottomN),D.push(a9.bottomP,a8.bottomP,a6.bottomN)):(D.push(a7.topN,a6.topN,a8.topP),D.push(a7.topN,a8.topP,a9.topP),D.push(a8.bottomP,a6.bottomN,a7.bottomN),D.push(a8.bottomP,a7.bottomN,a9.bottomP)),a6=a8,a7=a9,bb===bc)for(let bg=1;bg<bb;bg++)a8=this.buildBevelVert(L,aW,(a1+bg)%aY,bg/(bb-1)),a9=this.buildBevelVert(L,aX,(a2+bg)%aZ,bg/(bc-1)),D.push(a6.topN,a8.topP,a7.topN),D.push(a7.topN,a8.topP,a9.topP),D.push(a8.bottomP,a6.bottomN,a7.bottomN),D.push(a8.bottomP,a7.bottomN,a9.bottomP),a6=a8,a7=a9;else if(bb>bc){let bh=bb/bc,bi=0;for(let bj=1;bj<bb;bj++)a8=this.buildBevelVert(L,aW,(a1+bj)%aY,bj/(bb-1)),D.push(a6.topN,a8.topP,a7.topN),D.push(a8.bottomP,a6.bottomN,a7.bottomN),a6=a8,bj>(bi+1)*bh&&(bi++,a9=this.buildBevelVert(L,aX,(a2+bi)%aZ,bi/(bc-1)),D.push(a7.topN,a8.topP,a9.topP),D.push(a8.bottomP,a7.bottomN,a9.bottomP),a7=a9)}else{let bk=bc/bb,bl=0;for(let bm=1;bm<bc;bm++)a9=this.buildBevelVert(L,aX,(a2+bm)%aZ,bm/(bc-1)),D.push(a7.topN,a8.topP,a9.topP),D.push(a8.bottomP,a7.bottomN,a9.bottomP),a7=a9,bm>(bl+1)*bk&&(bl++,a8=this.buildBevelVert(L,aW,(a1+bl)%aY,bl/(bb-1)),D.push(a6.topN,a8.topP,a7.topN),D.push(a8.bottomP,a6.bottomN,a7.bottomN),a6=a8)}}a1=(a1+bb)%aY,a2=(a2+bc)%aZ,a_=(a_+1)%a$}while(a_!==a3)}{let bn=ai[0];for(let bo=0,bp=bn.boundary.vertexCount;bo<bp;bo++){let bq=this.buildBevelVert(L,bn,bo),br=this.buildBevelVert(L,bn,(bo+1)%bp);D.push(br.topP,bq.topN,bq.bottomN),D.push(br.topP,bq.bottomN,br.bottomP)}}if(G){let bs=[];for(let bt=D.length-1;bt>=aU+2;bt-=3){let bu=D[bt-2],bv=D[bt-1],bw=D[bt-0];bs.push(bw,bv,bu)}D.splice(aU,D.length-aU,...bs)}if(G){let bx=[];for(let by=ai[ai.length-1].boundary.vertices.length-1;by>=1;by-=2){let bz=ai[ai.length-1].boundary.vertices[by-1],bA=ai[ai.length-1].boundary.vertices[by-0];bx.push(bz,bA)}E.push(bx)}if(!G){let bB=ai[ai.length-1],bC=h_({windingRule:ai.length>1?jb.POSITIVE:jb.ODD,elementType:jc.POLYGONS,vertexSize:2,strict:!0,contours:[bB.insetPoints,...E]});if(!bC)throw Error("Error generating geometry for surface");0===g.length&&Object.assign(this,{capStartIndex:D.length});for(let bD=0;bD<3*bC.elementCount;bD+=3){let bE=this.buildSurfaceVert(bC,bC.elements[bD+0]),bF=this.buildSurfaceVert(bC,bC.elements[bD+1]),bG=this.buildSurfaceVert(bC,bC.elements[bD+2]);D.push(bE.top,bF.top,bG.top),D.push(bG.bottom,bF.bottom,bE.bottom)}}this.vertexCache={}}this._buffer.shrink();let bH=new h.BufferAttribute(Uint32Array.from(D),1),bI=new h.BufferAttribute(this._buffer.positions,3),bJ=new h.BufferAttribute(this._buffer.normals,3),bK=new h.BufferAttribute(this._buffer.uvs,2);bI.needsUpdate=!0,bJ.needsUpdate=!0,bK.needsUpdate=!0,bH.needsUpdate=!0,this.setAttribute("position",bI),this.setAttribute("normal",bJ),this.setAttribute("uv",bK),this.setIndex(bH)}buildSurfaceVert(a,b){let c=b.toString();if(c in this.vertexCache)return this.vertexCache[c];let d=a.vertices[2*b+0],e=a.vertices[2*b+1],f=(d-this._minX)/this._width,g=(e-this._minY)/this._height,h=this._buffer.get(2),i=3*h,j=2*h,k={top:h+0,bottom:h+1};return this._buffer.positions[i+0]=d,this._buffer.positions[i+1]=e,this._buffer.positions[i+2]=this._depth,this._buffer.normals[i+0]=0,this._buffer.normals[i+1]=0,this._buffer.normals[i+2]=1,this._buffer.uvs[j+0]=f,this._buffer.uvs[j+1]=g,this._buffer.positions[i+3]=d,this._buffer.positions[i+4]=e,this._buffer.positions[i+5]=0,this._buffer.normals[i+3]=0,this._buffer.normals[i+4]=0,this._buffer.normals[i+5]=-1,this._buffer.uvs[j+2]=f,this._buffer.uvs[j+3]=g,this.vertexCache[c]=k,k}buildBevelVert(a,b,c,d=1){let e=`${b.bevelI}:${c}`;if(e in this.vertexCache)return this.vertexCache[e];let[f,g]=b.boundary.vertexIndices[c],h,i,j,k;f!==g?(i=f,h=g,k=!1,j=a.continuous[i]&&a.continuous[h]):(i=((h=f)-1+a.count)%a.count,k=a.concave[h]&&b.bevelI>0,j=a.continuous[h]||k);let l=Math.cos(b.angle),m=Math.sin(b.angle),n=2*c,o=2*h,p=2*i,q=b.boundary.vertices[n+0],r=b.boundary.vertices[n+1],s=(1-m)*this._bevelSize,t=(q-this._minX)/this._width,u=(r-this._minY)/this._height,v=a.normals[o+0],w=a.normals[o+1],x=a.normals[p+0],y=a.normals[p+1];if(k){let z=x-v,A=y-w,B=Math.sqrt((v+=z*(1-d))*v+(w+=A*(1-d))*w);v/=B,w/=B}let C=this._buffer.get(j?2:4),D=3*C,E=2*C,F={i:c,fi:h,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1};return this._buffer.positions[D+0]=q,this._buffer.positions[D+1]=r,this._buffer.positions[D+2]=this._depth-s,this._buffer.normals[D+0]=v*l,this._buffer.normals[D+1]=w*l,this._buffer.normals[D+2]=m,this._buffer.uvs[E+0]=t,this._buffer.uvs[E+1]=u,this._buffer.positions[D+3]=q,this._buffer.positions[D+4]=r,this._buffer.positions[D+5]=s,this._buffer.normals[D+3]=v*l,this._buffer.normals[D+4]=w*l,this._buffer.normals[D+5]=-m,this._buffer.uvs[E+2]=u,this._buffer.uvs[E+3]=t,j||(C+=2,D+=6,E+=4,F.topP=C+0,F.bottomP=C+1,this._buffer.positions[D+0]=q,this._buffer.positions[D+1]=r,this._buffer.positions[D+2]=this._depth-s,this._buffer.normals[D+0]=x*l,this._buffer.normals[D+1]=y*l,this._buffer.normals[D+2]=m,this._buffer.uvs[E+0]=t,this._buffer.uvs[E+1]=u,this._buffer.positions[D+3]=q,this._buffer.positions[D+4]=r,this._buffer.positions[D+5]=s,this._buffer.normals[D+3]=x*l,this._buffer.normals[D+4]=y*l,this._buffer.normals[D+5]=-m,this._buffer.uvs[E+2]=u,this._buffer.uvs[E+3]=t),this.vertexCache[e]=F,F}clone(){let a=new h4(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return a.userData=dU(this.userData),a}},h5=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},a.parameters),d=Math.abs(c.width),e=Math.abs(c.height??c.width),f=Math.abs(c.depth??0),g=a.shape??b?.shape,h=g?.roundness??c.roundness;void 0!==g&&(g instanceof hI?(g.width!==d||g.height!==e)&&g.applySize(d,e):g=new hI(d,e).fromJSON(g),a.parameters?.roundness!==void 0&&a.parameters?.roundness>0&&g.update(!1));let i=g??new hI(d,e);return{parameters:Object.assign(c,{width:d,height:e,depth:f,roundness:h}),shape:i}}static build(a){let{depth:b,extrudeBevelSize:c,extrudeBevelSegments:d,subdivisions:e,roundness:f}=a.parameters;a.shape.roundness=f;let g;return Object.assign(b<=0?new h0(a.shape,e):new h4(a.shape,b,c,e,d),{userData:{...a,type:"VectorGeometry"}})}},h6=2*Math.PI,h7=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},a.parameters);return{shape:a.shape&&a.shape instanceof hI?a.shape:new hI,parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??0)})}}static build(a){let{width:b,height:c,spikes:d,angle:e,innerRadius:f,depth:g,extrudeBevelSize:h,extrudeBevelSegments:i}=a.parameters,j=a.shape,k=h8(j,.5*b,.5*c,e*Math.PI/180,d,f);j.isClosed=!0,j.update();let l=h5.create({shape:j,parameters:{subdivisions:k,depth:g,extrudeBevelSize:h,extrudeBevelSegments:i}});return Object.assign(l,{userData:{...a,type:"EllipseGeometry"}})}};function h8(a,b,c,d,e,f){if(d>=h6)return e>30||e%4==0?(ib(a,b,c,f),Math.round(e/4)):ia(a,d,e,b,c,f);let g={x:0,y:c},h=d+.5*Math.PI,i={x:Math.cos(h)*b,y:Math.sin(h)*c},j=function({px:a,py:b,cx:c,cy:d,rx:e,ry:f,largeArcFlag:g,sweepFlag:h}){var i,j,k,l,m,n,o,p,q,r;let s=[];if(0===e||0===f)return[];let t=(a-c)/2,u=(b-d)/2;if(0===t&&0===u)return[];e=Math.abs(e),f=Math.abs(f);let v=Math.pow(t,2)/Math.pow(e,2)+Math.pow(u,2)/Math.pow(f,2);v>1&&(e*=Math.sqrt(v),f*=Math.sqrt(v));let w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=(i=a,j=b,k=c,l=d,m=e,n=f,o=t,p=u,q=g,r=h,w=Math.pow(m,2),x=Math.pow(n,2),y=Math.pow(o,2),z=Math.pow(p,2),A=w*x-w*z-x*y,A<0&&(A=0),A/=w*z+x*y,B=(A=Math.sqrt(A)*(q===r?-1:1))*m/n*p,C=-(A*n)/m*o,D=B+(i+k)/2,E=C+(j+l)/2,F=(o-B)/m,G=(p-C)/n,H=(-o-B)/m,I=(-p-C)/n,J=hM(1,0,F,G),K=hM(F,G,H,I),!r&&K>0&&(K-=hJ),r&&K<0&&(K+=hJ),{centerx:D,centery:E,ang1:J,ang2:K}),{ang1:M,ang2:N}=L,{centerx:O,centery:P}=L,Q=Math.abs(N)/(hJ/4);1e-7>Math.abs(1-Q)&&(Q=1);let R=Math.max(Math.ceil(Q),1);N/=R;for(let S=0;S<R;S++)s.push(hL(M,N)),M+=N;return s.map(a=>{let{x:b,y:c}=hK(a[0],e,f,O,P),{x:d,y:g}=hK(a[1],e,f,O,P),{x:h,y:i}=hK(a[2],e,f,O,P);return{x1:b,y1:c,x2:d,y2:g,x:h,y:i}})}({px:g.x,py:g.y,cx:i.x,cy:i.y,rx:b,ry:c,largeArcFlag:d>Math.PI,sweepFlag:!0});return e>30||e%j.length==0?h9(a,g.x,g.y,j,e,b,c,f):ia(a,d,e,b,c,f)}function h9(a,b,c,d,e,f,g,h){let i=Math.round(e/d.length);a.addPoint(ic(b,c));for(let j=0,k=d.length;j<k;j++){let l=d[j],m=a.points[j],n=ic(l.x,l.y);m.controls[1].position.set(l.x1,l.y1),n.controls[0].position.set(l.x2,l.y2),a.addPoint(n)}return h>0?ie(a,f,g,h):a.addPoint(ic(0,0)),i}function ia(a,b,c,d,e,f){let g=-b/c;for(let h=0;h<=c;h++){let i=g*h,j=Math.sin(i)*d,k=Math.cos(i)*e;a.addPoint(ic(j,k))}return b<h6?f>0?ie(a,d,e,f):a.addPoint(ic(0,0)):(a.removePoint(a.points[a.points.length-1]),f>0&&ig(a,d,e,f)),1}function ib(a,b,c,d=0,e=0,f=0){let g=.5522847498*b,h=.5522847498*c;a.addPoint(id(e-b,f,e-b,f-h,e-b,f+h)),a.addPoint(id(e,f+c,e-g,f+c,e+g,f+c)),a.addPoint(id(e+b,f,e+b,f+h,e+b,f-h)),a.addPoint(id(e,f-c,e+g,f-c,e-g,f-c)),d>0&&ig(a,b,c,d)}function ic(a,b){return new hd(h.MathUtils.generateUUID(),new h.Vector2(a,b))}function id(a,b,c,d,e,f){let g=ic(a,b);return g.controls[0].position.set(c,d),g.controls[1].position.set(e,f),g}function ie(a,b,c,d){ih(a,b,c,d).forEach(b=>a.addPoint(b))}function ig(a,b,c,d){let e=ih(a,b,c,d),f=new hI;e.forEach(a=>f.addPoint(a)),f.isClosed=!0,a.shapeHoles.push(f)}function ih(a,b,c,d){let e=d*b/100,f=new h.Vector2(e/b,e*(Math.abs(c)/Math.abs(b))/c),g=a.points.map(a=>{let b=a.clone();return b.uuid=h.MathUtils.generateUUID(),b}).reverse();return g.forEach(a=>{a.position.multiply(f);let b=a.controls[0].position.clone().multiply(f),c=a.controls[1].position.clone().multiply(f);a.controls[0].position.copy(c),a.controls[1].position.copy(b)}),g}var ii=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},a.parameters),d=Math.abs(c.width),e=Math.abs(c.height??d),f=Math.abs(c.depth??d);return{parameters:Object.assign(c,{width:d,height:e,depth:f,radius:Math.abs(Math.min(d,f))/2,segments:Math.round(c.segments),pathSegments:Math.round(c.pathSegments),cornerSegments:Math.round(c.cornerSegments)})}}static build(a){let{width:b,height:c,depth:d,radius:e,revolutions:f,segments:g,pathRadius:h,pathType:i,pathSegments:j,cornerRadius:k,cornerSegments:l}=a.parameters;return Object.assign(new ij(!1,b,c,d,e,f,g,h,i,j,k,l),{userData:{...a,type:"HelixGeometry"}})}},ij=class extends h.BufferGeometry{constructor(a=!0,b=1,c=1,d=1,e=1,f=1,g=1,i=1,j=1,k=1,l=1,m=1){super();let n=a&&1===f;n&&(m=0),l>100&&(l=100);let o=()=>new h.Vector3,p=new h.Vector3,q=o(),r=o(),s=o(),t,u,v,w,x,y,z,A,B=o(),C=o(),D=o(),E=o(),F=o(),G=o(),H=o(),I=o(),J=c-2*i+.001,K=J/f,L=Math.ceil(g*f),M=L+1,N=J/L,O=-J/2,P=k+1,Q=2*Math.PI/k,R=Math.PI/2/m,S=Math.min((1-l/100)*i,i-.01),T=i-S,U=0,V=2*m+2,W=P*V/2,X=W+P*M,Y=P*(M+V),[Z,$,_]=[3,3,2].map(a=>Array(Y*a).fill(0)),aa=[],ab=e-i;function ac(b,c){A=2*Math.PI*((y=c*N)%K)/K+Math.PI/2,y+=O,z=Math.sin(A)*ab,x=Math.cos(A)*ab,a?b.set(x,z,y):b.set(x,y,z)}ac(p,-.0000000001),ac(q,0),B.copy(p),ac(p,1);let ad=p.distanceTo(q),ae=T+S,af=ad*L+2*ae,ag=S,ah=af-ae;for(let ai=0;ai<=L;ai++){ac(r,ai),I.subVectors(r,B).normalize(),B.copy(r),G.copy(r).setComponent(+a+1,0).normalize(),H.crossVectors(I,G).normalize();let aj=0===ai,ak=ai===L,al=aj?3*Math.PI/2:R,am=aj?ag:ah,an=aj?P:X,ao=aj?0:Y-P,ap=I.clone().multiplyScalar(aj?-T:T).add(r),aq=I.clone().multiplyScalar(aj?-1:1).normalize();for(let ar=0;ar<P;ar++){let as=ar*Q;if(C.addVectors(p.copy(G).multiplyScalar(i*Math.cos(as)),q.copy(H).multiplyScalar(i*Math.sin(as))),D.copy(C).normalize(),aj||ak){n||(U=ao+ar,[0,1,2].forEach(a=>{Z[3*U+a]=ap.getComponent(a),$[3*U+a]=aq.getComponent(a)}),_[2*U]=+ak,_[2*U+1]=ar/k),q.copy(D).multiplyScalar(S),s.addVectors(r,q);for(let at=0;at<m;at++){let au=at*R+al;E.addVectors(p.copy(I).multiplyScalar(T*Math.sin(au)),q.copy(D).multiplyScalar(T*Math.cos(au))),F.copy(E).normalize(),q.addVectors(s,E),E.normalize(),U=an+at*P+ar,[0,1,2].forEach(a=>{Z[3*U+a]=q.getComponent(a),$[3*U+a]=F.getComponent(a)});let av=+aj+Math.sin(au);_[2*U]=(am+T*av)/af,_[2*U+1]=ar/k}}q.addVectors(r,C),U=W+ai*P+ar,[0,1,2].forEach(a=>{Z[3*U+a]=q.getComponent(a),$[3*U+a]=D.getComponent(a)}),_[2*U]=(ae+ai*ad)/af,_[2*U+1]=ar/k}}let aw=M+2*m+2,[ax,ay]=n?[1,1+M-1]:[0,aw-1];for(let az=ax;az<=ay-1;az++){let aA=n&&az===ay-1;for(let aB=0;aB<P-1;aB++)u=(t=az*P+aB)+1,v=(aA?aB:t)+P,w=(aA?aB+1:u)+P,0===az?aa.push(u,w,v):az===aw-2?aa.push(t,u,v):aa.push(t,u,v,u,w,v)}this.setIndex(aa),this.setAttribute("position",new h.Float32BufferAttribute(Z,3)),this.setAttribute("normal",new h.Float32BufferAttribute($,3)),this.setAttribute("uv",new h.Float32BufferAttribute(_,2))}},ik=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,detail:0,corner:0,cornerSides:4},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b,height:c,depth:d,detail:e,corner:f,cornerSides:g}=a.parameters,i=0===e&&0!==f?new il(.5*b,f,g):new h.IcosahedronBufferGeometry(.5*b,e);return i.scale(1,c/b,d/b),Object.assign(i,{userData:{...a,type:"IcosahedronGeometry"}})}},il=class extends g8{constructor(a=1,b=.2,c=4){let d=(1+Math.sqrt(5))/2,e="IcosahedronGeometry";super([-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,a,b,c),this.type=e}static fromJSON(a){return new il(a.radius,a.corner,a.cornerSides)}},im=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){(a.parameters?.points??[]).forEach(a=>{Array.isArray(a)&&(a.x=a[0],a.y=a[1])});let c=Object.assign({},b?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{points:b,segments:c,verticalSegments:d}=a.parameters,e=new h.Shape;e.moveTo(b[0].x,b[0].y),e.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);let f=new h.LatheBufferGeometry(e.extractPoints(d).shape,c);return f.rotateZ(Math.PI),Object.assign(f,{userData:{...a,type:"LatheGeometry"}})}},io=new h.Matrix4,ip=new h.Object3D,iq=new h.Vector3,ir=class extends h.EventDispatcher{constructor(){super(),this.uuid=h.MathUtils.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(a){let b=new h.Matrix3().getNormalMatrix(a);for(let c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);for(let e=0,f=this.faces.length;e<f;e++){let g=this.faces[e];g.normal.applyMatrix3(b).normalize();for(let i=0,j=g.vertexNormals.length;i<j;i++)g.vertexNormals[i].applyMatrix3(b).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(a){return io.makeRotationX(a),this.applyMatrix4(io),this}rotateY(a){return io.makeRotationY(a),this.applyMatrix4(io),this}rotateZ(a){return io.makeRotationZ(a),this.applyMatrix4(io),this}translate(a,b,c){return io.makeTranslation(a,b,c),this.applyMatrix4(io),this}scale(a,b,c){return io.makeScale(a,b,c),this.applyMatrix4(io),this}lookAt(a){return ip.lookAt(a),ip.updateMatrix(),this.applyMatrix4(ip.matrix),this}fromBufferGeometry(a){let b=this,c=null!==a.index?a.index:void 0,d=a.attributes;if(void 0===d.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let e=d.position,f=d.normal,g=d.color,i=d.uv,j=d.uv2;void 0!==j&&(this.faceVertexUvs[1]=[]);for(let k=0;k<e.count;k++)b.vertices.push(new h.Vector3().fromBufferAttribute(e,k)),void 0!==g&&b.colors.push(new h.Color().fromBufferAttribute(g,k));function l(a,c,d,e){let k=void 0===g?[]:[b.colors[a].clone(),b.colors[c].clone(),b.colors[d].clone()],l=void 0===f?[]:[new h.Vector3().fromBufferAttribute(f,a),new h.Vector3().fromBufferAttribute(f,c),new h.Vector3().fromBufferAttribute(f,d)],m=new it(a,c,d,l,k,e);b.faces.push(m),void 0!==i&&b.faceVertexUvs[0].push([new h.Vector2().fromBufferAttribute(i,a),new h.Vector2().fromBufferAttribute(i,c),new h.Vector2().fromBufferAttribute(i,d)]),void 0!==j&&b.faceVertexUvs[1].push([new h.Vector2().fromBufferAttribute(j,a),new h.Vector2().fromBufferAttribute(j,c),new h.Vector2().fromBufferAttribute(j,d)])}let m=a.groups;if(m.length>0)for(let n=0;n<m.length;n++){let o=m[n],p=o.start,q=o.count;for(let r=p,s=p+q;r<s;r+=3)void 0!==c?l(c.getX(r),c.getX(r+1),c.getX(r+2),o.materialIndex):l(r,r+1,r+2,o.materialIndex)}else if(void 0!==c)for(let t=0;t<c.count;t+=3)l(c.getX(t),c.getX(t+1),c.getX(t+2));else for(let u=0;u<e.count;u+=3)l(u,u+1,u+2);return this.computeFaceNormals(),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(iq).negate(),this.translate(iq.x,iq.y,iq.z),this}normalize(){this.computeBoundingSphere();let a=this.boundingSphere.center,b=this.boundingSphere.radius,c=0===b?1:1/b,d=new h.Matrix4;return d.set(c,0,0,-c*a.x,0,c,0,-c*a.y,0,0,c,-c*a.z,0,0,0,1),this.applyMatrix4(d),this}computeFaceNormals(){let a=new h.Vector3,b=new h.Vector3;for(let c=0,d=this.faces.length;c<d;c++){let e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b],i=this.vertices[e.c];a.subVectors(i,g),b.subVectors(f,g),a.cross(b),a.normalize(),e.normal.copy(a)}}computeVertexNormals(a=!0){let b=Array(this.vertices.length);for(let c=0,d=this.vertices.length;c<d;c++)b[c]=new h.Vector3;if(a){let e=new h.Vector3,f=new h.Vector3;for(let g=0,i=this.faces.length;g<i;g++){let j=this.faces[g],k=this.vertices[j.a],l=this.vertices[j.b],m=this.vertices[j.c];e.subVectors(m,l),f.subVectors(k,l),e.cross(f),b[j.a].add(e),b[j.b].add(e),b[j.c].add(e)}}else{this.computeFaceNormals();for(let n=0,o=this.faces.length;n<o;n++){let p=this.faces[n];b[p.a].add(p.normal),b[p.b].add(p.normal),b[p.c].add(p.normal)}}for(let q=0,r=this.vertices.length;q<r;q++)b[q].normalize();for(let s=0,t=this.faces.length;s<t;s++){let u=this.faces[s],v=u.vertexNormals;3===v.length?(v[0].copy(b[u.a]),v[1].copy(b[u.b]),v[2].copy(b[u.c])):(v[0]=b[u.a].clone(),v[1]=b[u.b].clone(),v[2]=b[u.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let a=0,b=this.faces.length;a<b;a++){let c=this.faces[a],d=c.vertexNormals;3===d.length?(d[0].copy(c.normal),d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let a=0,b=this.faces.length;a<b;a++){let c=this.faces[a];c.__originalFaceNormal?c.__originalFaceNormal.copy(c.normal):c.__originalFaceNormal=c.normal.clone(),c.__originalVertexNormals||(c.__originalVertexNormals=[]);for(let d=0,e=c.vertexNormals.length;d<e;d++)c.__originalVertexNormals[d]?c.__originalVertexNormals[d].copy(c.vertexNormals[d]):c.__originalVertexNormals[d]=c.vertexNormals[d].clone()}let f=new ir;f.faces=this.faces;for(let g=0,i=this.morphTargets.length;g<i;g++){if(!this.morphNormals[g]){this.morphNormals[g]={},this.morphNormals[g].faceNormals=[],this.morphNormals[g].vertexNormals=[];let j=this.morphNormals[g].faceNormals,k=this.morphNormals[g].vertexNormals;for(let l=0,m=this.faces.length;l<m;l++){let n=new h.Vector3,o={a:new h.Vector3,b:new h.Vector3,c:new h.Vector3};j.push(n),k.push(o)}}let p=this.morphNormals[g];f.vertices=this.morphTargets[g].vertices,f.computeFaceNormals(),f.computeVertexNormals();for(let q=0,r=this.faces.length;q<r;q++){let s=this.faces[q],t=p.faceNormals[q],u=p.vertexNormals[q];t.copy(s.normal),u.a.copy(s.vertexNormals[0]),u.b.copy(s.vertexNormals[1]),u.c.copy(s.vertexNormals[2])}}for(let v=0,w=this.faces.length;v<w;v++){let x=this.faces[v];x.normal=x.__originalFaceNormal,x.vertexNormals=x.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new h.Box3),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new h.Sphere),this.boundingSphere.setFromPoints(this.vertices)}merge(a,b,c=0){if(!(a&&a.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);return}let d,e=this.vertices.length,f=this.vertices,g=a.vertices,i=this.faces,j=a.faces,k=this.colors,l=a.colors;void 0!==b&&(d=new h.Matrix3().getNormalMatrix(b));for(let m=0,n=g.length;m<n;m++){let o=g[m].clone();void 0!==b&&o.applyMatrix4(b),f.push(o)}for(let p=0,q=l.length;p<q;p++)k.push(l[p].clone());for(let r=0,s=j.length;r<s;r++){let t=j[r],u,v,w=t.vertexNormals,x=t.vertexColors,y=new it(t.a+e,t.b+e,t.c+e);y.normal.copy(t.normal),void 0!==d&&y.normal.applyMatrix3(d).normalize();for(let z=0,A=w.length;z<A;z++)u=w[z].clone(),void 0!==d&&u.applyMatrix3(d).normalize(),y.vertexNormals.push(u);y.color.copy(t.color);for(let B=0,C=x.length;B<C;B++)v=x[B],y.vertexColors.push(v.clone());y.materialIndex=t.materialIndex+c,i.push(y)}for(let D=0,E=a.faceVertexUvs.length;D<E;D++){let F=a.faceVertexUvs[D];void 0===this.faceVertexUvs[D]&&(this.faceVertexUvs[D]=[]);for(let G=0,H=F.length;G<H;G++){let I=F[G],J=[];for(let K=0,L=I.length;K<L;K++)J.push(I[K].clone());this.faceVertexUvs[D].push(J)}}}mergeMesh(a){if(!(a&&a.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a);return}a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)}mergeVertices(a=4){let b={},c=[],d=[],e=Math.pow(10,a);for(let f=0,g=this.vertices.length;f<g;f++){let h=this.vertices[f],i=Math.round(h.x*e)+"_"+Math.round(h.y*e)+"_"+Math.round(h.z*e);void 0===b[i]?(b[i]=f,c.push(this.vertices[f]),d[f]=c.length-1):d[f]=d[b[i]]}let j=[];for(let k=0,l=this.faces.length;k<l;k++){let m=this.faces[k];m.a=d[m.a],m.b=d[m.b],m.c=d[m.c];let n=[m.a,m.b,m.c];for(let o=0;o<3;o++)if(n[o]===n[(o+1)%3]){j.push(k);break}}for(let p=j.length-1;p>=0;p--){let q=j[p];this.faces.splice(q,1);for(let r=0,s=this.faceVertexUvs.length;r<s;r++)this.faceVertexUvs[r].splice(q,1)}let t=this.vertices.length-c.length;return this.vertices=c,t}setFromPoints(a){this.vertices=[];for(let b=0,c=a.length;b<c;b++){let d=a[b];this.vertices.push(new h.Vector3(d.x,d.y,d.z||0))}return this}sortFacesByMaterialIndex(){let a=this.faces,b=a.length;for(let c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});let d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]),e&&e.length===b&&(g=[]);for(let h=0;h<b;h++){let i=a[h]._id;f&&f.push(d[i]),g&&g.push(e[i])}f&&(this.faceVertexUvs[0]=f),g&&(this.faceVertexUvs[1]=g)}toJSON(){let a={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),void 0!==this.parameters){let b=this.parameters;for(let c in b)void 0!==b[c]&&(a[c]=b[c]);return a}let d=[];for(let e=0;e<this.vertices.length;e++){let f=this.vertices[e];d.push(f.x,f.y,f.z)}let g=[],h=[],i={},j=[],k={},l=[],m={};for(let n=0;n<this.faces.length;n++){let o=this.faces[n],p=!0,q=!1,r=void 0!==this.faceVertexUvs[0][n],s=o.normal.length()>0,t=o.vertexNormals.length>0,u=1!==o.color.r||1!==o.color.g||1!==o.color.b,v=o.vertexColors.length>0,w=0;if(w=A(w,0,0),w=A(w,1,p),w=A(w,2,q),w=A(w,3,r),w=A(w,4,s),w=A(w,5,t),w=A(w,6,u),w=A(w,7,v),g.push(w),g.push(o.a,o.b,o.c),g.push(o.materialIndex),r){let x=this.faceVertexUvs[0][n];g.push(D(x[0]),D(x[1]),D(x[2]))}if(s&&g.push(B(o.normal)),t){let y=o.vertexNormals;g.push(B(y[0]),B(y[1]),B(y[2]))}if(u&&g.push(C(o.color)),v){let z=o.vertexColors;g.push(C(z[0]),C(z[1]),C(z[2]))}}function A(a,b,c){return c?a|1<<b:a& ~(1<<b)}function B(a){let b=a.x.toString()+a.y.toString()+a.z.toString();return void 0!==i[b]||(i[b]=h.length/3,h.push(a.x,a.y,a.z)),i[b]}function C(a){let b=a.r.toString()+a.g.toString()+a.b.toString();return void 0!==k[b]||(k[b]=j.length,j.push(a.getHex())),k[b]}function D(a){let b=a.x.toString()+a.y.toString();return void 0!==m[b]||(m[b]=l.length/2,l.push(a.x,a.y)),m[b]}return a.data={},a.data.vertices=d,a.data.normals=h,j.length>0&&(a.data.colors=j),l.length>0&&(a.data.uvs=[l]),a.data.faces=g,a}clone(){return new ir().copy(this)}copy(a){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=a.name;let b=a.vertices;for(let c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());let e=a.colors;for(let f=0,g=e.length;f<g;f++)this.colors.push(e[f].clone());let h=a.faces;for(let i=0,j=h.length;i<j;i++)this.faces.push(h[i].clone());for(let k=0,l=a.faceVertexUvs.length;k<l;k++){let m=a.faceVertexUvs[k];void 0===this.faceVertexUvs[k]&&(this.faceVertexUvs[k]=[]);for(let n=0,o=m.length;n<o;n++){let p=m[n],q=[];for(let r=0,s=p.length;r<s;r++){let t=p[r];q.push(t.clone())}this.faceVertexUvs[k].push(q)}}let u=a.morphTargets;for(let v=0,w=u.length;v<w;v++){let x={};if(x.name=u[v].name,void 0!==u[v].vertices){x.vertices=[];for(let y=0,z=u[v].vertices.length;y<z;y++)x.vertices.push(u[v].vertices[y].clone())}if(void 0!==u[v].normals){x.normals=[];for(let A=0,B=u[v].normals.length;A<B;A++)x.normals.push(u[v].normals[A].clone())}this.morphTargets.push(x)}let C=a.morphNormals;for(let D=0,E=C.length;D<E;D++){let F={};if(void 0!==C[D].vertexNormals){F.vertexNormals=[];for(let G=0,H=C[D].vertexNormals.length;G<H;G++){let I=C[D].vertexNormals[G],J={};J.a=I.a.clone(),J.b=I.b.clone(),J.c=I.c.clone(),F.vertexNormals.push(J)}}if(void 0!==C[D].faceNormals){F.faceNormals=[];for(let K=0,L=C[D].faceNormals.length;K<L;K++)F.faceNormals.push(C[D].faceNormals[K].clone())}this.morphNormals.push(F)}let M=a.skinWeights;for(let N=0,O=M.length;N<O;N++)this.skinWeights.push(M[N].clone());let P=a.skinIndices;for(let Q=0,R=P.length;Q<R;Q++)this.skinIndices.push(P[Q].clone());let S=a.lineDistances;for(let T=0,U=S.length;T<U;T++)this.lineDistances.push(S[T]);let V=a.boundingBox;null!==V&&(this.boundingBox=V.clone());let W=a.boundingSphere;return null!==W&&(this.boundingSphere=W.clone()),this.elementsNeedUpdate=a.elementsNeedUpdate,this.verticesNeedUpdate=a.verticesNeedUpdate,this.uvsNeedUpdate=a.uvsNeedUpdate,this.normalsNeedUpdate=a.normalsNeedUpdate,this.colorsNeedUpdate=a.colorsNeedUpdate,this.lineDistancesNeedUpdate=a.lineDistancesNeedUpdate,this.groupsNeedUpdate=a.groupsNeedUpdate,this}toBufferGeometry(){let a=new is().fromGeometry(this),b=new h.BufferGeometry,c=new Float32Array(3*a.vertices.length);if(b.setAttribute("position",new h.BufferAttribute(c,3).copyVector3sArray(a.vertices)),a.normals.length>0){let d=new Float32Array(3*a.normals.length);b.setAttribute("normal",new h.BufferAttribute(d,3).copyVector3sArray(a.normals))}if(a.colors.length>0){let e=new Float32Array(3*a.colors.length);b.setAttribute("color",new h.BufferAttribute(e,3).copyColorsArray(a.colors))}if(a.uvs.length>0){let f=new Float32Array(2*a.uvs.length);b.setAttribute("uv",new h.BufferAttribute(f,2).copyVector2sArray(a.uvs))}if(a.uvs2.length>0){let g=new Float32Array(2*a.uvs2.length);b.setAttribute("uv2",new h.BufferAttribute(g,2).copyVector2sArray(a.uvs2))}for(let i in b.groups=a.groups,a.morphTargets){let j=[],k=a.morphTargets[i];for(let l=0,m=k.length;l<m;l++){let n=k[l],o=new h.Float32BufferAttribute(3*n.data.length,3);o.name=n.name,j.push(o.copyVector3sArray(n.data))}b.morphAttributes[i]=j}if(a.skinIndices.length>0){let p=new h.Float32BufferAttribute(4*a.skinIndices.length,4);b.setAttribute("skinIndex",p.copyVector4sArray(a.skinIndices))}if(a.skinWeights.length>0){let q=new h.Float32BufferAttribute(4*a.skinWeights.length,4);b.setAttribute("skinWeight",q.copyVector4sArray(a.skinWeights))}return null!==a.boundingSphere&&(b.boundingSphere=a.boundingSphere.clone()),null!==a.boundingBox&&(b.boundingBox=a.boundingBox.clone()),b}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(a){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(a)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(a){let b=new h.BufferGeometry,c=a.geometry;if(a.isPoints||a.isLine){let d=new h.Float32BufferAttribute(3*c.vertices.length,3),e=new h.Float32BufferAttribute(3*c.colors.length,3);if(b.setAttribute("position",d.copyVector3sArray(c.vertices)),b.setAttribute("color",e.copyColorsArray(c.colors)),c.lineDistances&&c.lineDistances.length===c.vertices.length){let f=new h.Float32BufferAttribute(c.lineDistances.length,1);b.setAttribute("lineDistance",f.copyArray(c.lineDistances))}null!==c.boundingSphere&&(b.boundingSphere=c.boundingSphere.clone()),null!==c.boundingBox&&(b.boundingBox=c.boundingBox.clone())}else a.isMesh&&(b=c.toBufferGeometry());return b}};ir.prototype.isGeometry=!0;var is=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(a){let b=[],c,d,e,f=a.faces;for(d=0;d<f.length;d++){let g=f[d];g.materialIndex!==e&&(e=g.materialIndex,void 0!==c&&(c.count=3*d-c.start,b.push(c)),c={start:3*d,materialIndex:e})}void 0!==c&&(c.count=3*d-c.start,b.push(c)),this.groups=b}fromGeometry(a){let b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&d[0].length>0,f=d[1]&&d[1].length>0,g=a.morphTargets,i=g.length,j;if(i>0){j=[];for(let k=0;k<i;k++)j[k]={name:g[k].name,data:[]};this.morphTargets.position=j}let l=a.morphNormals,m=l.length,n;if(m>0){n=[];for(let o=0;o<m;o++)n[o]={name:l[o].name,data:[]};this.morphTargets.normal=n}let p=a.skinIndices,q=a.skinWeights,r=p.length===c.length,s=q.length===c.length;c.length>0&&0===b.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<b.length;t++){let u=b[t];this.vertices.push(c[u.a],c[u.b],c[u.c]);let v=u.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let w=u.normal;this.normals.push(w,w,w)}let x=u.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{let y=u.color;this.colors.push(y,y,y)}if(!0===e){let z=d[0][t];void 0!==z?this.uvs.push(z[0],z[1],z[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new h.Vector2,new h.Vector2,new h.Vector2))}if(!0===f){let A=d[1][t];void 0!==A?this.uvs2.push(A[0],A[1],A[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new h.Vector2,new h.Vector2,new h.Vector2))}for(let B=0;B<i;B++){let C=g[B].vertices;j[B].data.push(C[u.a],C[u.b],C[u.c])}for(let D=0;D<m;D++){let E=l[D].vertexNormals[t];n[D].data.push(E.a,E.b,E.c)}r&&this.skinIndices.push(p[u.a],p[u.b],p[u.c]),s&&this.skinWeights.push(q[u.a],q[u.b],q[u.c])}return this.computeGroups(a),this.verticesNeedUpdate=a.verticesNeedUpdate,this.normalsNeedUpdate=a.normalsNeedUpdate,this.colorsNeedUpdate=a.colorsNeedUpdate,this.uvsNeedUpdate=a.uvsNeedUpdate,this.groupsNeedUpdate=a.groupsNeedUpdate,null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),this}},it=class{constructor(a,b,c,d,e,f=0){this.a=a,this.b=b,this.c=c,this.normal=d&&d.isVector3?d:new h.Vector3,this.vertexNormals=Array.isArray(d)?d:[],this.color=e&&e.isColor?e:new h.Color,this.vertexColors=Array.isArray(e)?e:[],this.materialIndex=f}clone(){return new this.constructor().copy(this)}copy(a){this.a=a.a,this.b=a.b,this.c=a.c,this.normal.copy(a.normal),this.color.copy(a.color),this.materialIndex=a.materialIndex;for(let b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();for(let d=0,e=a.vertexColors.length;d<e;d++)this.vertexColors[d]=a.vertexColors[d].clone();return this}},iu=["a","b","c"];function iv(a,b){switch(b){case"c":return a.c;case"b":return a.b;default:return a.a}}function iw(a,b,c){return c.get(Math.min(a,b)+"_"+Math.max(a,b))}function ix(a,b,c,d,e,f){let g=Math.min(a,b),h=Math.max(a,b),i=g+"_"+h,j;if(d.has(i))j=d.get(i);else{let k=c[g],l=c[h];j={a:k,b:l,newEdge:null,faces:[]},d.set(i,j)}j.faces.push(e),f[a].edges.push(j),f[b].edges.push(j)}function iy(a,b,c,d,e){a.push(new it(b,c,d,void 0,void 0,e))}function iz(a,b){return Math.abs(b-a)/2+Math.min(a,b)}function iA(a,b,c,d){a.push([b.clone(),c.clone(),d.clone()])}var iB=class{constructor(a=1){this.subdivisions=a}modify(a){(a=a instanceof h.BufferGeometry?new ir().fromBufferGeometry(a):a.clone()).mergeVertices();let b=this.subdivisions;for(;b-- >0;)this._smooth(a);return a.computeFaceNormals(),a.computeVertexNormals(),a}_smooth(a){let b=new h.Vector3,c,d,e,f,g,i=a.vertices,j=a.faces,k=a.faceVertexUvs[0],l=void 0!==k&&k.length>0,m=[],n=new Map;!function(a,b,c,d){let e,f,g;for(e=0,f=a.length;e<f;e++)c[e]={edges:[]};for(e=0,f=b.length;e<f;e++)ix((g=b[e]).a,g.b,a,d,g,c),ix(g.b,g.c,a,d,g,c),ix(g.c,g.a,a,d,g,c)}(i,j,m,n);let o=[],p,q,r,s,t,u,v;for(let w of Array.from(n.keys())){for(q=n.get(w),r=new h.Vector3,t=3/8,u=1/8,2!=(v=q.faces.length)&&(t=.5,u=0),r.addVectors(q.a,q.b).multiplyScalar(t),b.set(0,0,0),f=0;f<v;f++){for(s=q.faces[f],g=0;g<3&&!((p=i[iv(s,iu[g])])!==q.a&&p!==q.b);g++);p&&b.add(p)}b.multiplyScalar(u),r.add(b),q.newEdge=o.length,o.push(r)}let x,y,z,A,B,C,D,E=[];for(d=0,e=i.length;d<e;d++){for(C=i[d],B=m[d].edges,c=B.length,3==c?x=3/16:c>3&&(x=3/(8*c)),y=1-c*Number(x),z=x,c<=2&&2==c&&(y=3/4,z=1/8),D=C.clone().multiplyScalar(y),b.set(0,0,0),f=0;f<c;f++)p=(A=B[f]).a!==C?A.a:A.b,b.add(p);b.multiplyScalar(Number(z)),D.add(b),E.push(D)}let F=E.concat(o),G=E.length,H,I,J,K=[],L=[],M,N,O,P,Q=new h.Vector2,R=new h.Vector2,S=new h.Vector2;for(d=0,e=j.length;d<e;d++)H=Number(iw((s=j[d]).a,s.b,n).newEdge)+G,I=Number(iw(s.b,s.c,n).newEdge)+G,J=Number(iw(s.c,s.a,n).newEdge)+G,iy(K,H,I,J,s.materialIndex),iy(K,s.a,H,J,s.materialIndex),iy(K,s.b,I,H,s.materialIndex),iy(K,s.c,J,I,s.materialIndex),l&&(N=(M=k[d])[0],O=M[1],P=M[2],Q.set(iz(N.x,O.x),iz(N.y,O.y)),R.set(iz(O.x,P.x),iz(O.y,P.y)),S.set(iz(N.x,P.x),iz(N.y,P.y)),iA(L,Q,R,S),iA(L,N,Q,S),iA(L,O,R,Q),iA(L,P,S,R));a.vertices=F,a.faces=K,l&&(a.faceVertexUvs[0]=L)}},iC=new h.Vector3,iD=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=(a.geometry??b?.geometry)??new h.BufferGeometry().copy(new h.BoxBufferGeometry(100,100,100)),d;void 0===b?(c.computeBoundingBox(),c.boundingBox.getSize(iC),d={width:iC.x,height:iC.y,depth:iC.z,subdivisions:0}):d=b.parameters;let e={...d,...a.parameters};return{parameters:{width:Math.abs(e.width),height:Math.abs(e.height),depth:Math.abs(e.depth),subdivisions:Math.abs(e.subdivisions)},geometry:c}}static build(a){let{width:b,height:c,depth:d,subdivisions:e}=a.parameters,f=a.geometry??new h.BufferGeometry().copy(new h.BoxBufferGeometry(100,100,100)),g=f.userData.parameters;void 0===g?(f.computeBoundingBox(),f.boundingBox.getSize(iC)):iC.set(g.width,g.height,g.depth),(b!==iC.x||c!==iC.y||d!==iC.z)&&f.scale(0===iC.x?1:b/iC.x,0===iC.y?1:c/iC.y,0===iC.z?1:d/iC.z);let i=f.originalGeometry;return e>0?(void 0===i||g?.subdivisions!==e)&&(void 0===i&&(i=f),f=new iB(e).modify(i).toBufferGeometry()):(void 0!==i&&(f=i),i=void 0,void 0===f.getAttribute("normal")&&f.computeVertexNormals()),void 0!==i&&Object.assign(f,{originalGeometry:i}),delete a.geometry,Object.assign(f,{userData:{...a,type:"NonParametricGeometry"}})}static loadFromUrl(a,b,c){new h.BufferGeometryLoader(c).load(a,a=>{let c=this.normalizeInputs({geometry:a});a.boundingBox.getSize(iC);let d=100/iC.x;Object.assign(c.parameters,{width:100,height:iC.y*d,depth:iC.z*d}),b(this.build(c))})}},iE=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},a.parameters);return{shape:a.shape&&a.shape instanceof hI?a.shape:new hI,parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??0)})}}static build(a){let{width:b,height:c,spikes:d,cornerRadius:e,depth:f,extrudeBevelSize:g,extrudeBevelSegments:h}=a.parameters,i=a.shape,j=.5*b,k=.5*c,l=2*Math.PI/d;for(let m=0;m<d;m++){let n=l*m,o=0+Math.sin(n)*j,p=0+Math.cos(n)*k;i.addPoint(i.createPoint(o,p))}i.isClosed=!0;for(let q=0,r=i.points.length;q<r;q++)i.points[q].roundness=e;return i.roundness=e,i.update(),Object.assign(h5.create({shape:i,parameters:{roundness:e,depth:f,extrudeBevelSize:g,extrudeBevelSegments:h}}),{userData:{...a,type:"PolygonGeometry"}})}},iF=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b,height:c,depth:d,radialSegments:e,heightSegments:f,openEnded:g,cornerRadius:h,cornerSegments:i}=a.parameters,j=new iJ(.5*b,c,e,f,g,h,i);return j.scale(1,1,d/b),Object.assign(j,{userData:{...a,type:"PyramidGeometry"}})}};function iG(a,b,c){c.x=a.x*b.x,c.y=a.y,c.z=a.x*b.y}function iH(a,b,c,d,e,f){let g=b.clone().sub(a),h=c.clone().sub(a),i=g.angleTo(h);if(g.normalize(),h.normalize(),d===e){let j=g.add(h).normalize();f.copy(a).addScaledVector(j,d/Math.sin(i/2))}else{let k=g.angleTo(h);f.copy(a),f.addScaledVector(g,e/Math.sin(k)),f.addScaledVector(h,d/Math.sin(k))}}function iI(a,b,c){let d=a.clone().sub(b),e=c.clone().sub(b);return d.projectOnVector(e),d.add(b)}var iJ=class extends h.BufferGeometry{constructor(a=.5,b=1,c=4,d=1,e=!1,f=0,g=4){super(),c=Math.floor(Math.max(3,c)),d=Math.floor(d),g=Math.floor(g);let i=[],j=[],k=[],l=[],m=0,n=b/2,o=Math.PI/c,p=a*Math.cos(Math.PI/c),q=2*Math.PI/c,r=(c-2)*Math.PI/c,s=Math.PI-r,t=new h.Vector3(0,-n,0),u=new h.Vector3(0,n,0),v=new h.Vector2(a,-n),w=new h.Vector2(p,-n),x=new h.Vector2(0,u.y).sub(w),y=new h.Vector2(0,u.y).sub(v),z=new h.Vector2(x.y,-x.x).normalize(),A=new h.Vector2(y.y,-y.x).normalize(),B=a*Math.cos(Math.PI/c)*Math.tan((Math.PI-x.angle())/2)-1e-8;f=Math.min(f,B);let C;{let D=new h.Vector3(z.x,z.y,0),E=new h.Vector3(Math.cos(q)*D.x,D.y,Math.sin(q)*D.x);C=D.angleTo(E)}let F=f/Math.tan((Math.PI-x.angle())/2),G=f/Math.tan((Math.PI-C)/2),H=new h.Vector3;if(!e){j.push(t.x,t.y,t.z),k.push(0,-1,0),l.push(0,0);let I=m++,J=[],K=v.clone(),L=F/Math.cos(Math.PI/c);K.x-=L;for(let M=0;M<c;M++){let N=M/c*Math.PI*2+o,O=new h.Vector2(Math.sin(N),Math.cos(N));iG(K,O,H),j.push(H.x,H.y,H.z),k.push(0,-1,0),l.push(0,0),J.push(m++)}for(let P=0;P<J.length;P++)i.push(J[P],I,J[(P+1)%J.length])}let Q=[];{let R=new h.Vector3,S=new h.Vector3,T=new h.Vector3,U=new h.Vector3,V=new h.Vector3,W=new h.Vector3;for(let X=0;X<c;X++){let Y=X/c*Math.PI*2+o,Z=(X+.5)/c*Math.PI*2+o,$=(X+1)/c*Math.PI*2+o,_=new h.Vector2(Math.sin(Y),Math.cos(Y)),aa=new h.Vector2(Math.sin(Z),Math.cos(Z)),ab=new h.Vector2(Math.sin($),Math.cos($));iG(v,_,S),iG(v,ab,T),iG(z,aa,R),iH(u,S,T,G,G,U),j.push(U.x,U.y,U.z),iH(S,u,T,G,F,V),j.push(V.x,V.y,V.z),iH(T,S,u,F,G,W),j.push(W.x,W.y,W.z),k.push(R.x,R.y,R.z),k.push(R.x,R.y,R.z),k.push(R.x,R.y,R.z),l.push(0,0),l.push(0,0),l.push(0,0);let ac=m++,ad=m++,ae=m++;if(i.push(ac,ad,ae),f>0){{let af=S.clone().add(T).multiplyScalar(.5),ag=u.clone().sub(af).normalize(),ah=t.clone().sub(af).normalize().add(ag).normalize().multiplyScalar(-1),ai=W.clone().sub(V);aM(af,ai,ah,x.angle())}let aj,ak;{let al=new h.Vector3;iG(A,ab,al);let am=W.clone().add(U).multiplyScalar(.5);am=iI(am,T,u);let an=W.clone().sub(U);[aj,ak]=aM(am,an,al,C,U.y)}{let ao=aj,ap=ao.clone().setY(0).normalize(),aq=new h.Vector3(0,-1,0),ar=ap.clone().cross(aq);aN(ao,ap,aq,ar)}Q.concat(ak);{let as=x.angle(),at=Math.PI-as,au=u.clone();au.y-=f/Math.sin(as-Math.PI/2);let av=new h.Vector3,aw=[];for(let ax=0;ax<g;ax++){let ay=[],az=Math.PI/2-at*ax/g,aA=Math.cos(az),aB=Math.sin(az),aC=Z;for(let aD=0;aD<=ax;aD++){let aE=Math.cos(aC),aF=Math.sin(aC);R.x=aA*aF,R.y=aB,R.z=aA*aE,av.copy(au).addScaledVector(R,f),j.push(av.x,av.y,av.z),k.push(R.x,R.y,R.z),l.push(0,0),ay.push(m++),aC+=2*Math.PI/ax/c}aw.push(ay)}ak.reverse(),aw.push(ak);let aG=aw.length-1;for(let aH=0;aH<aG;aH++){let aI=aw[aH],aJ=aw[aH+1],aK=aI.length-1;i.push(aJ[1],aI[0],aJ[0]);for(let aL=1;aL<=aK;aL++)i.push(aI[aL],aI[aL-1],aJ[aL]),i.push(aJ[aL+1],aI[aL],aJ[aL])}}}}}function aM(a,b,c,d,e){let n=-d/2,o=b.clone().normalize().cross(c);a.addScaledVector(c,-f/Math.sin((Math.PI-d)/2));let p=new h.Vector3,q=new h.Vector3,r=m,s=[];for(let t=0;t<=g;t++){let u=n+t/g*d;q.set(0,0,0),q.addScaledVector(o,Math.sin(u)),q.addScaledVector(c,Math.cos(u));for(let v=0;v<=1;v++){let w=v/1-.5;if(p.copy(a),p.addScaledVector(b,w),p.addScaledVector(q,f),null!=e){let x=Math.max(0,p.y-e);p.addScaledVector(b,-x/b.y)}j.push(p.x,p.y,p.z),k.push(q.x,q.y,q.z),l.push(0,0),0===v&&s.push(m),m++}}for(let y=0;y<g;y++)for(let z=0;z<1;z++){let A=r+z+2*y,B=A+2,C=B+1,D=A+1;i.push(A,B,D),i.push(B,C,D)}return[a.clone().addScaledVector(b,.5),s]}function aN(a,b,c,d){let e=Math.PI/2,n=y.angle()-e,o=[],p=new h.Vector3,q=new h.Vector3;for(let r=0;r<=g;r++){let t=[],u=r/g;for(let v=0;v<=r;v++){let w=((r?v/r:0)-.5)*s,x=Math.cos(w),z=Math.sin(w),A=Math.atan(Math.tan(n)*x),B=(e+A)*u,C=Math.cos(B),D=Math.sin(B);p.set(0,0,0),p.addScaledVector(b,D*x),p.addScaledVector(c,C),p.addScaledVector(d,D*z),q.copy(a).addScaledVector(p,f),j.push(q.x,q.y,q.z),k.push(p.x,p.y,p.z),l.push(0,0),t.push(m++)}o.push(t)}let E=o.length-1;for(let F=0;F<E;F++){let G=o[F],H=o[F+1],I=G.length-1;i.push(G[0],H[1],H[0]);for(let J=1;J<=I;J++)i.push(G[J-1],G[J],H[J]),i.push(G[J],H[J+1],H[J])}}this.setIndex(i),this.setAttribute("position",new h.Float32BufferAttribute(j,3)),this.setAttribute("normal",new h.Float32BufferAttribute(k,3)),this.setAttribute("uv",new h.Float32BufferAttribute(l,2))}},iK=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},a.parameters),d=Object.assign(b?.ui??{enabledIndieCorners:!1},a.ui);return{shape:a.shape&&a.shape instanceof hI?a.shape:new hI,parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??0)}),ui:d}}static build(a){let b=a.shape,{width:c,height:d,cornerRadius:e,cornerType:f,depth:g,extrudeBevelSize:h,extrudeBevelSegments:i}=a.parameters,j={x:.5*c,y:.5*d},k={x:-j.x,y:-j.y},l={x:j.x,y:j.y};function m(a,b,e){return b>c&&e>d?Math.min(a*c/b,a*d/e):b>c?a*c/b:e>d?a*d/e:a}let n=[];n[0]=0===e[0]?0:m(e[0],e[0]+e[3],e[0]+e[1]),n[1]=0===e[1]?0:m(e[1],e[1]+e[2],e[1]+e[0]),n[2]=0===e[2]?0:m(e[2],e[2]+e[1],e[2]+e[3]),n[3]=0===e[3]?0:m(e[3],e[3]+e[0],e[3]+e[2]);let o=k.x,p=l.x,q=l.y,r=k.y;b.addPoint(b.createPoint(o,q)),b.addPoint(b.createPoint(p,q)),b.addPoint(b.createPoint(p,r)),b.addPoint(b.createPoint(o,r)),b.isClosed=!0;let s=!0;for(let t=0,u=b.points.length;t<u;t++)b.points[t].roundness=n[t],t>0&&n[t]!==n[t-1]&&(s=!1);return s&&(b.roundness=n[0]),b.useCubicForRoundedCorners=1!==f,b.update(),Object.assign(h5.create({shape:b,parameters:{depth:g,extrudeBevelSize:h,extrudeBevelSegments:i}}),{userData:{...a,type:"RectangleGeometry"}})}},iL=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b=100,height:c=b,depth:d=b,widthSegments:e=64,heightSegments:f=64,phiStart:g,phiLength:i,thetaStart:j,thetaLength:k}=a.parameters,l=new h.SphereBufferGeometry(.5*b,e,f,g,i,j,k);return l.scale(1,c/b,d/b),Object.assign(l,{userData:{...a,type:"SphereGeometry"}})}},iM=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:0})}}static build(a){let{width:b=100,height:c=b,widthSegments:d=8,heightSegments:e=8}=a.parameters,f=new h.PlaneBufferGeometry(b,c,d,e);return f.scale(1,1,1),Object.assign(f,{userData:{...a,type:"PlaneGeometry"}})}},iN=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width)})}}static build(a){let{width:b,height:c,depth:d,angle:e,cornerRadius:f,cornerSegments:g}=a.parameters;return Object.assign(new iO(b,c,d,e,f,g),{userData:{...a,type:"BackdropGeometry"}})}},iO=class extends h.BufferGeometry{constructor(a=1,b=1,c=1,d=90,e=10,f=24){super(),this.type="BackdropGeometry";let g=[],i=[],j=[];0==e&&(f=1),f=Math.max(1,Math.floor(f)),e=Math.min(e,100),d=Math.min(179.999,d),d*=Math.PI/180;let k=[],l=Math.PI/2,m=(a=0,b=0,c=0)=>new h.Vector3(a,b,c),n=m(),o=m(),[p,q,r]=[b/2,a/2,c/2],s=-q,t=+q,[u,v,w]=[m(s,-p,+r),m(s,-p,-r),m(s,+p,-r)],x=(a,b=!1)=>Math.sin(a-Math.PI/(1+ +b)),y=(a,b=!1)=>Math.cos(a-Math.PI/(1+ +b));w.y=Math.sin(d)*b-p;let z=Math.cos(d)*b-r,A=u.z-.001;d<=l?(w.z=Math.min(z,A),w.z==A&&(w.y-=(z-A)/Math.tan(l-d))):v.z=Math.min(v.z-z-r,u.z-.001),n.subVectors(u,v),o.subVectors(w,v);let B=Math.min(n.length(),o.length())*e/100,C=B*Math.tan(d/2),D=B/Math.cos(d/2),E=n.clone().normalize().add(o.normalize()).setLength(D).add(v);n.set(0,x(d,!0),y(d,!0)),k.push([w,n.clone()]);let F=(Math.PI-d)/f;for(let G=0;G<=f;G++){let H=l+d+G*F;n.set(0,Math.sin(H)*C,Math.cos(H)*C),n.add(E),o.set(0,x(H),y(H)),k.push([n.clone(),o.clone()])}k.push([u,m(0,1,0)]);let I=Math.sin(F/2)*C*2,J=k.length-1,K=k[0][0].distanceTo(k[1][0]),L=K+I*f+k[J-1][0].distanceTo(k[J][0]);k[0].push(1);for(let M=0;M<=f;M++)k[M+1].push(1-(K+M*I)/L);k[J].push(0);let[N,O,P]=k[0],Q,R,S;for(let T=1;T<k.length;T++)[Q,R,S]=k[T],g.push(s,N.y,N.z,s,Q.y,Q.z,t,N.y,N.z,t,N.y,N.z,s,Q.y,Q.z,t,Q.y,Q.z),i.push(0,O.y,O.z,0,R.y,R.z,0,O.y,O.z,0,O.y,O.z,0,R.y,R.z,0,R.y,R.z),j.push(0,P,0,S,1,P,1,P,0,S,1,S),[N,O,P]=[Q,R,S];this.setAttribute("position",new h.Float32BufferAttribute(g,3)),this.setAttribute("normal",new h.Float32BufferAttribute(i,3)),this.setAttribute("uv",new h.Float32BufferAttribute(j,2))}},iP=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},a.parameters);return{shape:a.shape&&a.shape instanceof hI?a.shape:new hI,parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??0)})}}static build(a){let{width:b,height:c,innerRadiusPercent:d,spikes:e,cornerRadius:f,angle:g,depth:h,extrudeBevelSize:i,extrudeBevelSegments:j}=a.parameters,k=a.shape,l=.5*b,m=.5*c,n=0,o=0,p=g*Math.PI/360/e,q=-(Math.PI/2*3),r=l*d/100,s=m*d/100;if(3===e&&50===d){p=2*Math.PI/e;for(let t=0;t<e;t++){let u=p*t,v=n+Math.sin(u)*l,w=o+Math.cos(u)*m;k.addPoint(k.createPoint(v,w))}}else for(let x=0;x<e;x++){let y=n+Math.cos(q)*l,z=o+Math.sin(q)*m;k.addPoint(k.createPoint(y,z)),q+=p,y=n+Math.cos(q)*r,z=o+Math.sin(q)*s,k.addPoint(k.createPoint(y,z)),q+=p}k.isClosed=!0;for(let A=0,B=k.points.length;A<B;A++)k.points[A].roundness=f;return k.roundness=f,k.update(),Object.assign(h5.create({shape:k,parameters:{roundness:f,depth:h,extrudeBevelSize:i,extrudeBevelSegments:j}}),{userData:{...a,type:"StarGeometry"}})}},iQ=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??0)})}}static build(a){let{width:b,height:c}=a.parameters;return Object.assign(new h.PlaneBufferGeometry(b,c),{userData:{...a,type:"TextFrameGeometry"}})}},iR=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:2*Math.PI,cornerRadius:30,cornerSegments:8},a.parameters),d=Math.abs(c.width),e=Math.abs(c.height??c.width),f=Math.abs(c.depth??.25*c.width);return{parameters:Object.assign(c,{width:d,height:e,depth:f})}}static build(a){let{width:b,height:c,depth:d,radialSegments:e,tubularSegments:f,arc:g,cornerRadius:h,cornerSegments:i}=a.parameters,j=iS(b,c,d,.5*b,g,f,0,0,e,h,i);return j.scale(1,c/b,1),Object.assign(j,{userData:{...a,type:"TorusGeometry"}})}};function iS(a,b,c,d,e,f,g,h,i,j,k){return[b,c]=[c,b],g=b/2,1==(e/=2*Math.PI)&&(j=0),new ij(!0,a,b,c,d,e,f,g,h,i,j,k)}var iT,iU,iV,iW,iX,iY,iZ,i$,i_,i0,i1,i2,i3,i4,i5,i6,i7,i8,i9,ja,jb,jc,jd,je=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},a.parameters);return{parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width),depth:Math.abs(c.depth??c.width),tube:c.tube??.125*c.width})}}static build(a){let{width:b,tube:c,tubularSegments:d,radialSegments:e,p:f,q:g}=a.parameters,i=.5*b;return i!==c&&(i-=c),Object.assign(new h.TorusKnotBufferGeometry(i,c,d,e,f,g),{userData:{...a,type:"TorusKnotGeometry"}})}},jf=class{static create(a){return this.build(this.normalizeInputs(a))}static normalizeInputs(a,b){let c=Object.assign({},b?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},a.parameters);return{shape:a.shape&&a.shape instanceof hI?a.shape:new hI,parameters:Object.assign(c,{width:Math.abs(c.width),height:Math.abs(c.height??c.width*(c.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(c.depth??0)})}}static build(a){let{width:b=100,height:c,cornerRadius:d,depth:e,extrudeBevelSize:f,extrudeBevelSegments:g,isRect:h}=a.parameters,i=a.shape,j=.5*b,k=.5*c;h?(i.addPoint(i.createPoint(-j,k)),i.addPoint(i.createPoint(j,-k)),i.addPoint(i.createPoint(-j,-k))):(i.addPoint(i.createPoint(0,k)),i.addPoint(i.createPoint(j,-k)),i.addPoint(i.createPoint(-j,-k))),i.isClosed=!0;for(let l=0,m=i.points.length;l<m;l++)i.points[l].roundness=d;return i.roundness=d,i.update(),Object.assign(h5.create({shape:i,parameters:{roundness:d,depth:e,extrudeBevelSize:f,extrudeBevelSegments:g}}),{userData:{...a,type:"TriangleGeometry"}})}},jg=new Promise(a=>{jd=a});function jh(a,b){return b.color(a)}var ji=a=>"isEntity"in a,jj=a=>"isAbstractMesh"in a,jk=a=>null!==a&&"BooleanObject"===a.objectType,jl=a=>"CombinedCamera"===a.objectType,jm=a=>"objectHelper"in a,jn=a=>class extends a{hasEntityChild(){return this.children.some(a=>ji(a))}isDescendantOf(a){a instanceof h.Object3D&&(a=a.uuid);let b=this;for(;b.parent;){if(b.parent.uuid===a)return!0;b=b.parent}return!1}attach(a,b){this.updateWorldMatrix(!0,!1);let c=new h.Matrix4().copy(this.matrixWorld).invert();return null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),c.multiply(a.parent.matrixWorld)),ji(a)?a.hiddenMatrix.premultiply(c):a.applyMatrix4(c),a.updateWorldMatrix(!1,!1),this.add(a),void 0!==b&&(this.children.pop(),this.children.splice(b,0,a)),this}copy(a,b=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.userData=JSON.parse(JSON.stringify(a.userData)),!0===b)for(let c=0;c<a.children.length;c++){let d=a.children[c];this.add(d.clone())}return this}},jo=new h.Box3,jp=new h.Vector3,jq=new h.Vector3,jr=new h.Matrix4,js=[new h.Vector3(-1,1,1),new h.Vector3(-1,-1,1),new h.Vector3(1,-1,1),new h.Vector3(1,1,1),new h.Vector3(-1,1,-1),new h.Vector3(-1,-1,-1),new h.Vector3(1,-1,-1),new h.Vector3(1,1,-1)],jt=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],ju=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],jv=(a,b,c)=>{if(jj(a)){let d=a.geometry.userData.parameters,e=a.geometry.getAttribute("position");"SubdivGeometry"===a.geometry.userData.type?jp.copy(a.originalGeometry.boundingSphere.center):void 0!==e&&(function(a,b,c=0,d=b.count){let e=1/0,f=1/0,g=1/0,h=-1/0,i=-1/0,j=-1/0;for(let k=c;k<d;k++){let l=b.getX(k),m=b.getY(k),n=b.getZ(k);l<e&&(e=l),m<f&&(f=m),n<g&&(g=n),l>h&&(h=l),m>i&&(i=m),n>j&&(j=n)}a.min.set(e,f,g),a.max.set(h,i,j)}(jo,e,a.geometry.drawRange.start,a.geometry.drawRange.count<1/0?a.geometry.drawRange.count:e.count),jo.getCenter(jp)),a.forceComputeSize?jo.getSize(jq).multiplyScalar(.5):jq.set(d.width,d.height,d.depth??0).multiplyScalar(.5)}else if(jm(a)&&a.objectHelper.visible){let f=a.geometryHelper.getAttribute("position");jo.setFromArray(f.array),jo.getCenter(jp),jo.getSize(jq).multiplyScalar(.5)}else jp.setScalar(0),jq.setScalar(0);jr.copy(b).multiply(a.matrixWorld),0===jq.x&&0===jq.y&&0===jq.z?c.push(new h.Vector3(jp.x,jp.y,jp.z).applyMatrix4(jr)):js.forEach(a=>{c.push(a.clone().multiply(jq).add(jp).applyMatrix4(jr))})},jw=class extends h.Box3{constructor(){super(...arguments),this.matrix=new h.Matrix4,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(a){return super.copy(a),this.matrix.copy(a.matrix),this.vertices=a.vertices.map(a=>a.clone()),this.faces=a.faces.map(a=>a.clone()),this.edges=a.edges.map(a=>a.clone()),this.centerEdges=a.centerEdges.map(a=>a.clone()),this}setFromObjectSize(a,b=!1){a.updateWorldMatrix(!1,b),this.makeEmpty(),this.matrix.copy(a.matrixWorld);let c=new h.Matrix4().copy(a.matrixWorld).invert();return this.expandByObjectSize(a,c,b)}expandByObjectSize(a,b,c=!1){let d=[];return!0===c?a.traverseEntity(a=>{a.visible&&jv(a,b,d)}):jv(a,b,d),this.setFromPoints(d)}getCenter(a){return(a=super.getCenter(a)).applyMatrix4(this.matrix),a}getPositionToCenter(a){return(a=super.getCenter(a)).applyMatrix4(jr.copy(this.matrix).setPosition(0,0,0)),a}computeVertices(){this.getSize(jq).multiplyScalar(.5),this.getCenter(jp),jr.copy(this.matrix).setPosition(jp),this.vertices=js.map(a=>a.clone().multiply(jq).applyMatrix4(jr))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=jt.map(([a,b])=>new h.Line3(this.vertices[a],this.vertices[b])),this.centerEdges=this.edges.map(a=>a.getCenter(new h.Vector3))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=ju.map(([a,b])=>this.vertices[a].clone().add(this.vertices[b]).multiplyScalar(.5))}},jx=a=>"isEntity"in a,jy=a=>"isAbstractMesh"in a,jz=a=>class extends jn(a){constructor(){super(...arguments),this.objectType="",this.isEntity=!0,this.raycastLock=!1,this.scaleLock=!1,this.hiddenMatrix=new h.Matrix4,this._singleBBox=new jw,this._recursiveBBox=new jw,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.forceComputeSize=!1}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}resetBBoxNeedsUpdate(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.traverseAncestors(a=>{jx(a)&&(a.singleBBoxNeedsUpdate=!0,a.recursiveBBoxNeedsUpdate=!0)}),this.traverseEntity(a=>{a.singleBBoxNeedsUpdate=!0,a.recursiveBBoxNeedsUpdate=!0})}traverseEntity(a){for(let b of(a(this),this.children))jx(b)&&b.traverseEntity(a)}traverseVisibleEntity(a){for(let b of(a(this),this.children))jx(b)&&b.visible&&b.traverseVisibleEntity(a)}updateMatrixWorld(a){for(let b of(this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,a=!0),this.children))b.updateMatrixWorld(a)}updateWorldMatrix(a,b){let c=this.parent;if(a&&null!==c&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),b)for(let d of this.children)d.updateWorldMatrix(!1,!0)}clone(a){return new this.constructor().copy(this,a)}copy(a,b=!0){if(super.copy(a,!1),this.raycastLock=a.raycastLock,this.scaleLock=a.scaleLock,this.hiddenMatrix.copy(a.hiddenMatrix),!0===b)for(let c of a.children)jx(c)&&this.add(c.clone());return this}keepChildrenMatrixWorld(){let a=new h.Matrix4,b=this.matrixWorld.clone();for(let c of(this.updateWorldMatrix(!1,!1),a.copy(this.matrixWorld).invert(),a.multiply(b),this.children))jx(c)&&c.hiddenMatrix.premultiply(a)}toObjectTransformState(a=[]){return this.updateWorldMatrix(!0,!1),em({position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()},a)}fromObjectTransformState(a){return a.position&&this.position.fromArray(a.position),a.rotation&&this.rotation.fromArray(a.rotation),a.scale&&this.scale.fromArray(a.scale),a.hiddenMatrix&&this.hiddenMatrix.fromArray(a.hiddenMatrix),this.updateMatrix(),this}toState(a=[]){return em({name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(a)},a)}fromState(a,b){return a.name&&(this.name=a.name),void 0!==a.raycastLock&&(this.raycastLock=a.raycastLock),"OrthographicCamera"!==a.type&&"PerspectiveCamera"!==a.type&&(this.matrixAutoUpdate=!1),void 0!==a.visible&&(this.visible=a.visible),this.fromObjectTransformState(a),this}},jA=class extends h.Object3D{},jB=class extends jA{constructor(a){super(),this.object=a,this.matrixAutoUpdate=!0}get castShadow(){return this.object.castShadow}set castShadow(a){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(a){}get isMesh(){return!0}get isLight(){return!1}get layers(){return this.object.layers}set layers(a){}get isCamera(){return!1}get geometry(){return this.object.geometry}get material(){return this.object.material}},jC=class extends h.Object3D{constructor(a,b={}){super(),this.object=a;let c=a.recursiveBBox.getSize(new h.Vector3);this.parameters=e3.defaultData(c.toArray(),.1),eg(this.parameters,b),this.update(),this.setHideBase(this.parameters.hideBase)}setHideBase(a){this.parameters.hideBase=a}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters)}this.children.forEach(a=>a.updateMatrix())}_updateCount(){let a="grid"===this.parameters.type?this.parameters.grid.count[0]*this.parameters.grid.count[1]*this.parameters.grid.count[2]:this.parameters.count;if(this.children.length!==a){if(this.children.length<a)for(let b=0,c=a-this.children.length;b<c;++b){let d=new jB(this.object);d.visible=!0,this.add(d),this.parameters.hideBase&&this.setHideBase(!0)}else for(let e=0,f=this.children.length-a;e<f;++e)this.remove(this.children[0])}}_updateRadial(a){let b=a.radial,c=b.start*h.MathUtils.DEG2RAD,d=c-b.end*h.MathUtils.DEG2RAD,e=new h.Euler(b.rotation[0]*h.MathUtils.DEG2RAD,b.rotation[1]*h.MathUtils.DEG2RAD,b.rotation[2]*h.MathUtils.DEG2RAD),f;switch(b.axis){case"z":f=new h.Vector3(0,0,1);break;case"y":f=new h.Vector3(0,1,0);break;default:f=new h.Vector3(1,0,0)}for(let[g,i]of this.children.entries()){i.scale.x=b.scale[0],i.scale.y=b.scale[1],i.scale.z=b.scale[2],i.position.setScalar(0);let j=d/a.count*g-c;switch(b.axis){case"x":i.rotation.set(0,j,0);break;case"y":i.rotation.set(0,0,j);break;case"z":i.rotation.set(j,0,0)}i.translateOnAxis(f,b.radius),i.position.x+=b.position[0],i.position.y+=b.position[1],i.position.z+=b.position[2],!0===b.alignment?(i.rotation.x+=e.x,i.rotation.y+=e.y,i.rotation.z+=e.z):i.rotation.copy(e)}}_updateLinear(a){if("linear"!==a.type)throw Error();let b=a.linear,c=new h.Euler(b.rotation[0]*h.MathUtils.DEG2RAD,b.rotation[1]*h.MathUtils.DEG2RAD,b.rotation[2]*h.MathUtils.DEG2RAD);for(let[d,e]of this.children.entries())e.scale.x=1+(b.scale[0]-1)*d,e.scale.y=1+(b.scale[1]-1)*d,e.scale.z=1+(b.scale[2]-1)*d,e.rotation.x=c.x*d,e.rotation.y=c.y*d,e.rotation.z=c.z*d,e.position.x=b.position[0]*d,e.position.y=b.position[1]*d,e.position.z=b.position[2]*d}_updateGrid(a){let b=0,c=a.grid;if(!0===c.useCenter){let d={x:c.count[0]%2==0?2:1,y:c.count[1]%2==0?2:1,z:c.count[2]%2==0?2:1},e=new h.Vector3(c.size[0]*(c.count[0]-d.x)*.5,c.size[1]*(c.count[1]-d.y)*.5,c.size[2]*(c.count[2]-d.z)*.5);for(let f=0;f<c.count[0];f++)for(let g=0;g<c.count[1];g++)for(let i=0;i<c.count[2];i++){let j=this.children[b++];j.scale.setScalar(1),j.rotation.set(0,0,0),j.position.x=c.size[0]*f-e.x,j.position.y=c.size[1]*g-e.y,j.position.z=c.size[2]*i-e.z}}else for(let k=0;k<c.count[0];k++)for(let l=0;l<c.count[1];l++)for(let m=0;m<c.count[2];m++){let n=this.children[b++];n.scale.setScalar(1),n.rotation.set(0,0,0),n.position.x=c.size[0]*k,n.position.y=-c.size[1]*l,n.position.z=-c.size[2]*m}}fromClonerState(a){return void 0!==a.hideBase&&this.setHideBase(a.hideBase),eg(this.parameters,a),this.update(),this}},jD=class{constructor(a){a=a??{},this.name=a.name,this.type=a.type,this.node=a.node,this.size=a.size,this.needsUpdate=a.needsUpdate}get value(){return this.node.value}set value(a){this.node.value=a}},jE=class{constructor(a){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=h.MathUtils.generateUUID(),this.type=a,this.name=""}analyze(a,b){b=b??{},a.analyzing=!0,this.build(a.addFlow(b.slot,b.cache,b.context),"v4"),a.clearVertexNodeCode(),a.clearFragmentNodeCode(),a.removeFlow(),a.analyzing=!1}analyzeAndFlow(a,b,c){return c=c??{},this.analyze(a,c),this.flow(a,b,c)}flow(a,b,c){c=c??{},a.addFlow(c.slot,c.cache,c.context);let d={result:this.build(a,b),code:a.clearNodeCode(),extra:a.context.extra};return a.removeFlow(),d}build(a,b,c){b=b??this.getType(a,b);let d=a.getNodeData(c??this);return a.analyzing&&this.appendDepsNode(a,d,b),-1===a.nodes.indexOf(this)&&a.nodes.push(this),void 0!==this.updateFrame&& -1===a.updaters.indexOf(this)&&a.updaters.push(this),this.generate(a,b,c)}updateFrame(a){}generateReadonly(a,b,c,d,e,f){return""}generate(a,b,c,d,e){return""}parse(a,b,c,d){}appendDepsNode(a,b,c){b.deps=(b.deps||0)+1;let d=a.getTypeLength(c);(d>(b.outputMax||0)||this.getType(a,c))&&(b.outputMax=d,b.output=c)}setName(a){this.name=a}getName(){return this.name}getType(a,b){return"sampler2D"===b||"samplerCube"===b?b:this.type}getHash(){let a="{",b,c;for(b in this)(c=this[b])instanceof jE&&(a+='"'+b+'":'+c.getHash()+",");if(this.hashProperties)for(let d=0;d<this.hashProperties.length;d++)c=this[b=this.hashProperties[d]],a+='"'+b+'":"'+String(c)+'",';return a+('"id":"'+this.uuid)+'"}'}},jF=new class{constructor(){this.nodes={},this.keywords={}}add(a){this.nodes[a.name]=a}addKeyword(a,b,c){c=void 0===c||c,this.keywords[a]={callback:b,cache:c}}remove(a){delete this.nodes[a.name]}removeKeyword(a){delete this.keywords[a]}get(a){return this.nodes[a]}getKeyword(a,b){return this.keywords[a].callback(b)}getKeywordData(a){return this.keywords[a]}contains(a){return void 0!==this.nodes[a]}containsKeyword(a){return void 0!==this.keywords[a]}},jG=class extends jE{constructor(a,b){super(a),this.scope="",b=b??{},this.shared=void 0===b.shared||b.shared,this.unique=void 0!==b.unique&&b.unique}build(a,b,c,d){if(b=b??this.getType(a),this.getShared(a,b)){let e=this.getUnique(a,b);e&& void 0===this.uuid&&(this.uuid=h.MathUtils.generateUUID()),c=a.getUUID(c??this.getUUID(),!e);let f=a.getNodeData(c),g=f.output||this.getType(a);if(a.analyzing)return(f.deps||0)>0||this.getLabel()?(this.appendDepsNode(a,f,b),this.generate(a,b,c)):super.build(a,b,c);if(e)return f.name=f.name||super.build(a,b,c),f.name;if(!this.getLabel()&&(!this.getShared(a,g)||a.context.ignoreCache||1===f.deps))return super.build(a,b,c);c=this.getUUID(!1);let i=this.getTemp(a,c);if(i)return a.format(i,g,b);{i=super.generate(a,b,c,f.output,d);let j=this.generate(a,g,c);return a.addNodeCode(i+" = "+j+";"),a.format(i,g,b)}}return super.build(a,b,c)}getShared(a,b){return"sampler2D"!==b&&"samplerCube"!==b&&this.shared}getUnique(a,b){return this.unique}setLabel(a){return this.label=a,this}getLabel(){return this.label}getUUID(a){let b=this.uuid;return"string"==typeof this.scope&&(b=this.scope+"-"+b),b}getTemp(a,b){b=b||this.uuid;let c=a.getVars()[b];return c?c.name:void 0}generate(a,b,c,d,e){return this.getShared(a,b)||console.error("TempNode is not shared"),c=c??this.uuid,a.getTempVar(c,d??this.getType(a),e,this.getLabel()).name}},jH=class extends jG{constructor(a,b){(b=b??{}).shared=void 0!==b.shared&&b.shared,super(a,b),this.readonly=!1}setReadonly(a){return this.readonly=a,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(a,b,c,d,e,f){c=a.getUUID(c??this.getUUID()),d=d??this.getType(a);let g=a.getNodeData(c);return this.getReadonly()&& void 0!==this.generateReadonly?this.generateReadonly(a,b,c,d,e,f):a.isShader("vertex")?(g.vertex||(g.vertex=a.createVertexUniform(d,this,e,f,this.getLabel())),a.format(g.vertex.name,d,b)):(g.fragment||(g.fragment=a.createFragmentUniform(d,this,e,f,this.getLabel())),a.format(g.fragment.name,d,b))}},jI=class extends jH{constructor(a=0,b){super("v2"),this.nodeType="Vector2",this.value=a instanceof h.Vector2?a:new h.Vector2(a,b)}get x(){return this.value.x}set x(a){this.value.x=a}get y(){return this.value.y}set y(a){this.value.y=a}generateReadonly(a,b,c,d,e,f){return a.format("vec2("+this.value.x+", "+this.value.y+")",d,b)}},jJ=class extends jH{constructor(a=0,b,c){super("v3"),this.nodeType="Vector3",this.value=a instanceof h.Vector3?a:new h.Vector3(a,b,c)}get x(){return this.value.x}set x(a){this.value.x=a}get y(){return this.value.y}set y(a){this.value.y=a}get z(){return this.value.z}set z(a){this.value.z=a}generateReadonly(a,b,c,d,e,f){return a.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",d,b)}},jK=class extends jH{constructor(a){super("v4"),this.nodeType="Vector4",this.value=a instanceof g_?a:new g_(a.r,a.g,a.b,a.a)}generateReadonly(a,b,c,d,e,f){return a.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",d,b)}},jL=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,jM=/[a-z_0-9]+/gi,jN=class extends jG{constructor(a,b,c,d,e){super(e),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===e,this.isInterface=!1,this.parse(a,b,c,d)}getShared(a,b){return!this.isMethod}getType(a){return a.getTypeByFormat(this.type)}getInputByName(a){if(this.inputs){let b=this.inputs.length;for(;b--;)if(this.inputs[b].name===a)return this.inputs[b]}}getIncludeByName(a){if(this.includes){let b=this.includes.length;for(;b--;)if(this.includes[b].name===a)return this.includes[b]}}generate(a,b,c,d,e){let f,g=0,h=this.src;if(this.includes)for(let i=0;i<this.includes.length;i++)a.include(this.includes[i],this);for(let j in this.extensions)a.extensions[j]=!0;let k=[];for(;f=jM.exec(this.src);)k.push(f);for(let l=0;l<k.length;l++){let m=k[l],n=m[0],o=!this.isMethod||!this.getInputByName(n),p=n;if(this.keywords[n]||this.useKeywords&&o&&jF.containsKeyword(n)){let q=this.keywords[n];if(!q){let r=jF.getKeywordData(n);r.cache&&(q=a.keywords[n]),q=q||jF.getKeyword(n,a),r.cache&&(a.keywords[n]=q)}p=q.build(a)}n!==p&&"."!==h[m.index+g-1]&&(h=h.substring(0,m.index+g)+p+h.substring(m.index+n.length+g),g+=p.length-n.length),void 0===this.getIncludeByName(p)&&jF.contains(p)&&a.include(jF.get(p))}return"source"===b?h:this.isMethod?(this.isInterface||a.include(this,void 0,h),this.name):a.format("( "+h+" )",this.getType(a),b)}parse(a,b,c,d){if(this.src=a||"",this.includes=b??[],this.extensions=c??{},this.keywords=d??{},this.isMethod){let e=jL.exec(this.src);if(this.inputs=[],e&&4==e.length){this.type=e[1],this.name=e[2];let f=e[3].match(jM);if(f){let g=0;for(;g<f.length;){let h=f[g++],i;"in"===h||"out"===h||"inout"===h?i=f[g++]:(i=h,h="");let j=f[g++];this.inputs.push({name:j,type:i,qualifier:h})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},jO=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,jP=class extends jG{constructor(a="",b){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(a||jP.PI,void 0,void 0,void 0,b)}getType(a){return a.getTypeByFormat(this.type)}parse(a,b,c,d,e){this.src=a||"";let f,g,h="",i=jO.exec(a);this.useDefine=e??"#"===this.src.charAt(0),i&&i.length>1?(g=i[1],f=i[2],h=i[3]):(f=this.src,g="f"),this.name=f,this.type=g,this.value=h}build(a,b){if("source"===b){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return a.include(this),a.format(this.name,this.getType(a),b)}generate(a,b,c,d,e){return a.format(this.name,this.getType(a),b)}},jQ=jP;jQ.PI="PI",jQ.PI2="PI2",jQ.RECIPROCAL_PI="RECIPROCAL_PI",jQ.RECIPROCAL_PI2="RECIPROCAL_PI2",jQ.LOG2="LOG2",jQ.EPSILON="EPSILON";var jR=RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),jS=RegExp("s*(w*?)s*(w*?)(=|;)","gim"),jT=class extends jG{constructor(a=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(a)}getType(a){return a.getTypeByFormat(this.name)}getInputByName(a){let b=this.inputs.length;for(;b--;)if(this.inputs[b].name===a)return this.inputs[b]}generate(a,b,c,d,e){return"source"===b?this.src+";":a.format("( "+this.src+" )",this.getType(a),b)}parse(a=""){this.src=a,this.inputs=[];let b=jR.exec(a);if(b){let c=b[2],d;for(;d=jS.exec(c);)this.inputs.push({type:d[1],name:d[2]});this.name=b[1]}else this.name="";this.type=this.name}},jU=class extends jG{constructor(a){super("v2",{shared:!1}),this.nodeType="UV",this.index=a??0}generate(a,b){a.requires.uv[this.index]=!0;let c=this.index>0?this.index+1:"",d=a.isShader("vertex")?"uv"+c:"vUv"+c;return a.format(d,this.getType(a),b)}};jF.addKeyword("uv",function(){return new jU}),jF.addKeyword("uv2",function(){return new jU(1)});var jV=class extends jG{constructor(a,b){super("v4"),this.nodeType="ColorSpace",this.input=a,this.method=b??jV.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(a){switch(a){case h.LinearEncoding:return["Linear"];case h.sRGBEncoding:return["sRGB"];default:return[]}}generate(a,b){let c=this.input.build(a,"v4"),d=this.getType(a),e=jV.Nodes[this.method],f=a.include(e);if(f===jV.LINEAR_TO_LINEAR)return a.format(c,d,b);if(e.inputs?.length!==2)return a.format(f+"( "+c+" )",d,b);{let g=this.factor.build(a,"f");return a.format(f+"( "+c+", "+g+" )",d,b)}}fromEncoding(a){let b=jV.getEncodingComponents(a);this.method="LinearTo"+b[0],this.factor=b[1]}fromDecoding(a){let b=jV.getEncodingComponents(a);this.method=b[0]+"ToLinear",this.factor=b[1]}},jW=jV;jW.Nodes={LinearToLinear:new jN(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new jN(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new jN(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},jW.LINEAR_TO_LINEAR="LinearToLinear",jW.SRGB_TO_LINEAR="sRGBToLinear",jW.LINEAR_TO_SRGB="LinearTosRGB";var jX=class extends jN{constructor(a="",b,c,d,e){super(a,e,d,c,b),this.nodeType="Expression"}},jY=class extends jH{constructor(a=new h.Texture,b,c,d){super("v4",{shared:!0}),this.nodeType="Texture",this.value=a,this.uv=b??new jU,this.bias=c,this.project=void 0!==d&&d}getTexture(a,b){return super.generate(a,b,this.value.uuid,"t")}generate(a,b){if("sampler2D"===b)return this.getTexture(a,b);let c=this.getTexture(a,b),d=this.uv.build(a,this.project?"v4":"v2"),e=this.bias?this.bias.build(a,"f"):void 0;void 0===e&&a.context.bias&&(e=a.context.bias.setTexture(this).build(a,"f"));let f,g;f=this.project?"texture2DProj":e?"tex2DBias":"tex2D",g=e?f+"( "+c+", "+d+", "+e+" )":f+"( "+c+", "+d+" )";let h={include:a.isShader("vertex"),ignoreCache:!0},i=this.getType(a);return a.addContext(h),this.colorSpace=this.colorSpace??new jW(new jX("",i)),this.colorSpace.fromDecoding(a.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(g),g=this.colorSpace.build(a,i),a.removeContext(),a.format(g,i,b)}},jZ=class extends jH{constructor(a){super("f"),this.nodeType="Float",this.value=a??0}generateReadonly(a,b,c,d,e,f){return a.format(this.value+(this.value%1?"":".0"),d,b)}},j$=class extends jG{constructor(a,b){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=a,this.inputs=b??[]}getFunction(){return this.value}getType(a){return this.value.getType(a)}generate(a,b,c,d,e){d=this.getType(a);let f=this.value,g=f.build(a,b)+"( ",h=[];if(f.inputs){for(let i=0;i<f.inputs.length;i++){let j=f.inputs[i],k=this.inputs[i]||this.inputs[j.name];h.push(k.build(a,a.getTypeByFormat(j.type)))}g+=h.join(", ")+" )"}return a.format(g,d,b)}},j_=class extends jG{constructor(a,b,c=j_.ADD){super(),this.nodeType="Operator",this.type=a.type,this.a=a,this.b=b,this.op=c}getType(a){let b=this.a.getType(a),c=this.b.getType(a);return a.isTypeMatrix(b)?"v4":a.getTypeLength(c)>a.getTypeLength(b)?c:b}generate(a,b){let c=this.getType(a);this.type=c;let d=this.a.build(a,c),e=this.b.build(a,c);return a.format("( "+d+" "+this.op+" "+e+" )",c,b)}},j0=j_;j0.ADD="+",j0.SUB="-",j0.MUL="*",j0.DIV="/";var j1=class extends jG{constructor(a,b=j1.ABS,c,d){super(),this.nodeType="Math",this.a=a,"string"!=typeof b?this.b=b:d=b,"string"!=typeof c?this.c=c:d=c,this.method=d,this.hashProperties=["method"]}getNumInputs(a){switch(this.method){case j1.MIX:case j1.CLAMP:case j1.REFRACT:case j1.SMOOTHSTEP:case j1.FACEFORWARD:return 3;case j1.MIN:case j1.MAX:case j1.MOD:case j1.STEP:case j1.REFLECT:case j1.DISTANCE:case j1.DOT:case j1.CROSS:case j1.POW:return 2;default:return 1}}getInputType(a){let b=a.getTypeLength(this.a.getType(a)),c=this.b?a.getTypeLength(this.b.getType(a)):0,d=this.c?a.getTypeLength(this.c.getType(a)):0;return b>c&&b>d?this.a.getType(a):c>d?this.b.getType(a):this.c.getType(a)}getType(a){switch(this.method){case j1.LENGTH:case j1.DISTANCE:case j1.DOT:return"f";case j1.CROSS:return"v3"}return this.getInputType(a)}generate(a,b){let c,d,e,f=this.a?a.getTypeLength(this.a.getType(a)):0,g=this.b?a.getTypeLength(this.b.getType(a)):0,h=this.c?a.getTypeLength(this.c.getType(a)):0,i=this.getInputType(a),j=this.getType(a);switch(this.type=j,this.method){case j1.NEGATE:return a.format("( -"+this.a.build(a,i)+" )",i,b);case j1.INVERT:return a.format("( 1.0 - "+this.a.build(a,i)+" )",i,b);case j1.CROSS:c=this.a.build(a,"v3"),d=this.b.build(a,"v3");break;case j1.STEP:c=this.a.build(a,1===f?"f":i),d=this.b.build(a,i);break;case j1.MIN:case j1.MAX:case j1.MOD:c=this.a.build(a,i),d=this.b.build(a,1===g?"f":i);break;case j1.REFRACT:c=this.a.build(a,i),d=this.b.build(a,i),e=this.c.build(a,"f");break;case j1.MIX:c=this.a.build(a,i),d=this.b.build(a,i),e=this.c.build(a,1===h?"f":i);break;default:c=this.a.build(a,i),this.b&&(d=this.b.build(a,i)),this.c&&(e=this.c.build(a,i))}let k=[];k.push(c),d&&k.push(d),e&&k.push(e);let l=this.getNumInputs(a);if(k.length!==l)throw Error(`Arguments not match used in "${this.method}". Require ${l}, currently ${k.length}.`);return a.format(this.method+"( "+k.join(", ")+" )",j,b)}},j2=j1;j2.RAD="radians",j2.DEG="degrees",j2.EXP="exp",j2.EXP2="exp2",j2.LOG="log",j2.LOG2="log2",j2.SQRT="sqrt",j2.INV_SQRT="inversesqrt",j2.FLOOR="floor",j2.CEIL="ceil",j2.NORMALIZE="normalize",j2.FRACT="fract",j2.SATURATE="saturate",j2.SIN="sin",j2.COS="cos",j2.TAN="tan",j2.ASIN="asin",j2.ACOS="acos",j2.ARCTAN="atan",j2.ABS="abs",j2.SIGN="sign",j2.LENGTH="length",j2.NEGATE="negate",j2.INVERT="invert",j2.MIN="min",j2.MAX="max",j2.MOD="mod",j2.STEP="step",j2.REFLECT="reflect",j2.DISTANCE="distance",j2.DOT="dot",j2.CROSS="cross",j2.POW="pow",j2.MIX="mix",j2.CLAMP="clamp",j2.REFRACT="refract",j2.SMOOTHSTEP="smoothstep",j2.FACEFORWARD="faceforward";var j3=class extends jG{constructor(a,b,c){super("v4"),this.nodeType="TextureCubeUV",this.value=a,this.uv=b,this.bias=c}bilinearCubeUV(a,b,c,d){let e=new j$(j3.Nodes.bilinearCubeUV,[b,c,d]);this.colorSpaceTL=this.colorSpaceTL??new jW(new jX("","v4")),this.colorSpaceTL.fromDecoding(a.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(e.build(a)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new jW(new jX("","v4")),this.colorSpaceTR.fromDecoding(a.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(e.build(a)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new jW(new jX("","v4")),this.colorSpaceBL.fromDecoding(a.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(e.build(a)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new jW(new jX("","v4")),this.colorSpaceBR.fromDecoding(a.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(e.build(a)+".br");let f={include:a.isShader("vertex"),ignoreCache:!0};a.addContext(f),this.colorSpaceTLExp=new jX(this.colorSpaceTL.build(a,"v4"),"v4"),this.colorSpaceTRExp=new jX(this.colorSpaceTR.build(a,"v4"),"v4"),this.colorSpaceBLExp=new jX(this.colorSpaceBL.build(a,"v4"),"v4"),this.colorSpaceBRExp=new jX(this.colorSpaceBR.build(a,"v4"),"v4"),a.removeContext();let g=new jX("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return g.keywords.cubeUV_TL=this.colorSpaceTLExp,g.keywords.cubeUV_TR=this.colorSpaceTRExp,g.keywords.cubeUV_BL=this.colorSpaceBLExp,g.keywords.cubeUV_BR=this.colorSpaceBRExp,g.keywords.cubeUV=e,g}generate(a,b){if(!a.isShader("fragment"))return console.warn("TextureCubeUVNode is not compatible with "+a.shader+" shader."),a.format("vec4( 0.0 )",this.getType(a),b);{let c=this.uv,d=this.bias||a.context.roughness,e=new j$(j3.Nodes.roughnessToMip,[d]),f=new j2(e,j3.Nodes.m0,j3.Nodes.cubeUV_maxMipLevel,j2.CLAMP),g=new j2(f,j2.FLOOR),h=new j2(f,j2.FRACT),i=this.bilinearCubeUV(a,this.value,c,g),j=this.bilinearCubeUV(a,this.value,c,new j0(g,new jZ(1).setReadonly(!0),j0.ADD)),k=new j2(i,j,h,j2.MIX);return a.format(k.build(a),"v4",b)}}},j4=j3;let j5,j6,j7,j8,j9,ka,kb,kc,kd,ke,kf,kg,kh,ki,kj,kk,kl,km,kn,ko,kp,kq,kr,ks;j4.Nodes=(j5=new jT(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),j6=new jQ("float cubeUV_maxMipLevel 8.0",!0),j7=new jQ("float cubeUV_minMipLevel 4.0",!0),j8=new jQ("float cubeUV_maxTileSize 256.0",!0),j9=new jQ("float cubeUV_minTileSize 16.0",!0),ka=new jN(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`),ka.useKeywords=!1,kb=new jN(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`),kb.useKeywords=!1,kc=new jN(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[j5,ka,kb,j6,j7,j8,j9]),kc.useKeywords=!1,kd=new jQ("float r0 1.0",!0),ke=new jQ("float v0 0.339",!0),kf=new jQ("float m0 -2.0",!0),kg=new jQ("float r1 0.8",!0),kh=new jQ("float v1 0.276",!0),ki=new jQ("float m1 -1.0",!0),kj=new jQ("float r4 0.4",!0),kk=new jQ("float v4 0.046",!0),kl=new jQ("float m4 2.0",!0),km=new jQ("float r5 0.305",!0),kn=new jQ("float v5 0.016",!0),ko=new jQ("float m5 3.0",!0),kp=new jQ("float r6 0.21",!0),kq=new jQ("float v6 0.0038",!0),kr=new jQ("float m6 4.0",!0),ks=new jN(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,[kd,ke,kf,kg,kh,ki,kj,kk,kl,km,kn,ko,kp,kq,kr]),{bilinearCubeUV:kc,roughnessToMip:ks,m0:kf,cubeUV_maxMipLevel:j6});var kt=class extends jG{constructor(a){super("v3"),this.nodeType="Normal",this.scope=a??kt.VIEW}getShared(){return this.scope===kt.WORLD}build(a,b,c,d){let e=a.context[this.scope+"Normal"];return e?e.build(a,b,c,d):super.build(a,b,c)}generate(a,b,c,d,e){let f;switch(this.scope){case kt.VIEW:f=a.isShader("vertex")?"transformedNormal":"geometryNormal";break;case kt.LOCAL:a.isShader("vertex")?f="objectNormal":(a.requires.normal=!0,f="vObjectNormal");break;case kt.WORLD:a.isShader("vertex")?f="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(a.requires.worldNormal=!0,f="vWNormal")}return a.format(f,this.getType(a),b)}},ku=kt;ku.LOCAL="local",ku.WORLD="world",ku.VIEW="view",ku.NORMAL="normal",jF.addKeyword("viewNormal",function(){return new ku(ku.VIEW)}),jF.addKeyword("localNormal",function(){return new ku(ku.NORMAL)}),jF.addKeyword("worldNormal",function(){return new ku(ku.WORLD)});var kv=class extends jG{constructor(a){super("v3"),this.nodeType="Position",this.scope=a??kv.LOCAL}getType(){return this.scope===kv.PROJECTION?"v4":(0,this.type)}getShader(){switch(this.scope){case kv.LOCAL:case kv.WORLD:return!1}return!0}generate(a,b,c,d,e){let f;switch(this.scope){case kv.LOCAL:a.isShader("vertex")?f="transformed":(a.requires.position=!0,f="vPosition");break;case kv.WORLD:if(a.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";a.requires.worldPosition=!0,f="vWPosition";break;case kv.VIEW:f=a.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case kv.PROJECTION:f=a.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return a.format(f,this.getType(),b)}},kw=kv;kw.LOCAL="local",kw.WORLD="world",kw.VIEW="view",kw.PROJECTION="projection",jF.addKeyword("position",function(){return new kw}),jF.addKeyword("worldPosition",function(){return new kw(kw.WORLD)}),jF.addKeyword("viewPosition",function(){return new kw(kw.VIEW)});var kx=class extends jG{constructor(a){super("v3"),this.nodeType="Reflect",this.scope=a??kx.CUBE}getUnique(a){return!a.context.viewNormal}getType(){return this.scope===kx.SPHERE?"v2":(0,this.type)}generate(a,b){let c=this.getUnique(a);if(!a.isShader("fragment"))return console.warn("ReflectNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.type,b);{let d;switch(this.scope){case kx.VECTOR:{let e=new ku(ku.VIEW),f=a.context.roughness,g=e.build(a,"v3"),h=new kw(kw.VIEW).build(a,"v3"),i=f?f.build(a,"f"):void 0,j=`reflect( -normalize( ${h} ), ${g} )`;i&&(j=`normalize( mix( ${j}, ${g}, ${i} * ${i} ) )`);let k=`inverseTransformDirection( ${j}, viewMatrix )`;c?(a.addNodeCode(`vec3 reflectVec = ${k};`),d="reflectVec"):d=k;break}case kx.CUBE:{let l=new kx(kx.VECTOR).build(a,"v3"),m="vec3( -"+l+".x, "+l+".yz )";c?(a.addNodeCode(`vec3 reflectCubeVec = ${m};`),d="reflectCubeVec"):d=m;break}case kx.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new kx(kx.VECTOR).build(a,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";c?(a.addNodeCode(`vec2 reflectSphereVec = ${n};`),d="reflectSphereVec"):d=n}}return a.format(d,this.getType(),b)}}},ky=kx;ky.CUBE="cube",ky.SPHERE="sphere",ky.VECTOR="vector";var kz,kA=class extends jG{constructor(a=new jY,b,c){super("v4"),this.nodeType="TextureCube",this.value=a,this.radianceNode=new j4(this.value,b??new ky(ky.VECTOR),c),this.irradianceNode=new j4(this.value,new ku(ku.WORLD),new jZ(1).setReadonly(!0))}generate(a,b){return a.isShader("fragment")?(a.require("irradiance"),a.context.bias&&a.context.bias.setTexture(this.value),("irradiance"===a.slot?this.irradianceNode:this.radianceNode).build(a,b)):(console.warn("TextureCubeNode is not compatible with "+a.shader+" shader."),a.format("vec4( 0.0 )",this.getType(a),b))}},kB=class extends jH{constructor(a=new h.CubeTexture,b,c){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=a,this.uv=b??new ky,this.bias=c}getTexture(a,b){return super.generate(a,b,this.value.uuid,"tc")}generate(a,b){if("samplerCube"===b)return this.getTexture(a,b);let c=this.getTexture(a,b),d=this.uv?.build(a,"v3"),e=this.bias?this.bias.build(a,"f"):void 0;void 0===e&&a.context.bias&&(e=a.context.bias.setTexture(this).build(a,"f"));let f;f=e?"texCubeBias( "+c+", "+d+", "+e+" )":"texCube( "+c+", "+d+" )";let g={include:a.isShader("vertex"),ignoreCache:!0},h=this.getType(a);return a.addContext(g),this.colorSpace=this.colorSpace??new jW(new jX("",h)),this.colorSpace.fromDecoding(a.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(f),f=this.colorSpace.build(a,h),a.removeContext(),a.format(f,h,b)}},kC=["x","y","z","w"],kD=["float","vec2","vec3","vec4"],kE={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},kF={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},kG=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.getIncludesCode=function(){function a(a,b){return a.deps.length-b.deps.length}return function(b,c){let d=this.getIncludes(b,c);if(!d)return"";let e="";d=d.sort(a);for(let f=0;f<d.length;f++)d[f].src&&(e+=d[f].src+`
`);return e}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(a,b){this.buildShader("vertex",a),this.buildShader("fragment",b);for(let c=0;c<this.requires.uv.length;c++)if(this.requires.uv[c]){let d=c>0?c+1:"";this.addVaryCode("varying vec2 vUv"+d+";"),c>0&&this.addVertexParsCode("attribute vec2 uv"+d+";"),this.addVertexFinalCode("vUv"+d+" = uv"+d+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this}buildShader(a,b){this.resultCode[a]=b.build(this.setShader(a),"v4")}setMaterial(a,b){return this.material=a,this.renderer=b,this.defines={},this}addFlow(a,b,c){return this.addSlot(a).addCache(b).addContext(c)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(a){return this.cache=a??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(a){return this.context=Object.assign({},this.context,a),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(a){return this.slot=a||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(a,b){void 0===this.fragmentVariables[a]&&(this.addFragmentCode(`${b} ${a};`),this.fragmentVariables[a]="")}addFragmentParsVariable(a,b){void 0===this.fragmentParsVariables[a]&&(this.addFragmentParsCode(`${b} ${a};`),this.fragmentParsVariables[a]="")}addVertexParsVariable(a,b){void 0===this.vertexParsVariables[a]&&(this.addVertexParsCode(`${b} ${a};`),this.vertexParsVariables[a]="")}addVertexCode(a){this.addCode(a,"vertex")}addFragmentCode(a){this.addCode(a,"fragment")}addCode(a,b){this.code[b??this.shader]+=a+`
`}addVertexNodeCode(a){this.addNodeCode(a,"vertex")}addFragmentNodeCode(a){this.addNodeCode(a,"fragment")}addNodeCode(a,b){this.nodeCode[b??this.shader]+=a+`
`}clearNodeCode(a){a=a??this.shader;let b=this.nodeCode[a];return this.nodeCode[a]="",b}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(a){this.addFinalCode(a,"vertex")}addFragmentFinalCode(a){this.addFinalCode(a,"fragment")}addFinalCode(a,b){this.finalCode[b??this.shader]+=a+`
`}addVertexParsCode(a){this.addParsCode(a,"vertex")}addFragmentParsCode(a){this.addParsCode(a,"fragment")}addParsCode(a,b){this.parsCode[b??this.shader]+=a+`
`}addVaryCode(a){this.addVertexParsCode(a),this.addFragmentParsCode(a)}isCache(a){return -1!==this.caches.indexOf(a)}isSlot(a){return -1!==this.slots.indexOf(a)}define(a,b){this.defines[a]=void 0===b?1:b}require(a){this.requires[a]=!0}isDefined(a){return void 0!==this.defines[a]}getVar(a,b,c,d="varying",e="V",f=""){let g=this.getVars(d),h=g[a];if(!h){let i=g.length;h={name:c||"node"+e+i+(f?"_"+f:""),type:b},g.push(h),g[a]=h}return h}getTempVar(a,b,c,d){return this.getVar(a,b,c,this.shader,"T",d)}getAttribute(a,b){if(!this.attributes[a]){let c=this.getVar(a,b);this.addVertexParsCode("attribute "+b+" "+a+";"),this.addVertexFinalCode(c.name+" = "+a+";"),this.attributes[a]={varying:c,name:a,type:b}}return this.attributes[a]}getCode(a){return[this.prefixCode,this.parsCode[a],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[a],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[a],"uniform"),this.getIncludesCode("consts",a),this.getIncludesCode("structs",a),this.getIncludesCode("functions",a),"void main() {",this.getVarListCode(this.getVars(a)),this.code[a],this.resultCode[a],this.finalCode[a],"}"].join(`
`)}getVarListCode(a,b){b=b??"";let c="";for(let d=0,e=a.length;d<e;++d){let f=a[d],g=f.type,h=f.name,i=f.size,j=this.getFormatByType(g);if(void 0===j)throw Error("Node pars "+j+" not found.");j.includes("[]")?c+=b+" "+j.substring(0,j.length-2)+" "+h+`[${i}];
`:c+=b+" "+j+" "+h+`;
`}return c}getVars(a){return this.inputs.vars[a??this.shader]}getNodeData(a){let b=a instanceof jE?a.uuid:a;return this.nodeData[b]=this.nodeData[b]||{}}createUniform(a,b,c,d,e,f){if(b.includes("[]")){let g=this.inputs.arrayUniforms,h=g.list.length,i=new jD({type:b,size:c.size,name:d||"nodeUA"+h+(f?"_"+f:""),node:c,needsUpdate:e});return g.list.push(i),g[a].push(i),g[a][i.name]=i,this.uniforms[i.name]=i,i}{let j=this.inputs.uniforms,k=j.list.length,l=new jD({type:b,name:d||"nodeU"+k+(f?"_"+f:""),node:c,needsUpdate:e});return j.list.push(l),j[a].push(l),j[a][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(a,b,c,d,e){return this.createUniform("vertex",a,b,c,d,e)}createFragmentUniform(a,b,c,d,e){return this.createUniform("fragment",a,b,c,d,e)}include(a,b,c){let d;if(a="string"==typeof a?jF.get(a):a,!1===this.context.include)return a.name;a instanceof jN?d=this.includes.functions:a instanceof jQ?d=this.includes.consts:a instanceof jT&&(d=this.includes.structs);let e=d[this.shader]=d[this.shader]||[];if(a){let f=e[a.name];if(f||(f=e[a.name]={node:a,deps:[]},e.push(f),f.src=a.build(this,"source")),a instanceof jN&&b&&e[b.name]&& -1===e[b.name].deps.indexOf(a)&&(e[b.name].deps.push(a),a.includes?.length)){let g=0;do this.include(a.includes[g++],b);while(g<a.includes.length)}return c&&(f.src=c),a.name}throw Error("Include not found.")}colorToVectorProperties(a){return a.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(a){return a.replace(/c/g,"v3")}getIncludes(a,b){return this.includes[a][b||this.shader]}getConstructorFromLength(a){return kD[a-1]}isTypeMatrix(a){return/^m/.test(a)}getTypeLength(a){return"f"===a?1:parseInt(this.colorToVector(a).substr(1))}getTypeFromLength(a){return 1===a?"f":"v"+a}findNode(...a){for(let b=0;b<arguments.length;b++){let c=a[b];if(c?.isNode)return c}}resolve(...a){for(let b=0;b<arguments.length;b++){let c=a[b];if(void 0!==c){if(c.isNode)return c;if(c.isTexture)switch(c.mapping){case h.CubeReflectionMapping:case h.CubeRefractionMapping:return new kB(c);case h.CubeUVReflectionMapping:return new kA(new jY(c));default:return new jY(c)}else{if(c.isVector2)return new jI(c);if(c.isVector3)return new jJ(c);if(c.isVector4)return new jK(c)}}}}format(a,b,c){switch(this.colorToVector(c+" <- "+b)){case"f <- v2":case"f <- v3":case"f <- v4":return a+".x";case"f <- i":case"f <- b":return"float( "+a+" )";case"v2 <- f":return"vec2( "+a+" )";case"v2 <- v3":case"v2 <- v4":return a+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+a+" ) )";case"v3 <- f":return"vec3( "+a+" )";case"v3 <- v2":return"vec3( "+a+", 0.0 )";case"v3 <- v4":return a+".xyz";case"v4 <- f":return"vec4( "+a+" )";case"v4 <- v2":return"vec4( "+a+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+a+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+a+" ) )";case"i <- f":case"i <- b":return"int( "+a+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+a+".x )";case"b <- f":return"( "+a+" != 0.0 )";case"b <- v2":return"( "+a+" != vec2( 0.0 ) )";case"b <- v3":return"( "+a+" != vec3( 0.0 ) )";case"b <- v4":return"( "+a+" != vec4( 0.0 ) )";case"b <- i":return"( "+a+" != 0 )"}return a}getTypeByFormat(a){return kE[a]||a}getFormatByType(a){return kF[a]||a}getUUID(a,b){return(b=void 0===b||b)&&this.cache&&(a=this.cache+"-"+a),a}getElementByIndex(a){return kC[a]}getIndexByElement(a){return kC.indexOf(a)}isShader(a){return this.shader===a}setShader(a){return this.shader=a,this}mergeDefines(a){for(let b in a)this.defines[b]=a[b];return this.defines}mergeUniform(a){for(let b in a)this.uniforms[b]=a[b];return this.uniforms}getTextureEncodingFromMap(a){let b;return a?a.isTexture&&(b=a.encoding):b=h.LinearEncoding,b===h.LinearEncoding&&this.context.gamma&&(b=h.sRGBEncoding),b}},kH=class extends jH{constructor(a=0,b,c,d){super("c"),this.nodeType="Color",this.value=a instanceof g_?a:new g_(a||0,b,c,d)}setRGBA(a){this.value.setRGBA(a.r,a.g,a.b,a.a)}generate(a,b,c,d,e,f){c=a.getUUID(c??this.getUUID()),d=d??this.getType(a);let g=a.getNodeData(c),h=this.getReadonly()&& void 0!==this.generateReadonly;if(this.alpha){let i=this.alpha.build(a,"f");a.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${i};`)}return h?this.generateReadonly(a,b,c,d,e,f):a.isShader("vertex")?(g.vertex||(g.vertex=a.createVertexUniform(d,this,e,f,this.getLabel())),a.format(g.vertex.name,d,b)):(g.fragment||(g.fragment=a.createFragmentUniform(d,this,e,f,this.getLabel())),a.format(g.fragment.name,d,b))}generateReadonly(a,b,c,d,e,f){return a.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",d,b)}},kI=class extends jH{constructor(a){super("i"),this.nodeType="Int",this.value=Math.floor(a??0)}generateReadonly(a,b,c,d,e,f){return a.format(this.value.toString(),d,b)}},kJ=class extends jE{constructor(){super("basic"),this.nodeType="Basic",this.color=new kH(5855577),this.shadingAlpha=new jZ(1),this.shadingBlend=new kI(0)}generate(a){let b;if(a.isShader("vertex")){let c=this.position?this.position.analyzeAndFlow(a,"v3",{cache:"position"}):void 0;a.mergeUniform(h.UniformsUtils.merge([h.UniformsLib.fog])),a.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let d=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];c&&d.push(c.code,c.result?"displaced_position = "+c.result+";":""),d.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),d.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),d.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),b=d.join(`
`)}else{void 0===this.color&&(this.color=new kH(5855577)),this.color.analyze(a,{slot:"color"}),this.alpha&&this.alpha.analyze(a),this.afterColor&&this.afterColor.analyze(a,{slot:"afterColor"});let e=this.color.flow(a,"c",{slot:"color"}),f=this.alpha?this.alpha.flow(a,"f"):void 0,g=this.afterColor?this.afterColor.flow(a,"c",{slot:"afterColor"}):void 0;a.requires.transparent=void 0!==f,a.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let i=["#include <normal_fragment_begin>",e.code];f&&i.push(f.code,"#ifdef ALPHATEST"," if ( "+f.result+" <= ALPHATEST ) discard;","#endif"),g?i.push(g.code,`vec3 outgoingLight = ${e.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${g.result}, 1.0, SPE_BLENDING_NORMAL);`):i.push(`vec3 finalColor = ${e.result};`),f?i.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${f.result} );`):i.push("gl_FragColor = vec4("+e.result+", 1.0 );"),i.push("#include <fog_fragment>","#include <dithering_fragment>"),b=i.join(`
`)}return b}},kK=class extends jH{constructor(a){super("b"),this.nodeType="Bool",this.value=a?? !1}generateReadonly(a,b,c,d){return a.format(this.value?"true":"false",d,b)}},kL=class extends jH{constructor(a){super("m3"),this.nodeType="Matrix3",this.value=a??new h.Matrix3}generateReadonly(a,b,c,d,e,f){return a.format("mat3("+this.value.elements.join(", ")+")",d,b)}get elements(){return this.value.elements}set elements(a){this.value.fromArray(a)}},kM=class extends jH{constructor(a=1,b){super("f[]"),this.nodeType="FloatArray",this.size=a,this.value=Array.isArray(b)?b:"number"==typeof b?Array(a).fill(b):Array(a).fill(0)}},kN=class extends jH{constructor(a=1,b){super("v4[]"),this.nodeType="Vector4Array",this.size=a,this.value=Array.isArray(b)?b:b instanceof h.Vector4?Array(a).fill(b):Array(a).fill(new h.Vector4(0))}};let kO,kP,kQ,kR,kS,kT,kU,kV,kW,kX,kY,kZ;var k$=((kz=k$||{}).SIMPLEX="simplex3d",kz.SIMPLEX_FRACTAL="simplex3dFractal",kz.ASHIMA="simplexAshima",kz.FBM="fbm",kz.PERLIN="perlin",kz),k_=(kO=new jN(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),kP=new jN(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[kO]),kP.keywords.F3=new jQ("float F3 0.3333333"),kP.keywords.G3=new jQ("float G3 0.1666667"),kQ=new jN(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[kP]),kR=new jN("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),kS=new jN("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),kT=new jN(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[kR,kS]),kU=new jN("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),kV=new jN("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[kU]),kW=new jN(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[kV]),kX=new jN(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[kW]),kX.keywords.NUM_OCTAVES=new jQ("int NUM_OCTAVES 5"),kY=new jN("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),kZ=new jN(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[kR,kS,kY]),{simplex:kP,simplexFractal:kQ,simplexAshima:kT,fbm:kX,perlin:kZ}),k0=class extends jG{constructor(a,b,c,d,e,f,g,h,i,j,k,l){super("v3"),this.nodeType="Noise",this.scale=a,this.size=b,this.move=c,this.fA=d,this.fB=e,this.distortion=f,this.colorA=g,this.colorB=h,this.colorC=i,this.colorD=j,this.alpha=k,this.noiseType=l,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b,c,d,e){a.require("uv"),a.requires.uv=[!0],a.addFragmentVariable(this.calpha,"float");let f=Object.values(k$)[this.noiseType.value],g=new jN(`vec3 ${f}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, float alpha, out float calpha) {
                vec3 st = position / size;
				st /= scale;
				vec3 q = vec3(${f}(st),
							  ${f}(st + vec3(1.0)),
							  ${f}(st + vec3(1.0)));
				vec3 r = vec3(${f}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
							  ${f}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
							  ${f}(st * q));
				float f = ${f}(st + r);
				vec4 color;
				color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
				color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
				color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));

                float lalpha = alpha * color.a;
                calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			    accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return clamp(color, 0.0, 1.0).rgb;
			}`,[k_.simplex,k_.simplexFractal,k_.simplexAshima,k_.fbm,k_.perlin]),h=a.include(g),i=[];return i.push(this.scale.build(a,"f")),i.push(this.size.build(a,"v3")),i.push(this.move.build(a,"f")),i.push(this.fA.build(a,"v2")),i.push(this.fB.build(a,"v2")),i.push(this.distortion.build(a,"v2")),i.push(this.colorA.build(a,"v4")),i.push(this.colorB.build(a,"v4")),i.push(this.colorC.build(a,"v4")),i.push(this.colorD.build(a,"v4")),i.push(this.alpha.build(a,"f")),i.push(this.calpha),a.format(h+"("+i.join(",")+")",this.getType(a),b)}};k0.numOctaves=5;var k1=class extends jE{constructor(){super("phong"),this.nodeType="Phong",this.color=new kH(5855577),this.specular=new kH(1118481),this.shininess=new jZ(30),this.shadingAlpha=new jZ(1),this.shadingBlend=new kI(0)}build(a){let b;if(a.define("PHONG"),a.requires.lights=!0,a.extensions.derivatives=!0,a.isShader("vertex")){let c=this.position?this.position.analyzeAndFlow(a,"v3",{cache:"position"}):void 0;a.mergeUniform(h.UniformsUtils.merge([h.UniformsLib.fog,h.UniformsLib.lights])),a.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let d=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];c&&d.push(c.code,c.result?"displaced_position = "+c.result+";":""),d.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),d.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),d.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),b=d.join(`
`)}else{a.mergeUniform({penumbraSize:lE.penumbraSize}),void 0===this.color&&(this.color=new kH(5855577)),this.color.analyze(a,{slot:"color"}),this.specular.analyze(a),this.shininess.analyze(a),this.shadingAlpha.analyze(a),this.shadingBlend.analyze(a),this.afterColor&&this.afterColor.analyze(a,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(a);let e=this.color.flow(a,"c",{slot:"color"}),f=this.specular.flow(a,"c"),g=this.shininess.flow(a,"f"),i=this.shadingAlpha.flow(a,"f"),j=this.shadingBlend.flow(a,"i"),k=this.afterColor?this.afterColor.flow(a,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(a,"f"):void 0;a.requires.transparent=void 0!==l,a.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let m=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];m.push(e.code,"	vec3 diffuseColor = "+e.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",f.code,"	vec3 specular = "+f.result+";",g.code,"	float shininess = max( 0.0001, "+g.result+" );","	float specularStrength = 1.0;"),l&&m.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),m.push("material.diffuseColor = diffuseColor;"),m.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),m.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;"),m.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${i.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${i.result}, ${j.result} );
				}
				`),k&&m.push(k.code,`outgoingLight = spe_blend(outgoingLight, ${k.result}, 1.0, SPE_BLENDING_NORMAL);`),l?m.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):m.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),m.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),b=m.join(`
`)}return b}},k2=class extends jG{constructor(a,b,c,d,e,f,g){super("v3"),this.nodeType="Fresnel",this.color=a,this.bias=b,this.scale=c,this.intensity=d,this.factor=e,this.alpha=f,this.mode=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(a.require("vWorldViewDir"),a.require("worldNormal"),!a.isShader("fragment"))return console.warn("FresnelNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.addFragmentVariable(this.calpha,"float");let c=a.include(k2.Nodes.fresnel),d=[];return d.push(this.color.build(a,"c")),d.push(this.bias.build(a,"f")),d.push(this.scale.build(a,"f")),d.push(this.intensity.build(a,"f")),d.push(this.factor.build(a,"f")),d.push(this.alpha.build(a,"f")),d.push(this.mode.build(a,"i")),d.push(this.calpha),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},k3=k2;k3.Nodes={fresnel:new jN(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, float alpha, int mode, out float calpha) {
				float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

				float lalpha = clamp( fresnel, 0.0, 1.0 ) * alpha;
				calpha = lalpha / clamp(lalpha + accumAlpha, 0.001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;
				return color;
			}`)};var k4=class extends jG{constructor(a,b,c,d,e,f,g){super("v3"),this.nodeType="Rainbow",this.filmThickness=a,this.movement=b,this.wavelengths=c,this.noiseStrength=d,this.noiseScale=e,this.offset=f,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(a.require("vWorldViewDir"),a.require("worldNormal"),!a.isShader("fragment"))return console.warn("RainbowNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.require("uv"),a.requires.uv=[!0],a.addFragmentVariable(this.calpha,"float");let c=a.include(k4.Nodes.rainbow),d=[];return d.push(this.filmThickness.build(a,"f")),d.push(this.movement.build(a,"f")),d.push(this.wavelengths.build(a,"v3")),d.push(this.noiseStrength.build(a,"f")),d.push(this.noiseScale.build(a,"f")),d.push(this.offset.build(a,"v3")),d.push(this.alpha.build(a,"f")),d.push(this.calpha),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},k5=k4;let k6;k5.Nodes=(k6=new jN(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[k_.simplex]),{rainbow:new jN(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, float alpha, out float calpha) {
                 vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

                 float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);
                 float lalpha = alpha * rainbowContribution;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

                 return res;
             }`,[k6])});var k7=class extends jG{constructor(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=a,this.contourColor=b,this.outlineWidth=c,this.contourWidth=d,this.contourThreshold=e,this.outlineThreshold=f,this.contourFrequency=g,this.outlineSmoothing=h,this.contourDirection=i,this.positionalLines=j,this.compensation=k,this.resolution=l,this.normalMap=m,this.depthMap=n,this.pixelRatio=o,this.alpha=p,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(a.require("vWorldViewDir"),a.require("worldNormal"),a.extensions.derivatives=!0,this.firstTime){let c=this.outlineWidth.build(a,"f"),d=this.resolution.build(a,"v2"),e=this.compensation.build(a,"b"),f=this.pixelRatio.build(a,"f");a.addVertexParsVariable("randomColor","attribute vec3"),a.addVertexParsVariable("extrudeNormal","attribute vec3"),a.addVertexParsVariable(c,"uniform float"),a.addVertexParsVariable(d,"uniform vec2"),a.addVertexParsVariable(e,"uniform bool"),a.addVertexParsVariable(f,"uniform float"),a.addVertexParsVariable("vID","flat out float"),a.addFragmentParsVariable("vID","flat in float");let g=`g${this.uuid.toString().replace(/-/g,"")}`;a.addVertexFinalCode(`
                vID = randomColor.r;
                if (${e}) {
                    vec4 ${g}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${g}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    vec2 ${g}_offset = normalize(${g}_clipNormal.xy) / ${d} * (${c} / 2.0) * ${g}_clipPosition.w * 2.0 * ${f};
                    ${g}_clipPosition.xy += ${g}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${g}_clipPosition;
                }
            `)}if(!a.isShader("fragment"))return console.warn("OutlineNode is not compatible with "+a.shader+" shader."),"";{a.require("uv"),a.requires.uv=[!0],a.addFragmentVariable(this.calpha,"float");let h=a.include(k7.Nodes.outline),i=[];return i.push(this.outlineColor.build(a,"c")),i.push(this.contourColor.build(a,"c")),i.push(this.outlineWidth.build(a,"f")),i.push(this.contourWidth.build(a,"f")),i.push(this.contourThreshold.build(a,"f")),i.push(this.outlineThreshold.build(a,"f")),i.push(this.contourFrequency.build(a,"f")),i.push(this.outlineSmoothing.build(a,"f")),i.push(this.contourDirection.build(a,"v3")),i.push(this.positionalLines.build(a,"b")),i.push(this.resolution.build(a,"v2")),i.push(this.normalMap.getTexture(a,"t")),i.push(this.depthMap.getTexture(a,"t")),i.push(this.pixelRatio.build(a,"f")),i.push(this.compensation.build(a,"b")),i.push(this.alpha.build(a,"f")),i.push(this.calpha),this.firstTime=!this.firstTime,a.format(h+"("+i.join(",")+")",this.getType(a),b)}}},k8=k7;let k9;k8.Nodes=(k9=new jN(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 texelSize = (vec2(1.0) / resolution) * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -texelSize.x, -texelSize.y);
	uvSamples[1] = uv + vec2(0.0, -texelSize.y);
	uvSamples[2] = uv + vec2(  texelSize.x, -texelSize.y);
	uvSamples[3] = uv + vec2( -texelSize.x, 0.0);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  texelSize.x, 0.0);
	uvSamples[6] = uv + vec2( -texelSize.x, texelSize.y);
	uvSamples[7] = uv + vec2(0.0, texelSize.y);
	uvSamples[8] = uv + vec2(  texelSize.x, texelSize.y);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec4 sobel_edge_h = normalSamples[2] + (2.0*normalSamples[5]) + normalSamples[8] - (normalSamples[0] + (2.0*normalSamples[3]) + normalSamples[6]);
  	vec4 sobel_edge_v = normalSamples[0] + (2.0*normalSamples[1]) + normalSamples[2] - (normalSamples[6] + (2.0*normalSamples[7]) + normalSamples[8]);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`),{outline:new jN(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return result;
             }`,[k9])});var la=class extends jG{constructor(a,b,c,d,e,f,g,h){super("v3"),this.nodeType="Transmission",this.thickness=a,this.ior=b,this.roughness=c,this.transmissionSamplerSize=d,this.transmissionSamplerMap=e,this.transmissionDepthMap=f,this.aspectRatio=g,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(a.extensions.shaderTextureLOD=!0,a.extensions.derivatives=!0,!a.isShader("fragment"))return console.warn("TransmissionNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.define("NUM_SAMPLES",30),a.require("worldPosition"),a.requires.worldNormal=!0,a.requires.modelMatrix=!0,a.requires.projectionMatrix=!0,a.addFragmentVariable(this.calpha,"float");let c=a.include(la.Nodes.transmission),d=[];return d.push(this.thickness.build(a,"f")),d.push(this.ior.build(a,"f")),d.push(this.roughness.build(a,"f")),d.push(this.transmissionSamplerSize.build(a,"v2")),d.push(this.transmissionSamplerMap.getTexture(a,"t")),d.push(this.transmissionDepthMap.getTexture(a,"t")),d.push(this.aspectRatio.build(a,"v2")),d.push("normal"),d.push(this.alpha.build(a,"f")),d.push(this.calpha),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},lb=la;let lc,ld,le,lf,lg,lh;lb.Nodes=(lc=new jN(`
            float gaussian(vec2 i) {
                const float sigma = float(NUM_SAMPLES) * .25;
                return exp( -.5* dot(i/=sigma,i) ) / ( 6.28 * sigma*sigma );
            }`),ld=new jN(`
            vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

                const int LOD = 2;
                const int sLOD = 4; // tile size = 2^LOD

                vec3 O = vec3(0);
                float a = 0.0;
                const int s = NUM_SAMPLES/sLOD;
                for ( int i = 0; i < s*s; i++ ) {
                    int modulo = (i)-((i)/(s))*(s);
                    vec2 d = vec2(float(modulo), float(i/s))*float(sLOD) - float(NUM_SAMPLES)/2.;
                    vec2 uv = U + (scale * aspectRatio) * d;
                    // What is the depth of the opaque object we're trying to sample
                    float opaqueDepth = unpackRGBAToDepth(texture2D(dm, uv));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU + ((scale * min(lod / 2., 1.)) * aspectRatio) * d;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    float gaussian = gaussian(d);
		            #ifdef TEXTURE_LOD_EXT
                    O += gaussian * texture2DLodEXT( sp, uv, lod).rgb;
                    #else
                    O += gaussian * textureLod( sp, uv, lod).rgb;
                    #endif
                    a += gaussian;
                }
                return O / a;
            }`,[lc]),le=new jN(`
            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        // Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		        // The thickness is specified in local space.
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),lf=new jN(`
float applyIorToRoughness( float roughness, float ior ) {
		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	} `),lg=new jN(`
vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
        float lod = applyIorToRoughness(roughness, ior);

        return blur(transmissionSamplerMap, fragCoord, vec2(lod / (transmissionSamplerSize.x / 2.)), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
	}`,[lf,ld]),lh=new jN(`
vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
        vec3 refractedRayExit = position + transmissionRay;

        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
        vec2 refractionCoords = ndcPos.xy / ndcPos.w;
        refractionCoords += 1.0;
        refractionCoords /= 2.0;

        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
        unrefractedCoords += 1.0;
        unrefractedCoords /= 2.0;

        // Sample framebuffer to get pixel the refracted ray hits.
        return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    }`,[lg,le]),{transmission:new jN(`
            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                float lalpha = alpha;

                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return transmission;
            }`,[lh])});var li=class extends jG{constructor(a,b,c,d,e,f,g,h,i,j,k){super("v3"),this.nodeType="Depth",this.gradientType=a,this.smooth=b,this.near=c,this.far=d,this.isVector=e,this.isWorldSpace=f,this.origin=g,this.direction=h,this.colors=i,this.steps=j,this.alpha=k,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){let c=`g${this.uuid.toString().replace(/-/g,"")}`,d=new jN(`vec3 ${c}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${c}_MAX_COLORS], float steps[${c}_MAX_COLORS], float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${c}_IS_VECTOR
                   #ifdef ${c}_LINEAR
                       #ifdef ${c}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${c}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${c}_SMOOTH
				for ( int i = 1; i < ${c}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${c}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a;
               calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			   accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
               return color.rgb;
			}`,[li.Nodes.vectorLinearWorldSpaceDepth,li.Nodes.vectorLinearObjectSpaceDepth,li.Nodes.vectorSphericalObjectSpaceDepth,li.Nodes.vectorSphericalWorldSpaceDepth]);if(!a.isShader("fragment"))return console.warn("DepthNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.define(`${c}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&a.define(`${c}_SMOOTH`),this.isVector.value>.5&&a.define(`${c}_IS_VECTOR`),0===this.gradientType.value&&a.define(`${c}_LINEAR`),this.isWorldSpace.value>.5&&a.define(`${c}_WORLDSPACE`),a.require("worldPosition"),a.addFragmentVariable(this.calpha,"float");let e=a.include(d),f=[];return f.push(this.near.build(a,"f")),f.push(this.far.build(a,"f")),f.push(this.origin.build(a,"v3")),f.push(this.direction.build(a,"v3")),f.push(this.colors.build(a,"v4[]")),f.push(this.steps.build(a,"f[]")),f.push(this.alpha.build(a,"f")),f.push(this.calpha),a.format(e+"("+f.join(",")+")",this.getType(a),b)}}},lj=li;let lk,ll,lm,ln;lj.Nodes=(lk=new jN(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),ll=new jN(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),lm=new jN(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),ln=new jN(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`),{vectorLinearWorldSpaceDepth:lk,vectorLinearObjectSpaceDepth:ll,vectorSphericalWorldSpaceDepth:lm,vectorSphericalObjectSpaceDepth:ln});var lo,lp=class extends jG{constructor(a,b,c,d){super("v3"),this.nodeType="Blend",this.a=a,this.b=b,this.alpha=c,this.mode=d}generate(a,b){if(!a.isShader("fragment"))return console.warn("BlendNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{let c=[];return c.push(this.a.build(a,"c")),c.push(this.b.build(a,"c")),c.push(this.alpha.build(a,"f")),c.push(this.mode.build(a,"i")),a.format("spe_blend("+c.join(",")+")",this.getType(a),b)}}},lq=((lo=lq||{}).NOISE="noise",lo.MAP="map",lo),lr=class extends jG{constructor(a,b,c,d,e){super("v3"),this.displacementTypeIndex=new kI(0),this.nodeType="VertexDisplacement",this.intensity=a,this.movementOrTexture=b,"map"===Object.values(lq)[this.displacementTypeIndex.value]&&(this.mat=new kL(this.movementOrTexture.value.matrix)),this.cropOrOffset=c,this.scale=d,this.noiseFunctionIndex=e}generate(a,b){if(!a.isShader("vertex"))return console.warn("VertexDisplacementNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.define("USE_LAYER_DISPLACE");let c,d=[];switch(d.push("displaced_position"),d.push("displaced_normal"),Object.values(lq)[this.displacementTypeIndex.value]){case"map":c=a.include(lr.Nodes.map),d.push(this.movementOrTexture.getTexture(a,"t")),d.push("uv"),d.push(this.cropOrOffset.build(a,"f")),this.mat&&d.push(this.mat.build(a,"mat3"));break;case"noise":{let e=Object.values(k$)[this.noiseFunctionIndex.value],f=new jN(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),g=new jN(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement) {
							return p + n * ${e}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
						}`,[k_.simplex,k_.simplexFractal,k_.simplexAshima,k_.fbm,k_.perlin]),h=new jN(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[g,f]);c=a.include(h),d.push(this.scale.build(a,"f")),d.push(this.cropOrOffset.build(a,"v3")),d.push(this.movementOrTexture.build(a,"f"))}}return d.push(this.intensity.build(a,"f")),d.push("displaced_normal"),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},ls=lr;let lt,lu;ls.Nodes=(lt=new jN(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),lu=new jN(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`),{map:new jN(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[lt,lu])});var lv=class extends jG{constructor(a,b,c,d,e,f,g,h){super("v3"),this.nodeType="Gradient",this.gradientType=a,this.smooth=b,this.colors=c,this.steps=d,this.offset=e,this.morph=f,this.angle=g,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(!a.isShader("fragment"))return console.warn("GradientNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.define("GRAD_MAX",10),a.require("uv"),a.requires.uv=[!0],a.addFragmentVariable(this.calpha,"float");let c=a.include(lv.Nodes.gradient),d=[];return d.push(this.gradientType.build(a,"i")),d.push(this.smooth.build(a,"b")),d.push(this.colors.build(a,"v4[]")),d.push(this.steps.build(a,"f[]")),d.push(this.offset.build(a,"v2")),d.push(this.morph.build(a,"v2")),d.push(this.angle.build(a,"f")),d.push(this.alpha.build(a,"f")),d.push(this.calpha),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},lw=lv;lw.Nodes={gradient:new jN(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return color.xyz;
			}`)};var lx=class extends jG{constructor(a,b,c,d,e,f,g,h,i,j){super("v3"),this.nodeType="CustomTexture",this.firstTime=!0,this.texture=a,this.textureSize=b,this.crop=c,this.projection=d,this.axis=e,this.side=f,this.size=g,this.mat=h,this.alpha=i,this.mode=j,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){a.require("position"),a.require("normal"),a.require("uv"),a.requires.uv=[!0],a.extensions.shaderTextureLOD=!0,a.extensions.derivatives=!0;let c=`g${this.uuid.toString().replace(/-/g,"")}`,d;switch(this.projection.value){case 3:d=a.include(lx.Nodes.cylindrical);break;case 2:d=a.include(lx.Nodes.spherical);break;case 1:let e=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],f=new jN(`
		vec3 ${c}_planarTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( (${c}_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, mat * ${e}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);d=a.include(f);break;default:d=a.include(lx.Nodes.uv)}if(1===this.projection.value&&this.firstTime){a.addVertexParsCode(`varying vec2 ${c}_vCustomUv;`),a.addFragmentParsCode(`varying vec2 ${c}_vCustomUv;`);let g=["zy","xz","xy"][this.axis.value];a.addVertexFinalCode(`${c}_vCustomUv = (1. + (transformed.${g})) / 2.;`)}a.addFragmentVariable(this.calpha,"float");let h=[];return h.push(this.texture.generate(a,"t")),h.push(this.textureSize.build(a,"v2")),h.push(this.crop.build(a,"f")),h.push(this.mat.build(a,"mat3")),h.push(this.size.build(a,"v2")),h.push(this.alpha.build(a,"f")),h.push(this.mode.build(a,"i")),h.push(this.calpha),this.firstTime=!this.firstTime,a.format(d+"("+h.join(",")+")",this.getType(a),b)}},ly=lx;let lz,lA,lB;ly.Nodes=(lz=new jN(`
vec3 cylindricalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),lA=new jN(`
vec3 sphericalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),lB=new jN(`vec3 uvTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`),{cylindrical:lz,spherical:lA,uv:lB});var lC=class extends jG{constructor(a,b){super("v3"),this.nodeType="CustomNormal",this.cnormal=a,this.alpha=b}generate(a,b){if(!a.isShader("fragment"))return console.warn("CustomNormalNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{let c=a.include(lC.Nodes.customNormal),d=[];return d.push(this.cnormal.build(a,"v3")),d.push("normal"),d.push(this.alpha.build(a,"f")),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},lD=lC;lD.Nodes={customNormal:new jN(`vec3 customNormal(vec3 cnormal, vec3 norm, float alpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return normal;
			}`)};var lE={normalRenderTarget:new jY,normalRenderTargetDepth:new jY,transmissionRenderTarget:new jY,transmissionSize:new jI(2048,2048),transmissionRenderTargetDepth:new jY,pixelRatioNode:new jZ(1),resolution:new jI,penumbraSize:new kM(5,.5)};for(let lF of Object.values(lE))lF.isRenderGlobal=!0;var lG=class extends jE{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new kH(5855577),this.emissive=new kH(0),this.emissiveIntensity=new jZ(1),this.shadingAlpha=new jZ(1),this.shadingBlend=new kI(0)}build(a){let b;if(a.define("LAMBERT"),a.requires.lights=!0,a.extensions.derivatives=!0,a.isShader("vertex")){let c=this.position?this.position.analyzeAndFlow(a,"v3",{cache:"position"}):void 0;a.mergeUniform(h.UniformsUtils.merge([h.UniformsLib.fog,h.UniformsLib.lights])),a.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let d=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];c&&d.push(c.code,c.result?"displaced_position = "+c.result+";":""),d.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),d.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),d.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),b=d.join(`
`)}else{a.mergeUniform({penumbraSize:lE.penumbraSize}),void 0===this.color&&(this.color=new kH(5855577)),this.color.analyze(a,{slot:"color"}),this.shadingAlpha.analyze(a),this.shadingBlend.analyze(a),this.afterColor&&this.afterColor.analyze(a,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(a);let e=this.color.flow(a,"c",{slot:"color"}),f=this.emissive.flow(a,"c",{slot:"emissive"}),g=this.emissiveIntensity.flow(a,"f",{slot:"emissive"}),i=this.shadingAlpha.flow(a,"f"),j=this.shadingBlend.flow(a,"i"),k=this.afterColor?this.afterColor.flow(a,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(a,"f"):void 0;a.requires.transparent=void 0!==l,a.addParsCode(["uniform float penumbraSize[5];","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let m=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];m.push(e.code,"vec3 diffuseColor = "+e.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),l&&m.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),m.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),f&&m.push(f.code,"reflectedLight.directDiffuse += "+f.result+" * "+g.result+";"),m.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;"),m.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${i.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${i.result}, ${j.result} );
				}
				`),k&&m.push(k.code,`outgoingLight = spe_blend(outgoingLight, ${k.result}, 1.0, SPE_BLENDING_NORMAL);`),l?m.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):m.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),m.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),b=m.join(`
`)}return b}},lH=class extends jE{constructor(){super("standard"),this.nodeType="Standard",this.color=new kH(5855577),this.roughness=new jZ(.3),this.metalness=new jZ(0),this.reflectivity=new jZ(.5),this.shadingAlpha=new jZ(1),this.shadingBlend=new kI(0)}build(a){let b;if(a.define("STANDARD"),a.requires.lights=!0,a.extensions.derivatives=!0,a.extensions.shaderTextureLOD=!0,a.isShader("vertex")){let c=this.position?this.position.analyzeAndFlow(a,"v3",{cache:"position"}):void 0;a.mergeUniform(h.UniformsUtils.merge([h.UniformsLib.fog,h.UniformsLib.lights])),h.UniformsLib.LTC_1&&(a.uniforms.ltc_1={value:void 0},a.uniforms.ltc_2={value:void 0}),a.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let d=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];c&&d.push(c.code,c.result?"displaced_position = "+c.result+";":""),d.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),d.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),d.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),b=d.join(`
`)}else{a.mergeUniform({penumbraSize:lE.penumbraSize});let e={gamma:!0};void 0===this.color&&(this.color=new kH(5855577)),this.color.analyze(a,{slot:"color",context:e}),this.roughness.analyze(a),this.metalness.analyze(a),this.shadingAlpha.analyze(a),this.shadingBlend.analyze(a),this.afterColor&&this.afterColor.analyze(a,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(a),this.reflectivity&&this.reflectivity.analyze(a);let f=this.color.flow(a,"c",{slot:"color",context:e}),g=this.roughness.flow(a,"f"),i=this.metalness.flow(a,"f"),j=this.shadingAlpha.flow(a,"f"),k=this.shadingBlend.flow(a,"i"),l=this.afterColor?this.afterColor.flow(a,"c",{slot:"afterColor"}):void 0,m=this.alpha?this.alpha.flow(a,"f"):void 0,n=this.reflectivity?this.reflectivity.flow(a,"f"):void 0;a.requires.transparent=void 0!==m,a.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let o=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];o.push(f.code,"	vec3 diffuseColor = "+f.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",g.code,"	float roughnessFactor = "+g.result+";",i.code,"	float metalnessFactor = "+i.result+";"),m&&o.push(m.code,"#ifdef ALPHATEST","	if ( "+m.result+" <= ALPHATEST ) discard;","#endif"),o.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),o.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),n?o.push(n.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+n.result+" ) ), diffuseColor, metalnessFactor );"):o.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),o.push("#include <lights_fragment_begin>"),o.push("#include <lights_fragment_end>"),o.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),o.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${j.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${j.result}, ${k.result} );
				}
				`),l&&o.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),m?o.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${m.result} );`):o.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),o.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),b=o.join(`
`)}return b}},lI=class extends jE{constructor(){super("toon"),this.nodeType="Toon",this.color=new kH(5855577),this.specular=new kH(1118481),this.shininess=new jZ(30),this.shadingAlpha=new jZ(1),this.shadingBlend=new kI(0)}build(a){let b;if(a.define("TOON"),a.requires.lights=!0,a.extensions.derivatives=!0,a.isShader("vertex")){let c=this.position?this.position.analyzeAndFlow(a,"v3",{cache:"position"}):void 0;a.mergeUniform(h.UniformsUtils.merge([h.UniformsLib.fog,h.UniformsLib.lights])),a.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let d=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];c&&d.push(c.code,c.result?"displaced_position = "+c.result+";":""),d.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),d.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),d.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),b=d.join(`
`)}else{a.mergeUniform({penumbraSize:lE.penumbraSize}),void 0===this.color&&(this.color=new kH(5855577)),this.color.analyze(a,{slot:"color"}),this.specular.analyze(a),this.shininess.analyze(a),this.shadingAlpha.analyze(a),this.shadingBlend.analyze(a),this.afterColor&&this.afterColor.analyze(a,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(a);let e=this.color.flow(a,"c",{slot:"color"}),f=this.specular.flow(a,"c"),g=this.shininess.flow(a,"f"),i=this.shadingAlpha.flow(a,"f"),j=this.shadingBlend.flow(a,"i"),k=this.afterColor?this.afterColor.flow(a,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(a,"f"):void 0;a.requires.transparent=void 0!==l,a.addParsCode(["uniform float penumbraSize[5];","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let m=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];m.push(e.code,"	vec3 diffuseColor = "+e.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",f.code,"	vec3 specular = "+f.result+";",g.code,"	float shininess = max( 0.0001, "+g.result+" );","	float specularStrength = 1.0;"),l&&m.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),m.push("material.diffuseColor = diffuseColor;"),m.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),m.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),m.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${i.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${i.result}, ${j.result} );
				}
				`),k&&m.push(k.code,`outgoingLight = spe_blend(outgoingLight, ${k.result}, 1.0, SPE_BLENDING_NORMAL);`),l?m.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):m.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),m.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),b=m.join(`
`)}return b}};function lJ(a){var b;let{alpha:c,mode:d}=a;return{type:(b=a).type,alpha:c,mode:d}}var lK=class extends g_{},lL=new Map,lM={url:"head",time:0,data:null,next:null,prev:null},lN={url:"tail",time:1/0,data:null,next:null,prev:null};lM.next=lN,lN.prev=lM;var lO=0,lP=class{constructor(a,b){this.data=a,this.onImageLoad=b,this.loaded=!1,this.updateSrc(a.data)}updateSrc(a){typeof document>"u"||(this.dispose(),this.loaded=!1,this.img=new Image,this.img.src=function(a){if("string"==typeof a)return a;let b=Date.now(),c=lL.get(a);return void 0===c?(c={url:URL.createObjectURL(new Blob([a])),data:a,time:b,next:null,prev:null},lL.set(a,c)):(c.time=b,c.prev.next=c.next,c.next.prev=c.prev),c.prev=lN.prev,c.next=lN,lN.prev.next=c,lN.prev=c,b-lO>1e4&&(lO=b+1e3,setTimeout(()=>{let a=Date.now(),b=lM.next;for(;b.time<a-1e4;)URL.revokeObjectURL(b.url),lL.delete(b.data),(b=b.next).prev=lM,lM.next=b},900)),c.url}(a),this.img.onload=()=>{for(let a of(this.loaded=!0,[1e3,1001,1002])){let b=this[a];b&&(b.image=this.img,b.needsUpdate=!0)}this.onImageLoad&&this.onImageLoad()})}getTexture(a){let b=this[a];if(b)return b;{let c=new h.Texture(this.img,void 0,a,a);return this.loaded&&(c.needsUpdate=!0),this[a]=c,c}}dispose(){this[1e3]?.dispose(),this[1e3]=void 0,this[1001]?.dispose(),this[1001]=void 0,this[1002]?.dispose(),this[1002]=void 0}},lQ=class extends lP{},lR=class extends jH{},lS={noise:["noiseType"],texture:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"]},lT={depth:["colors"]};function lU(a,b,c){let d=lS[a.type],e=lT[a.type];if(void 0!==e){let f=a.color;if(e.includes(b)){let g=f[b]?.value?.length;if(void 0!==g&&g!==c.length)return!0}}return void 0!==d&&d.includes(b)}function lV(a,b,c){let d=c.uniforms[`f${c.id}_texture`];if(!d)return!1;let e=!1,f=a;if("image"in f){let g=f.image,h=b.image(g),i=d;i instanceof lQ||i.image.dispose(),i.image=h}if("wrapping"in f&&(d.wrap=f.wrapping),"repeat"in f||"offset"in f){let j="mat",k=c.uniforms[`f${c.id}_${j}`];"repeat"in f&&(k.repeat=f.repeat),"offset"in f&&(k.offset=f.offset),k.updateMatrix()}return e}var lW=class extends jG{constructor(a,b,c){super("v3"),this.nodeType="Matcap",this.texture=a,this.alpha=b,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(!a.isShader("fragment"))return console.warn("MatcapNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.addFragmentVariable(this.calpha,"float");let c=a.include(lW.Nodes.matcap);a.require("normal"),a.requires.normal=!0;let d=[];return d.push(this.texture.generate(a,"t")),d.push("normal"),d.push(this.alpha.build(a,"f")),d.push(this.mode.build(a,"i")),d.push(this.calpha),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},lX=lW;lX.Nodes={matcap:new jN(`vec3 matcap(sampler2D matcapTex, vec3 normal, float alpha, int mode, out float calpha) {
                vec3 viewDir = normalize( vViewPosition );
                vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
                vec3 y = cross( viewDir, x );
                vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
                vec4 matcapColor = texture2D( matcapTex, uv );

                calpha =  alpha / clamp( alpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;
                
                return matcapColor.rgb;
            }
            `)};var lY=class extends lR{constructor(a,b){super("t"),this.image=a,this.wrap=b}get value(){return this.image.getTexture(this.wrap)}},lZ=class extends lR{constructor(a){super("v3"),this.image=a,this._value=new h.Vector3}get value(){return this._value.x=this.image.img.width,this._value.y=this.image.img.height,this._value}},l$=class extends jG{constructor(a,b,c,d,e,f,g,h,i,j){super("v3"),this.nodeType="Toon",this.positioning=a,this.colors=b,this.steps=c,this.source=d,this.isWorldSpace=e,this.noiseStrength=f,this.noiseScale=g,this.shadowColor=h,this.offset=i,this.alpha=j,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(a,b){if(a.require("worldNormal"),a.require("worldPosition"),!a.isShader("fragment"))return console.warn("ToonNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b);{a.define("COLORS_MAX",10),a.addFragmentVariable(this.calpha,"float");let c=a.include(l$.Nodes.toon),d=[];return d.push(this.positioning.build(a,"i")),d.push(this.colors.build(a,"v4[]")),d.push(this.steps.build(a,"f[]")),d.push(this.source.build(a,"v3")),d.push(this.isWorldSpace.build(a,"b")),d.push(this.noiseStrength.build(a,"f")),d.push(this.noiseScale.build(a,"f")),d.push(this.shadowColor.build(a,"v4")),d.push(this.offset.build(a,"v3")),d.push(this.alpha.build(a,"f")),d.push(this.calpha),a.format(c+"("+d.join(",")+")",this.getType(a),b)}}},l_=l$;let l0,l1,l2,l3,l4;function l5(a,b,c){a.setUvTransform(c[0],c[1],b[0],b[1],0,0,0)}l_.Nodes=(l0=new jN(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),l1=new jN(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),l2=new jN(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[l1]),l3=new jN(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),l4=new jN(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[l3]),{toon:new jN(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[k_.simplex,l0,l2,l4])});var l6=class extends kL{constructor(a,b){super(new h.Matrix3),this.repeat=a,this.offset=b,l5(this.value,a,b)}updateMatrix(){l5(this.value,this.repeat,this.offset)}},l7=class{constructor(a,b,c,d){for(let e in this.id=a,this.uuid=b,this.data=c,this.uniforms={},d)this.uniforms[`f${this.id}_${e}`]=d[e];for(let f in c)md(f,this,c)}get type(){return this.data.type}static create(a,b,c,d){if("light"===c.type)return ma.createLigherLayer(a,b,c,d);if("texture"===c.type){let e=d.image(c.texture.image),f=new lY(e,c.texture.wrapping),g=new lZ(e),i=new l6(c.texture.repeat,c.texture.offset),j=new jZ(c.crop?1:0),k=new kI(c.projection??0),l=new kI(["x","y","z"].indexOf(c.axis)??0),m=new kI(c.side??0),n=new jI(c.size?new h.Vector2(c.size[0],c.size[1]):new h.Vector2(100,100)),o=new jZ(c.alpha??1),p=new kI(c.mode??0),q=new ly(f,g,j,k,l,m,n,i,o,p),r=new jX(q.calpha,"f");return new l8(a,b,c,{texture:f,textureSize:g,crop:j,projection:k,axis:l,side:m,size:n,mat:i,alpha:o,mode:p},q,p,r)}if("matcap"===c.type){let s=d.image(c.texture.image),t=new lY(s,c.texture.wrapping),u=new jZ(c.alpha??1),v=new kI(c.mode??0),w=new lX(t,u,v),x=new jX(w.calpha,"f");return new l8(a,b,c,{texture:t,alpha:u,mode:v},w,v,x)}if("displace"!==c.type)return mc(a,b,c,d);if("noise"===c.displacementType){let y=new jJ(new h.Vector3(...c.offset)),z=new jZ(c.scale??10),A=new jZ(c.intensity??8),B=new jZ(c.movement??1),C=new kI(c.noiseType??0),D=new ls(A,B,y,z,C);return new l9(a,b,c,{offset:y,scale:z,intensity:A,movement:B,noiseType:C},D)}throw Error()}updateByOp(a,b,c){let d=a;if(void 0===d.path[0]){if(0===d.type)return"type"in d.props||"category"in d.props||function(a,b,c,d){let e=!1;for(let[f,g]of Object.entries(a)){if(!f|| void 0===g||md(f,c,d))continue;c.visible=d.visible;let i=c.uniforms[`f${c.id}_${f}`];if(i&&!(i instanceof lR))switch(e=e||lU(c,f,g),i.constructor){case kH:if("string"==typeof g){let j=b.getColor(g);j&&(i.value=j);break}{let k=g;i.value instanceof lK?i.value=new g_(k.r,k.g,k.b,k.a):i.setRGBA(k);break}case jK:if("string"==typeof g){let l=b.getColor(g);l&&(i.value=l);break}{let m=g;i.value instanceof lK?i.value=new g_(m.r,m.g,m.b,m.a):i.value.setRGBA(m.r,m.g,m.b,m.a);break}case jI:{let n=g;i.value.setX(n[0]),i.value.setY(n[1]);break}case jJ:{let o=g;i.value.setX(o[0]),i.value.setY(o[1]),i.value.setZ(o[2]);break}case jY:lV(g,b,c);break;case kN:i.value=g.map(a=>new h.Vector4(...a));break;default:i.value=g}}return e}(d.props,c,this,b)}else if("texture"===d.path[0])return!("texture"in b)||lV(d.props,c,this);return!1}dispose(){}hasValueByKey(a){return void 0!==this.uniforms[a]}hasValue(a){return this.hasValueByKey(`f${this.id}_${a}`)}setValue(a,b){let c=`f${this.id}_${a}`;this.hasValueByKey(c)&& void 0!==b&&(this.uniforms[c].value=b)}getNode(a){let b=`f${this.id}_${a}`;if(this.hasValueByKey(b))return this.uniforms[b]}getValue(a){let b=`f${this.id}_${a}`;if(this.hasValueByKey(b))return this.uniforms[b].value}getName(a){let b=/f\d+_(.*)/.exec(a);if(b&&b.length>1)return b[1];console.log(`Layer.getName: error ${a}`)}getNames(){let a=[];for(let b in this.uniforms){let c=this.getName(b);c&&a.push(c)}return a}},l8=class extends l7{constructor(a,b,c,d,e,f,g){super(a,b,c,d),this.color=e,this.mode=f,this.alpha=g}},l9=class extends l7{constructor(a,b,c,d,e){super(a,b,c,d),this.position=e}},ma=class extends l7{constructor(a,b,c,d,e){super(a,b,c,e),this.data=c,this.node=d}static createLigherLayer(a,b,c,d){let e,f=new jZ(c.alpha),g=new kI(c.mode),h;if("lambert"===c.category){e=new lG;let i=new kH(d.color(c.emissive)??0);h={emissive:i},e.emissive=i}else if("phong"===c.category){e=new k1;let j=new jZ(c.shininess??30),k=new kH(d.color(c.specular)??1118481);h={shininess:j,specular:k},e.shininess=j,e.specular=k}else if("toon"===c.category){e=new lI;let l=new jZ(c.shininess??30),m=new kH(d.color(c.specular)??1118481);h={shininess:l,specular:m},e.shininess=l,e.specular=m}else if("physical"===c.category){e=new lH;let n=new jZ(c.roughness??.3),o=new jZ(c.metalness??0),p=new jZ(c.reflectivity??.5);h={roughness:n,metalness:o,reflectivity:p},e.roughness=n,e.metalness=o,e.reflectivity=p}else e=new kJ,h={};return e.alpha=new jZ(1),e.shadingAlpha=f,e.shadingBlend=g,h.alpha=e.shadingAlpha,h.mode=e.shadingBlend,new ma(a,b,c,e,h)}};function mb(a){let b=a instanceof l7?a.type:a;return"texture"===b||"displace_map"===b||"matcap"===b}function mc(a,b,c,d){let e=function(a,b){var c,d,e,f,g,i,j,k,l,m,n;switch(a.type){case"fresnel":return function a(b,c){let{bias:d,scale:e,intensity:f,factor:g,color:h}=b;return{...lJ(b),color:jh(h,c),bias:d,scale:e,intensity:f,factor:g}}(a,b);case"gradient":return function a(b){let{gradientType:c,smooth:d,colors:e,steps:f,angle:g,offset:i,morph:j}=b;return{...lJ(b),gradientType:c,smooth:d,colors:e.map(a=>new h.Vector4(a[0],a[1],a[2],a[3])),num:e.length,steps:f,offset:new h.Vector2(...i),morph:new h.Vector2(...j),angle:g}}(a);case"depth":return function a(b){let{gradientType:c,near:d,far:e,isVector:f,isWorldSpace:g,origin:i,direction:j,colors:k,steps:l,smooth:m}=b;return{...lJ(b),gradientType:c,near:d,far:e,isVector:f,isWorldSpace:g,origin:new h.Vector3(...i),direction:j?new h.Vector3(...j):new h.Vector3(1,0,0),colors:k.map(a=>void 0!==a?new h.Vector4(a[0],a[1],a[2],a[3]):new h.Vector4(0,0,0,0)),steps:l,smooth:m}}(a);case"normal":return function a(b){let{cnormal:c}=b;return{...lJ(b),cnormal:new h.Vector3(c[0],c[1],c[2])}}(a);case"noise":return c=a,d=b,{...lJ(c),scale:c.scale,move:c.move,fA:new h.Vector2(...c.fA),fB:new h.Vector2(...c.fB),size:new h.Vector3(...c.size),distortion:new h.Vector2(...c.distortion),colorA:jh(c.colorA,d),colorB:jh(c.colorB,d),colorC:jh(c.colorC,d),colorD:jh(c.colorD,d),noiseType:c.noiseType};case"rainbow":return e=a,{...lJ(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new h.Vector3(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new h.Vector3(...e.offset)};case"toon":return f=a,g=b,{...lJ(f),positioning:f.positioning,colors:f.colors.map(a=>new h.Vector4(a[0],a[1],a[2],a[3])),num:f.colors.length,steps:f.steps,source:new h.Vector3(...f.source),isWorldSpace:f.isWorldSpace,noiseStrength:f.noiseStrength,noiseScale:f.noiseScale,shadowColor:jh(f.shadowColor,g),offset:new h.Vector3(...f.offset)};case"outline":return i=a,j=b,{...lJ(i),outlineColor:jh(i.outlineColor,j),contourColor:jh(i.contourColor,j),outlineWidth:i.outlineWidth,contourWidth:i.contourWidth,outlineThreshold:i.outlineThreshold,contourThreshold:i.contourThreshold,outlineSmoothing:i.outlineSmoothing,contourFrequency:i.contourFrequency,contourDirection:i.contourDirection,positionalLines:i.positionalLines,compensation:i.compensation};case"transmission":return k=a,l=b,{...lJ(k),thickness:k.thickness,ior:k.ior,roughness:k.roughness};case"color":return m=a,n=b,{...lJ(m),color:jh(m.color,n)}}}(c,d);return function(a,b,c,d){switch(a.type){case"color":{let e=new kH(d.color??5855577),f=new jZ(d.alpha??1),g=new jX("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");g.keywords.alpha=f;let i=new kI(d.mode??0);return e.alpha=f,new l8(b,c,a,{color:e,alpha:f,mode:i},e,i,g)}case"fresnel":{let j=new kH(d.color??16777215),k=new jZ(d.bias??.1),l=new jZ(d.scale??1),m=new jZ(d.intensity??2),n=new jZ(d.factor??1),o=new jZ(d.alpha??1),p=new kI(d.mode??0),q=new k3(j,k,l,m,n,o,p),r=new jX(q.calpha,"f");return new l8(b,c,a,{color:j,bias:k,scale:l,intensity:m,factor:n,alpha:o,mode:p},q,p,r)}case"rainbow":{let s=new jZ(d.filmThickness??30),t=new jZ(d.movement??0),u=new jJ(d.wavelengths??new h.Vector3(0,0,0)),v=new jZ(d.noiseStrength??0),w=new jZ(d.noiseScale??1),x=new jJ(d.offset??new h.Vector3(0,0,0)),y=new jZ(d.alpha??1),z=new k5(s,t,u,v,w,x,y),A=new jX(z.calpha,"f"),B=new kI(d.mode??0);return new l8(b,c,a,{filmThickness:s,movement:t,wavelengths:u,noiseStrength:v,noiseScale:w,offset:x,alpha:y,mode:B},z,B,A)}case"transmission":{let C=new jZ(d.thickness??10),D=new jZ(d.ior??1.5),E=new jZ(d.roughness??.5),F=lE.transmissionSize,G=lE.transmissionRenderTarget,H=lE.transmissionRenderTargetDepth,I=window.innerWidth,J=window.innerHeight,K=I>=J?new jI(J/I,1):new jI(1,I/J),L=new jZ(d.alpha??1),M=new lb(C,D,E,F,G,H,K,L),N=new jX(M.calpha,"f"),O=new kI(d.mode??0);return new l8(b,c,a,{thickness:C,ior:D,roughness:E,aspectRatio:K,alpha:L,mode:O},M,O,N)}case"toon":{let P=new kI(d.positioning??0),Q;d.colors?Q=new kN(d.colors.length,d.colors):(Q=new kN(10,new h.Vector4(0,0,0,1))).value[1]=new h.Vector4(1,1,1,1);let R;d.steps?R=new kM(d.steps.length,d.steps):(R=new kM(10,1)).value[0]=0;let S=new jJ(d.source??new h.Vector3(0,0,0)),T=new kK(d.isWorldSpace?? !0),U=new jZ(d.noiseStrength??0),V=new jZ(d.noiseScale??1),W=new jK(d.shadowColor),X=new jJ(d.offset??new h.Vector3(0,0,0)),Y=new jZ(d.alpha??1),Z=new l_(P,Q,R,S,T,U,V,W,X,Y),$=new jX(Z.calpha,"f"),_=new kI(d.mode??0);return new l8(b,c,a,{positioning:P,colors:Q,steps:R,source:S,isWorldSpace:T,noiseStrength:U,noiseScale:V,shadowColor:W,offset:X,alpha:Y,mode:_},Z,_,$)}case"outline":{let aa=new kH(d.outlineColor??16777215),ab=new kH(d.contourColor??16777215),ac=new jZ(d.outlineWidth??.1),ad=new jZ(d.contourWidth??.1),ae=new jZ(d.outlineThreshold??.1),af=new jZ(d.contourThreshold??.1),ag=new jZ(d.outlineSmoothing??.1),ah=new jZ(d.contourFrequency??.1),ai=new jJ(d.contourDirections??new h.Vector3(0,1,0)),aj=new kK(d.positionalLines?? !1),ak=new kK(d.compensation?? !0),al=lE.normalRenderTarget,am=lE.normalRenderTargetDepth,an=lE.pixelRatioNode,ao=lE.resolution,ap=new jZ(d.alpha??1),aq=new k8(aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,ao,al,am,an,ap),ar=new jX(aq.calpha,"f"),as=new kI(d.mode??0);return new l8(b,c,a,{outlineColor:aa,contourColor:ab,outlineWidth:ac,contourWidth:ad,outlineThreshold:ae,contourThreshold:af,outlineSmoothing:ag,contourFrequency:ah,contourDirection:ai,positionalLines:aj,compensation:ak,alpha:ap,mode:as},aq,as,ar)}case"depth":{let at=new kI(d.gradientType??0),au=new kK(d.smooth?? !1),av=new jZ(d.near??50),aw=new jZ(d.far??200),ax=new jZ(d.isVector??1),ay=new jZ(d.isWorldSpace??0),az=new jJ(d.origin??new h.Vector3),aA=new jJ(d.direction??new h.Vector3),aB;d.colors?aB=new kN(d.colors.length,d.colors):(aB=new kN(2,new h.Vector4(0,0,0,1))).value[1]=new h.Vector4(1,1,1,1);let aC;d.steps?aC=new kM(d.steps.length,d.steps):(aC=new kM(2,1)).value[0]=0;let aD=new jZ(d.alpha??1),aE=new kI(d.mode??0),aF=new lj(at,au,av,aw,ax,ay,az,aA,aB,aC,aD),aG=new jX(aF.calpha,"f");return new l8(b,c,a,{gradientType:at,smooth:au,near:av,far:aw,isVector:ax,isWorldSpace:ay,origin:az,direction:aA,colors:aB,steps:aC,alpha:aD,mode:aE},aF,aE,aG)}case"noise":{let aH=new jZ(d.scale??1),aI=new jJ(d.size??new h.Vector3(100,100,100)),aJ=new jZ(d.move??1),aK=new jI(d.fA??new h.Vector2(1.7,9.2)),aL=new jI(d.fB??new h.Vector2(8.3,2.8)),aM=new jI(d.distortion??new h.Vector2(1,1)),aN=new jK(d.colorA),aO=new jK(d.colorB),aP=new jK(d.colorC),aQ=new jK(d.colorD),aR=new jZ(d.alpha??1),aS=new kI(d.mode??0),aT=new kI(d.noiseType??0),aU=new k0(aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aT),aV=new jX(aU.calpha,"f");return new l8(b,c,a,{scale:aH,size:aI,move:aJ,fA:aK,fB:aL,distortion:aM,colorA:aN,colorB:aO,colorC:aP,colorD:aQ,alpha:aR,mode:aS,noiseType:aT},aU,aS,aV)}case"normal":{let aW=new jJ(d.cnormal??new h.Vector3(1,1,1)),aX=new jZ(d.alpha??1),aY=new kI(d.mode??0),aZ=new lD(aW,aX),a$=new jX("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");return a$.keywords.alpha=aX,new l8(b,c,a,{cnormal:aW,alpha:aX,mode:aY},aZ,aY,a$)}case"gradient":{let a_=new kI(d.gradientType??0),a0=new kK(d.smooth?? !1),a1;d.colors?a1=new kN(d.colors.length,d.colors):(a1=new kN(10,new h.Vector4(0,0,0,1))).value[1]=new h.Vector4(1,1,1,1);let a2;d.steps?a2=new kM(d.steps.length,d.steps):(a2=new kM(10,1)).value[0]=0;let a3=new jI(d.offset??new h.Vector2(0,0)),a4=new jI(d.morph??new h.Vector2(0,0)),a5=new jZ(d.angle??0),a6=new jZ(d.alpha??1),a7=new kI(d.mode??0),a8=new lw(a_,a0,a1,a2,a3,a4,a5,a6),a9=new jX(a8.calpha,"f");return new l8(b,c,a,{gradientType:a_,smooth:a0,colors:a1,steps:a2,offset:a3,morph:a4,angle:a5,alpha:a6,mode:a7},a8,a7,a9)}default:{let ba=new kH(1,0,0,1),bb=new jZ(1),bc=new jX("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");bc.keywords.alpha=bb;let bd=new kI(0);return ba.alpha=bb,new l8(b,c,a,{color:ba,alpha:bb,mode:bd},ba,bd,bc)}}}(c,a,b,e)}function md(a,b,c){if("displace"===c.type&&("intensity"===a||"visible"===a)){let d=b.uniforms[`f${b.id}_intensity`];return d?(d.value=c.intensity*(c.visible?1:0),d):void 0}if("displace"!==c.type&&("alpha"===a||"visible"===a)){let e=b.uniforms[`f${b.id}_alpha`];if(!e)return;if(e.value=c.alpha*(c.visible?1:0),"outline"===c.type&&"visible"==a){let f=b.uniforms[`f${b.id}_compensation`];f&&(f.value=c.compensation&&c.visible)}return e}}var me=class extends h.ShaderMaterial{constructor(a,b){super(void 0),this.data=a,this.layerIdGen=0,this.type="NodeMaterial",this.uniformsBackup={},this.fog=!0,this.updaters=[],this.dithering=!0,this.vertexColors=!0,this.onBeforeCompile=this._onBeforeCompile,this.transparent=!0,this.reset(a,b)}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.data.category}reset(a,b){let c=a.layers??iX.defaultTwoLayerData("phong").layers;this.layers=c.map(a=>l7.create(this.layerIdGen++,a.id,a.data,b)),this.layers.reverse(),this.name=a.name??"Untitled Material",this.onUpdate(b)}getLayersOfType(a){return this.layers.filter(b=>b.type===a)}getLayerByUuid(a){return this.layers.find(b=>b.uuid===a)}onUpdate(a){this.lightLayer=this.layers.find(a=>a instanceof ma),void 0===this.lightLayer&&(this.lightLayer=new ma(0,"",gE.defaultData("light","basic"),new kJ,{})),this.dispose(),this.needsUpdate=!0,this.blendColors(),this.blendAfterColors(),this.blendPositions()}updateByOp(a,b,c){if(this.data=b,"layers"===a.path[0]){let d=a.path[1];if(void 0===d){if(this.layers.reverse(),4===a.type){let e=l7.create(this.layerIdGen++,a.id,a.data,c);this.layers.splice(a.localIndex,0,e)}else if(5===a.type)this.layers.splice(a.localIndex,1)[0].dispose();else if(6===a.type){let f=this.layers.findIndex(b=>b.uuid===a.id),g=this.layers[f];this.layers.splice(f,1),this.layers.splice(a.localIndex,0,g)}this.layers.reverse(),this.onUpdate(c)}else{let h=this.layers.find(a=>a.uuid===d);if(h){let i=b.layers.data(d);if(h.updateByOp({...a,path:a.path.slice(2)},i,c)){let j=l7.create(this.layerIdGen++,d,i,c);this.layers.splice(this.layers.findIndex(a=>a.uuid===d),1,j),this.onUpdate(c)}}}}}blendColors(){let a=this.layers.findIndex(a=>a instanceof l8),b=this.layers.findIndex(a=>a instanceof ma);if(-1!==a&&a<b){let c=this.layers[a].color;for(let d=a+1;d<b;++d){let e=this.layers[d];e instanceof l8&&(c=new lp(c,e.color,e.alpha,e.mode))}this.fragment.color=c}else this.fragment.color=void 0}blendAfterColors(){let a=new jX("outgoingLight","f"),b=this.layers.findIndex(a=>a instanceof ma);if(this.layers.length>b+1){for(let c=b+1;c<this.layers.length;++c){let d=this.layers[c];d instanceof l8&&(a=new lp(a,d.color,d.alpha,d.mode))}this.fragment.afterColor=a}else this.fragment.afterColor=void 0}blendPositions(){let a=this.layers.filter(a=>a instanceof l9);if(a.length>0){let b=a[0].position;for(let c=1;c<a.length;++c)a[c]&&(b=new j0(b,a[c].position,j0.ADD),b=new j0(b,new jZ(.5).setReadonly(!0),j0.MUL));this.fragment.position=b}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}_onBeforeCompile(a,b){this.build({renderer:b}),a.defines=this.defines,a.uniforms=this.uniforms,a.vertexShader=this.vertexShader,a.fragmentShader=this.fragmentShader,a.extensionDerivatives=!0===this.extensions.derivatives,a.extensionFragDepth=!0===this.extensions.fragDepth,a.extensionDrawBuffers=!0===this.extensions.drawBuffers,a.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(a,b){let c=(a,b,c)=>Math.min(Math.max(a,b),c);for(let d of this.layers)if("displace"===d.type){this.uniformsBackup[`f${d.id}_intensity`]=d.uniforms[`f${d.id}_intensity`].value;let e=c(d.uniforms[`f${d.id}_intensity`].value,a,b);d.uniforms[`f${d.id}_intensity`].value=e}}restoreClampedUniforms(){for(let a of this.layers)"displace"===a.type&&(a.uniforms[`f${a.id}_intensity`].value=this.uniformsBackup[`f${a.id}_intensity`])}customProgramCacheKey(){let a="[";for(let{data:b}of this.data.layers)if("light"===b.type)a+=`"${b.category.toUpperCase()}",`;else{let c=(lS[b.type]??[]).map(a=>b[a]),d=(lT[b.type]??[]).map(a=>b[a]?.length??0),e=[...c,...d];e.length?a+=`["${b.type}", "${e.join('","')}"],`:a+=`"${b.type}",`}return a.slice(0,-1)+"]"}updateFrame(a){for(let b=0;b<this.updaters.length;++b)a.updateNode(this.updaters[b])}build(a){let b=(a=a??{}).builder??new kG;return this.lights="basic"!==this.lightLayer.data.category,b.setMaterial(this,a.renderer),b.build(this.fragment,this.fragment),this.vertexShader=b.getCode("vertex"),this.fragmentShader=b.getCode("fragment"),this.defines=b.defines,this.uniforms=b.uniforms,this.extensions=b.extensions,this.updaters=b.updaters,this.transparent=b.requires.transparent||this.blending>h.NormalBlending,this}dispose(){this.layers.forEach(a=>a.dispose()),super.dispose()}getHash(){let a="{";return a+='"fragment":'+this.fragment.getHash(),a+="}"}};function mf(a){if("TextFrame"!==a.objectType){if(Array.isArray(a.material)){for(let b of a.material)if(0===b.getLayersOfType("outline").length)return}else if(!(a.material instanceof me)||0===a.material.getLayersOfType("outline").length)return;"Mesh2D"===a.objectType?function(a){if(a.geometry.attributes.extrudeNormals||!a.geometry.attributes.position)return;let b=a.geometry.attributes.position.array,c=new Float32Array(b.length),d=new h.Vector3;for(let e=0;e<b.length;e+=3)d.set(b[e],b[e+1],b[e+2]).normalize(),c[e]=d.x,c[e+1]=d.y,c[e+2]=d.z;a.geometry.setAttribute("extrudeNormal",new h.Float32BufferAttribute(c,3))}(a):function(a){if(a.geometry.attributes.extrudeNormal||!a.geometry.attributes.position)return;let b=new Map,c=a.geometry.attributes.position.array,d=a.geometry.attributes.normal.array,e=new Float32Array(c.length);for(let f=0;f<c.length;f+=3){let g=`${c[f]}_${c[f+1]}_${c[f+2]}`,i=new h.Vector3(d[f],d[f+1],d[f+2]);b.has(g)?b.get(g)?.normals.push(i):b.set(g,{normals:[i],result:new h.Vector3})}b.forEach((a,b)=>{for(let c of a.normals)a.result.add(c);a.result.divideScalar(a.normals.length)});for(let j=0;j<c.length;j+=3){let k=b.get(`${c[j]}_${c[j+1]}_${c[j+2]}`)?.result;k&&(e[j]=k.x,e[j+1]=k.y,e[j+2]=k.z)}a.geometry.setAttribute("extrudeNormal",new h.Float32BufferAttribute(e,3))}(a)}}function mg(a){if(!a.geometry.attributes.position)return;let b=a.geometry.attributes.position.array,c=new Float32Array(b.length),d=parseInt(a.uuid.replace(/\D/g,"")),e=[h.MathUtils.seededRandom(d),h.MathUtils.seededRandom(d+1e4),h.MathUtils.seededRandom(d+2e4)];for(let f=0;f<b.length;f++)c[f]=e[f%3];a.geometry.setAttribute("randomColor",new h.BufferAttribute(c,3))}Object.defineProperties(me.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(a){!0===a&&this.version++,this.needsCompile=a},get:function(){return this.needsCompile}}});var mh=class extends jz(h.Mesh){constructor(a,b){super(a,b),this.isAbstractMesh=!0,this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new h.Matrix4,this.booleanExclude=null,Array.isArray(b)&&0===a.groups.length&&a.addGroup(0,a.getAttribute("position").count,0)}get isGroup(){return!0===this._cloner?.parameters.hideBase}get isMesh(){return!this.isGroup}set isMesh(a){}get cloner(){return this._cloner}set cloner(a){this._cloner&&this.remove(this._cloner),a&&this.add(a),this._cloner=a}updateGeometry(a){let b=this.geometry,c=mJ[b.userData.type],d="NonParametric"===this.objectType?Object.assign({},b.userData,{geometry:b}):b.userData,e=c.build(c.normalizeInputs(a,d)),f=b.uuid;this.geometry.dispose(),this.geometry=e,this.geometry.uuid=f,this.geometry.computeBoundingSphere(),mf(this),b.getAttribute("randomColor")&&mg(this)}clone(a){let b=mK("NonParametric"===this.objectType?Object.assign({},this.geometry.userData,{geometry:this.geometry.clone()}):this.geometry.userData),c=this.material;return new this.constructor(b,c).copy(this,a)}copy(a,b=!0){return super.copy(a,b),a.cloner&&(this.cloner=new jC(a,a.cloner.parameters),this.add(this.cloner)),this}setFromClonerState(a){null===a?this.cloner=void 0:(void 0===this.cloner&&(this.cloner=new jC(this)),this.cloner.fromClonerState(a))}fromState(a,b){return super.fromState(a),"Mesh"===a.type&&(this.setFromClonerState(a.cloner),this.castShadow=a.castShadow?? !0,this.receiveShadow=a.receiveShadow?? !0,this.booleanExclude=a.booleanExclude??null),this}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(mB.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(a=!1){return a?this.booleanWasTransformed=!0:this.freeBooleanPointer(),jk(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){for(let a of(this.freeBooleanPointer(),this.children))jj(a)&&(a.freeBooleanPointer(),jk(a)&&a.invalidateUpstreamBooleanData())}},mi=new h.Vector3(0,0,1),mj=new h.Vector3,mk=new h.Vector3,ml=new h.Matrix3,mm=class extends mh{constructor(a=h5.create({}),b){super(a,b),this.recursiveSelection=!1,this.objectType="VectorObject",this.eventDispatcher=new h.EventDispatcher,this._onShapeUpdate=()=>{this.updateGeometry({}),this.geometry.computeBoundingSphere(),this.geometry.computeBoundingBox()},this.castShadow=!0,this.receiveShadow=!0,this.forceComputeSize=!0,this.shape=a.userData.shape,this.shape.eventDispatcher?.addEventListener("update",this._onShapeUpdate)}fromState(a){return super.fromState(a),this.shape.update(),this}setHelperVisibility(){}updateGeometry(a){if(super.updateGeometry(a),"userData"in this.geometry){let b=this.geometry.userData.parameters;this.eventDispatcher.dispatchEvent({type:"geometryUpdate",parameters:b})}}setShape(a){this.shape&&this.shape.eventDispatcher?.removeEventListener("update",this._onShapeUpdate),this.shape=a,this.shape.eventDispatcher?.addEventListener("update",this._onShapeUpdate)}updateWorldMatrix(a,b){super.updateWorldMatrix(a,b),ml.getNormalMatrix(this.matrixWorld),mj.copy(mi).applyMatrix3(ml).normalize(),mk.setFromMatrixPosition(this.matrixWorld),this.shape.plane.setFromNormalAndCoplanarPoint(mj,mk)}clone(a){let b=this.shape.clone(),c=this.material,d=this.geometry.userData,e=h5.create(Object.assign({},d,{shape:b})),f=new mm(e,c).copy(this,a);return f.shape=b,b.update(),f}raycast(a,b){mh.prototype.raycast.call(this,a,b)}};function mn(a){let b={parameters:a,type:a.type};if("VectorGeometry"===a.type){let c=hI.createFromState(a.shape,a.width,a.height);b.shape=c}else"NonParametricGeometry"===a.type&&(a.data.groups&&a.data.groups.forEach(a=>a.materialIndex=Math.max(a.materialIndex??0,0)),b.geometry=new h.BufferGeometryLoader().parse(a));let d;try{d=mK(b)}catch(e){console.error(e)}if(!d){let f=hI.createFromState(iY.defaultData(),100,100);b.shape=f,d=mK(b)}return d}jg.then(a=>{mz=a});var mo=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),mp=new Uint32Array([0,1,2,3]),mq=new Uint8Array([4]),mr=class{static build(a,b,c,d,e){let f,g,h,i=(a?.phongAngle??b?.phongAngle)??35;if(!1===d&&(i=-1),void 0!==a.positionWASM){c&&0!==c&&(mz.free_bvh(c),mz.free_subdivision_surface(c));try{f=mr.allocate(a,e)}catch(j){console.error(j,a),f=mr.allocate({positionWASM:mo,indexWASM:mp,verticesPerFaceWASM:mq},e)}mz.set_destination_refinement_level(f,0),g=mr.buildLevel(f,!0,i)}else f=c,void 0!==a.phongAngle&&(g=mr.buildLevel(f,!0,i));return void 0!==a.subdivisions&&(mz.set_destination_refinement_level(f,a.subdivisions),h=a.subdivisions>0?mr.buildLevel(f,!1,i):null),{subdivPointer:f,originalGeometry:g,subdividedGeometry:h}}static primitiveToQuads(a,b){var c;a.widthSegments>16&&(a.widthSegments=16),a.heightSegments>16&&(a.heightSegments=16),a.depthSegments>16&&(a.depthSegments=16),a.radialSegments>16&&(a.radialSegments=16),"DodecahedronGeometry"===a.type&&(a.detail=0);let d=void 0!==a.shape?b.geometry:mn(c=a),e,f,g,h;({positions:e,triIndices:h}=mt(d.getAttribute("position"),d.getIndex()));let i;if("CylinderGeometry"===a.type&&0===a.cornerRadius&&0===a.hollow&& !1===a.openEnded){let j=a.radialSegments*a.heightSegments*6,k=j+3*a.radialSegments;i=[j,k]}return{indices:f,verticesPerFace:g}=my(e,h,d,i),{positions:e,indices:f,verticesPerFace:g}}static allocate(a,b){let c,d,e,f=[],g=[];a.positionWASM&&a.positionWASM.length>0?(c=a.positionWASM,d=a.indexWASM,e=a.verticesPerFaceWASM):(c=mo,d=mp,e=mq);let i=c.length,j=d.length,k=e.length,l=c.length+f.length+g.length,m=d.length+e.length,n=l*Float32Array.BYTES_PER_ELEMENT+m*Uint32Array.BYTES_PER_ELEMENT,o=l*Float32Array.BYTES_PER_ELEMENT,p=(Uint32Array.BYTES_PER_ELEMENT,mz._malloc(n)),q=new Float32Array(mz.HEAPF32.buffer,p,l),r=new Uint32Array(mz.HEAPU32.buffer,p+o,m);q.set(c,0),q.set(f,c.length),q.set(g,c.length+f.length),r.set(d,0),r.set(e,d.length);let s;a?.scaleBaked?.some(a=>1!==a)&&(s=new h.Matrix4().makeScale(...a.scaleBaked)),b&&(s?s.premultiply(b):s=b);let t=s?mz.alloc_subdivision_surface2(p,i,p+o,j,p+o+d.length*Uint32Array.BYTES_PER_ELEMENT,k,s.elements):mz.alloc_subdivision_surface(p,i,p+o,j,p+o+d.length*Uint32Array.BYTES_PER_ELEMENT,k);return mz._free(p),t}static buildLevel(a,b,c,d,e){let f=e?mz.get_mesh_data2(a,b?mz.Level.CONTROL:mz.Level.REFINED,c,e.elements):mz.get_mesh_data(a,b?mz.Level.CONTROL:mz.Level.REFINED,c),g=8,i=mz.HEAPU32.subarray(f>>2,(f>>2)+g),j=i.subarray(4,8),k=0,l=mz.HEAPU32[i[k]>>2],m=mz.HEAPF32.subarray(l>>2,(l>>2)+j[k]);k++;let n=mz.HEAPU32[i[k]>>2],o=mz.HEAPF32.subarray(n>>2,(n>>2)+j[k]);k++;let p=mz.HEAPU32[i[k]>>2],q=mz.HEAPU32.subarray(p>>2,(p>>2)+j[k]);k++;let r=mz.HEAPU32[i[k]>>2],s=mz.HEAPU32.subarray(r>>2,(r>>2)+j[k]);if(k++,void 0===d){let t=new h.BufferGeometry;if(t.setIndex(new h.Uint32BufferAttribute(s,1)),t.setAttribute("position",new h.Float32BufferAttribute(m,3)),t.setAttribute("normal",new h.Float32BufferAttribute(o,3)),b){t.setAttribute("faceMap",new h.Uint32BufferAttribute(q,1));let u=new Float32Array(o.length/3*4).fill(0);t.setAttribute("color",new h.BufferAttribute(u,4))}return mz.free_mesh_data(f),t.userData.type="SubdivGeometry",t}d.getAttribute("position").copyArray(m),d.getAttribute("normal").copyArray(o),d.attributes.position.needsUpdate=!0,d.attributes.normal.needsUpdate=!0,mz.free_mesh_data(f)}static buildControlCageWireframe(a,b,c){let d=mz.get_wireframe_data_for_base_level(a),e=4,f=mz.HEAPU32.subarray(d>>2,(d>>2)+e),g=f.subarray(2,4),i=0,j=mz.HEAPU32[f[i]>>2],k=mz.HEAPF32.subarray(j>>2,(j>>2)+g[i]);i++;let l=mz.HEAPU32[f[i]>>2],m=mz.HEAPU32.subarray(l>>2,(l>>2)+g[i]);if(void 0===b){let n=new h.BufferGeometry;n.setAttribute("position",new h.Float32BufferAttribute(k,3));let o=new Float32Array(k.length);for(let p=0,q=k.length;p<q;)o[p++]=c.r,o[p++]=c.g,o[p++]=c.b;return n.setAttribute("color",new h.BufferAttribute(o,3)),n.setIndex(new h.Uint32BufferAttribute(m,1)),mz.free_wireframe_data_for_base_level(d),n}b.getAttribute("position").copyArray(k),b.attributes.position.needsUpdate=!0,mz.free_wireframe_data_for_base_level(d)}static updateCollabMesh(a,b,c){let d=0===b;d||mz.set_destination_refinement_level(a,b);let e=c?mz.get_topological_data2(a,d?mz.Level.CONTROL:mz.Level.REFINED,c.elements):mz.get_topological_data(a,d?mz.Level.CONTROL:mz.Level.REFINED),f=6,g=mz.HEAPU32.subarray(e>>2,(e>>2)+f),h=g.subarray(3,6),i=0,j=mz.HEAPU32[g[i]>>2],k=new Float32Array(mz.HEAPF32.subarray(j>>2,(j>>2)+h[i]));i++;let l=mz.HEAPU32[g[i]>>2],m=new Uint32Array(mz.HEAPU32.subarray(l>>2,(l>>2)+h[i]));i++;let n=mz.HEAPU32[g[i]>>2],o=new Uint8Array(mz.HEAPU32.subarray(n>>2,(n>>2)+h[i]));return mz.free_topological_data(e),{positions:k,indices:m,verticesPerFace:o}}},ms=["getX","getY","getZ"];function mt(a,b){let c={},d=b?b.count:a.count,e=0,f=[],g=[];for(let h=0;h<d;h++){let i=b?b.getX(h):h,j="";for(let k=0;k<3;k++)j+=`${~~(1e4*a[ms[k]](i))},`;if(j in c)f.push(c[j]);else{for(let l=0;l<3;l++)g.push(a[ms[l]](i));c[j]=e,f.push(e),e++}}let m=[];for(let n=0;n<f.length;n+=3)f[n]===f[n+1]||f[n]===f[n+2]||f[n+1]===f[n+2]||m.push(f[n],f[n+1],f[n+2]);return{positions:g,triIndices:m}}var mu=new h.Vector3,mv=new h.Vector3,mw=new h.Vector3,mx=new h.Vector3;function my(a,b,c,d){let e=[],f=[];if(void 0!==c.userData.shape&&0===c.userData.parameters.depth&&0===c.userData.shape.shapeHoles.length){let g=c.userData.shape.extractShapePointsToFlatArray([]),h=0;for(let i=0;i<g.length;i+=2)h+=(g[i]-g[(0===i?g.length:i)-2])*(g[i+1]+g[(0===i?g.length:i)-1]);a.length=0;let j=0;if(h<0)for(let k=0;k<g.length;k+=2)a.push(g[k],g[k+1],0),e.push(j++);else for(let l=g.length-2;l>=0;l-=2)a.push(g[l],g[l+1],0),e.push(j++);return f.push(j),{indices:e,verticesPerFace:f}}for(let m=0,n=c.capStartIndex??b.length;m<n;)if(b[m+1]===b[m+3]&&b[m+2]===b[m+5]||b[m+0]===b[m+3]&&b[m+2]===b[m+4]){mu.set(a[3*b[m]],a[3*b[m]+1],a[3*b[m]+2]),mv.set(a[3*b[m+1]],a[3*b[m+1]+1],a[3*b[m+1]+2]),mw.set(a[3*b[m+4]],a[3*b[m+4]+1],a[3*b[m+4]+2]),mx.set(a[3*b[m+5]],a[3*b[m+5]+1],a[3*b[m+5]+2]),mv.sub(mu).normalize(),mw.sub(mu).normalize(),mx.sub(mu).normalize();Math.abs(mv.cross(mw).dot(mx))>.005||d&&d.some((a,b)=>b%2!=1&&m>=d[b]&&m<d[b+1])?(e.push(b[m],b[m+1],b[m+2]),f.push(3),m+=3):(e.push(b[m],b[m+1],b[m+4],b[m+5]),f.push(4),m+=6)}else e.push(b[m],b[m+1],b[m+2]),f.push(3),m+=3;if(void 0!==c.capStartIndex){let o=[],p=[],q=0,r=new Float32Array([c.userData.parameters.depth])[0];for(let s=0,t=0;s<a.length;s+=3,t++)0===a[s+2]&&(o.push(t),q++),a[s+2]===r&&p.push(t);if(0===c.userData.parameters.extrudeBevelSize){let u=p[0];p[0]=p[1],p[1]=u}o.reverse(),e.push(...o,...p),f.push(q,q)}return{indices:e,verticesPerFace:f}}var mz,mA,mB={};function mC(a){let b=a.length,c=b*Uint32Array.BYTES_PER_ELEMENT,e=b*Float32Array.BYTES_PER_ELEMENT,f=Number.isInteger(a[0])?c:e,g=d._malloc(f);return(Number.isInteger(a[0])?new Uint32Array(d.HEAPU32.buffer,g,b):new Float32Array(d.HEAPF32.buffer,g,b)).set(a,0),g}function mD(a){switch(a){case 0:return d.OP.UNION;case 1:return d.OP.INTERSECTION;case 2:return d.OP.A_MINUS_B;case 3:return d.OP.B_MINUS_A;case 4:return d.OP.SYMMETRIC_DIFFERENCE;case 5:return d.OP.ALL;default:throw Error("Unknown boolean operation "+a)}}function mE(a,b){void 0===e&&(e=d.init_csg());let c=mC(a),f=d.csg_calc_topological(e,c,a.length,mD(b));d._free(c);let g=6,h=d.HEAPU32.subarray(f>>2,(f>>2)+g),i=h.subarray(3,6),j=0,k=d.HEAPU32[h[j]>>2],l=new Float32Array(d.HEAPF32.subarray(k>>2,(k>>2)+i[j]));j++;let m=d.HEAPU32[h[j]>>2],n=new Uint32Array(d.HEAPU32.subarray(m>>2,(m>>2)+i[j]));j++;let o=d.HEAPU32[h[j]>>2],p=new Uint8Array(d.HEAPU32.subarray(o>>2,(o>>2)+i[j]));return d.free_mesh_data(f),{positions:l,indices:n,verticesPerFace:p}}function mF(a,b,c,f){void 0===e&&(e=d.init_csg());let g=mC(a),i=d.csg_calc(e,g,a.length,f,mD(b));d._free(g);let j=5,k=d.HEAPU32.subarray(i>>2,(i>>2)+j),l=k.subarray(2,5),m=0,n=d.HEAPU32[k[m]>>2],o=d.HEAPF32.subarray(n>>2,(n>>2)+l[m]);m++;let p=d.HEAPU32[k[m]>>2],q=d.HEAPF32.subarray(p>>2,(p>>2)+l[m]),r=l[++m];c.setAttribute("position",new h.Float32BufferAttribute(o,3)),c.setAttribute("normal",new h.Float32BufferAttribute(q,3));let s=d.HEAPF32.subarray((i>>2)+5,(i>>2)+5+6);return null===c.boundingSphere&&(c.boundingSphere=new h.Sphere),c.boundingSphere.center.set(s[0],s[1],s[2]),c.boundingSphere.radius=(s[3]**2+s[4]**2+s[5]**2)**.5,c.userData.parameters={width:2*s[3],height:2*s[4],depth:2*s[5]},d.free_mesh_data(i),r}function mG(a,b,c){if(void 0===d)return -1;let e,f,g;if(b&& void 0!==a.userData.positions){let h=a.userData;g=h.verticesPerFace.length,e=h.positions,f=Array(h.verticesPerFace.reduce((a,b)=>a+b,0)+g);for(let i=0,j=0,k=0;i<h.verticesPerFace.length;i++){f[k++]=h.verticesPerFace[i];for(let l=0;l<h.verticesPerFace[i];l++)f[k++]=h.indices[j++]}}else({positions:e,faceIndices:f,nFaces:g}=function(a,b,c){let d,{positions:e,triIndices:f}=mt(a.getAttribute("position"),a.getIndex()),g;if(b&&c){let{indices:h,verticesPerFace:i}=my(e,f,a);g=i.length,d=[];for(let j=0,k=0;j<g;j++){d.push(i[j]);for(let l=0;l<i[j];l++)d.push(h[k++])}}else{let m=f.length;d=Array(m+m/3),g=0;for(let n=0,o=0;o<d.length;)d[o++]=3,g++,d[o++]=f[n++],d[o++]=f[n++],d[o++]=f[n++]}return{positions:e,faceIndices:d,nFaces:g}}(a,b,c));let m=e.length,n=f.length,o=e.length,p=f.length,q=o*Float32Array.BYTES_PER_ELEMENT+p*Uint32Array.BYTES_PER_ELEMENT,r=o*Float32Array.BYTES_PER_ELEMENT,s=(Uint32Array.BYTES_PER_ELEMENT,d._malloc(q)),t=new Float32Array(d.HEAPF32.buffer,s,o),u=new Uint32Array(d.HEAPU32.buffer,s+r,p);return t.set(e,0),u.set(f,0),d.get_csg_mesh(s,m,s+r,n,g)}function mH(a,b){d.transform_csg_mesh(a,b.elements)}function mI(a){d.free_csg_mesh(a)}u(mB,{calcBoolean:()=>mF,calcBooleanTopological:()=>mE,freeMeshSet:()=>mI,getMeshSet:()=>mG,transformMeshSet:()=>mH}),new Promise(a=>{mA=a}).then(a=>d=a);var mJ={ConeGeometry:g4,CubeGeometry:g5,CylinderGeometry:g0,DodecahedronGeometry:g9,EllipseGeometry:h7,HelixGeometry:ii,IcosahedronGeometry:ik,LatheGeometry:im,NonParametricGeometry:iD,PolygonGeometry:iE,PyramidGeometry:iF,RectangleGeometry:iK,SphereGeometry:iL,PlaneGeometry:iM,BackdropGeometry:iN,StarGeometry:iP,TextFrameGeometry:iQ,TorusGeometry:iR,TorusKnotGeometry:je,TriangleGeometry:jf,VectorGeometry:h5},mK=a=>mJ[a.type].create(a),mL=new h.Matrix4,mM=class extends mh{constructor(a=new h.BufferGeometry,b){super(a,b),this.booleanOp=2,this.phongAngle=35,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.objectType="BooleanObject",this.castShadow=!0,this.receiveShadow=!0,this.geometry.userData.parameters={width:0,height:0,depth:0},this.onAfterRender=this.recomputeBoolean.bind(this)}reInit(){this.objectType="BooleanObject",this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry.userData.parameters={width:0,height:0,depth:0},this.onAfterRender=this.recomputeBoolean.bind(this)}recomputeBoolean(a,b=!0){if(-1!==this.booleanMeshSetAddress)return;for(let c=0;c<this.children.length;c++){let d=this.children[c];jk(d)&&d.recomputeBoolean(!0===a,b)}this.meshSetAddresses=[];for(let e=0;e<this.children.length;e++){let f=this.children[e];if(jy(f)&& !1===f.booleanExclude&&f.geometry.attributes.position?.count>0&&f.geometry.drawRange.count>0){if(-1===f.booleanMeshSetAddress){if(f.geometry.index&&f.geometry.index.count/3<15e5&&(f.booleanMeshSetAddress=mB.getMeshSet(f.geometry,!0===a,b)),-1===f.booleanMeshSetAddress)return;mB.transformMeshSet(f.booleanMeshSetAddress,f.matrix),f.booleanMatrixInvOld.copy(f.matrix).invert(),f.booleanWasTransformed=!1}else jk(f)&& !0===f.needsTransformForDownstream?(mB.transformMeshSet(f.booleanMeshSetAddress,f.matrix),f.needsTransformForDownstream=!1):!0===f.booleanWasTransformed&&(mL.multiplyMatrices(f.matrix,f.booleanMatrixInvOld),mB.transformMeshSet(f.booleanMeshSetAddress,mL),f.booleanMatrixInvOld.copy(f.matrix).invert(),f.booleanWasTransformed=!1);this.meshSetAddresses.push(f.booleanMeshSetAddress)}}if(0===this.meshSetAddresses.length){this.geometry.setDrawRange(0,0);return}if(!0===a)return mB.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let g=this.geometry;g.dispose(),this.geometry=new h.BufferGeometry,this.geometry.userData=g.userData,this.geometry.boundingSphere=g.boundingSphere;try{this.booleanMeshSetAddress=mB.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(i){this.booleanMeshSetAddress=0,console.error(i)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,mf(this),mg(this)}updateGeometry(a){let b=a.parameters;void 0!==b.operation&&(this.booleanOp=b.operation),void 0!==b.phongAngle&&(this.phongAngle=b.phongAngle),this.invalidateDownstreamBooleanData().recomputeBoolean()}},mN=a=>{var b;return(b=class extends a{constructor(){super(...arguments),this.isObjectHelper=!0}}).geometryHelper=new h.BoxBufferGeometry(30,30,30),b},mO=new h.Ray,mP=new h.Sphere,mQ=new h.Matrix4,mR=(a,b,c,d,e=!1)=>{let f=b,g=a.matrixWorld;if(null===f.boundingSphere&&f.computeBoundingSphere(),mP.copy(f.boundingSphere),mP.applyMatrix4(g),!1===c.ray.intersectsSphere(mP)||(mQ.copy(g).invert(),mO.copy(c.ray).applyMatrix4(mQ),null!==f.boundingBox&& !1===mO.intersectsBox(f.boundingBox)))return;let i,j,k,l,m=f.index,n=f.attributes.position,o=f.drawRange,p,q;if(!1===e){let r=Math.max(0,o.start),s=Math.min(m.count,o.start+o.count);for(p=r,q=s;p<q;p+=3)if(j=m.getX(p),k=m.getX(p+1),l=m.getX(p+2),i=G(a,c,mO,n,j,k,l)){i.faceIndex=Math.floor(p/3),d.push(i);return}}else{let t=f.attributes.position,u=new h.Vector3,v=new h.Vector3,w=new h.Vector3,x=new h.Vector3,y=2,z=1/((a.scale.x+a.scale.y+a.scale.z)/3),A=z*z,B=Math.max(0,o.start),C=Math.min(t.count,o.start+o.count);for(let D=B,E=C-1;D<E;D+=y){if(u.fromBufferAttribute(t,D),v.fromBufferAttribute(t,D+1),mO.distanceSqToSegment(u,v,x,w)>A)continue;x.applyMatrix4(a.matrixWorld);let F=c.ray.origin.distanceTo(x);F<c.near||F>c.far||d.push({distance:F,point:w.clone().applyMatrix4(a.matrixWorld),object:a})}}function G(a,b,c,d,e,f,g){let i=new h.Vector3,j=new h.Vector3,k=new h.Vector3,l=new h.Vector3,m=new h.Vector3;if(i.fromBufferAttribute(d,e),j.fromBufferAttribute(d,f),k.fromBufferAttribute(d,g),null===c.intersectTriangle(i,j,k,!1,l))return null;m.copy(l),m.applyMatrix4(a.matrixWorld);let n=b.ray.origin.distanceTo(m);return n<b.near||n>b.far?null:{faceIndex:1,distance:n,point:m.clone(),object:a}}},mS=new h.Vector3,mT=new h.Camera,mU=class extends h.LineSegments{constructor(a){let b=new h.BufferGeometry,c=new h.LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),d=[],e=[],f={},g=new h.Color(15711266),i=new h.Color(15711266),j=new h.Color(2857471);function k(a,b,c){l(a,c),l(b,c)}function l(a,b){d.push(0,0,0),e.push(b.r,b.g,b.b),void 0===f[a]&&(f[a]=[]),f[a].push(d.length/3-1)}k("n1","n2",g),k("n2","n4",g),k("n4","n3",g),k("n3","n1",g),k("f1","f2",g),k("f2","f4",g),k("f4","f3",g),k("f3","f1",g),k("n1","f1",g),k("n2","f2",g),k("n3","f3",g),k("n4","f4",g),k("p","n1",i),k("p","n2",i),k("p","n3",i),k("p","n4",i),k("u1","u2",j),k("u2","u3",j),k("u3","u1",j),b.setAttribute("position",new h.Float32BufferAttribute(d,3)),b.setAttribute("color",new h.Float32BufferAttribute(e,3)),super(b,c),this.type="CameraHelper",this.camera=a,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=f,this.update()}update(){let a=this.geometry,b=this.pointMap;mT.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];mV("n1",b,a,mT,-1,-1,.8),mV("n2",b,a,mT,1,-1,.8),mV("n3",b,a,mT,-1,1,.8),mV("n4",b,a,mT,1,1,.8);mV("f1",b,a,mT,-1,-1,.8),mV("f2",b,a,mT,1,-1,.8),mV("f3",b,a,mT,-1,1,.8),mV("f4",b,a,mT,1,1,.8);mV("u1",b,a,mT,.35,1.1,.8),mV("u2",b,a,mT,-.35,1.1,.8),mV("u3",b,a,mT,0,1.55,.8),a.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function mV(a,b,c,d,e,f,g){mS.set(e,f,g).unproject(d);let h=b[a];if(void 0!==h){let i=c.getAttribute("position");for(let j=0,k=h.length;j<k;j++)i.setXYZ(h[j],mS.x,mS.y,mS.z)}}var mW=class extends mN(mU){constructor(a){super(a),this.object=a,this.object=a,this.name=`CombinedCameraHelper: ${a.uuid}`}updateMatrixWorld(a){super.updateMatrixWorld(a),this.updateTarget()}updateTarget(){let a=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(a)}raycast(a,b){mR(this.object,this.geometry,a,b,!0)}},mX=class extends mN(h.DirectionalLightHelper){constructor(a,b=15,c=10066329){super(a,b,c),this.object=a,this.added=!1,this.name=`DirectionalLightHelper: ${a.uuid}`}raycast(a,b){mR(this.object,mX.geometryHelper,a,b)}},mY=class extends mN(h.AxesHelper){constructor(a,b=15){super(b),this.object=a,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${a.uuid}`,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1}raycast(a,b){mR(this.object,mY.geometryHelper,a,b)}update(){}},mZ=class extends mN(h.PointLightHelper){constructor(a,b=15,c=6710886){super(a,b,c),this.object=a,this.name=`PointLightHelper: ${a.uuid}`}raycast(a,b){mR(this.object,mZ.geometryHelper,a,b)}},m$=class extends mN(h.SpotLightHelper){constructor(a,b=6710886){super(a,b),this.object=a,this.name=`SpotLightHelper: ${a.uuid}`}raycast(a,b){mR(this.object,m$.geometryHelper,a,b)}update(){if(void 0!==this.object){let a=m$._vector,b=this.object.distance?this.object.distance:1e3,c=b*Math.tan(this.object.angle);this.cone.scale.set(c,c,b),a.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(a);let d=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let e=0,f=this.cone.material.length;e<f;e++)this.cone.material[e].color.set(d);else this.cone.material.color.set(d)}}},m_=m$;m_._vector=new h.Vector3;var m0=(a,b)=>class extends a{constructor(){super(...arguments),this.objectHelper=new b(this)}get geometryHelper(){return b.geometryHelper}raycast(a,b){this.objectHelper.raycast(a,b)}fromLightState(a,b){if("LightDirectional"===this.objectType||"LightPoint"===this.objectType||"LightSpot"===this.objectType){let c=this;void 0!==a.color&&(c.color=jh(a.color,b)),void 0!==a.intensity&&(c.intensity=a.intensity),void 0!==a.depth&&(c.shadow.camera.far=a.depth,c.shadow.needsUpdate=!0),void 0!==a.shadows&&(this.castShadow=a.shadows)}return this}},m1=new h.Vector3,m2=new h.Vector3,m3=class extends m0(jz(h.Camera),mW){constructor(a=window.innerWidth,b=window.innerHeight,c=45,d,e=1e5){super(),this.objectType="CombinedCamera",this._cameraType="OrthographicCamera",this.targetOffset=eV.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.width=a,this.height=b,this.orthoCamera=new h.OrthographicCamera(-.5*a,.5*a,.5*b,-.5*b,d?? -5e4,e),this.perspCamera=new h.PerspectiveCamera(c,a/b,d??50,e),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.fov=this.perspCamera.fov,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.toOrthographic()}static createFromState(a,b){let c=new m3().fromState(b);return c.objectHelper.update(),c.uuid=a,c}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}setNear(a,b){"PerspectiveCamera"===a?this.perspCamera.near=b:this.orthoCamera.near=b}setZoom(a,b){b>=0&&("PerspectiveCamera"===a?this.perspCamera.zoom=b:this.orthoCamera.zoom=b)}set cameraType(a){"PerspectiveCamera"===a?this.toPerspective():"OrthographicCamera"===a&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(a){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=a:this.orthoCamera.near=a}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(a){a>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=a:this.orthoCamera.zoom=a)}lookAt(a){super.lookAt(a),this.getWorldPosition(m1),this.targetOffset=m1.distanceTo(a)}getTarget(a=new h.Vector3){return this.getWorldDirection(m2),this.getWorldPosition(m1),m2.multiplyScalar(this.targetOffset),a.copy(m1).add(m2),a}getDistanceToTarget(){let a=this.getTarget();return this.getWorldPosition(m1),m1.distanceTo(a)}updateUp(){let a=this.getWorldQuaternion(new h.Quaternion),b=new h.Vector3(0,0,1).applyQuaternion(a),c=new h.Vector3().copy(h.Object3D.DefaultUp);this.isUpVectorFlipped&&c.negate(),c.applyQuaternion(a);let d=new h.Vector3().copy(h.Object3D.DefaultUp).projectOnPlane(b),e=new h.Vector3().crossVectors(d,c).dot(b)>=0?1:-1;this.angleOffsetFromUp=d.angleTo(c)*e}getViewFrontToObject(a){let b=a.getWorldPosition(new h.Vector3),c=a.getWorldDirection(new h.Vector3).multiplyScalar(this.targetOffset);return{position:b.clone().add(c),target:b}}getViewToObject(a){let b=a.getWorldPosition(new h.Vector3),c=this.getWorldDirection(new h.Vector3).multiplyScalar(this.targetOffset);return{position:b.clone().sub(c),target:b}}setViewplaneSize(a,b){this.left=-(.5*a),this.right=.5*a,this.top=.5*b,this.bottom=-(.5*b),this.aspect=a/b,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(a){this.perspCamera.setFocalLength(a),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(a,b,c,d,e,f){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(a,b,c,d,e,f):this.orthoCamera.setViewOffset(a,b,c,d,e,f)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,b){super.updateWorldMatrix(a,b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(a,b){return super.copy(a,b),this.orthoCamera.copy(a.orthoCamera),this.perspCamera.copy(a.perspCamera),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.far=a.far,this.view=null===a.view?null:Object.assign({},a.view),this._cameraType=a._cameraType,this.aspect=a.aspect,this.fov=a.fov,this.focus=a.focus,this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this.targetOffset=a.targetOffset,this.updateProjectionMatrix(),this}toCameraState(a=[]){return em({type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped},a)}fromCameraState(a){let{orthographic:b,perspective:c}=a;return void 0!==a.type&&(this.cameraType=a.type),void 0!==a.far&&(this.far=a.far),void 0!==b&&(void 0!==b.near&&(this.orthoCamera.near=b.near),void 0!==b.zoom&&(this.orthoCamera.zoom=b.zoom)),void 0!==c&&(void 0!==c.near&&(this.perspCamera.near=c.near),void 0!==c.fov&&(this.perspCamera.fov=c.fov),void 0!==c.zoom&&(this.perspCamera.zoom=c.zoom)),"PerspectiveCamera"===a.type?(this.zoom=this.perspCamera.zoom,this.fov=this.perspCamera.fov,this.near=this.perspCamera.near):(this.near=this.orthoCamera.near,this.zoom=this.orthoCamera.zoom),void 0!==a.up&&this.up.fromArray(a.up),void 0!==a.targetOffset&&(this.targetOffset=a.targetOffset),void 0!==a.isUpVectorFlipped&&(this.isUpVectorFlipped=a.isUpVectorFlipped),this.updateProjectionMatrix(),this}toState(a){return{...super.toState(a),...this.toCameraState(a),type:this.cameraType}}fromState(a){return super.fromState(a),this.fromCameraState(a),this}},m4=class extends m0(jz(h.Group),mY){constructor(){super(...arguments),this.objectType="EmptyObject"}static createFromState(a,b){let c=new m4().fromState(b);return c.uuid=a,c.objectHelper.update(),c}},m5=class extends m0(jz(h.DirectionalLight),mX){constructor(...a){super(...a),this.objectType="LightDirectional",this._gizmos={},this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let b=this.shadow.camera;b.top=1250,b.bottom=-1250,b.right=1250,b.left=-1250,b.near=-1e4,b.far=2500;let c=new h.CameraHelper(this.shadow.camera);c.visible=!1,this._gizmos.shadowmap=c,this.update()}static createFromState(a,b,c){let d=new m5().fromState(b,c);return d.uuid=a,d}get gizmos(){return this._gizmos}showGizmos(){for(let a in this._gizmos){let b=this._gizmos[a];b instanceof h.CameraHelper&&(b.visible=!0)}}hideGizmos(){for(let a in this._gizmos){let b=this._gizmos[a];b instanceof h.CameraHelper&&(b.visible=!1)}}update(){for(let a in this.shadow.camera.updateProjectionMatrix(),this._gizmos){let b=this._gizmos[a];b instanceof h.CameraHelper&&b.update()}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.objectHelper&&this.objectHelper.update()}fromDirectionalLightState(a,b){var c,d;let e=void 0!==a.depth&&a.depth!==this.shadow.camera.far|| void 0!==a.size&&a.size/2!==this.shadow.camera.right;return super.fromLightState(a,b),void 0!==a.size&&(c=this,d=a.size,c.shadow.camera.right=d/2,c.shadow.camera.left=-d/2,c.shadow.camera.top=d/2,c.shadow.camera.bottom=-d/2,c.shadow.needsUpdate=!0),void 0!==a.shadowRadius&&(this.shadow.radius=a.shadowRadius),void 0!==a.shadowResolution&&(this.shadow.mapSize.set(a.shadowResolution,a.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e&&this.update(),this}fromState(a,b){return super.fromState(a),this.fromDirectionalLightState(a,b),this}},m6=class extends m0(jz(h.PointLight),mZ){constructor(...a){super(...a),this.objectType="LightPoint",this._gizmos={},this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let b=this.shadow.camera;b.fov=90,b.aspect=1,b.near=100,b.far=2500;let c=new h.Vector3(-b.far+this.position.x,-b.far+this.position.y,-b.far+this.position.z),d=new h.Vector3(b.far+this.position.x,b.far+this.position.y,b.far+this.position.z),e=new h.Box3(c,d),f=new h.Box3Helper(e,new h.Color(16755200));f.visible=!1,this._gizmos.shadowmap=f,this.update()}static createFromState(a,b,c){let d=new m6().fromState(b,c);return d.uuid=a,d}get gizmos(){return this._gizmos}showGizmos(){for(let a in this._gizmos){let b=this._gizmos[a];b instanceof h.Box3Helper&&(b.visible=!0)}}hideGizmos(){for(let a in this._gizmos){let b=this._gizmos[a];b instanceof h.Box3Helper&&(b.visible=!1)}}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this._gizmos))for(let a in this._gizmos){let b=this._gizmos[a];if(b instanceof h.Box3Helper){let c=this.shadow.camera,d=new h.Vector3(-c.far+this.position.x,-c.far+this.position.y,-c.far+this.position.z),e=new h.Vector3(c.far+this.position.x,c.far+this.position.y,c.far+this.position.z);b.box.set(d,e),b.updateMatrixWorld(!0)}}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.objectHelper&&this.objectHelper.update()}fromPointLightState(a,b){return super.fromLightState(a,b),void 0!==a.distance&&(this.distance=a.distance),void 0!==a.decay&&(this.decay=a.decay),void 0!==a.shadowRadius&&(this.shadow.radius=a.shadowRadius),void 0!==a.shadowResolution&&(this.shadow.mapSize.set(a.shadowResolution,a.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),this}fromState(a,b){return super.fromState(a),this.fromPointLightState(a,b),this}},m7=new h.Vector3,m8=new h.Vector3,m9=new h.Quaternion,na=class extends m0(jz(h.SpotLight),m_){constructor(...a){super(...a),this.objectType="LightSpot",this._gizmos={},this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let b=this.shadow.camera;b.fov=2*h.MathUtils.RAD2DEG*this.angle,b.aspect=1,b.near=100,b.far=2500;let c=new h.CameraHelper(this.shadow.camera);c.visible=!1,this._gizmos.shadowmap=c,this.update()}static createFromState(a,b,c){let d=new na().fromState(b,c);return d.uuid=a,d}get gizmos(){return this._gizmos}showGizmos(){for(let a in this._gizmos){let b=this._gizmos[a];b instanceof h.CameraHelper&&(b.visible=!0)}}hideGizmos(){for(let a in this._gizmos){let b=this._gizmos[a];b instanceof h.CameraHelper&&(b.visible=!1)}}update(){for(let a in this.shadow.camera.updateProjectionMatrix(),this._gizmos){let b=this._gizmos[a];b instanceof h.CameraHelper&&b.update()}}updateMatrixWorld(a){super.updateMatrixWorld(a),m8.setFromMatrixPosition(this.matrixWorld),m9.setFromRotationMatrix(this.matrixWorld),m7.copy(this.up).applyQuaternion(m9).negate().multiplyScalar(this.distance),this.target.position.copy(m8).add(m7),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}fromSpotLightState(a,b){return super.fromLightState(a,b),void 0!==a.distance&&(this.distance=a.distance),void 0!==a.decay&&(this.decay=a.decay),void 0!==a.angle&&(this.angle=a.angle),void 0!==a.penumbra&&(this.penumbra=a.penumbra),void 0!==a.shadowRadius&&(this.shadow.radius=a.shadowRadius),void 0!==a.shadowResolution&&(this.shadow.mapSize.set(a.shadowResolution,a.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),this}fromState(a,b){return super.fromState(a),this.fromSpotLightState(a,b),this}},nb=a=>"VIDEO"===a.tagName,nc=class{static resize(a,b,c){let d=a/b,e;if(!c.image)return;let f=c.image;e=nb(f)?f.videoWidth/f.videoHeight:f.width/f.height,d>e&&("WEBCAM"==c.imageType?c.repeat.set(-1,1*e/d):c.repeat.set(1,1*e/d)),d<e&&("WEBCAM"==c.imageType?c.repeat.set(-(1*d/e*1),1):c.repeat.set(1*d/e,1)),d==e&&("WEBCAM"==c.imageType?c.repeat.set(-1,1):c.repeat.set(1,1))}static resizeTextureLayer(a,b,c){let d=a/b,e=void 0!==c.image?c.image.width/c.image.height:1,f;f=d>e?{x:1,y:e/d}:d<e?{x:d/e,y:1}:{x:1,y:1},c.repeat.set(f.x,f.y),c.updateMatrix()}static resizeTextureLayers(a,b,c){let d=c.layers;for(let e=0;e<d.length;e++){let f=d[e];mb(f)&&nc.resizeTextureLayer(a,b,f.uniforms[`f${f.id}_texture`].value)}}static resizeComplex(a,b,c,d){let e=a/b,f,g=c.image;f=nb(g)?g.videoWidth/g.videoHeight:g.width/g.height,d.geometry.type.includes("Shape")?(e>f&&("WEBCAM"==c.imageType?c.repeat.set(-(1/a*1),1/b*f/e):c.repeat.set(1/a,1/b*f/e)),e<f&&("WEBCAM"==c.imageType?c.repeat.set(-(1/a*e/f*1),1/b):c.repeat.set(1/a*e/f,1/b)),e==f&&("WEBCAM"==c.imageType?c.repeat.set(-(1/a*1),1/b):c.repeat.set(1/a,1/b))):(e>f&&("WEBCAM"==c.imageType?c.repeat.set(-1,1*f/e):c.repeat.set(1,1*f/e)),e<f&&("WEBCAM"==c.imageType?c.repeat.set(-(1*e/f*1),1):c.repeat.set(1*e/f,1)),e==f&&("WEBCAM"==c.imageType?c.repeat.set(-1,1):c.repeat.set(1,1)))}},nd=class extends mh{constructor(a,b){super(a,b),this.objectType="Mesh2D",this.castShadow=!0,this.receiveShadow=!0}updateGeometry(a){super.updateGeometry(a),this.material.layers&&nc.resizeTextureLayers(this.geometry.userData.parameters.width,this.geometry.userData.parameters.height,this.material)}},ne=class extends mh{constructor(a,b){super(a,b),this.objectType="Mesh3D",this.castShadow=!0,this.receiveShadow=!0}},nf=class extends ne{constructor(a,b){super(a,b),this.objectType="NonParametric"}},ng=class extends h.Mesh{constructor({char:a,originalChar:b,fontFamily:c,letterSpacing:d,fontSize:e,LOD:f=16},g=new h.MeshBasicMaterial({color:0,opacity:1,visible:!0,transparent:!0,side:h.DoubleSide})){let i=ng.loadChar(a,c,f);super(i.geometry,g),this.char=a,this.originalChar=b??a,this.fontFamily=c,this.letterSpacing=d,this.fontSize=e,this.LOD=f,this.resolution=i.resolution,this.glyphsHa=i.glyphsHa,this.localPosition=new h.Vector2,this.charSize=0,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}static get FONTS_PATH(){return ng._fontPath}static set FONTS_PATH(a){ng._fontPath=a}updatePosition(a,b){this.localPosition.copy(a);let c=new h.Vector3(this.localPosition.x,-this.localPosition.y,0);this.position.copy(c).add(b)}updateFontSize(a){let b=a/this.resolution;this.fontSize=a,this.scale.set(this.fontSize,this.fontSize,1),this.charSize=this.glyphsHa*b*this.letterSpacing}updateFontFamily(a){if(this.fontFamily===a)return;this.fontFamily=a;let b=ng.loadChar(this.char,a,this.LOD);this.geometry=b.geometry,this.resolution=b.resolution,this.glyphsHa=b.glyphsHa,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}updateChar(a){if(this.char===a)return;this.char=a;let b=ng.loadChar(a,this.fontFamily,this.LOD);this.geometry=b.geometry,this.resolution=b.resolution,this.glyphsHa=b.glyphsHa,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}updateLetterSpacing(a){this.letterSpacing!==a&&(this.letterSpacing=a,this.updateFontSize(this.fontSize))}updateLOD(a){if(this.LOD===a)return;this.LOD=a;let b=ng.loadChar(this.char,this.fontFamily,this.LOD);this.geometry=b.geometry,this.resolution=b.resolution,this.glyphsHa=b.glyphsHa,this.geometry.userData={type:"CharacterGeometry",parameters:{char:this.char,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,lod:this.LOD,resolution:this.resolution,charSize:this.charSize,localPosition:this.localPosition}},this.updateFontSize(this.fontSize)}clone(){let a={char:this.char,originalChar:this.originalChar,fontFamily:this.fontFamily,letterSpacing:this.letterSpacing,fontSize:this.fontSize,LOD:this.LOD};return new ng(a).copy(this)}static loadFont(a){return new Promise(function(b,c){ng.fontCache[a]?b(ng.fontCache[a]):new i.J().load(ng.FONTS_PATH+a+".json",c=>{ng.fontCache[a]=c,b(c)},void 0,c)})}static loadChar(a,b,c){if(ng.charCache[a]){if(ng.charCache[a][c]&&ng.charCache[a][c].fontFamily===b)return ng.charCache[a][c]}else ng.charCache[a]={};let d=ng.fontCache[b],e=d.generateShapes(a,1);return ng.charCache[a][c]={geometry:new h.ShapeBufferGeometry(e,c),fontFamily:b,resolution:d.data.resolution,glyphsHa:d.data.glyphs[a].ha},ng.charCache[a][c]}},nh=ng;nh.charCache={},nh.fontCache={},nh._fontPath="/_assets/_fonts/";var ni=new h.Vector2,nj=class{constructor(a,b,c){this.message=[],this.endLine=!0,this.yLinePos=a,this.lineHeight=b,this.maxCharSize=c,this.nextChar3DPos=new h.Vector2(0,this.yLinePos+this.maxCharSize*this.lineHeight),this.align=1}addChar3D(a,b,c=this.message.length){this.message.splice(c,0,a),a.fontSize>this.maxCharSize?(this.maxCharSize=a.fontSize,this.nextChar3DPos.y=this.yLinePos+this.maxCharSize*this.lineHeight,this.fullUpdate(b)):(a.updatePosition(this.nextChar3DPos,b),this.nextChar3DPos.x+=a.charSize)}deleteChar3D(a=this.message.length-1){let b=this.message[a];if(b)return this.message.splice(a,1),this.nextChar3DPos.x-=b.charSize,b}isEndLine(a){this.endLine=a}fullUpdate(a,b=0){this.nextChar3DPos.x=0;for(let c=b,d=this.message.length;c<d;c+=1)this.message[c].updatePosition(this.nextChar3DPos,a),this.nextChar3DPos.x+=this.message[c].charSize}checkOverFlow(a){let b,c=this.message.length-1;if(c<=0)return!1;for(;c>=0;){if(" "!==this.message[c].char){b=this.message[c];break}c-=1}return!!(c>=0&&b&&b.localPosition.x+b.charSize>a)}containSpaceOverFlow(a=this.message.length-1){for(let b=a;b>=0;b-=1)if(" "===this.message[b].char)return!0;return!1}containSpace(a=this.message.length-1){if(this.endLine)return!0;for(let b=a;b>=0;b-=1)if(" "===this.message[b].char)return!0;return!1}popWord(a=this.message.length-1){let b=[],c=!0,d;for(d=a;d>=0;d-=1)if(" "===this.message[d].char){c=!1,0===b.length&&(d-=1,b.splice(0,0,this.message[d]));break}else b.splice(0,0,this.message[d]);return c?b=[]:this.message.splice(d+1,b.length),b}getWord(a=0,b=1){let c=[],d=a;for(d=a;;d+=b){if(!this.message[d]||" "===this.message[d].char){0===c.length&&this.message[d]&&(c.push(this.message[d]),this.message.splice(d,1));break}b>0?(c.push(this.message[d]),this.message.splice(d,1),d-=b):(c.splice(0,0,this.message[d]),this.message.splice(d,1))}return c}getWordAtIndex(a){let b=[];for(let c=a;c<this.message.length&&" "!==this.message[c].char;c++)b.push(this.message[c]);for(let d=a-1;d>=0&&" "!==this.message[d].char;d--)b.splice(0,0,this.message[d]);return b}wordSize(a=0,b=-1){let c=0,d=a;for(;d>=0&&d<this.message.length;){if(" "===this.message[d].char){0===c&&(c=this.message[d].charSize);break}c+=this.message[d].charSize,d+=b}return(d<0||d>=this.message.length)&&!this.endLine?this.message[a]?this.message[a].charSize:999999999:0===c?999999999:c}spaceLeft(a){return a-this.nextChar3DPos.x}popChar(a=this.message.length-1){return this.nextChar3DPos.x-=this.message[a].charSize,this.message.splice(a,1)}isEmpty(){return!this.message.length}updateNextCharPosY(){this.nextChar3DPos.y=this.yLinePos+this.maxCharSize*this.lineHeight}updateYLinePos(a){this.yLinePos=a,this.updateNextCharPosY()}updatelineHeight(a){this.lineHeight=a,this.updateNextCharPosY()}updateFontSize(a,b=0,c=this.message.length-1){for(let d=b;d<=c;d+=1)this.message[d].updateFontSize(a);this.maxCharSize=a,this.nextChar3DPos.y=this.yLinePos+this.maxCharSize*this.lineHeight}countSpaces(){let a=0;for(let b=0;b<this.message.length;b++)" "===this.message[b].char&&(a+=1);return a}alignText(a,b,c,d,e){switch(c){case 1:this.leftAlign(a,e);break;case 3:this.centerAlign(this.spaceLeft(b),a,e);break;case 2:this.rightAlign(this.spaceLeft(b),a,e);break;case 4:this.justifyAlign(this.spaceLeft(b),a,e)}}offsetCharacters(a,b,c){ni.set(b,c);let d=this.message.length;for(let e=0;e<d;e++)this.message[e].updatePosition(this.message[e].localPosition.add(ni),a)}leftAlign(a,b){this.align=1,this.offsetCharacters(a,0,b)}centerAlign(a,b,c){this.align=3,this.offsetCharacters(b,a/2,c)}rightAlign(a,b,c){this.align=2,this.offsetCharacters(b,a,c)}justifyAlign(a,b,c){if(this.align=4,this.endLine){this.offsetCharacters(b,0,c);return}let d=this.countSpaces();if(0===d){this.offsetCharacters(b,0,c);return}let e=a/d,f=0;for(let g=0;g<this.message.length;g++)" "===this.message[g].char&&(f+=e),ni.set(f,c),this.message[g].updatePosition(this.message[g].localPosition.add(ni),b)}clone(){let a=new nj(this.yLinePos,this.lineHeight,this.maxCharSize);a.nextChar3DPos=this.nextChar3DPos.clone(),a.align=this.align,a.endLine=this.endLine;for(let b=0;b<this.message.length;b++)a.message.push(this.message[b].clone());return a}},nk=class extends mh{constructor(a){super(a,new h.MeshBasicMaterial({transparent:!0,opacity:1,visible:!1,side:h.DoubleSide})),this.objectType="TextFrame",this.charContainer=new h.Object3D,this.add(this.charContainer),this.material.visible=!1,this._geometryUserData=a.userData,this.userData.textFrame={hexColor:null,opacity:1,visible:!0,text:"",fontSize:16,lineHeight:1.5,letterSpacing:1,fontFamily:"roboto_regular",textTransform:1,horizontalAlignment:1,verticalAlignment:1,LOD:16,maxLineSize:this._geometryUserData.parameters.width,textOrigin:new h.Vector3(-.5*this._geometryUserData.parameters.width,.5*this._geometryUserData.parameters.height,0),textLines:[]},this.createTextLine()}static createFromState(a,b,c){let d=iQ.create({parameters:{width:b.width,height:b.height}}),e=new nk(d).fromState(b,c);return e.uuid=a,e}async updateText(a){this.clearText();let b=this.userData.textFrame,c=b.fontFamily;await nh.loadFont(c),b.text=a;let d=b.textOrigin,e=new h.MeshBasicMaterial({visible:b.visible,transparent:!0,side:h.DoubleSide}),f=a.split(`
`),g=0;this.userData.textFrame.textLines=f.map((a,f)=>{let h=new nj(g,b.lineHeight,b.fontSize);return h.message=a.split("").map(a=>{let f={char:a,fontFamily:c,letterSpacing:b.letterSpacing,fontSize:b.fontSize,LOD:16},g=e.clone();g.color=b.hexColor,g.opacity=b.opacity;let i=new nh(f,g);return h.addChar3D(i,d),this.charContainer.add(i),i}),g+=h.maxCharSize*h.lineHeight,h}),this.textFullUpdate(),this.checkOverFlow()}clearText(){let a=this.userData.textFrame.textLines;for(;this.charContainer.children.length;){let b=this.charContainer.children[0];this.charContainer.remove(b)}for(;a.length;)a.pop()}raycast(a,b){let c=[];if(super.raycast(a,c),c.length>0){b.push(c[0]);return}let d=[];for(let e=0,f=this.charContainer.children.length;e<f;++e)if(this.charContainer.children[e]instanceof nh&&(a.intersectObject(this.charContainer.children[e],!1,d),d.length>0)){d[0].object=this,b.push(d[0]);return}}updateGeometry(a){let b=this.userData,c=this.geometry.userData,d=c.parameters.width,e=c.parameters.height,f=a.parameters?.width??d,g=a.parameters?.height??e,h=b.textFrame;super.updateGeometry(a),h.maxLineSize=f,h.textOrigin.set(-.5*f,.5*g,0),g!==e?(this.checkOverFlow(),this.checkCapacity()):f!==d&&(d<f?this.checkCapacity():d>f&&this.checkOverFlow())}checkOverFlow(a=0){let b=this.userData,c=b.textFrame.textOrigin,d=b.textFrame.textLines;for(let e=a;e<d.length;e++){d[e].updateYLinePos(this.getNewLinePosition(e)),d[e].fullUpdate(c);let f=[];for(;d[e].checkOverFlow(b.textFrame.maxLineSize);)d[e].containSpaceOverFlow()?f.unshift(d[e].getWord(d[e].message.length-1,-1)):f.unshift(d[e].popChar());if(f.length>0){void 0===d[e+1]?(d[e].isEndLine(!1),this.createTextLine()):d[e].endLine&&(this.createTextLine(e+1),d[e].isEndLine(!1),d[e+1].isEndLine(!0));let g=0;for(let h=0;h<f.length;h+=1)for(let i=0;i<f[h].length;i+=1)d[e+1].addChar3D(f[h][i],c,g),g+=1;d[e+1].fullUpdate(c)}d[e].fullUpdate(c)}this.textFullUpdate(a)}checkCapacity(a=0){let b=this.userData,c=b.textFrame.textOrigin,d=b.textFrame.maxLineSize,e=b.textFrame.textLines;for(let f=a;f<e.length;f+=1)if(e[f].updateYLinePos(this.getNewLinePosition(f)),e[f].fullUpdate(c),e[f-1])for(;!e[f-1].endLine;){let g,h=e[f-1].spaceLeft(d);if(e[f].wordSize(0,1)<=h){g=e[f].containSpace()?e[f].getWord(0,1):e[f].popChar(0);for(let i=0;i<g.length;i+=1)g[i]&&e[f-1].addChar3D(g[i],c)}else{e[f].isEmpty()?(e[f].endLine&&e[f-1].isEndLine(!0),e.splice(f,1),f-=1):(e[f].updateYLinePos(this.getNewLinePosition(f)),e[f].fullUpdate(c));break}}this.textFullUpdate(a)}createTextLine(a=this.userData.textFrame.textLines.length){let b=this.userData.textFrame;b.textLines.splice(a,0,new nj(this.getNewLinePosition(a),b.lineHeight,b.fontSize))}textFullUpdate(a=0){let b=this.userData.textFrame,c=b.textLines,d=this.getVerticalAlignmentOffSet();for(let e=a;e<c.length;e++)c[e].updateYLinePos(this.getNewLinePosition(e)),c[e].fullUpdate(b.textOrigin),c[e].alignText(b.textOrigin,b.maxLineSize,b.horizontalAlignment,b.verticalAlignment,d)}getVerticalAlignmentOffSet(){switch(this.userData.textFrame.verticalAlignment){case 1:default:return 0;case 2:return this.getRemainingVerticalSpace()/2;case 3:return this.getRemainingVerticalSpace()}}getRemainingVerticalSpace(){let a=this.userData.textFrame.textLines;return this.geometry.userData.parameters.height-this.getNewLinePosition(a.length)}getNewLinePosition(a){let b=this.userData.textFrame.textLines,c=0;for(let d=0;d<a;d+=1)c+=b[d].maxCharSize*b[d].lineHeight;return c}updateColor(a){let b=this.userData;b.textFrame.hexColor=a;let c=b.textFrame.textLines;for(let d=0;d<c.length;d++){let e=c[d].message;for(let f=0;f<e.length;f++){let g=e[f].material;g.color?.isColor&&(g.color=a)}}}updateOpacity(a){let b=this.userData;b.textFrame.opacity=a;let c=b.textFrame.textLines;for(let d=0;d<c.length;d++){let e=c[d].message;for(let f=0;f<e.length;f++)e[f].material.opacity=a}}updateVisible(a){let b=this.userData;b.textFrame.visible=a;let c=b.textFrame.textLines;for(let d=0;d<c.length;d++){let e=c[d].message;for(let f=0;f<e.length;f++)e[f].material.visible=a}}async updateFontFamily(a){await nh.loadFont(a);let b=this.userData.textFrame,c=b.textLines;b.fontFamily=a;for(let d=0;d<c.length;d++){let e=c[d].message;for(let f=0;f<e.length;f++)e[f].updateFontFamily(a)}this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity()}updateFontSize(a){let b=this.userData.textFrame,c=b.textLines,d=b.fontSize;b.fontSize=a;for(let e=0;e<c.length;e++)c[e].updateFontSize(a);this.textFullUpdate(),a>d?this.checkOverFlow():a<d&&this.checkCapacity()}async updateTextTransform(a){let b=this.userData.textFrame;await nh.loadFont(b.fontFamily);let c=b.textLines;switch(b.textTransform=a,a){case 2:for(let d=0;d<c.length;d++){let e=c[d].message;for(let f=0;f<e.length;f++)c[d].message[f].updateChar(e[f].char.toUpperCase())}break;case 3:for(let g=0;g<c.length;g++){let h=c[g].message;for(let i=0;i<h.length;i++)c[g].message[i].updateChar(h[i].char.toLowerCase())}break;default:for(let j=0;j<c.length;j++){let k=c[j].message;for(let l=0;l<k.length;l++)c[j].message[l].updateChar(k[l].originalChar)}}this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity()}updateLetterSpacing(a){let b=this.userData,c=b.textFrame.textLines;b.textFrame.letterSpacing=a;for(let d=0;d<c.length;d++){let e=c[d].message;for(let f=0;f<e.length;f++)e[f].updateLetterSpacing(a)}this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity()}updateLOD(a){let b=this.userData;b.textFrame.LOD=a;let c=b.textFrame.textLines;for(let d=0;d<c.length;d++);this.textFullUpdate(),this.checkOverFlow(),this.checkCapacity()}updateLineHeight(a){let b=this.userData,c=b.textFrame.textLines;b.textFrame.lineHeight=a;for(let d=0;d<c.length;d++)c[d].updatelineHeight(a);this.textFullUpdate()}updateVerticalAlignment(a){this.userData.textFrame.verticalAlignment=a,this.textFullUpdate()}updateHorizontalAlignment(a){this.userData.textFrame.horizontalAlignment=a,this.textFullUpdate()}fromTextFrameData(a,b){if(void 0!==a.color){let c=jh(a.color,b);this.updateColor(c),this.updateOpacity(c.a)}void 0!==a.alpha&&this.updateOpacity(a.alpha),void 0!==a.font&&this.updateFontFamily(a.font),void 0!==a.horizontalAlign&&this.updateHorizontalAlignment(a.horizontalAlign),void 0!==a.verticalAlign&&this.updateVerticalAlignment(a.verticalAlign),void 0!==a.textTransform&&this.updateTextTransform(a.textTransform),void 0!==a.fontSize&&this.updateFontSize(a.fontSize),void 0!==a.lineHeight&&this.updateLineHeight(a.lineHeight),void 0!==a.letterSpacing&&this.updateLetterSpacing(a.letterSpacing),void 0!==a.text&&""!==a.text&&this.updateText(a.text),(void 0!==a.width|| void 0!==a.height)&&this.updateGeometry({parameters:{width:a.width,height:a.height}})}fromState(a,b){return super.fromState(a),this.fromTextFrameData(a,b),this}},nl=nk;nl.VerticalAlign=gC,nl.HorizontalAlign=gB,nl.TextTransform=gD;var nm=class extends me{},nn=w(x()),no=new Map,np=class{constructor({src:a,volume:b,delay:c,loop:d}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._isStarted=!1,this.onEnd=()=>{this._loop>1?this.loopsRemaining===1/0?this.play():this.loopsRemaining>1?(this.play(),this.loopsRemaining--):this._isStarted=!1:this._isStarted=!1};let e;e="string"==typeof a?{src:a}:{src:function(a){if("string"==typeof a)return a;let b=no.get(a);return b||(b={url:URL.createObjectURL(new Blob([a]))},no.set(a,b)),b.url}(a),format:"wav"},this.sound=new nn.Howl(e),this.sound.on("end",this.onEnd),this._src=a,void 0!==b&&(this.volume=b),void 0!==c&&(this.delay=c),void 0!==d&&(this.loop=d)}get src(){return this._src}get isStarted(){return this._isStarted}get volume(){return this._volume}set volume(a){this._volume=a,this.sound.volume(a)}get loop(){return this._loop}set loop(a){this._loop=a,this.loopsRemaining=a}fade(a,b=1e3){a?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,b),this.clearFade()},a)):this.sound.fade(this._volume,0,b)}on(a,b,c){this.sound.on(a,b,c)}off(a,b,c){this.sound.off(a,b,c)}play(){this._isStarted=!0,this.delay?(this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)):this.sound.play()}pause(){this._isStarted=!1,this.sound.pause(),this.clearFade(),this.clearDelay()}stop(){this._isStarted=!1,this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay()}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(a=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},nq=class{constructor(a,b={}){if(this.deletedMaterial=new nm(iX.defaultTwoLayerData("basic"),this),this.deletedImage=new lQ(ja.emptyImage),this.materials={},this.images={},this.colors={},this.audios={},this.penumbraSize=[],this.onImageLoad=()=>{this._onImageLoad&&this._onImageLoad()},b.images)for(let[c,d]of Object.entries(b.images))this.addImage(c,d);if(b.audios)for(let[e,f]of Object.entries(b.audios))this.addAudio(e,f.data);this.reset(a)}setOnImageLoad(a){this._onImageLoad=a}reset(a){for(let[b,c]of Object.entries(a.images))this.addImage(b,c);for(let[d,e]of Object.entries(a.colors))this.addColor(d,e);for(let[f,g]of Object.entries(a.materials))this.addMaterial(f,new nm(g,this));for(let[h,i]of Object.entries(a.audios))this.addAudio(h,i.data);this.penumbraSize=a.penumbraSize}addMaterial(a,b){b.uuid=a,this.materials[a]=b}deleteMaterial(a){this.materials[a]&&(this.materials[a].dispose(),delete this.materials[a])}getMaterial(a){return this.materials[a]}getMaterialOrDeletedPlaceholder(a){return this.materials[a]??this.deletedMaterial}material(a){return"string"==typeof a?this.getMaterialOrDeletedPlaceholder(a):new me(a,this)}getMaterials(){return this.materials}addImage(a,b){return this.images[a]?(this.images[a].updateSrc(b.data),!0):(this.images[a]=new lQ(b,this.onImageLoad),!1)}deleteImage(a){this.images[a]&&delete this.images[a]}getDefaultImage(){return this.images.image_0}getImage(a){return this.images[a]??this.deletedImage}image(a){return"string"==typeof a?this.getImage(a):new lP(a,this.onImageLoad)}getImages(){return this.images}addColor(a,b){return this.colors[a]?("a"in b?this.colors[a].setRGBA(b.r,b.g,b.b,b.a):this.colors[a].setRGBA(b.r,b.g,b.b,1),!0):("a"in b?this.colors[a]=new lK(b.r,b.g,b.b,b.a):this.colors[a]=new lK(b.r,b.g,b.b,1),!1)}updateColor(a,b){if(this.colors[a]){let c=this.colors[a];return this.colors[a].r=b.r??c.r,this.colors[a].g=b.g??c.g,this.colors[a].b=b.b??c.b,this.colors[a].a=b.a??c.a,!0}return!1}deleteColor(a){this.colors[a]&&delete this.colors[a]}getColor(a){return this.colors[a]}color(a){let b;if("string"!=typeof a)return"a"in a?new g_(a.r,a.g,a.b,a.a):new g_(a.r,a.g,a.b,1);{let c=this.getColor(a);c?b=c:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),b=new g_(0,0,0,0))}return b}addAudio(a,b){this.audios[a]=b}getAudio(a){let b=this.audios[a];if(b instanceof np)return b;{let c=new np({src:b});return this.audios[a]=c,c}}deleteAudio(a){this.audios[a]&&delete this.audios[a]}dispose(){Object.keys(this.materials).forEach(a=>this.deleteMaterial(a)),this._onImageLoad=void 0,Object.values(this.audios).forEach(a=>{a instanceof np&&a.dispose()}),this.audios={}}};async function nr(a){if(f){let b={attributeIDs:f.defaultAttributeIDs,attributeTypes:f.defaultAttributeTypes,useUniqueIDs:!1},c;try{c=await f.decodeGeometry(new Int8Array(a).buffer,b)}catch(d){console.error(d)}if(c)return{index:c.index?{array:c.index.array}:void 0,attributes:Object.entries(c.attributes).map(([a,b])=>({name:a,itemSize:b.itemSize,array:b.array}))}}return null}async function ns(a,b){var c,d,e,g,h,i,k,l,m;let[n,o]=eO(gt.deserialize(new Uint8Array(a))),p,q;18!==(p=(c=n).schema??0)&&(console.warn("updating from ",p,"to ",18),p<1&&(gW(c,gU),gV(c,gU),c.schema=1),p<2&&(Object.assign((d=c).scene.publish,{orbitControls:{...i8.defaultData,...eQ(d.scene.publish.orbitControls)}}),c.schema=2),p<3&&(function(a){function b(a){if(a.layers){for(let b of Object.values(a.layers))if(b){for(let[c,d]of Object.entries(b))if((gS.includes(c)||"boolean"==typeof d)&&delete b[c],"texture"===c)for(let[e,f]of Object.entries(d))(gT.includes(e)||"boolean"==typeof f)&&delete d[e]}}}a.scene.objects.traverse((a,c)=>{c.states.forEach(a=>{let c=a;c.material?b(c.material):c.materials&&c.materials.forEach(a=>{b(a)})})})}(c),c.schema=3),p<4&&(c.scene.publish.withBackground=!0,c.schema=4),p<5&&(c.scene.publish.settings.web={compress:!0,preload:!0,preset:1},c.schema=5),p<6&&(function(a){a.scene.objects.traverse((a,b)=>{let c=b.cloner;c&&(c.radial.scale=c.radial.scale.map(a=>a+1),c.linear.scale=c.linear.scale.map(a=>a+1))})}(c),c.schema=6),p<7&&(function(a){a.scene.objects.traverse((a,b)=>{let c=b.geometry;c&&("DodecahedronGeometry"===c.type||"IcosahedronGeometry"===c.type)&&(c.detail=Math.round(c.detail))})}(c),c.schema=7),p<8&&(function(a){a.scene.objects.traverse((b,c)=>{let d=a.scene.objects.parent(b);"Mesh"!==c.type||d&&a.scene.objects.data(d).geometry?.type==="BooleanGeometry"||(c.booleanExclude=null)})}(c),c.schema=8),p<9&&(gZ(c),c.schema=9),p<10&&(function(a){a.scene.objects.traverse((a,b)=>{"Mesh"===b.type&&("BooleanGeometry"===b.geometry.type||"SubdivGeometry"===b.geometry.type)&&(b.geometry.phongAngle=35)})}(c),c.schema=10),p<11&&((h=c).scene.environment.ambientLight.softShadows=!1,h.scene.environment.ambientLight.softShadowQuality="low",h.scene.objects.traverse((a,b)=>{("DirectionalLight"===b.type||"SpotLight"===b.type)&&(b.shadowResolution=1024,b.shadowRadius=1,b.depth=1e5)}),h.shared.penumbraSize=[,,,,,].fill(.5),c.schema=11),p<12&&(gZ(c),c.schema=12),p<13&&(c.shared.audios=z({},er.prototype),c.schema=13),p<14&&(Object.entries(q=c.shared.materials).forEach(([a,b])=>{!b.layers&&Object.assign(q,{[a]:{name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"basic",alpha:1,visible:!0,mode:0},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]}})}),c.schema=14),p<15&&(Object.entries(eQ((l=c).shared.images)).filter(a=>!1===a[1].asset).map(a=>a[0]).forEach(a=>{delete l.shared.images[a]}),Object.entries(eQ(l.shared.audios)).filter(a=>!1===a[1].asset).map(a=>a[0]).forEach(a=>{delete l.shared.audios[a]}),c.schema=15),p<16&&(c.scene.publish.settings.web.preload=!1,c.schema=16),p<17&&(gW(c,g$),gV(c,g$),c.schema=17),p<18&&(gW(c,gX),gV(c,gX),c.schema=18));let r=[];for(let s of(n.scene.objects.traverse((a,b)=>{"Mesh"===b.type&&"NonParametricGeometry"===b.geometry.type&& void 0!==b.geometry.data.draco&&r.push(b)}),r.length&&await (f||(f=new j._).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),f.decoderPending),r)){let t=await nr(eQ(s.geometry.data.draco));if(t){t.index&&(s.geometry.data.index={array:t.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let u={};t.attributes.forEach(({name:a,array:b,itemSize:c})=>{u[a]={array:b,itemSize:c,type:"Float32Array",normalized:!1}}),s.geometry.data.attributes=u,s.geometry.data.draco=void 0}}return b&&b(n),o.result().data}new nq(i9.emptyData());var nt=w(y());jg.then(a=>{g=a});var nu=new h.Matrix4,nv=new h.Matrix4,nw=new h.Matrix4,nx=new h.Box3,ny=new h.Vector3,nz=new h.Matrix4,nA=new h.Matrix4,nB=class extends mh{constructor(a,b,c,d){super(c??b,d),this.subdivPointer=a,this.originalGeometry=b,this.subdividedGeometry=c,this.objectType="SubdivObject",this.hiddenMatrixOld=new h.Matrix4,this.smoothShading=!0,this.phongAngle=35,this.matrixWorldRigid=new h.Matrix4,this.castShadow=!0,this.receiveShadow=!0,this.forceComputeSize=!1}static createFromState(a,b,c){let{subdivPointer:d,originalGeometry:e,subdividedGeometry:f}=mr.build(b.geometry,void 0,void 0,!b.flatShading),g=c.material(b.material),h=new nB(d,e,f||void 0,g);return void 0!==b.geometry.phongAngle&&(h.phongAngle=b.geometry.phongAngle),h.calcBoundingBox(),h.freeSubdivPointer(),h.uuid=a,h.fromState(b),h}buildFromStore(a,b){let{originalGeometry:c,subdividedGeometry:d,subdivPointer:e}=mr.build(a,b,this.subdivPointer,this.smoothShading,this.shearScale);void 0!==a.phongAngle&&(this.phongAngle=a.phongAngle),this.subdivPointer=e,void 0!==c&&(this.originalGeometry?.dispose(),this.originalGeometry=c),void 0!==d&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=d??void 0),this.geometry=this.subdividedGeometry??this.originalGeometry,mf(this),mg(this),a.width&&(this.geometry.userData.parameters={width:a.width,height:a.height,depth:a.depth})}updateMesh(a=!1){mr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,a?this.shearScaleInv:void 0),this.subdividedGeometry&&mr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,a?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=mr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=mr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.geometry=this.subdividedGeometry??this.originalGeometry}raycast(a,b){this.geometry=this.originalGeometry,mh.prototype.raycast.call(this,a,b),this.geometry=this.subdividedGeometry??this.originalGeometry}updateMatrixWorldSVD(){let a=this.matrixWorld.elements,b=[[a[0],a[4],a[8]],[a[1],a[5],a[9]],[a[2],a[6],a[10]]],{u:c,v:d,q:e}=(0,nt.SVD)(b),f=nu.set(c[0][0],c[0][1],c[0][2],0,c[1][0],c[1][1],c[1][2],0,c[2][0],c[2][1],c[2][2],0,0,0,0,1),g=nv.set(d[0][0],d[0][1],d[0][2],0,d[1][0],d[1][1],d[1][2],0,d[2][0],d[2][1],d[2][2],0,0,0,0,1),h=nw.copy(g).transpose();this.shearScale=nz.makeScale(e[0],e[1],e[2]).multiply(h).premultiply(g),this.shearScaleInv=nA.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(f,h),e.every(a=>.01>Math.abs(e[0]-a))&&(this.shearScale=void 0,this.shearScaleInv=void 0)}activateSVDCompensation(){void 0!==this.shearScale&&(this.matrixAutoUpdate=!1,this.matrix.copy(this.matrixWorldRigid).copyPosition(this.matrixWorld),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){void 0!==this.shearScale&&(this.shearScale=void 0,this.shearScaleInv=void 0,this.matrixAutoUpdate=!0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let a=this.originalGeometry;null===a.boundingSphere&&(a.boundingSphere=new h.Sphere);let b=a.attributes.position,c=a.boundingSphere.center;nx.setFromBufferAttribute(b),nx.getCenter(c),a.boundingSphere.radius=c.distanceTo(nx.max),isNaN(a.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),nx.getSize(ny);let d={width:ny.x,height:ny.y,depth:ny.z};return this.geometry.userData.parameters=d,d}updateBoundingBox(a){let b=this.originalGeometry;nx.min.set(a[0],a[2],a[4]),nx.max.set(a[1],a[3],a[5]),this.shearScaleInv&&(nx.min.applyMatrix4(this.shearScaleInv),nx.max.applyMatrix4(this.shearScaleInv)),null===b.boundingSphere&&(b.boundingSphere=new h.Sphere);let c=b.boundingSphere.center;nx.getCenter(c),b.boundingSphere.radius=c.distanceTo(nx.max),isNaN(b.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),nx.getSize(ny);let d={width:ny.x,height:ny.y,depth:ny.z};return this.geometry.userData.parameters=d,d}freeSubdivPointer(){this.subdivPointer&&(g.free_bvh(this.subdivPointer),g.free_subdivision_surface(this.subdivPointer),this.subdivPointer=0)}updateGeometry(a){this.geometry.userData.scale||(this.geometry.userData.scale=[,,,]),this.geometry.userData.scale[0]=0===this.geometry.userData.parameters.width?1:a.parameters.width/this.geometry.userData.parameters.width,this.geometry.userData.scale[1]=0===this.geometry.userData.parameters.height?1:a.parameters.height/this.geometry.userData.parameters.height,this.geometry.userData.scale[2]=0===this.geometry.userData.parameters.depth?1:a.parameters.depth/this.geometry.userData.parameters.depth,nC(this.originalGeometry.attributes,...this.geometry.userData.scale),this.originalGeometry.attributes.position.needsUpdate=!0,this.originalGeometry.attributes.normal.needsUpdate=!0,this.subdividedGeometry&&(nC(this.subdividedGeometry.attributes,...this.subdividedGeometry.userData.scale),this.subdividedGeometry.attributes.position.needsUpdate=!0,this.subdividedGeometry.attributes.normal.needsUpdate=!0),this.geometry.userData.parameters={...a.parameters}}};function nC(a,b,c,d){let e=a.position.array,f=a.normal.array,g=nu.makeScale(b,c,d).invert().elements,h,i,j;for(var k=0,l=e.length;k<l;k+=3)e[k]*=b,e[k+1]*=c,e[k+2]*=d,h=f[k],i=f[k+1],j=f[k+2],f[k]=g[0]*h+g[4]*i+g[8]*j,f[k+1]=g[1]*h+g[5]*i+g[9]*j,f[k+2]=g[2]*h+g[6]*i+g[10]*j}function nD(a,b){void 0!==b.flatShading&&(a.flatShading=b.flatShading,a.needsUpdate=!0),void 0!==b.wireframe&&(a.wireframe=b.wireframe),void 0!==b.side&&(0===b.side?a.side=h.FrontSide:1===b.side?a.side=h.BackSide:a.side=h.DoubleSide)}function nE(a,b){let c=!1,d=b.getLayersOfType("transmission"),e=b.getLayersOfType("outline");return e.length>0&&(a.layers.set(8),d.length>0&&a.layers.enable(3),c=!0,mg(a),mf(a)),0===d.length&&0===e.length&&a.layers.set(0),c}function nF(a,b){if(!b.layers)return!1;let c=!1,d=b.getLayersOfType("transmission"),e=b.getLayersOfType("outline");return d.length>0&&(a.layers.set(3),e.length>0&&a.layers.enable(8),c=!0),0===d.length&&0===e.length&&a.layers.set(0),c}var nG=new h.Raycaster,nH=new h.Matrix4,nI=new h.Ray;function nJ(a,b,c){let d=a.cloner;if(d)for(let e of d.children){let f=nH.copy(e.matrixWorld).invert(),g=nI.copy(b.ray).applyMatrix4(f),h=a.matrixWorld;g.applyMatrix4(h);let i=nG;i.set(g.origin,g.direction),i.near=b.near,i.far=b.far,i.intersectObject(a,!1).length>0&&c.push({object:a})}}var nK=new h.Vector3,nL=class extends jn(h.Scene){constructor(a,b){super(),this.objectType="Scene",this.backupFog=new h.Fog(16777215,.1,2e3),this.fogUseBGColor=!1,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.bgColor=new g_(1,1,1,1),this.entityByUuid={},this.ambientLight=new h.HemisphereLight(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.personalCamera=this.createPersonalCamera(),this.activeCamera=this.personalCamera,this.postprocessing=a.postprocessing,this.init(a,b)}needsTransmission(){var a;let b;return this.needsTransmissionDirty&&(this._needsTransmission=(a=this,b=!1,a.traverseEntity(a=>{if(a instanceof h.Mesh){if(Array.isArray(a.material))for(let c=0;c<a.material.length;c++)nF(a,a.material[c])&&(b=!0);else nF(a,a.material)&&(b=!0)}}),b),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){var a;let b;return this.needsNormalDirty&&(this._needsNormal=(a=this,b=!1,a.traverseEntity(a=>{if(a instanceof h.Mesh&&"TextFrame"!==a.objectType){if(Array.isArray(a.material))for(let c=0;c<a.material.length;c++)nE(a,a.material[c])&&(b=!0);else nE(a,a.material)&&(b=!0)}}),b),this.needsNormalDirty=!1),this._needsNormal}find(a){if(""===a|| void 0===a)return;let b=this.entityByUuid[a];return void 0===b?this.getObjectByProperty("uuid",a):b}get enableFog(){return null!==this.fog}set enableFog(a){this.fog=!0===a?this.backupFog:null}init(a,b){if(this.createChildrenObjects(a.objects,this,b),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor(jh(a.backgroundColor,b)),this.updateFog(a.fog,b),this.updateAmbientLight(a.environment.ambientLight,b),this.activeCamera=this.personalCamera,null!==a.publish.playCamera){let c=this.find(a.publish.playCamera);c instanceof m3&&this.switchActiveCamera(c)}this.traverse(a=>{jk(a)&&a.recomputeBoolean()})}clearScene(){for(let a of(this.traverseEntity(a=>{var b;"material"in(b=a)&&function a(b){var c;(Array.isArray(c=b)?c:[c]).forEach(a=>{a instanceof nm||a.dispose()})}(b.material),"geometry"in b&&b.geometry.dispose()}),this.children))jx(a)&&a.removeFromParent()}resetAfterClear(a,b){this.init(a,b)}createPersonalCamera(){let a=m3.createFromState(nL.PERSONAL_CAMERA_ID,{...i4.defaultData,name:"Personal Camera"});return a.objectHelper.visible=!1,delete a.isEntity,this.registerObjectCreatedInLegacy(a),a}raycast(a){let b=[],c=d=>{for(let e of d.children)jx(e)&&!e.raycastLock&&e.visible&&((jj(e)||jm(e)&&this.enableHelpers&&e.objectHelper.visible)&&(a.intersectObject(e,!1,b),nJ(e,a,b)),c(e))};return c(this),b}traverseEntity(a){for(let b of this.children)jx(b)&&b.traverseEntity(a)}traverseVisibleEntity(a){for(let b of this.children)jx(b)&&b.visible&&b.traverseVisibleEntity(a)}updateFog(a,b){this.enableFog=a.enabled,this.fogUseBGColor=a.useBackgroundColor,a.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=jh(a.color,b),this.backupFog.near=a.near,this.backupFog.far=a.far}dispose(){this.clearScene()}updateAmbientLight(a,b){var c,d,e,f,g,i,j;let k;c=this.ambientLight,d=a,e=b,f=c,g=d,i=f,k=!1,(j=g).position&&(i.position.fromArray(j.position),k=!0),j.rotation&&(i.rotation.fromArray(j.rotation),k=!0),j.scale&&(k=!0,i.scale.fromArray(j.scale)),void 0!==j.hiddenMatrix&&"hiddenMatrix"in i&&(k=!0,i.hiddenMatrix.fromArray(j.hiddenMatrix??eZ.identity)),k&&(i.updateMatrix(),jk(i.parent)&&jj(i)&&i.invalidateDownstreamBooleanData(!0).recomputeBoolean()),j.position&&j.rotation&&j.scale&& void 0!==j.hiddenMatrix&&i.updateWorldMatrix(!1,!0),"CombinedCamera"===i.objectType&&(void 0!==j.isUpVectorFlipped&&(i.isUpVectorFlipped=j.isUpVectorFlipped),i.updateUp()),void 0!==g.name&&(f.name=g.name),void 0!==g.visible&&(f.visible=g.visible),void 0!==d.color&&(c.color=jh(d.color,e)),void 0!==d.intensity&&(c.intensity=d.intensity),void 0===d.shadows||c instanceof h.HemisphereLight||(c.castShadow=d.shadows),!c.shadow||c instanceof h.HemisphereLight|| void 0===d.depth||(c.shadow.camera.far=d.depth,c.shadow.needsUpdate=!0),void 0!==a.groundColor&&(this.ambientLight.groundColor=jh(a.groundColor,b)),void 0!==a.enabled&&(this.ambientLight.visible=a.enabled)}switchActiveCamera(a){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=a,a.objectHelper.visible=!1}setBackgroundColor(a){this.bgColor=a,!0===this.fogUseBGColor&&(this.backupFog.color=a)}createChildrenObjects(a,b,c){for(let d of a)this.createChildObject(d.id,d.data,d.children,b,c)}registerObjectCreatedInLegacy(a){this.entityByUuid[a.uuid]=a}unregisterObject(a){for(let b of(delete this.entityByUuid[a.uuid],a.children))this.unregisterObject(b)}createChildObject(a,b,c,d,e){var f,g,i;let j=(f=a,g=b,i=e,"Mesh"===g.type?function(a,b,c){let d;if("SubdivGeometry"===b.geometry.type)d=nB.createFromState(a,b,c);else{var e,f;let g="BooleanGeometry"===b.geometry.type?new h.BufferGeometry:(e=b.geometry,mn(e)),i="materials"in b?b.materials.map(a=>c.material(a)):c.material(b.material);iZ.is2DParametricMesh(g.userData.type)?d=new nd(g,i):"VectorGeometry"===g?.userData.type?d=new mm(g,i):"NonParametricGeometry"===b.geometry.type?d=new nf(g,i):"BooleanGeometry"===b.geometry.type?((d=new mM(void 0,i)).booleanOp=b.geometry.operation,void 0!==b.geometry.phongAngle&&(d.phongAngle=b.geometry.phongAngle)):d=new ne(g,i),d.uuid=a,d.fromState(b,c)}return function(a,b){if(Array.isArray(a.material))for(let c of a.material)nD(c,b);else nD(a.material,b);"SubdivObject"===a.objectType&& void 0!==b.flatShading&&(a.material.flatShading=!1,a.smoothShading=!b.flatShading,a.updateMesh())}(d,b),d}(f,g,i):"TextFrame"===g.type?nl.createFromState(f,g,i):"Empty"===g.type?m4.createFromState(f,g):"PointLight"===g.type?m6.createFromState(f,g,i):"SpotLight"===g.type?na.createFromState(f,g,i):"DirectionalLight"===g.type?m5.createFromState(f,g,i):eU.is(g.type)?m3.createFromState(f,g):(console.error(g),new m4));return j&&(this.entityByUuid[a]=j,d.add(j),jk(d)&&jj(j)&&(j.prevBooleanObjectParent=d),this.createChildrenObjects(c,j,e)),j}getCenter(a){let b=[];for(let c=0,d=a.length;c<d;++c){let{id:e,recursive:f}=a[c],g=this.find(e),i=f?g.recursiveBBox:g.singleBBox;b.push(...i.vertices)}let j=new h.Box3;return j.setFromPoints(b),j.getCenter(nK),nK}copyMatrixWorld(a,b){if(null===a){b.identity();return}let c=this.find(a);c?b.copy(c.matrixWorld):b.identity()}copyParentMatrixWorld(a,b){if(null===a){b.identity();return}let c=this.find(a)?.parent;c?b.copy(c.matrixWorld):b.identity()}traverseMaterial(a){this.traverseEntity(b=>{if(b instanceof mh){if(Array.isArray(b.material))for(let c=0;c<b.material.length;c++)b.material[c]instanceof me&&a(b.material[c]);else b.material instanceof me&&a(b.material)}})}updateCanvasSize(a,b){this.activeCamera.setViewplaneSize(a,b);let c,d;a>=b?(c=b/a,d=1):(c=1,d=a/b),this.traverseMaterial(a=>{a.getLayersOfType("transmission").forEach(a=>{a.uniforms[`f${a.id}_aspectRatio`].value.x=c,a.uniforms[`f${a.id}_aspectRatio`].value.y=d})})}},nM=nL;nM.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera";function nN(a){Object.values(a.shared.materials).forEach(a=>{nO(a)}),a.scene.objects.traverse((a,b)=>{"material"in b?nO(b.material):"materials"in b&&b.materials.forEach(a=>{nO(a)})})}function nO(a){if("string"==typeof a)return;let b=[];a.layers.forEach((a,c)=>{"outline"===a.type&&b.push(c)}),b.reverse().forEach(b=>{a.layers.delete(b)}),b.length&&console.warn("The Spline Loader currently does not support the outline layer.")}var nP="The SplineLoader only accepts .splinecode files that are generated from Spline export panel.",nQ=class extends h.Loader{load(a,b,c,d=console.error){let e=new h.FileLoader(this.manager);e.setPath(this.path),e.setResponseType("arraybuffer"),e.setRequestHeader(this.requestHeader),e.setWithCredentials(this.withCredentials),a.endsWith(".spline")?console.warn(nP+" The .spline files are only meant to be used by the Editor."):a.endsWith(".splinecode")||console.warn(nP),e.load(a,async a=>{try{if("string"==typeof a)throw Error("The .spline file is not binary!");let c=await this.parse(a);b(c)}catch(e){d(e)}},c,d)}async parse(a){var b,c,d,e,f;let g=await ns(a,nN),i=new nq(g.shared);Object.values(i.getMaterials()).forEach(a=>Object.assign(a,{isAsset:!0}));let j=new nM(g.scene,i);j.remove(j.personalCamera),g.scene.environment.ambientLight.enabled||j.remove(j.ambientLight);let l=g.scene.publish.playCamera;if(l){let m=j.find(l);m&&jl(m)&&Object.assign(m,{makeDefault:!0})}let n,o,p,q;return(f=j=(e=j=((d=j=(c=j=(n=[],(b=j).traverse(a=>{a instanceof jC&&n.push(a)}),n.forEach(a=>{let b=a.object,c=a.children.map(a=>{a.updateMatrix();let b=a.geometry.clone().applyMatrix4(a.matrix);return 0>a.matrix.determinant()&&function(a){let b;if(a.index)for(let c=0;c<a.index.array.length;c+=3)b=a.index.array[c],a.index.array[c]=a.index.array[c+2],a.index.array[c+2]=b}(b),b}),d=(0,k.qf)(a.parameters.hideBase?c:[b.geometry,...c]);b.geometry=d,b.remove(a),b.cloner=void 0}),b),o=new Set,c.traverse(a=>{if(jj(a)){if(T(a.material))a.material.forEach(a=>{let b=a;o.has(b)||o.add(b)});else{let b=a.material;o.has(b)||o.add(b)}}}),o.forEach(a=>{var b,c;if(a instanceof Array)return;let d=a.onBeforeCompile.bind(a);if(b=a,b.getLayersOfType("transmission").length>0){Object.assign(a,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new h.Color,specularColor:new h.Color});let e=0;a.onBeforeCompile=(b,c)=>{d&&d(b,c),b.uniforms=Object.assign(h.ShaderLib.physical.uniforms,b.uniforms),a.getLayersOfType("transmission").forEach(c=>{if(b.uniforms.transmissionSamplerMap.value){let d=c.color;d&&(d.transmissionSamplerMap.value=b.uniforms.transmissionSamplerMap.value,d.transmissionSamplerSize.value=b.uniforms.transmissionSamplerSize.value)}else++e<2&&(a.needsUpdate=!0)})}}else{let f;c=a,f=0,c.layers.forEach(a=>{if("light"!==a.type&&"fresnel"!==a.type){let b=a.uniforms["f"+a.id+"_alpha"];b&&(f+=(1-f)*b.value)}}),f<1||(a.onBeforeCompile=(b,c)=>{d&&d(b,c),a.transparent=!1})}}),c)).traverse(a=>{if("Camera"===a.type){let b=a;b.type=b.cameraType}}),d),p=[],q=(a,b=0)=>{let c=b>0?a+b:a;return p.includes(c)?q(a,b+1):c},e.traverse(a=>{if(p.includes(a.name)){let b=a.name,c=q(a.name);if(a.name=c,a.isMesh){let d=a;d.material instanceof Array?d.material.forEach(a=>{a.name=a.name.replace(b,c)}):d.material.isAsset||(d.material.name=d.material.name.replace(b,c))}}p.push(a.name)}),e)).traverse(a=>{a.matrixAutoUpdate=!0}),f}}}}])